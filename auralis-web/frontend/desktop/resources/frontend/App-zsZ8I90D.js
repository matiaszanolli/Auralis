const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["DropZone-CTvoQMTE.js","vendor-ZvUuodmP.js","tokens-DlAeTiWz.js","assets/index-VS_9sDlP.js"])))=>i.map(i=>d[i]);
var Ld=Object.defineProperty;var va=e=>{throw TypeError(e)};var zd=(e,t,r)=>t in e?Ld(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;var B=(e,t,r)=>zd(e,typeof t!="symbol"?t+"":t,r),To=(e,t,r)=>t.has(e)||va("Cannot "+r);var w=(e,t,r)=>(To(e,t,"read from private field"),r?r.call(e):t.get(e)),G=(e,t,r)=>t.has(e)?va("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,r),z=(e,t,r,n)=>(To(e,t,"write to private field"),n?n.call(e,r):t.set(e,r),r),Y=(e,t,r)=>(To(e,t,"access private method"),r);var Cn=(e,t,r,n)=>({set _(o){z(e,t,o,r)},get _(){return w(e,t,n)}});import{r as g,j as a,b as Nd,T as Wd,C as Ud,k as ie,s as j,B as Hd,d as Qi,e as Vi,I as Gd,f as qd,S as Qd,g as Mt,h as Vd,D as As,i as Ki,l as tr,m as kr,n as Kd,L as Yd,o as Xd,R as q,p as Jd,u as ln,q as Et,t as P,v as so,w as Yi,A as Un,P as st,x as Zd,F as nt,y as _,z as ot,E as eu,G as tu,V as ru,H as nu,J as ou,K as su,M as au,N as cn,O as Xi,Q as Ds,U as ce,W as Rs,X as Ts,Y as ao,Z as io,_ as dn,$ as un,a0 as pn,a1 as he,a2 as Ms,a3 as iu,a4 as Xe,a5 as lu,a6 as at,a7 as Ji,a8 as Zi,a9 as el,aa as br,ab as lo,ac as $s,ad as Fs,ae as fe,af as co,ag as $t,ah as _s,ai as Os,aj as tl,ak as rl,al as nl,am as hn,an as be,ao as uo,ap as ol,aq as sl,ar as al,as as cu,at as At,au as Yo,av as du,aw as xt,ax as uu,ay as pu,az as hu,aA as fu,aB as Or,aC as Br,aD as Lr,aE as gu,aF as il,aG as ll,aH as mu,aI as cl,aJ as yu,aK as dl,aL as bu,aM as xu,aN as Su,aO as vu,aP as wu,aQ as Cu,aR as ku,aS as ju,aT as Pu,aU as Iu,aV as po,aW as Wr,aX as Eu,aY as Au,aZ as Du,a_ as Ru,a$ as Tu}from"./vendor-ZvUuodmP.js";import{t as s,w as wa}from"./tokens-DlAeTiWz.js";import{_ as Mu}from"./assets/index-VS_9sDlP.js";var fn=class{constructor(){this.listeners=new Set,this.subscribe=this.subscribe.bind(this)}subscribe(e){return this.listeners.add(e),this.onSubscribe(),()=>{this.listeners.delete(e),this.onUnsubscribe()}}hasListeners(){return this.listeners.size>0}onSubscribe(){}onUnsubscribe(){}},$u={setTimeout:(e,t)=>setTimeout(e,t),clearTimeout:e=>clearTimeout(e),setInterval:(e,t)=>setInterval(e,t),clearInterval:e=>clearInterval(e)},St,Es,Oi,Fu=(Oi=class{constructor(){G(this,St,$u);G(this,Es,!1)}setTimeoutProvider(e){z(this,St,e)}setTimeout(e,t){return w(this,St).setTimeout(e,t)}clearTimeout(e){w(this,St).clearTimeout(e)}setInterval(e,t){return w(this,St).setInterval(e,t)}clearInterval(e){w(this,St).clearInterval(e)}},St=new WeakMap,Es=new WeakMap,Oi),zt=new Fu;function _u(e){setTimeout(e,0)}var Xt=typeof window>"u"||"Deno"in globalThis;function Te(){}function Ou(e,t){return typeof e=="function"?e(t):e}function Xo(e){return typeof e=="number"&&e>=0&&e!==1/0}function ul(e,t){return Math.max(e+(t||0)-Date.now(),0)}function Dt(e,t){return typeof e=="function"?e(t):e}function Ue(e,t){return typeof e=="function"?e(t):e}function Ca(e,t){const{type:r="all",exact:n,fetchStatus:o,predicate:i,queryKey:l,stale:c}=e;if(l){if(n){if(t.queryHash!==Bs(l,t.options))return!1}else if(!Hr(t.queryKey,l))return!1}if(r!=="all"){const d=t.isActive();if(r==="active"&&!d||r==="inactive"&&d)return!1}return!(typeof c=="boolean"&&t.isStale()!==c||o&&o!==t.state.fetchStatus||i&&!i(t))}function ka(e,t){const{exact:r,status:n,predicate:o,mutationKey:i}=e;if(i){if(!t.options.mutationKey)return!1;if(r){if(Ur(t.options.mutationKey)!==Ur(i))return!1}else if(!Hr(t.options.mutationKey,i))return!1}return!(n&&t.state.status!==n||o&&!o(t))}function Bs(e,t){return((t==null?void 0:t.queryKeyHashFn)||Ur)(e)}function Ur(e){return JSON.stringify(e,(t,r)=>Zo(r)?Object.keys(r).sort().reduce((n,o)=>(n[o]=r[o],n),{}):r)}function Hr(e,t){return e===t?!0:typeof e!=typeof t?!1:e&&t&&typeof e=="object"&&typeof t=="object"?Object.keys(t).every(r=>Hr(e[r],t[r])):!1}var Bu=Object.prototype.hasOwnProperty;function pl(e,t){if(e===t)return e;const r=ja(e)&&ja(t);if(!r&&!(Zo(e)&&Zo(t)))return t;const o=(r?e:Object.keys(e)).length,i=r?t:Object.keys(t),l=i.length,c=r?new Array(l):{};let d=0;for(let u=0;u<l;u++){const f=r?u:i[u],p=e[f],h=t[f];if(p===h){c[f]=p,(r?u<o:Bu.call(e,f))&&d++;continue}if(p===null||h===null||typeof p!="object"||typeof h!="object"){c[f]=h;continue}const m=pl(p,h);c[f]=m,m===p&&d++}return o===l&&d===o?e:c}function Jo(e,t){if(!t||Object.keys(e).length!==Object.keys(t).length)return!1;for(const r in e)if(e[r]!==t[r])return!1;return!0}function ja(e){return Array.isArray(e)&&e.length===Object.keys(e).length}function Zo(e){if(!Pa(e))return!1;const t=e.constructor;if(t===void 0)return!0;const r=t.prototype;return!(!Pa(r)||!r.hasOwnProperty("isPrototypeOf")||Object.getPrototypeOf(e)!==Object.prototype)}function Pa(e){return Object.prototype.toString.call(e)==="[object Object]"}function Lu(e){return new Promise(t=>{zt.setTimeout(t,e)})}function es(e,t,r){return typeof r.structuralSharing=="function"?r.structuralSharing(e,t):r.structuralSharing!==!1?pl(e,t):t}function zu(e,t,r=0){const n=[...e,t];return r&&n.length>r?n.slice(1):n}function Nu(e,t,r=0){const n=[t,...e];return r&&n.length>r?n.slice(0,-1):n}var Ls=Symbol();function hl(e,t){return!e.queryFn&&(t!=null&&t.initialPromise)?()=>t.initialPromise:!e.queryFn||e.queryFn===Ls?()=>Promise.reject(new Error(`Missing queryFn: '${e.queryHash}'`)):e.queryFn}function Wu(e,t){return typeof e=="function"?e(...t):!!e}var Nt,vt,ar,Bi,Uu=(Bi=class extends fn{constructor(){super();G(this,Nt);G(this,vt);G(this,ar);z(this,ar,t=>{if(!Xt&&window.addEventListener){const r=()=>t();return window.addEventListener("visibilitychange",r,!1),()=>{window.removeEventListener("visibilitychange",r)}}})}onSubscribe(){w(this,vt)||this.setEventListener(w(this,ar))}onUnsubscribe(){var t;this.hasListeners()||((t=w(this,vt))==null||t.call(this),z(this,vt,void 0))}setEventListener(t){var r;z(this,ar,t),(r=w(this,vt))==null||r.call(this),z(this,vt,t(n=>{typeof n=="boolean"?this.setFocused(n):this.onFocus()}))}setFocused(t){w(this,Nt)!==t&&(z(this,Nt,t),this.onFocus())}onFocus(){const t=this.isFocused();this.listeners.forEach(r=>{r(t)})}isFocused(){var t;return typeof w(this,Nt)=="boolean"?w(this,Nt):((t=globalThis.document)==null?void 0:t.visibilityState)!=="hidden"}},Nt=new WeakMap,vt=new WeakMap,ar=new WeakMap,Bi),zs=new Uu;function ts(){let e,t;const r=new Promise((o,i)=>{e=o,t=i});r.status="pending",r.catch(()=>{});function n(o){Object.assign(r,o),delete r.resolve,delete r.reject}return r.resolve=o=>{n({status:"fulfilled",value:o}),e(o)},r.reject=o=>{n({status:"rejected",reason:o}),t(o)},r}var Hu=_u;function Gu(){let e=[],t=0,r=c=>{c()},n=c=>{c()},o=Hu;const i=c=>{t?e.push(c):o(()=>{r(c)})},l=()=>{const c=e;e=[],c.length&&o(()=>{n(()=>{c.forEach(d=>{r(d)})})})};return{batch:c=>{let d;t++;try{d=c()}finally{t--,t||l()}return d},batchCalls:c=>(...d)=>{i(()=>{c(...d)})},schedule:i,setNotifyFunction:c=>{r=c},setBatchNotifyFunction:c=>{n=c},setScheduler:c=>{o=c}}}var we=Gu(),ir,wt,lr,Li,qu=(Li=class extends fn{constructor(){super();G(this,ir,!0);G(this,wt);G(this,lr);z(this,lr,t=>{if(!Xt&&window.addEventListener){const r=()=>t(!0),n=()=>t(!1);return window.addEventListener("online",r,!1),window.addEventListener("offline",n,!1),()=>{window.removeEventListener("online",r),window.removeEventListener("offline",n)}}})}onSubscribe(){w(this,wt)||this.setEventListener(w(this,lr))}onUnsubscribe(){var t;this.hasListeners()||((t=w(this,wt))==null||t.call(this),z(this,wt,void 0))}setEventListener(t){var r;z(this,lr,t),(r=w(this,wt))==null||r.call(this),z(this,wt,t(this.setOnline.bind(this)))}setOnline(t){w(this,ir)!==t&&(z(this,ir,t),this.listeners.forEach(n=>{n(t)}))}isOnline(){return w(this,ir)}},ir=new WeakMap,wt=new WeakMap,lr=new WeakMap,Li),Hn=new qu;function Qu(e){return Math.min(1e3*2**e,3e4)}function fl(e){return(e??"online")==="online"?Hn.isOnline():!0}var rs=class extends Error{constructor(e){super("CancelledError"),this.revert=e==null?void 0:e.revert,this.silent=e==null?void 0:e.silent}};function gl(e){let t=!1,r=0,n;const o=ts(),i=()=>o.status!=="pending",l=b=>{var x;if(!i()){const S=new rs(b);h(S),(x=e.onCancel)==null||x.call(e,S)}},c=()=>{t=!0},d=()=>{t=!1},u=()=>zs.isFocused()&&(e.networkMode==="always"||Hn.isOnline())&&e.canRun(),f=()=>fl(e.networkMode)&&e.canRun(),p=b=>{i()||(n==null||n(),o.resolve(b))},h=b=>{i()||(n==null||n(),o.reject(b))},m=()=>new Promise(b=>{var x;n=S=>{(i()||u())&&b(S)},(x=e.onPause)==null||x.call(e)}).then(()=>{var b;n=void 0,i()||(b=e.onContinue)==null||b.call(e)}),y=()=>{if(i())return;let b;const x=r===0?e.initialPromise:void 0;try{b=x??e.fn()}catch(S){b=Promise.reject(S)}Promise.resolve(b).then(p).catch(S=>{var E;if(i())return;const v=e.retry??(Xt?0:3),k=e.retryDelay??Qu,C=typeof k=="function"?k(r,S):k,I=v===!0||typeof v=="number"&&r<v||typeof v=="function"&&v(r,S);if(t||!I){h(S);return}r++,(E=e.onFail)==null||E.call(e,r,S),Lu(C).then(()=>u()?void 0:m()).then(()=>{t?h(S):y()})})};return{promise:o,status:()=>o.status,cancel:l,continue:()=>(n==null||n(),o),cancelRetry:c,continueRetry:d,canStart:f,start:()=>(f()?y():m().then(y),o)}}var Wt,zi,ml=(zi=class{constructor(){G(this,Wt)}destroy(){this.clearGcTimeout()}scheduleGc(){this.clearGcTimeout(),Xo(this.gcTime)&&z(this,Wt,zt.setTimeout(()=>{this.optionalRemove()},this.gcTime))}updateGcTime(e){this.gcTime=Math.max(this.gcTime||0,e??(Xt?1/0:5*60*1e3))}clearGcTimeout(){w(this,Wt)&&(zt.clearTimeout(w(this,Wt)),z(this,Wt,void 0))}},Wt=new WeakMap,zi),Ut,cr,We,Ht,ge,rn,Gt,Ve,ct,Ni,Vu=(Ni=class extends ml{constructor(t){super();G(this,Ve);G(this,Ut);G(this,cr);G(this,We);G(this,Ht);G(this,ge);G(this,rn);G(this,Gt);z(this,Gt,!1),z(this,rn,t.defaultOptions),this.setOptions(t.options),this.observers=[],z(this,Ht,t.client),z(this,We,w(this,Ht).getQueryCache()),this.queryKey=t.queryKey,this.queryHash=t.queryHash,z(this,Ut,Ea(this.options)),this.state=t.state??w(this,Ut),this.scheduleGc()}get meta(){return this.options.meta}get promise(){var t;return(t=w(this,ge))==null?void 0:t.promise}setOptions(t){if(this.options={...w(this,rn),...t},this.updateGcTime(this.options.gcTime),this.state&&this.state.data===void 0){const r=Ea(this.options);r.data!==void 0&&(this.setState(Ia(r.data,r.dataUpdatedAt)),z(this,Ut,r))}}optionalRemove(){!this.observers.length&&this.state.fetchStatus==="idle"&&w(this,We).remove(this)}setData(t,r){const n=es(this.state.data,t,this.options);return Y(this,Ve,ct).call(this,{data:n,type:"success",dataUpdatedAt:r==null?void 0:r.updatedAt,manual:r==null?void 0:r.manual}),n}setState(t,r){Y(this,Ve,ct).call(this,{type:"setState",state:t,setStateOptions:r})}cancel(t){var n,o;const r=(n=w(this,ge))==null?void 0:n.promise;return(o=w(this,ge))==null||o.cancel(t),r?r.then(Te).catch(Te):Promise.resolve()}destroy(){super.destroy(),this.cancel({silent:!0})}reset(){this.destroy(),this.setState(w(this,Ut))}isActive(){return this.observers.some(t=>Ue(t.options.enabled,this)!==!1)}isDisabled(){return this.getObserversCount()>0?!this.isActive():this.options.queryFn===Ls||this.state.dataUpdateCount+this.state.errorUpdateCount===0}isStatic(){return this.getObserversCount()>0?this.observers.some(t=>Dt(t.options.staleTime,this)==="static"):!1}isStale(){return this.getObserversCount()>0?this.observers.some(t=>t.getCurrentResult().isStale):this.state.data===void 0||this.state.isInvalidated}isStaleByTime(t=0){return this.state.data===void 0?!0:t==="static"?!1:this.state.isInvalidated?!0:!ul(this.state.dataUpdatedAt,t)}onFocus(){var r;const t=this.observers.find(n=>n.shouldFetchOnWindowFocus());t==null||t.refetch({cancelRefetch:!1}),(r=w(this,ge))==null||r.continue()}onOnline(){var r;const t=this.observers.find(n=>n.shouldFetchOnReconnect());t==null||t.refetch({cancelRefetch:!1}),(r=w(this,ge))==null||r.continue()}addObserver(t){this.observers.includes(t)||(this.observers.push(t),this.clearGcTimeout(),w(this,We).notify({type:"observerAdded",query:this,observer:t}))}removeObserver(t){this.observers.includes(t)&&(this.observers=this.observers.filter(r=>r!==t),this.observers.length||(w(this,ge)&&(w(this,Gt)?w(this,ge).cancel({revert:!0}):w(this,ge).cancelRetry()),this.scheduleGc()),w(this,We).notify({type:"observerRemoved",query:this,observer:t}))}getObserversCount(){return this.observers.length}invalidate(){this.state.isInvalidated||Y(this,Ve,ct).call(this,{type:"invalidate"})}async fetch(t,r){var d,u,f,p,h,m,y,b,x,S,v,k;if(this.state.fetchStatus!=="idle"&&((d=w(this,ge))==null?void 0:d.status())!=="rejected"){if(this.state.data!==void 0&&(r!=null&&r.cancelRefetch))this.cancel({silent:!0});else if(w(this,ge))return w(this,ge).continueRetry(),w(this,ge).promise}if(t&&this.setOptions(t),!this.options.queryFn){const C=this.observers.find(I=>I.options.queryFn);C&&this.setOptions(C.options)}const n=new AbortController,o=C=>{Object.defineProperty(C,"signal",{enumerable:!0,get:()=>(z(this,Gt,!0),n.signal)})},i=()=>{const C=hl(this.options,r),E=(()=>{const $={client:w(this,Ht),queryKey:this.queryKey,meta:this.meta};return o($),$})();return z(this,Gt,!1),this.options.persister?this.options.persister(C,E,this):C(E)},c=(()=>{const C={fetchOptions:r,options:this.options,queryKey:this.queryKey,client:w(this,Ht),state:this.state,fetchFn:i};return o(C),C})();(u=this.options.behavior)==null||u.onFetch(c,this),z(this,cr,this.state),(this.state.fetchStatus==="idle"||this.state.fetchMeta!==((f=c.fetchOptions)==null?void 0:f.meta))&&Y(this,Ve,ct).call(this,{type:"fetch",meta:(p=c.fetchOptions)==null?void 0:p.meta}),z(this,ge,gl({initialPromise:r==null?void 0:r.initialPromise,fn:c.fetchFn,onCancel:C=>{C instanceof rs&&C.revert&&this.setState({...w(this,cr),fetchStatus:"idle"}),n.abort()},onFail:(C,I)=>{Y(this,Ve,ct).call(this,{type:"failed",failureCount:C,error:I})},onPause:()=>{Y(this,Ve,ct).call(this,{type:"pause"})},onContinue:()=>{Y(this,Ve,ct).call(this,{type:"continue"})},retry:c.options.retry,retryDelay:c.options.retryDelay,networkMode:c.options.networkMode,canRun:()=>!0}));try{const C=await w(this,ge).start();if(C===void 0)throw new Error(`${this.queryHash} data is undefined`);return this.setData(C),(m=(h=w(this,We).config).onSuccess)==null||m.call(h,C,this),(b=(y=w(this,We).config).onSettled)==null||b.call(y,C,this.state.error,this),C}catch(C){if(C instanceof rs){if(C.silent)return w(this,ge).promise;if(C.revert){if(this.state.data===void 0)throw C;return this.state.data}}throw Y(this,Ve,ct).call(this,{type:"error",error:C}),(S=(x=w(this,We).config).onError)==null||S.call(x,C,this),(k=(v=w(this,We).config).onSettled)==null||k.call(v,this.state.data,C,this),C}finally{this.scheduleGc()}}},Ut=new WeakMap,cr=new WeakMap,We=new WeakMap,Ht=new WeakMap,ge=new WeakMap,rn=new WeakMap,Gt=new WeakMap,Ve=new WeakSet,ct=function(t){const r=n=>{switch(t.type){case"failed":return{...n,fetchFailureCount:t.failureCount,fetchFailureReason:t.error};case"pause":return{...n,fetchStatus:"paused"};case"continue":return{...n,fetchStatus:"fetching"};case"fetch":return{...n,...yl(n.data,this.options),fetchMeta:t.meta??null};case"success":const o={...n,...Ia(t.data,t.dataUpdatedAt),dataUpdateCount:n.dataUpdateCount+1,...!t.manual&&{fetchStatus:"idle",fetchFailureCount:0,fetchFailureReason:null}};return z(this,cr,t.manual?o:void 0),o;case"error":const i=t.error;return{...n,error:i,errorUpdateCount:n.errorUpdateCount+1,errorUpdatedAt:Date.now(),fetchFailureCount:n.fetchFailureCount+1,fetchFailureReason:i,fetchStatus:"idle",status:"error"};case"invalidate":return{...n,isInvalidated:!0};case"setState":return{...n,...t.state}}};this.state=r(this.state),we.batch(()=>{this.observers.forEach(n=>{n.onQueryUpdate()}),w(this,We).notify({query:this,type:"updated",action:t})})},Ni);function yl(e,t){return{fetchFailureCount:0,fetchFailureReason:null,fetchStatus:fl(t.networkMode)?"fetching":"paused",...e===void 0&&{error:null,status:"pending"}}}function Ia(e,t){return{data:e,dataUpdatedAt:t??Date.now(),error:null,isInvalidated:!1,status:"success"}}function Ea(e){const t=typeof e.initialData=="function"?e.initialData():e.initialData,r=t!==void 0,n=r?typeof e.initialDataUpdatedAt=="function"?e.initialDataUpdatedAt():e.initialDataUpdatedAt:0;return{data:t,dataUpdateCount:0,dataUpdatedAt:r?n??Date.now():0,error:null,errorUpdateCount:0,errorUpdatedAt:0,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:null,isInvalidated:!1,status:r?"success":"pending",fetchStatus:"idle"}}var Re,X,nn,Ee,qt,dr,ut,Ct,on,ur,pr,Qt,Vt,kt,hr,oe,Fr,ns,os,ss,as,is,ls,cs,bl,Wi,Ku=(Wi=class extends fn{constructor(t,r){super();G(this,oe);G(this,Re);G(this,X);G(this,nn);G(this,Ee);G(this,qt);G(this,dr);G(this,ut);G(this,Ct);G(this,on);G(this,ur);G(this,pr);G(this,Qt);G(this,Vt);G(this,kt);G(this,hr,new Set);this.options=r,z(this,Re,t),z(this,Ct,null),z(this,ut,ts()),this.bindMethods(),this.setOptions(r)}bindMethods(){this.refetch=this.refetch.bind(this)}onSubscribe(){this.listeners.size===1&&(w(this,X).addObserver(this),Aa(w(this,X),this.options)?Y(this,oe,Fr).call(this):this.updateResult(),Y(this,oe,as).call(this))}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return ds(w(this,X),this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return ds(w(this,X),this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,Y(this,oe,is).call(this),Y(this,oe,ls).call(this),w(this,X).removeObserver(this)}setOptions(t){const r=this.options,n=w(this,X);if(this.options=w(this,Re).defaultQueryOptions(t),this.options.enabled!==void 0&&typeof this.options.enabled!="boolean"&&typeof this.options.enabled!="function"&&typeof Ue(this.options.enabled,w(this,X))!="boolean")throw new Error("Expected enabled to be a boolean or a callback that returns a boolean");Y(this,oe,cs).call(this),w(this,X).setOptions(this.options),r._defaulted&&!Jo(this.options,r)&&w(this,Re).getQueryCache().notify({type:"observerOptionsUpdated",query:w(this,X),observer:this});const o=this.hasListeners();o&&Da(w(this,X),n,this.options,r)&&Y(this,oe,Fr).call(this),this.updateResult(),o&&(w(this,X)!==n||Ue(this.options.enabled,w(this,X))!==Ue(r.enabled,w(this,X))||Dt(this.options.staleTime,w(this,X))!==Dt(r.staleTime,w(this,X)))&&Y(this,oe,ns).call(this);const i=Y(this,oe,os).call(this);o&&(w(this,X)!==n||Ue(this.options.enabled,w(this,X))!==Ue(r.enabled,w(this,X))||i!==w(this,kt))&&Y(this,oe,ss).call(this,i)}getOptimisticResult(t){const r=w(this,Re).getQueryCache().build(w(this,Re),t),n=this.createResult(r,t);return Xu(this,n)&&(z(this,Ee,n),z(this,dr,this.options),z(this,qt,w(this,X).state)),n}getCurrentResult(){return w(this,Ee)}trackResult(t,r){return new Proxy(t,{get:(n,o)=>(this.trackProp(o),r==null||r(o),o==="promise"&&(this.trackProp("data"),!this.options.experimental_prefetchInRender&&w(this,ut).status==="pending"&&w(this,ut).reject(new Error("experimental_prefetchInRender feature flag is not enabled"))),Reflect.get(n,o))})}trackProp(t){w(this,hr).add(t)}getCurrentQuery(){return w(this,X)}refetch({...t}={}){return this.fetch({...t})}fetchOptimistic(t){const r=w(this,Re).defaultQueryOptions(t),n=w(this,Re).getQueryCache().build(w(this,Re),r);return n.fetch().then(()=>this.createResult(n,r))}fetch(t){return Y(this,oe,Fr).call(this,{...t,cancelRefetch:t.cancelRefetch??!0}).then(()=>(this.updateResult(),w(this,Ee)))}createResult(t,r){var O;const n=w(this,X),o=this.options,i=w(this,Ee),l=w(this,qt),c=w(this,dr),u=t!==n?t.state:w(this,nn),{state:f}=t;let p={...f},h=!1,m;if(r._optimisticResults){const A=this.hasListeners(),R=!A&&Aa(t,r),U=A&&Da(t,n,r,o);(R||U)&&(p={...p,...yl(f.data,t.options)}),r._optimisticResults==="isRestoring"&&(p.fetchStatus="idle")}let{error:y,errorUpdatedAt:b,status:x}=p;m=p.data;let S=!1;if(r.placeholderData!==void 0&&m===void 0&&x==="pending"){let A;i!=null&&i.isPlaceholderData&&r.placeholderData===(c==null?void 0:c.placeholderData)?(A=i.data,S=!0):A=typeof r.placeholderData=="function"?r.placeholderData((O=w(this,pr))==null?void 0:O.state.data,w(this,pr)):r.placeholderData,A!==void 0&&(x="success",m=es(i==null?void 0:i.data,A,r),h=!0)}if(r.select&&m!==void 0&&!S)if(i&&m===(l==null?void 0:l.data)&&r.select===w(this,on))m=w(this,ur);else try{z(this,on,r.select),m=r.select(m),m=es(i==null?void 0:i.data,m,r),z(this,ur,m),z(this,Ct,null)}catch(A){z(this,Ct,A)}w(this,Ct)&&(y=w(this,Ct),m=w(this,ur),b=Date.now(),x="error");const v=p.fetchStatus==="fetching",k=x==="pending",C=x==="error",I=k&&v,E=m!==void 0,F={status:x,fetchStatus:p.fetchStatus,isPending:k,isSuccess:x==="success",isError:C,isInitialLoading:I,isLoading:I,data:m,dataUpdatedAt:p.dataUpdatedAt,error:y,errorUpdatedAt:b,failureCount:p.fetchFailureCount,failureReason:p.fetchFailureReason,errorUpdateCount:p.errorUpdateCount,isFetched:p.dataUpdateCount>0||p.errorUpdateCount>0,isFetchedAfterMount:p.dataUpdateCount>u.dataUpdateCount||p.errorUpdateCount>u.errorUpdateCount,isFetching:v,isRefetching:v&&!k,isLoadingError:C&&!E,isPaused:p.fetchStatus==="paused",isPlaceholderData:h,isRefetchError:C&&E,isStale:Ns(t,r),refetch:this.refetch,promise:w(this,ut),isEnabled:Ue(r.enabled,t)!==!1};if(this.options.experimental_prefetchInRender){const A=L=>{F.status==="error"?L.reject(F.error):F.data!==void 0&&L.resolve(F.data)},R=()=>{const L=z(this,ut,F.promise=ts());A(L)},U=w(this,ut);switch(U.status){case"pending":t.queryHash===n.queryHash&&A(U);break;case"fulfilled":(F.status==="error"||F.data!==U.value)&&R();break;case"rejected":(F.status!=="error"||F.error!==U.reason)&&R();break}}return F}updateResult(){const t=w(this,Ee),r=this.createResult(w(this,X),this.options);if(z(this,qt,w(this,X).state),z(this,dr,this.options),w(this,qt).data!==void 0&&z(this,pr,w(this,X)),Jo(r,t))return;z(this,Ee,r);const n=()=>{if(!t)return!0;const{notifyOnChangeProps:o}=this.options,i=typeof o=="function"?o():o;if(i==="all"||!i&&!w(this,hr).size)return!0;const l=new Set(i??w(this,hr));return this.options.throwOnError&&l.add("error"),Object.keys(w(this,Ee)).some(c=>{const d=c;return w(this,Ee)[d]!==t[d]&&l.has(d)})};Y(this,oe,bl).call(this,{listeners:n()})}onQueryUpdate(){this.updateResult(),this.hasListeners()&&Y(this,oe,as).call(this)}},Re=new WeakMap,X=new WeakMap,nn=new WeakMap,Ee=new WeakMap,qt=new WeakMap,dr=new WeakMap,ut=new WeakMap,Ct=new WeakMap,on=new WeakMap,ur=new WeakMap,pr=new WeakMap,Qt=new WeakMap,Vt=new WeakMap,kt=new WeakMap,hr=new WeakMap,oe=new WeakSet,Fr=function(t){Y(this,oe,cs).call(this);let r=w(this,X).fetch(this.options,t);return t!=null&&t.throwOnError||(r=r.catch(Te)),r},ns=function(){Y(this,oe,is).call(this);const t=Dt(this.options.staleTime,w(this,X));if(Xt||w(this,Ee).isStale||!Xo(t))return;const n=ul(w(this,Ee).dataUpdatedAt,t)+1;z(this,Qt,zt.setTimeout(()=>{w(this,Ee).isStale||this.updateResult()},n))},os=function(){return(typeof this.options.refetchInterval=="function"?this.options.refetchInterval(w(this,X)):this.options.refetchInterval)??!1},ss=function(t){Y(this,oe,ls).call(this),z(this,kt,t),!(Xt||Ue(this.options.enabled,w(this,X))===!1||!Xo(w(this,kt))||w(this,kt)===0)&&z(this,Vt,zt.setInterval(()=>{(this.options.refetchIntervalInBackground||zs.isFocused())&&Y(this,oe,Fr).call(this)},w(this,kt)))},as=function(){Y(this,oe,ns).call(this),Y(this,oe,ss).call(this,Y(this,oe,os).call(this))},is=function(){w(this,Qt)&&(zt.clearTimeout(w(this,Qt)),z(this,Qt,void 0))},ls=function(){w(this,Vt)&&(zt.clearInterval(w(this,Vt)),z(this,Vt,void 0))},cs=function(){const t=w(this,Re).getQueryCache().build(w(this,Re),this.options);if(t===w(this,X))return;const r=w(this,X);z(this,X,t),z(this,nn,t.state),this.hasListeners()&&(r==null||r.removeObserver(this),t.addObserver(this))},bl=function(t){we.batch(()=>{t.listeners&&this.listeners.forEach(r=>{r(w(this,Ee))}),w(this,Re).getQueryCache().notify({query:w(this,X),type:"observerResultsUpdated"})})},Wi);function Yu(e,t){return Ue(t.enabled,e)!==!1&&e.state.data===void 0&&!(e.state.status==="error"&&t.retryOnMount===!1)}function Aa(e,t){return Yu(e,t)||e.state.data!==void 0&&ds(e,t,t.refetchOnMount)}function ds(e,t,r){if(Ue(t.enabled,e)!==!1&&Dt(t.staleTime,e)!=="static"){const n=typeof r=="function"?r(e):r;return n==="always"||n!==!1&&Ns(e,t)}return!1}function Da(e,t,r,n){return(e!==t||Ue(n.enabled,e)===!1)&&(!r.suspense||e.state.status!=="error")&&Ns(e,r)}function Ns(e,t){return Ue(t.enabled,e)!==!1&&e.isStaleByTime(Dt(t.staleTime,e))}function Xu(e,t){return!Jo(e.getCurrentResult(),t)}function Gn(e){return{onFetch:(t,r)=>{var f,p,h,m,y;const n=t.options,o=(h=(p=(f=t.fetchOptions)==null?void 0:f.meta)==null?void 0:p.fetchMore)==null?void 0:h.direction,i=((m=t.state.data)==null?void 0:m.pages)||[],l=((y=t.state.data)==null?void 0:y.pageParams)||[];let c={pages:[],pageParams:[]},d=0;const u=async()=>{let b=!1;const x=k=>{Object.defineProperty(k,"signal",{enumerable:!0,get:()=>(t.signal.aborted?b=!0:t.signal.addEventListener("abort",()=>{b=!0}),t.signal)})},S=hl(t.options,t.fetchOptions),v=async(k,C,I)=>{if(b)return Promise.reject();if(C==null&&k.pages.length)return Promise.resolve(k);const $=(()=>{const R={client:t.client,queryKey:t.queryKey,pageParam:C,direction:I?"backward":"forward",meta:t.options.meta};return x(R),R})(),F=await S($),{maxPages:O}=t.options,A=I?Nu:zu;return{pages:A(k.pages,F,O),pageParams:A(k.pageParams,C,O)}};if(o&&i.length){const k=o==="backward",C=k?xl:us,I={pages:i,pageParams:l},E=C(n,I);c=await v(I,E,k)}else{const k=e??i.length;do{const C=d===0?l[0]??n.initialPageParam:us(n,c);if(d>0&&C==null)break;c=await v(c,C),d++}while(d<k)}return c};t.options.persister?t.fetchFn=()=>{var b,x;return(x=(b=t.options).persister)==null?void 0:x.call(b,u,{client:t.client,queryKey:t.queryKey,meta:t.options.meta,signal:t.signal},r)}:t.fetchFn=u}}}function us(e,{pages:t,pageParams:r}){const n=t.length-1;return t.length>0?e.getNextPageParam(t[n],t,r[n],r):void 0}function xl(e,{pages:t,pageParams:r}){var n;return t.length>0?(n=e.getPreviousPageParam)==null?void 0:n.call(e,t[0],t,r[0],r):void 0}function Ju(e,t){return t?us(e,t)!=null:!1}function Zu(e,t){return!t||!e.getPreviousPageParam?!1:xl(e,t)!=null}var ep=class extends Ku{constructor(e,t){super(e,t)}bindMethods(){super.bindMethods(),this.fetchNextPage=this.fetchNextPage.bind(this),this.fetchPreviousPage=this.fetchPreviousPage.bind(this)}setOptions(e){super.setOptions({...e,behavior:Gn()})}getOptimisticResult(e){return e.behavior=Gn(),super.getOptimisticResult(e)}fetchNextPage(e){return this.fetch({...e,meta:{fetchMore:{direction:"forward"}}})}fetchPreviousPage(e){return this.fetch({...e,meta:{fetchMore:{direction:"backward"}}})}createResult(e,t){var y,b;const{state:r}=e,n=super.createResult(e,t),{isFetching:o,isRefetching:i,isError:l,isRefetchError:c}=n,d=(b=(y=r.fetchMeta)==null?void 0:y.fetchMore)==null?void 0:b.direction,u=l&&d==="forward",f=o&&d==="forward",p=l&&d==="backward",h=o&&d==="backward";return{...n,fetchNextPage:this.fetchNextPage,fetchPreviousPage:this.fetchPreviousPage,hasNextPage:Ju(t,r.data),hasPreviousPage:Zu(t,r.data),isFetchNextPageError:u,isFetchingNextPage:f,isFetchPreviousPageError:p,isFetchingPreviousPage:h,isRefetchError:c&&!u&&!p,isRefetching:i&&!f&&!h}}},sn,et,Ae,Kt,tt,yt,Ui,tp=(Ui=class extends ml{constructor(t){super();G(this,tt);G(this,sn);G(this,et);G(this,Ae);G(this,Kt);z(this,sn,t.client),this.mutationId=t.mutationId,z(this,Ae,t.mutationCache),z(this,et,[]),this.state=t.state||rp(),this.setOptions(t.options),this.scheduleGc()}setOptions(t){this.options=t,this.updateGcTime(this.options.gcTime)}get meta(){return this.options.meta}addObserver(t){w(this,et).includes(t)||(w(this,et).push(t),this.clearGcTimeout(),w(this,Ae).notify({type:"observerAdded",mutation:this,observer:t}))}removeObserver(t){z(this,et,w(this,et).filter(r=>r!==t)),this.scheduleGc(),w(this,Ae).notify({type:"observerRemoved",mutation:this,observer:t})}optionalRemove(){w(this,et).length||(this.state.status==="pending"?this.scheduleGc():w(this,Ae).remove(this))}continue(){var t;return((t=w(this,Kt))==null?void 0:t.continue())??this.execute(this.state.variables)}async execute(t){var l,c,d,u,f,p,h,m,y,b,x,S,v,k,C,I,E,$,F,O;const r=()=>{Y(this,tt,yt).call(this,{type:"continue"})},n={client:w(this,sn),meta:this.options.meta,mutationKey:this.options.mutationKey};z(this,Kt,gl({fn:()=>this.options.mutationFn?this.options.mutationFn(t,n):Promise.reject(new Error("No mutationFn found")),onFail:(A,R)=>{Y(this,tt,yt).call(this,{type:"failed",failureCount:A,error:R})},onPause:()=>{Y(this,tt,yt).call(this,{type:"pause"})},onContinue:r,retry:this.options.retry??0,retryDelay:this.options.retryDelay,networkMode:this.options.networkMode,canRun:()=>w(this,Ae).canRun(this)}));const o=this.state.status==="pending",i=!w(this,Kt).canStart();try{if(o)r();else{Y(this,tt,yt).call(this,{type:"pending",variables:t,isPaused:i}),await((c=(l=w(this,Ae).config).onMutate)==null?void 0:c.call(l,t,this,n));const R=await((u=(d=this.options).onMutate)==null?void 0:u.call(d,t,n));R!==this.state.context&&Y(this,tt,yt).call(this,{type:"pending",context:R,variables:t,isPaused:i})}const A=await w(this,Kt).start();return await((p=(f=w(this,Ae).config).onSuccess)==null?void 0:p.call(f,A,t,this.state.context,this,n)),await((m=(h=this.options).onSuccess)==null?void 0:m.call(h,A,t,this.state.context,n)),await((b=(y=w(this,Ae).config).onSettled)==null?void 0:b.call(y,A,null,this.state.variables,this.state.context,this,n)),await((S=(x=this.options).onSettled)==null?void 0:S.call(x,A,null,t,this.state.context,n)),Y(this,tt,yt).call(this,{type:"success",data:A}),A}catch(A){try{throw await((k=(v=w(this,Ae).config).onError)==null?void 0:k.call(v,A,t,this.state.context,this,n)),await((I=(C=this.options).onError)==null?void 0:I.call(C,A,t,this.state.context,n)),await(($=(E=w(this,Ae).config).onSettled)==null?void 0:$.call(E,void 0,A,this.state.variables,this.state.context,this,n)),await((O=(F=this.options).onSettled)==null?void 0:O.call(F,void 0,A,t,this.state.context,n)),A}finally{Y(this,tt,yt).call(this,{type:"error",error:A})}}finally{w(this,Ae).runNext(this)}}},sn=new WeakMap,et=new WeakMap,Ae=new WeakMap,Kt=new WeakMap,tt=new WeakSet,yt=function(t){const r=n=>{switch(t.type){case"failed":return{...n,failureCount:t.failureCount,failureReason:t.error};case"pause":return{...n,isPaused:!0};case"continue":return{...n,isPaused:!1};case"pending":return{...n,context:t.context,data:void 0,failureCount:0,failureReason:null,error:null,isPaused:t.isPaused,status:"pending",variables:t.variables,submittedAt:Date.now()};case"success":return{...n,data:t.data,failureCount:0,failureReason:null,error:null,status:"success",isPaused:!1};case"error":return{...n,data:void 0,error:t.error,failureCount:n.failureCount+1,failureReason:t.error,isPaused:!1,status:"error"}}};this.state=r(this.state),we.batch(()=>{w(this,et).forEach(n=>{n.onMutationUpdate(t)}),w(this,Ae).notify({mutation:this,type:"updated",action:t})})},Ui);function rp(){return{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0,submittedAt:0}}var pt,Ke,an,Hi,np=(Hi=class extends fn{constructor(t={}){super();G(this,pt);G(this,Ke);G(this,an);this.config=t,z(this,pt,new Set),z(this,Ke,new Map),z(this,an,0)}build(t,r,n){const o=new tp({client:t,mutationCache:this,mutationId:++Cn(this,an)._,options:t.defaultMutationOptions(r),state:n});return this.add(o),o}add(t){w(this,pt).add(t);const r=kn(t);if(typeof r=="string"){const n=w(this,Ke).get(r);n?n.push(t):w(this,Ke).set(r,[t])}this.notify({type:"added",mutation:t})}remove(t){if(w(this,pt).delete(t)){const r=kn(t);if(typeof r=="string"){const n=w(this,Ke).get(r);if(n)if(n.length>1){const o=n.indexOf(t);o!==-1&&n.splice(o,1)}else n[0]===t&&w(this,Ke).delete(r)}}this.notify({type:"removed",mutation:t})}canRun(t){const r=kn(t);if(typeof r=="string"){const n=w(this,Ke).get(r),o=n==null?void 0:n.find(i=>i.state.status==="pending");return!o||o===t}else return!0}runNext(t){var n;const r=kn(t);if(typeof r=="string"){const o=(n=w(this,Ke).get(r))==null?void 0:n.find(i=>i!==t&&i.state.isPaused);return(o==null?void 0:o.continue())??Promise.resolve()}else return Promise.resolve()}clear(){we.batch(()=>{w(this,pt).forEach(t=>{this.notify({type:"removed",mutation:t})}),w(this,pt).clear(),w(this,Ke).clear()})}getAll(){return Array.from(w(this,pt))}find(t){const r={exact:!0,...t};return this.getAll().find(n=>ka(r,n))}findAll(t={}){return this.getAll().filter(r=>ka(t,r))}notify(t){we.batch(()=>{this.listeners.forEach(r=>{r(t)})})}resumePausedMutations(){const t=this.getAll().filter(r=>r.state.isPaused);return we.batch(()=>Promise.all(t.map(r=>r.continue().catch(Te))))}},pt=new WeakMap,Ke=new WeakMap,an=new WeakMap,Hi);function kn(e){var t;return(t=e.options.scope)==null?void 0:t.id}var rt,Gi,op=(Gi=class extends fn{constructor(t={}){super();G(this,rt);this.config=t,z(this,rt,new Map)}build(t,r,n){const o=r.queryKey,i=r.queryHash??Bs(o,r);let l=this.get(i);return l||(l=new Vu({client:t,queryKey:o,queryHash:i,options:t.defaultQueryOptions(r),state:n,defaultOptions:t.getQueryDefaults(o)}),this.add(l)),l}add(t){w(this,rt).has(t.queryHash)||(w(this,rt).set(t.queryHash,t),this.notify({type:"added",query:t}))}remove(t){const r=w(this,rt).get(t.queryHash);r&&(t.destroy(),r===t&&w(this,rt).delete(t.queryHash),this.notify({type:"removed",query:t}))}clear(){we.batch(()=>{this.getAll().forEach(t=>{this.remove(t)})})}get(t){return w(this,rt).get(t)}getAll(){return[...w(this,rt).values()]}find(t){const r={exact:!0,...t};return this.getAll().find(n=>Ca(r,n))}findAll(t={}){const r=this.getAll();return Object.keys(t).length>0?r.filter(n=>Ca(t,n)):r}notify(t){we.batch(()=>{this.listeners.forEach(r=>{r(t)})})}onFocus(){we.batch(()=>{this.getAll().forEach(t=>{t.onFocus()})})}onOnline(){we.batch(()=>{this.getAll().forEach(t=>{t.onOnline()})})}},rt=new WeakMap,Gi),de,jt,Pt,fr,gr,It,mr,yr,qi,sp=(qi=class{constructor(e={}){G(this,de);G(this,jt);G(this,Pt);G(this,fr);G(this,gr);G(this,It);G(this,mr);G(this,yr);z(this,de,e.queryCache||new op),z(this,jt,e.mutationCache||new np),z(this,Pt,e.defaultOptions||{}),z(this,fr,new Map),z(this,gr,new Map),z(this,It,0)}mount(){Cn(this,It)._++,w(this,It)===1&&(z(this,mr,zs.subscribe(async e=>{e&&(await this.resumePausedMutations(),w(this,de).onFocus())})),z(this,yr,Hn.subscribe(async e=>{e&&(await this.resumePausedMutations(),w(this,de).onOnline())})))}unmount(){var e,t;Cn(this,It)._--,w(this,It)===0&&((e=w(this,mr))==null||e.call(this),z(this,mr,void 0),(t=w(this,yr))==null||t.call(this),z(this,yr,void 0))}isFetching(e){return w(this,de).findAll({...e,fetchStatus:"fetching"}).length}isMutating(e){return w(this,jt).findAll({...e,status:"pending"}).length}getQueryData(e){var r;const t=this.defaultQueryOptions({queryKey:e});return(r=w(this,de).get(t.queryHash))==null?void 0:r.state.data}ensureQueryData(e){const t=this.defaultQueryOptions(e),r=w(this,de).build(this,t),n=r.state.data;return n===void 0?this.fetchQuery(e):(e.revalidateIfStale&&r.isStaleByTime(Dt(t.staleTime,r))&&this.prefetchQuery(t),Promise.resolve(n))}getQueriesData(e){return w(this,de).findAll(e).map(({queryKey:t,state:r})=>{const n=r.data;return[t,n]})}setQueryData(e,t,r){const n=this.defaultQueryOptions({queryKey:e}),o=w(this,de).get(n.queryHash),i=o==null?void 0:o.state.data,l=Ou(t,i);if(l!==void 0)return w(this,de).build(this,n).setData(l,{...r,manual:!0})}setQueriesData(e,t,r){return we.batch(()=>w(this,de).findAll(e).map(({queryKey:n})=>[n,this.setQueryData(n,t,r)]))}getQueryState(e){var r;const t=this.defaultQueryOptions({queryKey:e});return(r=w(this,de).get(t.queryHash))==null?void 0:r.state}removeQueries(e){const t=w(this,de);we.batch(()=>{t.findAll(e).forEach(r=>{t.remove(r)})})}resetQueries(e,t){const r=w(this,de);return we.batch(()=>(r.findAll(e).forEach(n=>{n.reset()}),this.refetchQueries({type:"active",...e},t)))}cancelQueries(e,t={}){const r={revert:!0,...t},n=we.batch(()=>w(this,de).findAll(e).map(o=>o.cancel(r)));return Promise.all(n).then(Te).catch(Te)}invalidateQueries(e,t={}){return we.batch(()=>(w(this,de).findAll(e).forEach(r=>{r.invalidate()}),(e==null?void 0:e.refetchType)==="none"?Promise.resolve():this.refetchQueries({...e,type:(e==null?void 0:e.refetchType)??(e==null?void 0:e.type)??"active"},t)))}refetchQueries(e,t={}){const r={...t,cancelRefetch:t.cancelRefetch??!0},n=we.batch(()=>w(this,de).findAll(e).filter(o=>!o.isDisabled()&&!o.isStatic()).map(o=>{let i=o.fetch(void 0,r);return r.throwOnError||(i=i.catch(Te)),o.state.fetchStatus==="paused"?Promise.resolve():i}));return Promise.all(n).then(Te)}fetchQuery(e){const t=this.defaultQueryOptions(e);t.retry===void 0&&(t.retry=!1);const r=w(this,de).build(this,t);return r.isStaleByTime(Dt(t.staleTime,r))?r.fetch(t):Promise.resolve(r.state.data)}prefetchQuery(e){return this.fetchQuery(e).then(Te).catch(Te)}fetchInfiniteQuery(e){return e.behavior=Gn(e.pages),this.fetchQuery(e)}prefetchInfiniteQuery(e){return this.fetchInfiniteQuery(e).then(Te).catch(Te)}ensureInfiniteQueryData(e){return e.behavior=Gn(e.pages),this.ensureQueryData(e)}resumePausedMutations(){return Hn.isOnline()?w(this,jt).resumePausedMutations():Promise.resolve()}getQueryCache(){return w(this,de)}getMutationCache(){return w(this,jt)}getDefaultOptions(){return w(this,Pt)}setDefaultOptions(e){z(this,Pt,e)}setQueryDefaults(e,t){w(this,fr).set(Ur(e),{queryKey:e,defaultOptions:t})}getQueryDefaults(e){const t=[...w(this,fr).values()],r={};return t.forEach(n=>{Hr(e,n.queryKey)&&Object.assign(r,n.defaultOptions)}),r}setMutationDefaults(e,t){w(this,gr).set(Ur(e),{mutationKey:e,defaultOptions:t})}getMutationDefaults(e){const t=[...w(this,gr).values()],r={};return t.forEach(n=>{Hr(e,n.mutationKey)&&Object.assign(r,n.defaultOptions)}),r}defaultQueryOptions(e){if(e._defaulted)return e;const t={...w(this,Pt).queries,...this.getQueryDefaults(e.queryKey),...e,_defaulted:!0};return t.queryHash||(t.queryHash=Bs(t.queryKey,t)),t.refetchOnReconnect===void 0&&(t.refetchOnReconnect=t.networkMode!=="always"),t.throwOnError===void 0&&(t.throwOnError=!!t.suspense),!t.networkMode&&t.persister&&(t.networkMode="offlineFirst"),t.queryFn===Ls&&(t.enabled=!1),t}defaultMutationOptions(e){return e!=null&&e._defaulted?e:{...w(this,Pt).mutations,...(e==null?void 0:e.mutationKey)&&this.getMutationDefaults(e.mutationKey),...e,_defaulted:!0}}clear(){w(this,de).clear(),w(this,jt).clear()}},de=new WeakMap,jt=new WeakMap,Pt=new WeakMap,fr=new WeakMap,gr=new WeakMap,It=new WeakMap,mr=new WeakMap,yr=new WeakMap,qi),Sl=g.createContext(void 0),ap=e=>{const t=g.useContext(Sl);if(!t)throw new Error("No QueryClient set, use QueryClientProvider to set one");return t},ip=({client:e,children:t})=>(g.useEffect(()=>(e.mount(),()=>{e.unmount()}),[e]),a.jsx(Sl.Provider,{value:e,children:t})),vl=g.createContext(!1),lp=()=>g.useContext(vl);vl.Provider;function cp(){let e=!1;return{clearReset:()=>{e=!1},reset:()=>{e=!0},isReset:()=>e}}var dp=g.createContext(cp()),up=()=>g.useContext(dp),pp=(e,t)=>{(e.suspense||e.throwOnError||e.experimental_prefetchInRender)&&(t.isReset()||(e.retryOnMount=!1))},hp=e=>{g.useEffect(()=>{e.clearReset()},[e])},fp=({result:e,errorResetBoundary:t,throwOnError:r,query:n,suspense:o})=>e.isError&&!t.isReset()&&!e.isFetching&&n&&(o&&e.data===void 0||Wu(r,[e.error,n])),gp=e=>{if(e.suspense){const r=o=>o==="static"?o:Math.max(o??1e3,1e3),n=e.staleTime;e.staleTime=typeof n=="function"?(...o)=>r(n(...o)):r(n),typeof e.gcTime=="number"&&(e.gcTime=Math.max(e.gcTime,1e3))}},mp=(e,t)=>e.isLoading&&e.isFetching&&!t,yp=(e,t)=>(e==null?void 0:e.suspense)&&t.isPending,Ra=(e,t,r)=>t.fetchOptimistic(e).catch(()=>{r.clearReset()});function bp(e,t,r){var p,h,m,y,b;const n=lp(),o=up(),i=ap(),l=i.defaultQueryOptions(e);(h=(p=i.getDefaultOptions().queries)==null?void 0:p._experimental_beforeQuery)==null||h.call(p,l),l._optimisticResults=n?"isRestoring":"optimistic",gp(l),pp(l,o),hp(o);const c=!i.getQueryCache().get(l.queryHash),[d]=g.useState(()=>new t(i,l)),u=d.getOptimisticResult(l),f=!n&&e.subscribed!==!1;if(g.useSyncExternalStore(g.useCallback(x=>{const S=f?d.subscribe(we.batchCalls(x)):Te;return d.updateResult(),S},[d,f]),()=>d.getCurrentResult(),()=>d.getCurrentResult()),g.useEffect(()=>{d.setOptions(l)},[l,d]),yp(l,u))throw Ra(l,d,o);if(fp({result:u,errorResetBoundary:o,throwOnError:l.throwOnError,query:i.getQueryCache().get(l.queryHash),suspense:l.suspense}))throw u.error;if((y=(m=i.getDefaultOptions().queries)==null?void 0:m._experimental_afterQuery)==null||y.call(m,l,u),l.experimental_prefetchInRender&&!Xt&&mp(u,n)){const x=c?Ra(l,d,o):(b=i.getQueryCache().get(l.queryHash))==null?void 0:b.promise;x==null||x.catch(Te).finally(()=>{d.updateResult()})}return l.notifyOnChangeProps?u:d.trackResult(u)}function xp(e,t){return bp(e,ep)}const Sp={aurora:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)"},qe={background:{primary:"#0A0E27",secondary:"#1a1f3a",surface:"#252b45",hover:"#2a3150",glass:"rgba(26, 31, 58, 0.7)"},text:{primary:"#ffffff",secondary:"#8b92b0",disabled:"#5a5f7a"},accent:{success:"#00d4aa",error:"#ff4757",warning:"#ffa502",info:"#4b7bec"},neon:{pink:"#ff6b9d",purple:"#c44569",blue:"#4b7bec",cyan:"#26de81",orange:"#ffa502"},glass:{border:"rgba(255, 255, 255, 0.1)",highlight:"rgba(255, 255, 255, 0.05)"}},Qe={background:{primary:"#f8f9fd",secondary:"#ffffff",surface:"#fafbff",hover:"#f0f2f8",glass:"rgba(255, 255, 255, 0.7)"},text:{primary:"#1a1f3a",secondary:"#5a6280",disabled:"#9ca3b8"},accent:{success:"#00a388",error:"#e63946",warning:"#e68a00",info:"#3d68d4"},neon:{pink:"#d9577e",purple:"#a03d5a",blue:"#3d68d4",cyan:"#1fb874",orange:"#e68a00"},glass:{border:"rgba(102, 126, 234, 0.15)",highlight:"rgba(102, 126, 234, 0.05)"}},Fn={panel:e=>({background:e?qe.background.glass:Qe.background.glass,backdropFilter:"blur(20px) saturate(180%)",WebkitBackdropFilter:"blur(20px) saturate(180%)",border:`1px solid ${e?qe.glass.border:Qe.glass.border}`,boxShadow:e?"0 8px 32px rgba(0, 0, 0, 0.3)":"0 8px 32px rgba(102, 126, 234, 0.08)"}),strong:e=>({background:e?"rgba(26, 31, 58, 0.85)":"rgba(255, 255, 255, 0.85)",backdropFilter:"blur(30px) saturate(200%)",WebkitBackdropFilter:"blur(30px) saturate(200%)",border:`1px solid ${e?"rgba(255, 255, 255, 0.15)":"rgba(102, 126, 234, 0.2)"}`,boxShadow:e?"0 12px 48px rgba(0, 0, 0, 0.5)":"0 12px 48px rgba(102, 126, 234, 0.12)"}),minimal:e=>({background:e?"rgba(42, 49, 80, 0.6)":"rgba(255, 255, 255, 0.6)",backdropFilter:"blur(10px)",WebkitBackdropFilter:"blur(10px)",border:`1px solid ${e?"rgba(255, 255, 255, 0.08)":"rgba(102, 126, 234, 0.1)"}`}),glow:(e,t="#667eea")=>({boxShadow:e?`0 0 20px ${t}66, 0 0 40px ${t}33`:`0 0 20px ${t}33, 0 0 40px ${t}1a`})},wl=e=>{const t=e==="dark",r=t?qe:Qe;return Nd({palette:{mode:e,primary:{main:"#667eea",light:"#8b9cf7",dark:"#5166d6"},secondary:{main:"#764ba2",light:"#9668c4",dark:"#5d3c82"},background:{default:r.background.primary,paper:r.background.secondary},text:{primary:r.text.primary,secondary:r.text.secondary,disabled:r.text.disabled},success:{main:r.accent.success},error:{main:r.accent.error},warning:{main:r.accent.warning},info:{main:r.accent.info}},typography:{fontFamily:["Inter","-apple-system","BlinkMacSystemFont",'"Segoe UI"',"Roboto",'"Helvetica Neue"',"Arial","sans-serif"].join(","),h1:{fontSize:"32px",fontWeight:700,letterSpacing:"-0.5px"},h2:{fontSize:"24px",fontWeight:600,letterSpacing:"-0.25px"},h3:{fontSize:"20px",fontWeight:600},h4:{fontSize:"18px",fontWeight:600},body1:{fontSize:"16px",lineHeight:1.5},body2:{fontSize:"14px",lineHeight:1.5},caption:{fontSize:"12px",color:r.text.secondary,letterSpacing:"0.5px"},button:{textTransform:"none",fontWeight:600}},shape:{borderRadius:8},components:{MuiButton:{styleOverrides:{root:{textTransform:"none",borderRadius:"8px",padding:"10px 24px",fontWeight:600,transition:"all 0.3s ease"},contained:{boxShadow:"none","&:hover":{boxShadow:t?"0 4px 12px rgba(0, 0, 0, 0.3)":"0 4px 12px rgba(102, 126, 234, 0.2)"}}}},MuiCard:{styleOverrides:{root:{...Fn.panel(t),backgroundImage:"none",transition:"all 0.3s ease"}}},MuiPaper:{styleOverrides:{root:{backgroundImage:"none",...Fn.strong(t)}}},MuiSlider:{styleOverrides:{root:{color:"#667eea",height:6},thumb:{width:16,height:16,backgroundColor:"#fff",border:t?"none":"2px solid #667eea","&:hover, &.Mui-focusVisible":{boxShadow:"0 0 0 8px rgba(102, 126, 234, 0.16)"}},track:{height:6,borderRadius:3},rail:{height:6,borderRadius:3,backgroundColor:r.background.surface,opacity:1}}},MuiSwitch:{styleOverrides:{root:{width:52,height:32,padding:0},switchBase:{padding:4,"&.Mui-checked":{transform:"translateX(20px)",color:"#fff","& + .MuiSwitch-track":{background:Sp.aurora,opacity:1}}},thumb:{width:24,height:24,boxShadow:t?"0 2px 4px rgba(0, 0, 0, 0.2)":"0 2px 4px rgba(0, 0, 0, 0.1)"},track:{borderRadius:16,backgroundColor:r.background.surface,opacity:1}}},MuiIconButton:{styleOverrides:{root:{transition:"all 0.3s ease","&:hover":{transform:"scale(1.1)",background:t?"rgba(255, 255, 255, 0.05)":"rgba(102, 126, 234, 0.05)"}}}},MuiTooltip:{styleOverrides:{tooltip:{...Fn.strong(t),fontSize:"12px"}}}}})};wl("dark");const Cl=g.createContext(void 0),vp=({children:e})=>{const[t,r]=g.useState(()=>localStorage.getItem("auralis-theme")||"dark"),n=wl(t),o=t==="dark"?qe:Qe;g.useEffect(()=>{localStorage.setItem("auralis-theme",t);const d=document.documentElement;t==="dark"?(d.style.setProperty("--bg-primary",qe.background.primary),d.style.setProperty("--bg-secondary",qe.background.secondary),d.style.setProperty("--bg-surface",qe.background.surface),d.style.setProperty("--bg-glass",qe.background.glass),d.style.setProperty("--text-primary",qe.text.primary),d.style.setProperty("--text-secondary",qe.text.secondary),d.style.setProperty("--glass-border",qe.glass.border)):(d.style.setProperty("--bg-primary",Qe.background.primary),d.style.setProperty("--bg-secondary",Qe.background.secondary),d.style.setProperty("--bg-surface",Qe.background.surface),d.style.setProperty("--bg-glass",Qe.background.glass),d.style.setProperty("--text-primary",Qe.text.primary),d.style.setProperty("--text-secondary",Qe.text.secondary),d.style.setProperty("--glass-border",Qe.glass.border))},[t]);const c={mode:t,toggleTheme:()=>{r(d=>d==="dark"?"light":"dark")},setTheme:d=>{r(d)},colors:o,glassEffects:Fn};return a.jsx(Cl.Provider,{value:c,children:a.jsxs(Wd,{theme:n,children:[a.jsx(Ud,{}),e]})})},wp=()=>{const e=g.useContext(Cl);if(!e)throw new Error("useTheme must be used within a ThemeProvider");return e};ie`
  from {
    opacity: 0;
  }
  to {
    opacity: 1;
  }
`;ie`
  from {
    opacity: 1;
  }
  to {
    opacity: 0;
  }
`;ie`
  from {
    transform: translateY(10px);
    opacity: 0;
  }
  to {
    transform: translateY(0);
    opacity: 1;
  }
`;ie`
  from {
    transform: translateY(-10px);
    opacity: 0;
  }
  to {
    transform: translateY(0);
    opacity: 1;
  }
`;ie`
  from {
    transform: translateX(100%);
    opacity: 0;
  }
  to {
    transform: translateX(0);
    opacity: 1;
  }
`;ie`
  from {
    transform: translateX(0);
    opacity: 1;
  }
  to {
    transform: translateX(100%);
    opacity: 0;
  }
`;ie`
  from {
    transform: translateX(-100%);
    opacity: 0;
  }
  to {
    transform: translateX(0);
    opacity: 1;
  }
`;ie`
  from {
    transform: translateX(0);
    opacity: 1;
  }
  to {
    transform: translateX(-100%);
    opacity: 0;
  }
`;ie`
  from {
    transform: scale(0.95);
    opacity: 0;
  }
  to {
    transform: scale(1);
    opacity: 1;
  }
`;ie`
  from {
    transform: scale(1);
    opacity: 1;
  }
  to {
    transform: scale(0.95);
    opacity: 0;
  }
`;ie`
  0%, 100% {
    opacity: 1;
  }
  50% {
    opacity: 0.5;
  }
`;ie`
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(360deg);
  }
`;ie`
  0%, 100% {
    transform: translateY(0);
  }
  50% {
    transform: translateY(-10px);
  }
`;ie`
  0% {
    background-position: -1000px 0;
  }
  100% {
    background-position: 1000px 0;
  }
`;ie`
  0%, 100% {
    box-shadow: 0 0 10px rgba(115, 102, 240, 0.5);
  }
  50% {
    box-shadow: 0 0 20px rgba(115, 102, 240, 0.8);
  }
`;ie`
  0%, 100% {
    box-shadow: 0 0 10px rgba(71, 214, 255, 0.5);
  }
  50% {
    box-shadow: 0 0 20px rgba(71, 214, 255, 0.8);
  }
`;const Cp=j(Hd,{shouldForwardProp:e=>!["variant","size","loading"].includes(e)})(({variant:e="primary",size:t="md",disabled:r,loading:n})=>{const o={fontFamily:s.typography.fontFamily.primary,fontWeight:s.typography.fontWeight.semibold,borderRadius:s.borderRadius.md,textTransform:"none",transition:s.transitions.all,border:"none",cursor:r||n?"not-allowed":"pointer",opacity:r||n?.5:1,position:"relative","& .MuiButton-label":{textTransform:"none"}},i=(()=>{switch(t){case"small":return"sm";case"medium":return"md";case"large":return"lg";default:return t}})(),l={sm:{height:"32px",padding:`${s.spacing.xs} ${s.spacing.md}`,fontSize:s.typography.fontSize.sm,gap:s.spacing.xs},md:{height:"40px",padding:`${s.spacing.sm} ${s.spacing.lg}`,fontSize:s.typography.fontSize.base,gap:s.spacing.sm},lg:{height:"48px",padding:`${s.spacing.md} ${s.spacing.xl}`,fontSize:s.typography.fontSize.md,gap:s.spacing.sm}},c={primary:{background:s.gradients.aurora,color:s.colors.text.primary,boxShadow:s.shadows.md,"&:hover":{boxShadow:s.shadows.lg,transform:"translateY(-1px)"},"&:active":{transform:"translateY(0)"}},secondary:{background:s.colors.bg.tertiary,color:s.colors.text.primary,border:`1px solid ${s.colors.border.medium}`,"&:hover":{background:s.colors.bg.elevated,borderColor:s.colors.border.heavy},"&:active":{background:s.colors.bg.tertiary}},ghost:{background:"transparent",color:s.colors.text.secondary,"&:hover":{background:s.colors.bg.tertiary,color:s.colors.text.primary},"&:active":{background:s.colors.bg.secondary}},danger:{background:s.colors.semantic.error,color:s.colors.text.primary,"&:hover":{background:s.colors.semantic.error,opacity:.9,boxShadow:s.shadows.md},"&:active":{background:s.colors.semantic.error,opacity:.8}}};return{...o,...l[i],...c[e]}}),kp=j(Qi)({position:"absolute",left:"50%",top:"50%",marginLeft:"-10px",marginTop:"-10px",color:s.colors.text.primary}),$e=({children:e,loading:t=!1,disabled:r=!1,variant:n="primary",size:o="md",startIcon:i,endIcon:l,...c})=>a.jsxs(Cp,{variant:n,size:o,disabled:r||t,loading:t,startIcon:t?void 0:i,endIcon:t?void 0:l,...c,children:[t&&a.jsx(kp,{size:20}),a.jsx("span",{style:{visibility:t?"hidden":"visible"},children:e})]}),jp=j(Gd,{shouldForwardProp:e=>!["variant","size","active"].includes(e)})(({variant:e="default",size:t="md",active:r,disabled:n})=>{const o=(()=>{switch(t){case"small":return"sm";case"medium":return"md";case"large":return"lg";default:return t}})(),i={sm:{width:"32px",height:"32px",fontSize:"18px"},md:{width:"40px",height:"40px",fontSize:"20px"},lg:{width:"48px",height:"48px",fontSize:"24px"}},l={default:{color:s.colors.text.secondary,background:"transparent","&:hover":{background:s.colors.bg.tertiary,color:s.colors.text.primary},"&:active":{background:s.colors.bg.elevated},...r&&{color:s.colors.accent.primary,background:s.colors.bg.tertiary}},primary:{color:s.colors.text.primary,background:s.gradients.aurora,boxShadow:s.shadows.md,"&:hover":{boxShadow:s.shadows.lg,transform:"scale(1.05)"},"&:active":{transform:"scale(1)"}},secondary:{color:s.colors.text.primary,background:s.colors.bg.tertiary,border:`1px solid ${s.colors.border.medium}`,"&:hover":{background:s.colors.bg.elevated,borderColor:s.colors.border.heavy},"&:active":{background:s.colors.bg.tertiary},...r&&{borderColor:s.colors.accent.primary,background:s.colors.bg.elevated}},ghost:{color:s.colors.text.secondary,background:"transparent","&:hover":{color:s.colors.text.primary,background:s.colors.bg.tertiary},...r&&{color:s.colors.accent.primary}}};return{...i[o],...l[e],borderRadius:s.borderRadius.md,transition:s.transitions.all,opacity:n?.5:1,cursor:n?"not-allowed":"pointer","& svg":{fontSize:"inherit"}}}),se=({children:e,tooltip:t,variant:r="default",size:n="md",active:o=!1,disabled:i=!1,...l})=>{const c=a.jsx(jp,{variant:r,size:n,active:o,disabled:i,...l,children:e});return t&&!i?a.jsx(Vi,{title:t,arrow:!0,children:c}):c},Pp=j(qd,{shouldForwardProp:e=>!["variant","padding","hoverable","selected"].includes(e)})(({variant:e="default",padding:t="md",hoverable:r,selected:n})=>{const o={none:{padding:0},sm:{padding:s.spacing.sm},md:{padding:s.spacing.md},lg:{padding:s.spacing.lg}},i={default:{background:s.colors.bg.tertiary,border:"none",boxShadow:s.shadows.none},elevated:{background:s.colors.bg.tertiary,border:"none",boxShadow:s.shadows.md},outlined:{background:s.colors.bg.secondary,border:`1px solid ${s.colors.border.light}`,boxShadow:s.shadows.none}},l=r?{cursor:"pointer",transition:s.transitions.all,"&:hover":{transform:`scale(${s.components.albumCard.hoverScale})`,boxShadow:s.shadows.lg},"&:active":{transform:"scale(1)"}}:{},c=n?{borderColor:s.colors.accent.primary,boxShadow:`0 0 0 2px ${s.colors.accent.primary}`}:{};return{...i[e],...o[t],...l,...c,borderRadius:s.borderRadius.lg,overflow:"hidden","&:focus-visible":{outline:`2px solid ${s.colors.accent.primary}`,outlineOffset:"2px"}}}),kl=({children:e,variant:t="default",padding:r="md",hoverable:n=!1,selected:o=!1,...i})=>a.jsx(Pp,{variant:t,padding:r,hoverable:n,selected:o,...i,children:e}),Ip=j(Qd,{shouldForwardProp:e=>!["variant","size"].includes(e)})(({variant:e="default",size:t="md"})=>{const r={sm:{height:"4px","& .MuiSlider-thumb":{width:"12px",height:"12px"}},md:{height:"6px","& .MuiSlider-thumb":{width:"16px",height:"16px"}},lg:{height:"8px","& .MuiSlider-thumb":{width:"20px",height:"20px"}}},n={default:{color:s.colors.text.secondary,"& .MuiSlider-track":{background:s.colors.text.secondary,border:"none"},"& .MuiSlider-thumb":{background:s.colors.text.primary,boxShadow:s.shadows.md,"&:hover, &.Mui-focusVisible":{boxShadow:s.shadows.glowSoft}},"& .MuiSlider-rail":{background:s.colors.bg.elevated,opacity:1}},gradient:{"& .MuiSlider-track":{background:s.gradients.aurora,border:"none"},"& .MuiSlider-thumb":{background:s.colors.text.primary,boxShadow:s.shadows.glowSoft,"&:hover, &.Mui-focusVisible":{boxShadow:s.shadows.glowMd}},"& .MuiSlider-rail":{background:s.colors.bg.elevated,opacity:1}},accent:{color:s.colors.accent.primary,"& .MuiSlider-track":{background:s.colors.accent.primary,border:"none"},"& .MuiSlider-thumb":{background:s.colors.accent.primary,boxShadow:s.shadows.md,"&:hover, &.Mui-focusVisible":{boxShadow:s.shadows.glowSoft}},"& .MuiSlider-rail":{background:s.colors.bg.elevated,opacity:1}}};return{...r[t],...n[e],borderRadius:s.borderRadius.full,"& .MuiSlider-thumb":{transition:s.transitions.all,"&:hover":{transform:"scale(1.2)"},"&:active":{transform:"scale(1.1)"}},"& .MuiSlider-valueLabel":{background:s.colors.bg.elevated,borderRadius:s.borderRadius.sm,fontSize:s.typography.fontSize.xs,padding:`${s.spacing.xs} ${s.spacing.sm}`,color:s.colors.text.primary}}}),ps=({variant:e="default",size:t="md",showValue:r=!1,...n})=>a.jsx(Ip,{variant:e,size:t,valueLabelDisplay:r?"auto":"off",...n});j(Mt,{shouldForwardProp:e=>!["variant","size"].includes(e)})(({variant:e="default",size:t="md",error:r})=>{const n={sm:{"& .MuiInputBase-root":{height:"32px",fontSize:s.typography.fontSize.sm}},md:{"& .MuiInputBase-root":{height:"40px",fontSize:s.typography.fontSize.base}},lg:{"& .MuiInputBase-root":{height:"48px",fontSize:s.typography.fontSize.md}}},o={default:{"& .MuiInputBase-root":{background:s.colors.bg.level3,borderRadius:s.borderRadius.md,border:`1px solid ${r?s.colors.semantic.error:s.colors.border.medium}`,color:s.colors.text.primary,transition:s.transitions.all,"&:hover":{borderColor:r?s.colors.semantic.error:s.colors.border.heavy},"&.Mui-focused":{borderColor:r?s.colors.semantic.error:s.colors.accent.primary,boxShadow:r?`0 0 12px ${s.colors.semantic.error}20`:s.shadows.glowSoft}},"& .MuiInputBase-input":{padding:`${s.spacing.sm} ${s.spacing.md}`,color:s.colors.text.primary,"&::placeholder":{color:s.colors.text.tertiary,opacity:1}},"& .MuiOutlinedInput-notchedOutline":{border:"none"}},search:{"& .MuiInputBase-root":{background:"rgba(31, 41, 54, 0.60)",borderRadius:s.borderRadius.full,border:`1px solid ${s.colors.border.light}`,color:s.colors.text.primary,transition:s.transitions.all,backdropFilter:"blur(10px)","&:hover":{background:"rgba(31, 41, 54, 0.80)",borderColor:s.colors.border.medium},"&.Mui-focused":{background:"rgba(31, 41, 54, 0.95)",borderColor:s.colors.accent.primary,boxShadow:s.shadows.glowSoft}},"& .MuiInputBase-input":{padding:`${s.spacing.sm} ${s.spacing.lg}`,color:s.colors.text.primary,"&::placeholder":{color:s.colors.text.tertiary,opacity:1}},"& .MuiOutlinedInput-notchedOutline":{border:"none"}}};return{...n[t],...o[e],"& .MuiFormHelperText-root":{marginLeft:s.spacing.sm,marginTop:s.spacing.xs,fontSize:s.typography.fontSize.xs,color:r?s.colors.semantic.error:s.colors.text.tertiary}}});j(Vd,{shouldForwardProp:e=>e!=="variant"})(({variant:e="default"})=>({...{default:{"& .MuiBadge-badge":{background:s.colors.text.secondary,color:s.colors.text.primary}},primary:{"& .MuiBadge-badge":{background:s.gradients.aurora,color:s.colors.text.primary}},success:{"& .MuiBadge-badge":{background:s.colors.semantic.success,color:s.colors.text.primary}},warning:{"& .MuiBadge-badge":{background:s.colors.semantic.warning,color:s.colors.text.primary}},error:{"& .MuiBadge-badge":{background:s.colors.semantic.error,color:s.colors.text.primary}}}[e],"& .MuiBadge-badge":{fontSize:s.typography.fontSize.xs,fontWeight:s.typography.fontWeight.semibold,height:"20px",minWidth:"20px",borderRadius:s.borderRadius.full,padding:`0 ${s.spacing.xs}`}}));const Ep=j(Vi)({"& .MuiTooltip-tooltip":{background:s.colors.bg.elevated,color:s.colors.text.primary,fontSize:s.typography.fontSize.sm,fontWeight:s.typography.fontWeight.medium,padding:`${s.spacing.xs} ${s.spacing.md}`,borderRadius:s.borderRadius.md,boxShadow:s.shadows.lg,border:`1px solid ${s.colors.border.light}`},"& .MuiTooltip-arrow":{color:s.colors.bg.elevated,"&::before":{border:`1px solid ${s.colors.border.light}`}}}),ke=e=>a.jsx(Ep,{...e});j(As,{shouldForwardProp:e=>e!=="size"})(({size:e="md"})=>({"& .MuiDialog-paper":{...{sm:{maxWidth:"400px"},md:{maxWidth:"600px"},lg:{maxWidth:"800px"},xl:{maxWidth:"1200px"}}[e],width:"100%",background:s.colors.bg.level4,borderRadius:s.borderRadius.xl,border:`1px solid ${s.colors.border.light}`,boxShadow:s.shadows["2xl"],backdropFilter:"blur(20px)"},"& .MuiBackdrop-root":{background:"rgba(0, 0, 0, 0.60)",backdropFilter:"blur(4px)"}}));j(Ki)({padding:s.spacing.lg,borderBottom:`1px solid ${s.colors.border.light}`,display:"flex",alignItems:"center",justifyContent:"space-between",color:s.colors.text.primary,fontSize:s.typography.fontSize.xl,fontWeight:s.typography.fontWeight.semibold});j(tr)({padding:s.spacing.lg,color:s.colors.text.secondary});j(kr)({padding:s.spacing.lg,borderTop:`1px solid ${s.colors.border.light}`,gap:s.spacing.sm});const Ap=j(Kd)({backgroundColor:s.colors.bg.level3,color:s.colors.text.primary,fontSize:s.typography.fontSize.sm,fontWeight:s.typography.fontWeight.medium,border:`1px solid ${s.colors.border.light}`,"&:hover":{backgroundColor:s.colors.bg.level4},"& .MuiChip-deleteIcon":{color:s.colors.text.secondary,"&:hover":{color:s.colors.semantic.error}},"&.MuiChip-filled":{backgroundColor:s.colors.bg.level3},"&.MuiChip-outlined":{border:`1px solid ${s.colors.border.medium}`,backgroundColor:"transparent"}}),Dp=e=>a.jsx(Ap,{...e}),Rp=j(Qi)({color:s.colors.accent.primary,"& circle":{strokeLinecap:"round"}}),ho=e=>a.jsx(Rp,{...e}),Tp=j(Yd)({backgroundColor:s.colors.bg.level3,height:6,borderRadius:s.borderRadius.sm,"& .MuiLinearProgress-bar":{backgroundColor:s.colors.accent.primary,borderRadius:s.borderRadius.sm},"& .MuiLinearProgress-bar2Indeterminate":{backgroundColor:s.colors.accent.secondary}}),Mp=e=>a.jsx(Tp,{...e}),$p=j(Xd)({padding:0,backgroundColor:s.colors.bg.level2,borderRadius:s.borderRadius.md,"& .MuiListItem-root":{padding:`${s.spacing.sm} ${s.spacing.md}`,borderBottom:`1px solid ${s.colors.border.light}`,"&:last-child":{borderBottom:"none"}}}),gn=e=>a.jsx($p,{...e}),jn=(e,t)=>{const r=parseInt(e.slice(1,3),16),n=parseInt(e.slice(3,5),16),o=parseInt(e.slice(5,7),16);return`rgba(${r}, ${n}, ${o}, ${t})`},Ta={info:{bg:jn(s.colors.semantic.info,.15),border:s.colors.semantic.info,text:s.colors.semantic.info},success:{bg:jn(s.colors.semantic.success,.15),border:s.colors.semantic.success,text:s.colors.semantic.success},warning:{bg:jn(s.colors.semantic.warning,.15),border:s.colors.semantic.warning,text:s.colors.semantic.warning},error:{bg:jn(s.colors.semantic.error,.15),border:s.colors.semantic.error,text:s.colors.semantic.error}},qn=q.forwardRef(({children:e,variant:t="info",icon:r,onClose:n,className:o=""},i)=>{const l=Ta[t]||Ta.info,c={display:"flex",alignItems:"flex-start",gap:s.spacing.md,padding:s.spacing.md,backgroundColor:l.bg,border:`1px solid ${l.border}`,borderRadius:s.borderRadius.md,color:l.text},d={flex:1,fontSize:s.typography.fontSize.sm,lineHeight:s.typography.lineHeight.normal},u={background:"none",border:"none",color:l.text,cursor:"pointer",padding:0,fontSize:s.typography.fontSize.lg,lineHeight:1};return a.jsxs("div",{ref:i,style:c,className:o,children:[r&&a.jsx("div",{children:r}),a.jsx("div",{style:d,children:e}),n&&a.jsx("button",{style:u,onClick:n,"aria-label":"Close alert",children:""})]})});qn.displayName="Alert";const Fp=q.forwardRef(({children:e,as:t="div",display:r,flexDirection:n,alignItems:o,justifyContent:i,gap:l,padding:c,paddingX:d,paddingY:u,margin:f,marginX:p,marginY:h,width:m,height:y,maxWidth:b,minWidth:x,maxHeight:S,minHeight:v,flex:k,flexShrink:C,flexGrow:I,overflow:E,overflowX:$,overflowY:F,position:O,top:A,right:R,bottom:U,left:L,bg:ae,color:K,borderRadius:Z,border:T,boxShadow:N,opacity:Q,style:ee={},className:re,onClick:W},V)=>{const pe={display:r,flexDirection:n,alignItems:o,justifyContent:i,gap:l?s.spacing[l]:void 0,padding:c?s.spacing[c]:void 0,paddingLeft:d?s.spacing[d]:void 0,paddingRight:d?s.spacing[d]:void 0,paddingTop:u?s.spacing[u]:void 0,paddingBottom:u?s.spacing[u]:void 0,margin:f?s.spacing[f]:void 0,marginLeft:p?s.spacing[p]:void 0,marginRight:p?s.spacing[p]:void 0,marginTop:h?s.spacing[h]:void 0,marginBottom:h?s.spacing[h]:void 0,width:m,height:y,maxWidth:b,minWidth:x,maxHeight:S,minHeight:v,flex:k,flexShrink:C,flexGrow:I,overflow:E,overflowX:$,overflowY:F,position:O,top:A,right:R,bottom:U,left:L,backgroundColor:ae,color:K,borderRadius:Z?s.borderRadius[Z]:void 0,border:T,boxShadow:N,opacity:Q,...ee};return a.jsx(t,{ref:V,style:pe,className:re,onClick:W,children:e})});Fp.displayName="Box";const _p=q.forwardRef(({label:e,error:t,className:r="",...n},o)=>{const i={display:"flex",alignItems:"center",gap:s.spacing.sm},l={width:"18px",height:"18px",cursor:"pointer",accentColor:s.colors.accent.primary},c={fontSize:s.typography.fontSize.base,color:s.colors.text.primary,cursor:"pointer",userSelect:"none"},d={fontSize:s.typography.fontSize.xs,color:s.colors.semantic.error,marginTop:s.spacing.xs};return a.jsxs("div",{className:r,children:[a.jsxs("div",{style:i,children:[a.jsx("input",{ref:o,type:"checkbox",style:l,...n}),e&&a.jsx("label",{style:c,children:e})]}),t&&a.jsx("div",{style:d,children:t})]})});_p.displayName="Checkbox";const Op={sm:"480px",md:"768px",lg:"1024px",xl:"1280px",full:"100%"},Bp=q.forwardRef(({children:e,maxWidth:t="lg",padding:r="lg",className:n=""},o)=>{const i={maxWidth:Op[t],margin:"0 auto",padding:s.spacing[r],width:"100%",boxSizing:"border-box"};return a.jsx("div",{ref:o,style:i,className:n,children:e})});Bp.displayName="Container";let Hk=class extends q.Component{constructor(r){super(r);B(this,"handleRetry",()=>{this.setState({hasError:!1,error:null})});this.state={hasError:!1,error:null}}static getDerivedStateFromError(r){return{hasError:!0,error:r}}componentDidCatch(r,n){var o,i;(i=(o=this.props).onError)==null||i.call(o,r,n)}render(){if(this.state.hasError&&this.state.error){if(this.props.fallback)return this.props.fallback(this.state.error,this.handleRetry);const r={padding:s.spacing.lg,backgroundColor:s.colors.semantic.error+"15",border:`1px solid ${s.colors.semantic.error}`,borderRadius:s.borderRadius.md,margin:s.spacing.lg},n={color:s.colors.semantic.error,fontSize:s.typography.fontSize.lg,fontWeight:s.typography.fontWeight.semibold,marginBottom:s.spacing.md},o={color:s.colors.text.secondary,fontSize:s.typography.fontSize.sm,marginBottom:s.spacing.md,fontFamily:s.typography.fontFamily.mono,overflow:"auto",maxHeight:"200px"},i={padding:`${s.spacing.sm} ${s.spacing.md}`,backgroundColor:s.colors.accent.primary,color:s.colors.text.primary,border:"none",borderRadius:s.borderRadius.md,cursor:"pointer",fontSize:s.typography.fontSize.sm,fontWeight:s.typography.fontWeight.medium};return a.jsxs("div",{style:r,children:[a.jsx("h3",{style:n,children:"Something went wrong"}),a.jsx("pre",{style:o,children:this.state.error.toString()}),a.jsx("button",{style:i,onClick:this.handleRetry,children:"Try again"})]})}return this.props.children}};const Lp=q.forwardRef(({children:e,columns:t,spacing:r="md",minColWidth:n="200px",className:o=""},i)=>{const c={display:"grid",gap:s.spacing[r],gridTemplateColumns:t?`repeat(${t}, 1fr)`:`repeat(auto-fit, minmax(${n}, 1fr))`};return a.jsx("div",{ref:i,style:c,className:o,children:e})});Lp.displayName="Grid";const zp={primary:s.colors.accent.primary,success:s.colors.semantic.success,warning:s.colors.semantic.warning,error:s.colors.semantic.error},Np={sm:"4px",md:"8px",lg:"12px"},Wp=q.forwardRef(({value:e,max:t=100,label:r,showValue:n=!1,color:o="primary",size:i="md",className:l=""},c)=>{const d=Math.min(e/t*100,100),u=Np[i],f=zp[o],p={display:"flex",flexDirection:"column",gap:s.spacing.sm},h={display:"flex",justifyContent:"space-between",alignItems:"center",fontSize:s.typography.fontSize.sm,color:s.colors.text.secondary},m={width:"100%",height:u,backgroundColor:s.colors.bg.secondary,borderRadius:s.borderRadius.full,overflow:"hidden"},y={height:"100%",width:`${d}%`,backgroundColor:f,transition:s.transitions.base,borderRadius:s.borderRadius.full};return a.jsxs("div",{ref:c,style:p,className:l,children:[(r||n)&&a.jsxs("div",{style:h,children:[r&&a.jsx("span",{children:r}),n&&a.jsxs("span",{children:[Math.round(d),"%"]})]}),a.jsx("div",{style:m,children:a.jsx("div",{style:y})})]})});Wp.displayName="ProgressBar";const Up=q.forwardRef(({children:e,direction:t="column",spacing:r="md",align:n="flex-start",justify:o="flex-start",className:i=""},l)=>{const c=s.spacing[r],d={display:"flex",flexDirection:t,gap:c,alignItems:n,justifyContent:o};return a.jsx("div",{ref:l,style:d,className:i,children:e})});Up.displayName="Stack";const Hp={display:{fontSize:s.typography.fontSize.xxl,fontWeight:s.typography.fontWeight.bold,lineHeight:1.2},title:{fontSize:s.typography.fontSize.xl,fontWeight:s.typography.fontWeight.bold,lineHeight:1.3},heading:{fontSize:s.typography.fontSize.lg,fontWeight:s.typography.fontWeight.semibold,lineHeight:1.4},body:{fontSize:s.typography.fontSize.base,fontWeight:s.typography.fontWeight.normal,lineHeight:1.5},caption:{fontSize:s.typography.fontSize.sm,fontWeight:s.typography.fontWeight.normal,lineHeight:1.4},label:{fontSize:s.typography.fontSize.xs,fontWeight:s.typography.fontWeight.medium,lineHeight:1.4,textTransform:"uppercase",letterSpacing:"0.5px"}},Gp=q.forwardRef(({children:e,as:t="span",variant:r="body",size:n,weight:o,color:i,opacity:l,align:c,truncate:d,className:u,style:f={}},p)=>{const h=Hp[r],m={fontFamily:s.typography.fontFamily.primary,margin:0,...h,...n&&{fontSize:s.typography.fontSize[n]},...o&&{fontWeight:s.typography.fontWeight[o]},...i&&{color:i},...l!==void 0&&{opacity:l},...c&&{textAlign:c},...d&&{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},...f};return a.jsx(t,{ref:p,style:m,className:u,children:e})});Gp.displayName="Text";const qp=q.forwardRef(({label:e,error:t,className:r="",...n},o)=>{const i={display:"flex",alignItems:"center",gap:s.spacing.md},l={position:"relative",display:"inline-flex",width:"48px",height:"28px"},c={appearance:"none",width:"100%",height:"100%",margin:0,padding:0,cursor:"pointer",backgroundColor:s.colors.bg.secondary,border:`2px solid ${s.colors.border.light}`,borderRadius:s.borderRadius.full,transition:s.transitions.all,outline:"none"},d={fontSize:s.typography.fontSize.base,color:s.colors.text.primary,cursor:"pointer",userSelect:"none"},u={fontSize:s.typography.fontSize.xs,color:s.colors.semantic.error,marginTop:s.spacing.xs};return a.jsxs("div",{className:r,children:[a.jsxs("div",{style:i,children:[a.jsx("div",{style:l,children:a.jsx("input",{ref:o,type:"checkbox",style:c,...n})}),e&&a.jsx("label",{style:d,children:e})]}),t&&a.jsx("div",{style:u,children:t})]})});qp.displayName="Toggle";const Mo=(e,t)=>{const r=parseInt(e.slice(1,3),16),n=parseInt(e.slice(3,5),16),o=parseInt(e.slice(5,7),16);return`rgba(${r}, ${n}, ${o}, ${t})`},Qp=e=>{switch(e){case"success":return Mo(s.colors.semantic.success,.15);case"error":return Mo(s.colors.semantic.error,.15);case"warning":return Mo(s.colors.semantic.warning,.15);case"info":return"rgba(102, 126, 234, 0.1)";default:return s.colors.bg.secondary}},Ma=e=>{switch(e){case"success":return s.colors.semantic.success;case"error":return s.colors.semantic.error;case"warning":return s.colors.semantic.warning;case"info":return"#667eea";default:return s.colors.text.disabled}},Vp=ie`
  from {
    transform: translateX(100%);
    opacity: 0;
  }
  to {
    transform: translateX(0);
    opacity: 1;
  }
`,Kp=j(qn)(({severity:e})=>({background:Qp(e),color:s.colors.text.primary,border:`1px solid ${Ma(e)}`,borderRadius:s.borderRadius.md,boxShadow:s.shadows.md,backdropFilter:"blur(12px)",animation:`${Vp} ${s.transitions.base}`,fontSize:s.typography.fontSize.base,fontWeight:s.typography.fontWeight.medium,"& .MuiAlert-icon":{color:Ma(e)},"& .MuiAlert-message":{padding:`${s.spacing.xs} 0`}})),Yp=({toast:e,index:t,onClose:r})=>{const n=g.useCallback(()=>{r(e.id)},[e.id,r]);return a.jsx(Jd,{open:!0,autoHideDuration:e.duration,onClose:n,anchorOrigin:{vertical:"top",horizontal:"right"},sx:{top:`${24+t*70}px !important`,transition:"top 0.3s ease"},children:a.jsx(Kp,{severity:e.type,onClose:n,variant:"filled",children:e.message})},e.id)},Xp=({maxToasts:e,onAdd:t})=>{const r=g.useCallback((c,d="info",u=4e3)=>{const p={id:`toast-${Date.now()}-${Math.random()}`,message:c,type:d,duration:u};t(p)},[e,t]),n=g.useCallback((c,d)=>{r(c,"success",d)},[r]),o=g.useCallback((c,d)=>{r(c,"error",d)},[r]),i=g.useCallback((c,d)=>{r(c,"info",d)},[r]),l=g.useCallback((c,d)=>{r(c,"warning",d)},[r]);return g.useMemo(()=>({showToast:r,success:n,error:o,info:i,warning:l}),[r,n,o,i,l])},jl=g.createContext(void 0),Fe=()=>{const e=g.useContext(jl);if(!e)throw new Error("useToast must be used within a ToastProvider");return e},Jp=({children:e,maxToasts:t=3})=>{const[r,n]=g.useState([]),o=g.useCallback(c=>{n(d=>[...d,c].slice(-t))},[t]),i=Xp({maxToasts:t,onAdd:o}),l=g.useCallback(c=>{n(d=>d.filter(u=>u.id!==c))},[]);return a.jsxs(jl.Provider,{value:i,children:[e,r.map((c,d)=>a.jsx(Yp,{toast:c,index:d,onClose:l},c.id))]})},Zp={maxReconnectAttempts:10,initialReconnectDelayMs:1e3,maxReconnectDelayMs:3e4,backoffMultiplier:1.5};class eh{constructor(t,r={}){B(this,"ws",null);B(this,"reconnectAttempts",0);B(this,"reconnectTimeout",null);B(this,"heartbeatInterval",null);B(this,"config");B(this,"url");B(this,"onOpen",null);B(this,"onClose",null);B(this,"onMessage",null);B(this,"onError",null);this.url=t,this.config={...Zp,...r}}async connect(){return new Promise((t,r)=>{try{this.ws=new WebSocket(this.url),this.ws.onopen=()=>{var n;console.log("[WebSocketManager] Connected"),this.reconnectAttempts=0,this.startHeartbeat(),(n=this.onOpen)==null||n.call(this),t()},this.ws.onerror=n=>{var o;console.error("[WebSocketManager] Error:",n),(o=this.onError)==null||o.call(this,n),r(n)},this.ws.onmessage=n=>{var o;(o=this.onMessage)==null||o.call(this,n)},this.ws.onclose=()=>{var n;console.log("[WebSocketManager] Disconnected"),this.stopHeartbeat(),(n=this.onClose)==null||n.call(this),this.attemptReconnect()}}catch(n){r(n)}})}attemptReconnect(){var n,o,i,l;if(this.reconnectAttempts>=this.config.maxReconnectAttempts){console.error("[WebSocketManager] Max reconnection attempts exceeded"),(o=(n=this.config).onMaxAttemptsExceeded)==null||o.call(n);return}const t=this.config.initialReconnectDelayMs*Math.pow(this.config.backoffMultiplier,this.reconnectAttempts),r=Math.min(t,this.config.maxReconnectDelayMs);this.reconnectAttempts++,console.log(`[WebSocketManager] Reconnection attempt ${this.reconnectAttempts}/${this.config.maxReconnectAttempts} in ${r}ms`),(l=(i=this.config).onReconnectAttempt)==null||l.call(i,this.reconnectAttempts,r),this.reconnectTimeout=setTimeout(()=>{this.connect().catch(c=>{console.error("[WebSocketManager] Reconnection failed:",c),this.attemptReconnect()})},r)}startHeartbeat(){this.heartbeatInterval=setInterval(()=>{if(this.ws&&this.ws.readyState===WebSocket.OPEN)try{this.ws.send(JSON.stringify({type:"heartbeat"}))}catch(t){console.warn("[WebSocketManager] Failed to send heartbeat:",t)}},3e4)}stopHeartbeat(){this.heartbeatInterval&&(clearInterval(this.heartbeatInterval),this.heartbeatInterval=null)}on(t,r){switch(t){case"open":this.onOpen=r;break;case"close":this.onClose=r;break;case"message":this.onMessage=r;break;case"error":this.onError=r;break}}send(t){if(this.ws&&this.ws.readyState===WebSocket.OPEN)try{return this.ws.send(t),!0}catch(r){return console.error("[WebSocketManager] Failed to send message:",r),!1}return!1}close(){this.reconnectTimeout&&clearTimeout(this.reconnectTimeout),this.stopHeartbeat(),this.ws&&this.ws.close()}isConnected(){return this.ws!==null&&this.ws.readyState===WebSocket.OPEN}}const Pl=g.createContext(null);let mt=null,rr=0;const th=new Map,rh=new Set,nh=({children:e,url:t=window.location.hostname==="localhost"&&parseInt(window.location.port)>=3e3?"ws://localhost:8765/ws":`${window.location.protocol==="https:"?"wss":"ws"}://${window.location.host}/ws`})=>{const r=g.useRef(null),[n,o]=g.useState(!1),[i,l]=g.useState("disconnected"),c=g.useRef(th),d=g.useRef(rh),u=g.useRef([]),f=g.useRef(!0),p=g.useCallback(async()=>{if(rr++,console.log(` WebSocket provider mounted (ref count: ${rr})`),mt!=null&&mt.isConnected()){console.log(" Reusing existing WebSocket connection (singleton)"),r.current=mt,o(!0),l("connected");return}console.log(" Creating new WebSocket connection:",t),l("connecting");try{const v=new eh(t,{maxReconnectAttempts:10,initialReconnectDelayMs:1e3,backoffMultiplier:2,maxReconnectDelayMs:3e4,onReconnectAttempt:(k,C)=>{console.log(` Reconnection attempt ${k}/10 (waiting ${C}ms)`)}});mt=v,r.current=v,v.on("message",k=>{try{const C=JSON.parse(k.data);if(d.current.forEach(I=>{try{I(C)}catch(E){console.error("Error in global WebSocket handler:",E)}}),C.type){const I=c.current.get(C.type);I&&I.forEach(E=>{try{E(C)}catch($){console.error(`Error in WebSocket handler for type "${C.type}":`,$)}})}}catch(C){console.error("Failed to parse WebSocket message:",C)}}),v.on("open",()=>{for(console.log(" WebSocket connected (singleton)"),f.current&&(o(!0),l("connected"));u.current.length>0;){const k=u.current.shift();v.send(JSON.stringify(k))}}),v.on("error",k=>{console.error(" WebSocket error:",k),f.current&&l("error")}),v.on("close",()=>{console.log(" WebSocket disconnected (will auto-reconnect)"),f.current&&(o(!1),l("disconnected"))}),await v.connect()}catch(S){console.error("Failed to create WebSocket connection:",S),l("error")}},[t]),h=g.useCallback(()=>{rr=Math.max(0,rr-1),console.log(` WebSocket provider unmounted (ref count: ${rr})`),rr===0&&mt&&(console.log(" Last provider unmounted - closing singleton WebSocket connection"),mt.close(),mt=null),r.current=null,o(!1),l("disconnected")},[]),m=g.useCallback((S,v)=>(c.current.has(S)||c.current.set(S,new Set),c.current.get(S).add(v),console.log(` Subscribed to message type: ${S}`),()=>{const k=c.current.get(S);k&&(k.delete(v),k.size===0&&c.current.delete(S)),console.log(` Unsubscribed from message type: ${S}`)}),[]),y=g.useCallback(S=>(d.current.add(S),console.log(" Subscribed to all messages"),()=>{d.current.delete(S),console.log(" Unsubscribed from all messages")}),[]),b=g.useCallback(S=>{var v;(v=r.current)!=null&&v.isConnected()?r.current.send(JSON.stringify(S)):(console.warn("WebSocket not connected, queueing message"),u.current.push(S))},[]);g.useEffect(()=>(p(),()=>{f.current=!1,h()}),[p,h]);const x={isConnected:n,connectionStatus:i,subscribe:m,subscribeAll:y,send:b,connect:p,disconnect:h};return a.jsx(Pl.Provider,{value:x,children:e})},Ot=()=>{const e=g.useContext(Pl);if(!e)throw new Error("useWebSocketContext must be used within WebSocketProvider");return e},Il=g.createContext(void 0),El=()=>{const e=g.useContext(Il);if(!e)throw new Error("useEnhancement must be used within EnhancementProvider");return e},oh=({children:e})=>{const[t,r]=g.useState({enabled:!0,preset:"adaptive",intensity:1}),[n,o]=g.useState(!1),{subscribe:i}=Ot();g.useEffect(()=>{console.log(" EnhancementContext: Setting up WebSocket subscriptions");const f=i("enhancement_toggled",m=>{try{r(y=>({...y,enabled:m.data.enabled,preset:m.data.preset,intensity:m.data.intensity}))}catch(y){console.error("Error handling enhancement_toggled:",y)}}),p=i("enhancement_preset_changed",m=>{try{r(y=>({...y,preset:m.data.preset,enabled:m.data.enabled,intensity:m.data.intensity}))}catch(y){console.error("Error handling enhancement_preset_changed:",y)}}),h=i("enhancement_intensity_changed",m=>{try{r(y=>({...y,intensity:m.data.intensity,enabled:m.data.enabled,preset:m.data.preset}))}catch(y){console.error("Error handling enhancement_intensity_changed:",y)}});return()=>{console.log(" EnhancementContext: Cleaning up WebSocket subscriptions"),f(),p(),h()}},[i]);const l=g.useCallback(async f=>{try{o(!0);const p=`/api/player/enhancement/toggle?enabled=${f}`;console.log("Calling enhancement toggle API:",p);const h=await fetch(p,{method:"POST",headers:{"Content-Type":"application/json"}});if(console.log("Enhancement toggle response:",h.status,h.statusText),!h.ok){const y=await h.text();throw console.error("Enhancement toggle failed:",y),new Error(`Failed to toggle enhancement: ${h.statusText} - ${y}`)}const m=await h.json();console.log("Enhancement toggle success:",m),r(y=>({...y,enabled:m.settings.enabled}))}catch(p){throw console.error("Failed to set enhancement enabled:",p),p}finally{o(!1)}},[]),c=g.useCallback(async f=>{try{o(!0);const p=await fetch(`/api/player/enhancement/preset?preset=${f}`,{method:"POST",headers:{"Content-Type":"application/json"}});if(!p.ok)throw new Error(`Failed to set preset: ${p.statusText}`);const h=await p.json();r(m=>({...m,preset:h.settings.preset}))}catch(p){console.error("Failed to set enhancement preset:",p)}finally{o(!1)}},[]),d=g.useCallback(async f=>{const p=Math.max(0,Math.min(1,f));try{o(!0);const h=await fetch(`/api/player/enhancement/intensity?intensity=${p}`,{method:"POST",headers:{"Content-Type":"application/json"}});if(!h.ok)throw new Error(`Failed to set intensity: ${h.statusText}`);const m=await h.json();r(y=>({...y,intensity:m.settings.intensity}))}catch(h){console.error("Failed to set enhancement intensity:",h)}finally{o(!1)}},[]),u={settings:t,setEnabled:l,setPreset:c,setIntensity:d,isProcessing:n};return a.jsx(Il.Provider,{value:u,children:e})};function _n(e,t=!1){if(!Number.isFinite(e)||e<0)return"0:00";const r=Math.floor(e),n=Math.floor(r/3600),o=Math.floor(r%3600/60),i=r%60;return n>0||t?`${n}:${o.toString().padStart(2,"0")}:${i.toString().padStart(2,"0")}`:`${o}:${i.toString().padStart(2,"0")}`}function sh({currentTime:e,duration:t,isPlaying:r=!1,bufferedPercentage:n=0,forceShowHours:o=!1}){const i=g.useMemo(()=>_n(e,o||t>=3600),[e,o,t]),l=g.useMemo(()=>_n(t,o||t>=3600),[t,o]),c=g.useMemo(()=>{if(!Number.isFinite(t)||t<=0)return 0;const b=e/t*100;return Math.min(Math.max(b,0),100)},[e,t]),d=g.useMemo(()=>!Number.isFinite(t)||t<=0?0:t-e,[e,t]),u=g.useMemo(()=>{const b=d;return b<=0?"0:00":`-${_n(b,o||t>=3600)}`},[d,o,t]),f=g.useMemo(()=>{const b=Math.min(Math.max(n,0),100);return`${Math.round(b)}%`},[n]),p=g.useMemo(()=>!Number.isFinite(t)||t===0,[t]),h=g.useMemo(()=>r?"Pause":"Play",[r]),m=g.useMemo(()=>p?"LIVE":`${i} / ${l}`,[i,l,p]),y=g.useMemo(()=>p?"LIVE":`${i} / ${l} (${u})`,[i,l,u,p]);return{currentTimeStr:i,durationStr:l,timeRemainingStr:u,progressPercentage:c,bufferedPercentageStr:f,playPauseLabel:h,isLiveContent:p,fullTimeDisplay:m,fullTimeWithRemaining:y}}function sr(e,t=!1){return _n(e,t)}const ah=({currentTime:e,duration:t,showRemaining:r=!1,className:n="",ariaLabel:o})=>{const i=g.useMemo(()=>!Number.isFinite(t)||t===0,[t]),l=g.useMemo(()=>sr(e,t>=3600),[e,t]),c=g.useMemo(()=>{if(i)return"";if(r){const f=Math.max(0,t-e);return`-${sr(f,t>=3600)}`}return sr(t,t>=3600)},[t,e,r,i]),d=g.useMemo(()=>i?"LIVE":r?`${l} / ${c}`:`${l} / ${c}`,[l,c,i,r]),u=g.useMemo(()=>o||(i?"Live stream":r?`Time remaining: ${c}`:`Duration: ${c}`),[o,i,r,c]);return a.jsx("time",{className:n,"aria-label":u,style:{fontFamily:s.typography.fontFamily.mono,fontSize:s.typography.fontSize.sm,color:s.colors.text.secondary,userSelect:"none"},"data-testid":"time-display",title:d,children:d})},ih=({bufferedPercentage:e,isBuffering:t=!1,isError:r=!1,errorMessage:n,className:o="",ariaLabel:i})=>{const l=g.useMemo(()=>Number.isNaN(e)?0:Math.min(Math.max(e,0),100),[e]),c=g.useMemo(()=>`${Math.round(l)}%`,[l]),d=g.useMemo(()=>r?n||"Playback error":t?"Buffering...":`Buffered: ${c}`,[r,t,n,c]),u=g.useMemo(()=>i||(r?n||"Playback error":t?"Buffering content, please wait":`${c} of content buffered`),[i,r,t,n,c]);return a.jsxs("div",{className:o,"data-testid":"buffering-indicator",role:"status","aria-label":u,"aria-live":"polite",style:{display:"flex",flexDirection:"column",gap:s.spacing.xs},children:[a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:s.spacing.xs},children:[a.jsx("div",{style:{flex:1,height:"4px",backgroundColor:s.colors.bg.tertiary,borderRadius:"2px",overflow:"hidden",position:"relative"},children:a.jsx("div",{style:{height:"100%",width:`${l}%`,backgroundColor:s.colors.accent.secondary,transition:"width 0.2s ease-out"},"data-testid":"buffered-bar"})}),a.jsx("span",{style:{minWidth:"35px",textAlign:"right",fontSize:s.typography.fontSize.xs,color:s.colors.text.tertiary,fontFamily:s.typography.fontFamily.mono},"data-testid":"buffered-percentage",children:c})]}),(t||r)&&a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:s.spacing.xs,fontSize:s.typography.fontSize.xs,color:r?s.colors.semantic.error:s.colors.text.secondary},"data-testid":"buffering-status",children:[t&&!r&&a.jsx("div",{style:{width:"12px",height:"12px",borderRadius:"50%",border:`2px solid ${s.colors.accent.primary}`,borderTopColor:s.colors.accent.secondary,animation:"spin 1s linear infinite"},"data-testid":"buffering-spinner"}),a.jsx("span",{children:d})]}),a.jsx("style",{children:`
        @keyframes spin {
          to {
            transform: rotate(360deg);
          }
        }
      `})]})},lh=({currentTime:e,duration:t,bufferedPercentage:r=0,onSeek:n,disabled:o=!1,className:i="",ariaLabel:l})=>{const c=g.useRef(null),[d,u]=g.useState(!1),[f,p]=g.useState(0),[h,m]=g.useState(!1),[y,b]=g.useState(!1),x=g.useMemo(()=>{if(!Number.isFinite(t)||t<=0)return 0;const K=e/t*100;return Math.min(Math.max(K,0),100)},[e,t]),S=g.useMemo(()=>Math.min(Math.max(r,0),100),[r]),v=g.useMemo(()=>sr(f,t>=3600),[f,t]),k=g.useCallback(K=>{if(!c.current)return e;const Z=c.current.getBoundingClientRect(),T=("clientX"in K?K.clientX:K.pageX)-Z.left;return Math.max(0,Math.min(1,T/Z.width))*t},[t,e]),C=g.useCallback(K=>{if(o||!Number.isFinite(t)||t<=0)return;const Z=k(K);n(Z)},[o,t,k,n]),I=g.useCallback(K=>{if(o||!c.current)return;const Z=k(K);p(Z)},[o,k]),E=g.useCallback(K=>{if(o||!Number.isFinite(t)||t<=0)return;m(!0);const Z=k(K);n(Z)},[o,t,k,n]),$=g.useCallback(K=>{if(!h||!c.current)return;const Z=k(K);n(Z)},[h,k,n]),F=g.useCallback(()=>{m(!1)},[]),O=g.useCallback(K=>{if(o||!Number.isFinite(t)||t<=0)return;const Z=1;let T=null;switch(K.key){case"ArrowLeft":case"ArrowDown":K.preventDefault(),T=Math.max(0,e-Z);break;case"ArrowRight":case"ArrowUp":K.preventDefault(),T=Math.min(t,e+Z);break;case"Home":K.preventDefault(),T=0;break;case"End":K.preventDefault(),T=t;break;default:return}T!==null&&n(T)},[o,t,e,n]),A=g.useCallback(K=>{if(o||!Number.isFinite(t)||t<=0)return;m(!0);const Z=K.touches[0];if(!Z||!c.current)return;const T=c.current.getBoundingClientRect(),N=Z.clientX-T.left,ee=Math.max(0,Math.min(1,N/T.width))*t;n(ee)},[o,t,n]),R=g.useCallback(K=>{if(!h||!c.current)return;K.preventDefault();const Z=K.touches[0];if(!Z)return;const T=c.current.getBoundingClientRect(),N=Z.clientX-T.left,ee=Math.max(0,Math.min(1,N/T.width))*t;n(ee)},[h,t,n]),U=g.useCallback(()=>{m(!1)},[]);q.useEffect(()=>{if(h)return document.addEventListener("mousemove",$),document.addEventListener("mouseup",F),()=>{document.removeEventListener("mousemove",$),document.removeEventListener("mouseup",F)}},[h,$,F]);const L=g.useMemo(()=>l||"Track progress slider. Use arrow keys to seek.",[l]),ae=g.useMemo(()=>`${sr(e,t>=3600)} of ${sr(t,t>=3600)}`,[e,t]);return a.jsx("div",{className:i,"data-testid":"progress-bar",style:{position:"relative",width:"100%"},children:a.jsxs("div",{ref:c,role:"slider",tabIndex:o?-1:0,"aria-label":L,"aria-valuemin":0,"aria-valuemax":Math.round(t),"aria-valuenow":Math.round(e),"aria-valuetext":ae,"aria-disabled":o,onMouseEnter:()=>u(!0),onMouseLeave:()=>u(!1),onMouseMove:I,onClick:C,onMouseDown:E,onTouchStart:A,onTouchMove:R,onTouchEnd:U,onKeyDown:O,onFocus:()=>b(!0),onBlur:()=>b(!1),style:{position:"relative",height:"24px",cursor:o?"default":"pointer",padding:"8px 0",userSelect:"none",outline:"none",borderRadius:s.borderRadius.md,transition:y&&!o?"0.2s outline":"none",...y&&!o&&{outline:`3px solid ${s.colors.accent.primary}`,outlineOffset:"2px"}},"data-testid":"progress-bar-container",children:[a.jsxs("div",{style:{position:"absolute",top:"50%",transform:"translateY(-50%)",width:"100%",height:"6px",backgroundColor:s.colors.bg.tertiary,borderRadius:s.borderRadius.full,overflow:"hidden",boxShadow:"inset 0 1px 3px rgba(0, 0, 0, 0.2)"},"data-testid":"progress-bar-track",children:[a.jsx("div",{style:{position:"absolute",height:"100%",width:`${S}%`,backgroundColor:s.colors.accent.secondary,opacity:.4,transition:h?"none":"width 0.1s ease-out"},"data-testid":"progress-bar-buffered"}),a.jsx("div",{style:{position:"absolute",height:"100%",width:`${x}%`,background:s.gradients.aurora,transition:h?"none":"width 0.1s ease-out"},"data-testid":"progress-bar-played"})]}),a.jsx("div",{style:{position:"absolute",top:"50%",left:`${x}%`,transform:"translate(-50%, -50%)",width:h?"16px":"12px",height:h?"16px":"12px",backgroundColor:s.colors.accent.primary,borderRadius:"50%",boxShadow:h?s.shadows.glowMd:s.shadows.glowSoft,transition:"all 0.1s ease-out",pointerEvents:"none",border:`2px solid ${s.colors.bg.level1}`},"data-testid":"progress-bar-thumb"}),d&&!o&&a.jsx("div",{style:{position:"absolute",top:"-40px",left:`${Math.min(Math.max(f/t*100,0),100)}%`,transform:"translateX(-50%)",backgroundColor:s.colors.bg.secondary,color:s.colors.text.primary,padding:`${s.spacing.sm} ${s.spacing.md}`,borderRadius:s.borderRadius.md,fontSize:s.typography.fontSize.xs,fontFamily:s.typography.fontFamily.mono,fontWeight:s.typography.fontWeight.semibold,whiteSpace:"nowrap",pointerEvents:"none",border:`1px solid ${s.colors.accent.primary}`,boxShadow:s.shadows.md,zIndex:1e3},"data-testid":"progress-bar-tooltip",children:v})]})})},nr={container:{display:"flex",alignItems:"center",gap:s.spacing.md,justifyContent:"center",flex:"0 0 auto"},primaryButton:{display:"flex",alignItems:"center",justifyContent:"center",width:"56px",height:"56px",padding:0,background:s.gradients.aurora,border:"none",borderRadius:s.borderRadius.full,cursor:"pointer",fontSize:s.typography.fontSize.xl,fontWeight:s.typography.fontWeight.bold,color:s.colors.text.primary,transition:s.transitions.all,boxShadow:s.shadows.md,outline:"none",":disabled":{opacity:.5,cursor:"not-allowed"}},secondaryButton:{display:"flex",alignItems:"center",justifyContent:"center",width:"40px",height:"40px",padding:0,backgroundColor:"transparent",border:`1px solid ${s.colors.border.light}`,borderRadius:s.borderRadius.md,cursor:"pointer",fontSize:s.typography.fontSize.md,color:s.colors.text.primary,transition:s.transitions.all,outline:"none",":disabled":{opacity:.5,cursor:"not-allowed"}},loadingIndicator:{fontSize:s.typography.fontSize.xs,color:s.colors.text.secondary,marginLeft:s.spacing.sm,fontStyle:"italic"}},ch=({isPlaying:e,onPlay:t,onPause:r,onNext:n,onPrevious:o,isLoading:i=!1,className:l="",disabled:c=!1})=>{const d=g.useMemo(()=>c||i,[c,i]);return a.jsxs("div",{className:l,"data-testid":"playback-controls",style:nr.container,children:[a.jsx("button",{onClick:o,disabled:d,"data-testid":"playback-controls-previous","aria-label":"Previous track ( )",title:"Previous track (  )",style:{...nr.secondaryButton,opacity:d?.7:1,color:d?s.colors.text.disabled:s.colors.text.secondary,cursor:d?"not-allowed":"pointer"},onMouseEnter:u=>{d||(u.currentTarget.style.backgroundColor=s.colors.bg.tertiary,u.currentTarget.style.borderColor=s.colors.accent.primary,u.currentTarget.style.transform="scale(1.05)")},onMouseLeave:u=>{u.currentTarget.style.backgroundColor="transparent",u.currentTarget.style.borderColor=s.colors.border.light,u.currentTarget.style.transform="scale(1)"},onFocus:u=>{d||(u.currentTarget.style.outline=`3px solid ${s.colors.accent.primary}`,u.currentTarget.style.outlineOffset="2px")},onBlur:u=>{u.currentTarget.style.outline="none"},children:""}),e?a.jsx("button",{onClick:r,disabled:d,"data-testid":"playback-controls-pause","aria-label":"Pause (Space )",title:"Pause playback ( Space )",style:{...nr.primaryButton,opacity:d?.7:1,color:d?s.colors.text.disabled:s.colors.text.primary,cursor:d?"not-allowed":"pointer"},onMouseEnter:u=>{d||(u.currentTarget.style.transform="scale(1.08)",u.currentTarget.style.boxShadow=s.shadows.glowMd)},onMouseLeave:u=>{u.currentTarget.style.transform="scale(1)",u.currentTarget.style.boxShadow=s.shadows.md},onFocus:u=>{d||(u.currentTarget.style.outline=`3px solid ${s.colors.accent.primary}`,u.currentTarget.style.outlineOffset="2px")},onBlur:u=>{u.currentTarget.style.outline="none"},children:""}):a.jsx("button",{onClick:t,disabled:d,"data-testid":"playback-controls-play","aria-label":"Play (Space )",title:"Play ( Space )",style:{...nr.primaryButton,opacity:d?.7:1,color:d?s.colors.text.disabled:s.colors.text.primary,cursor:d?"not-allowed":"pointer"},onMouseEnter:u=>{d||(u.currentTarget.style.transform="scale(1.08)",u.currentTarget.style.boxShadow=s.shadows.glowMd)},onMouseLeave:u=>{u.currentTarget.style.transform="scale(1)",u.currentTarget.style.boxShadow=s.shadows.md},onFocus:u=>{d||(u.currentTarget.style.outline=`3px solid ${s.colors.accent.primary}`,u.currentTarget.style.outlineOffset="2px")},onBlur:u=>{u.currentTarget.style.outline="none"},children:""}),a.jsx("button",{onClick:n,disabled:d,"data-testid":"playback-controls-next","aria-label":"Next track ( )",title:"Next track (  )",style:{...nr.secondaryButton,opacity:d?.7:1,color:d?s.colors.text.disabled:s.colors.text.secondary,cursor:d?"not-allowed":"pointer"},onMouseEnter:u=>{d||(u.currentTarget.style.backgroundColor=s.colors.bg.tertiary,u.currentTarget.style.borderColor=s.colors.accent.primary,u.currentTarget.style.transform="scale(1.05)")},onMouseLeave:u=>{u.currentTarget.style.backgroundColor="transparent",u.currentTarget.style.borderColor=s.colors.border.light,u.currentTarget.style.transform="scale(1)"},onFocus:u=>{d||(u.currentTarget.style.outline=`3px solid ${s.colors.accent.primary}`,u.currentTarget.style.outlineOffset="2px")},onBlur:u=>{u.currentTarget.style.outline="none"},children:""}),i&&a.jsx("div",{"data-testid":"playback-controls-loading",role:"status","aria-live":"polite","aria-atomic":"true",style:nr.loadingIndicator,children:"Loading..."})]})},dh=({volume:e,onVolumeChange:t,isMuted:r=!1,onMuteToggle:n,disabled:o=!1,className:i="",ariaLabel:l})=>{const[c,d]=g.useState(!1),[u,f]=g.useState(!1),p=g.useMemo(()=>{const b=Number.isNaN(e)?0:e;return Math.max(0,Math.min(1,b))},[e]),h=g.useMemo(()=>{const b=Math.round(p*100);return Number.isNaN(b)?0:b},[p]),m=g.useMemo(()=>r||p===0?"":p<.5?"":"",[r,p]),y=g.useMemo(()=>l||`Volume control, ${h}%${r?", muted":""}`,[l,h,r]);return a.jsxs("div",{className:i,"data-testid":"volume-control",style:{display:"flex",alignItems:"center",gap:s.spacing.sm,padding:`${s.spacing.sm} ${s.spacing.md}`,backgroundColor:"transparent",borderRadius:s.borderRadius.md,border:"none",width:"100%",maxWidth:"160px"},children:[a.jsx("button",{onClick:n,disabled:o,"data-testid":"volume-control-mute","aria-label":r||p===0?"Unmute ( M )":"Mute ( M )",title:r||p===0?"Unmute ( M )":"Mute ( M )",onFocus:()=>d(!0),onBlur:()=>d(!1),style:{display:"flex",alignItems:"center",justifyContent:"center",width:"40px",height:"40px",padding:0,backgroundColor:"transparent",border:`1px solid ${s.colors.border.light}`,borderRadius:s.borderRadius.md,cursor:o?"not-allowed":"pointer",transition:s.transitions.all,color:o?s.colors.text.disabled:s.colors.text.primary,fontSize:s.typography.fontSize.base,opacity:o?.7:1,outline:"none",...c&&!o&&{outline:`3px solid ${s.colors.accent.primary}`,outlineOffset:"2px",backgroundColor:s.colors.bg.tertiary}},onMouseEnter:b=>{o||(b.currentTarget.style.backgroundColor=s.colors.bg.tertiary,b.currentTarget.style.borderColor=s.colors.accent.primary,b.currentTarget.style.transform="scale(1.05)")},onMouseLeave:b=>{b.currentTarget.style.backgroundColor=c?s.colors.bg.tertiary:"transparent",b.currentTarget.style.borderColor=s.colors.border.light,b.currentTarget.style.transform="scale(1)"},children:a.jsx("span",{style:{display:"flex",alignItems:"center",justifyContent:"center"},"data-testid":"volume-control-icon",children:m})}),a.jsx("div",{style:{display:"flex",alignItems:"center",flex:1,minWidth:"100px"},children:a.jsx("input",{type:"range",min:"0",max:"1",step:"0.01",value:p,onChange:b=>t(parseFloat(b.target.value)),disabled:o,"data-testid":"volume-control-slider","aria-label":y,title:`Volume: ${h}%`,onFocus:()=>f(!0),onBlur:()=>f(!1),style:{width:"100%",height:"6px",cursor:o?"default":"pointer",appearance:"none",WebkitAppearance:"none",borderRadius:s.borderRadius.full,border:"none",outline:u&&!o?`3px solid ${s.colors.accent.primary}`:"none",outlineOffset:u&&!o?"2px":"0",background:`linear-gradient(to right, ${s.colors.accent.primary} 0%, ${s.colors.accent.primary} ${p*100}%, ${s.colors.bg.level3} ${p*100}%, ${s.colors.bg.level3} 100%)`,opacity:o?.5:1,transition:"height 0.2s ease, outline 0.2s ease"}})}),a.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",minWidth:"45px",fontSize:s.typography.fontSize.sm,color:s.colors.text.secondary,fontFamily:s.typography.fontFamily.mono,fontWeight:"bold"},"data-testid":"volume-control-percentage",children:[h,"%"]})]})},uh=({title:e,artist:t,album:r,isLoading:n=!1,className:o="",ariaLabel:i})=>{const l=g.useMemo(()=>{if(i)return i;const c=[e];return t&&c.push(t),r&&c.push(r),c.join("  ")},[e,t,r,i]);return n?a.jsxs("div",{className:o,"data-testid":"track-display",style:{display:"flex",flexDirection:"column",gap:s.spacing.xs,minWidth:"0"},"aria-label":l,children:[a.jsx("div",{style:{height:"20px",backgroundColor:s.colors.bg.tertiary,borderRadius:"4px",animation:"pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite"},"data-testid":"track-display-loading"}),t&&a.jsx("div",{style:{height:"16px",backgroundColor:s.colors.bg.tertiary,borderRadius:"4px",width:"70%",animation:"pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite"}})]}):a.jsxs("div",{className:o,"data-testid":"track-display",style:{display:"flex",flexDirection:"column",gap:s.spacing.xs,minWidth:"0"},"aria-label":l,children:[a.jsx("div",{style:{fontSize:s.typography.fontSize.md,fontWeight:"bold",color:s.colors.text.primary,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",lineHeight:"1.4"},"data-testid":"track-display-title",title:e,children:e}),(t||r)&&a.jsxs("div",{style:{fontSize:s.typography.fontSize.sm,color:s.colors.text.secondary,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",lineHeight:"1.4"},"data-testid":"track-display-meta",title:[t,r].filter(Boolean).join("  "),children:[t&&a.jsx("span",{"data-testid":"track-display-artist",children:t}),t&&r&&a.jsx("span",{children:"  "}),r&&a.jsx("span",{"data-testid":"track-display-album",children:r})]})]})};class Ar{static parse(t){return t instanceof Error?{status:500,message:t.message}:typeof t=="object"&&"status"in t&&"message"in t?t:{status:500,message:"Unknown error",details:t}}static isNetworkError(t){return t.status===0||t.status>=500}static isClientError(t){return t.status>=400&&t.status<500}static isNotFound(t){return t.status===404}static isUnauthorized(t){return t.status===401||t.status===403}static isValidationError(t){return t.status===422}}const ph="http://localhost:8765",hh=3e4;function Al(){const[e,t]=g.useState(!1),[r,n]=g.useState(null),o=g.useCallback((h,m)=>{let y=h.startsWith("http")?h:`${ph}${h}`;if(m&&Object.keys(m).length>0){const b=new URLSearchParams;Object.entries(m).forEach(([x,S])=>{S!=null&&b.append(x,String(S))}),y+=`?${b.toString()}`}return y},[]),i=g.useCallback(async(h,m={})=>{const y=new AbortController,b=setTimeout(()=>y.abort(),hh);try{return await fetch(h,{...m,signal:y.signal})}finally{clearTimeout(b)}},[]),l=g.useCallback(async h=>{t(!0),n(null);try{const m=o(h),y=await i(m,{method:"GET",headers:{"Content-Type":"application/json"}});if(!y.ok)throw new Error(`HTTP ${y.status}: ${y.statusText}`);return await y.json()}catch(m){const y=Ar.parse(m);throw n(y),y}finally{t(!1)}},[o,i]),c=g.useCallback(async(h,m,y)=>{t(!0),n(null);try{const b=o(h,y),x=await i(b,{method:"POST",headers:{"Content-Type":"application/json"},body:m?JSON.stringify(m):void 0});if(!x.ok)throw new Error(`HTTP ${x.status}: ${x.statusText}`);return await x.json()}catch(b){const x=Ar.parse(b);throw n(x),x}finally{t(!1)}},[o,i]),d=g.useCallback(async(h,m,y)=>{t(!0),n(null);try{const b=o(h,y),x=await i(b,{method:"PUT",headers:{"Content-Type":"application/json"},body:m?JSON.stringify(m):void 0});if(!x.ok)throw new Error(`HTTP ${x.status}: ${x.statusText}`);return await x.json()}catch(b){const x=Ar.parse(b);throw n(x),x}finally{t(!1)}},[o,i]),u=g.useCallback(async(h,m,y)=>{t(!0),n(null);try{const b=o(h,y),x=await i(b,{method:"PATCH",headers:{"Content-Type":"application/json"},body:m?JSON.stringify(m):void 0});if(!x.ok)throw new Error(`HTTP ${x.status}: ${x.statusText}`);return await x.json()}catch(b){const x=Ar.parse(b);throw n(x),x}finally{t(!1)}},[o,i]),f=g.useCallback(async h=>{t(!0),n(null);try{const m=o(h),y=await i(m,{method:"DELETE",headers:{"Content-Type":"application/json"}});if(!y.ok)throw new Error(`HTTP ${y.status}: ${y.statusText}`)}catch(m){const y=Ar.parse(m);throw n(y),y}finally{t(!1)}},[o,i]),p=g.useCallback(()=>{n(null)},[]);return g.useMemo(()=>({get:l,post:c,put:d,patch:u,delete:f,clearError:p,isLoading:e,error:r}),[l,c,d,u,f,p,e,r])}function Dl(e,t){const r=g.useCallback(t,[t]);return g.useEffect(()=>{},[e,r]),()=>{}}const fh={tracks:[],currentIndex:0,isShuffled:!1,repeatMode:"off",lastUpdated:Date.now()};function Rl(){const e=Al(),[t,r]=g.useState(fh),[n,o]=g.useState(!1),[i,l]=g.useState(null);Dl(["queue_changed","queue_shuffled","repeat_mode_changed"],S=>{const{type:v,data:k}=S;r(C=>{switch(v){case"queue_changed":return{...C,tracks:k.tracks||C.tracks,currentIndex:k.currentIndex??C.currentIndex,lastUpdated:Date.now()};case"queue_shuffled":return{...C,isShuffled:k.isShuffled??C.isShuffled,tracks:k.tracks||C.tracks,lastUpdated:Date.now()};case"repeat_mode_changed":return{...C,repeatMode:k.repeatMode??C.repeatMode,lastUpdated:Date.now()};default:return C}})}),g.useEffect(()=>{(async()=>{try{const v=await e.get("/api/player/queue");v&&r({tracks:v.tracks||[],currentIndex:v.currentIndex??0,isShuffled:v.isShuffled??!1,repeatMode:v.repeatMode??"off",lastUpdated:Date.now()})}catch(v){console.warn("Failed to fetch initial queue:",v)}})()},[e]);const c=g.useCallback(async(S,v=0)=>{o(!0),l(null);const k=t;r({tracks:S,currentIndex:v,isShuffled:t.isShuffled,repeatMode:t.repeatMode,lastUpdated:Date.now()});try{await e.post("/api/player/queue",{tracks:S.map(C=>C.id),start_index:v})}catch(C){r(k);const I=C instanceof Error?{message:C.message,code:"QUEUE_SET_ERROR",status:500}:C;throw l(I),I}finally{o(!1)}},[e,t]),d=g.useCallback(async(S,v)=>{o(!0),l(null);try{await e.post("/api/player/queue/add",{track_id:S.id,position:v!==void 0?v:void 0})}catch(k){const C=k instanceof Error?{message:k.message,code:"ADD_TRACK_ERROR",status:500}:k;throw l(C),C}finally{o(!1)}},[e]),u=g.useCallback(async S=>{o(!0),l(null);try{await e.delete(`/api/player/queue/${S}`)}catch(v){const k=v instanceof Error?{message:v.message,code:"REMOVE_TRACK_ERROR",status:500}:v;throw l(k),k}finally{o(!1)}},[e]),f=g.useCallback(async(S,v)=>{o(!0),l(null);try{await e.put("/api/player/queue/reorder",{from_index:S,to_index:v})}catch(k){const C=k instanceof Error?{message:k.message,code:"REORDER_ERROR",status:500}:k;throw l(C),C}finally{o(!1)}},[e]),p=g.useCallback(async S=>{o(!0),l(null);try{await e.put("/api/player/queue/reorder",{new_order:S})}catch(v){const k=v instanceof Error?{message:v.message,code:"REORDER_QUEUE_ERROR",status:500}:v;throw l(k),k}finally{o(!1)}},[e]),h=g.useCallback(async()=>{o(!0),l(null);const S=!t.isShuffled,v=t;r(k=>({...k,isShuffled:S,lastUpdated:Date.now()}));try{await e.post("/api/player/queue/shuffle",void 0,{enabled:S})}catch(k){r(v);const C=k instanceof Error?{message:k.message,code:"SHUFFLE_ERROR",status:500}:k;throw l(C),C}finally{o(!1)}},[e,t.isShuffled]),m=g.useCallback(async S=>{if(o(!0),l(null),!["off","all","one"].includes(S)){const k={message:`Invalid repeat mode: ${S}`,code:"INVALID_REPEAT_MODE",status:400};throw l(k),k}const v=t;r(k=>({...k,repeatMode:S,lastUpdated:Date.now()}));try{await e.post("/api/player/queue/repeat",void 0,{mode:S})}catch(k){r(v);const C=k instanceof Error?{message:k.message,code:"REPEAT_MODE_ERROR",status:500}:k;throw l(C),C}finally{o(!1)}},[e,t]),y=g.useCallback(async()=>{o(!0),l(null);const S=t;r({tracks:[],currentIndex:0,isShuffled:t.isShuffled,repeatMode:t.repeatMode,lastUpdated:Date.now()});try{await e.post("/api/player/queue/clear")}catch(v){r(S);const k=v instanceof Error?{message:v.message,code:"CLEAR_QUEUE_ERROR",status:500}:v;throw l(k),k}finally{o(!1)}},[e,t]),b=g.useCallback(()=>{l(null)},[]),x=t.tracks[t.currentIndex]||null;return{state:t,queue:t.tracks,currentIndex:t.currentIndex,currentTrack:x,isShuffled:t.isShuffled,repeatMode:t.repeatMode,setQueue:c,addTrack:d,removeTrack:u,reorderTrack:f,reorderQueue:p,toggleShuffle:h,setRepeatMode:m,clearQueue:y,isLoading:n,error:i,clearError:b}}const gh=({collapsed:e=!1,onToggleCollapse:t})=>{const{queue:r,currentIndex:n,isShuffled:o,repeatMode:i,removeTrack:l,reorderTrack:c,toggleShuffle:d,setRepeatMode:u,clearQueue:f,isLoading:p,error:h}=Rl(),[m,y]=g.useState(null),[b,x]=g.useState(null);if(e)return a.jsx("div",{style:te.collapsedContainer,children:a.jsxs("button",{style:te.toggleButton,onClick:t,title:"Expand queue","aria-label":"Expand queue panel",children:[" Queue (",r.length,")"]})});const S=async E=>{try{await l(E)}catch($){console.error("Failed to remove track from queue:",$)}},v=async()=>{try{await d()}catch(E){console.error("Failed to toggle shuffle:",E)}},k=async E=>{try{await u(E)}catch($){console.error("Failed to set repeat mode:",$)}},C=async()=>{if(confirm("Clear the entire queue?"))try{await f()}catch(E){console.error("Failed to clear queue:",E)}},I=async(E,$)=>{if(E!==$)try{await c(E,$)}catch(F){console.error("Failed to reorder track:",F)}};return a.jsxs("div",{style:te.container,children:[a.jsxs("div",{style:te.header,children:[a.jsxs("h3",{style:te.title,children:["Queue (",r.length,")"]}),a.jsx("button",{style:te.toggleButton,onClick:t,title:"Collapse queue","aria-label":"Collapse queue panel",children:""})]}),a.jsxs("div",{style:te.controlBar,children:[a.jsx("button",{style:{...te.modeButton,...o?te.modeButtonActive:{}},onClick:v,disabled:p,title:o?"Shuffle: ON":"Shuffle: OFF","aria-label":o?"Disable shuffle":"Enable shuffle",children:" Shuffle"}),a.jsxs("div",{style:te.repeatModeButtons,children:[a.jsx("button",{style:{...te.repeatButton,...i==="off"?te.repeatButtonActive:{}},onClick:()=>k("off"),disabled:p,title:"Repeat: OFF","aria-label":"Turn off repeat",children:""}),a.jsx("button",{style:{...te.repeatButton,...i==="all"?te.repeatButtonActive:{}},onClick:()=>k("all"),disabled:p,title:"Repeat: ALL","aria-label":"Repeat all tracks",children:""}),a.jsx("button",{style:{...te.repeatButton,...i==="one"?te.repeatButtonActive:{}},onClick:()=>k("one"),disabled:p,title:"Repeat: ONE","aria-label":"Repeat one track",children:"1"})]}),a.jsx("button",{style:te.clearButton,onClick:C,disabled:p||r.length===0,title:"Clear queue","aria-label":"Clear all tracks from queue",children:" Clear"})]}),h&&a.jsx("div",{style:te.errorBanner,children:a.jsx("span",{children:h.message})}),a.jsx("div",{style:te.queueContainer,children:r.length===0?a.jsxs("div",{style:te.emptyState,children:[a.jsx("p",{children:"Queue is empty"}),a.jsx("p",{style:te.emptySubtext,children:"Add tracks to get started"})]}):a.jsx("ul",{style:te.queueList,children:r.map((E,$)=>a.jsx(mh,{track:E,index:$,isCurrentTrack:$===n,isDragging:m===$,isHovered:b===$,onRemove:()=>S($),onDragStart:()=>y($),onDragEnd:()=>y(null),onDragOver:F=>{m!==null&&m!==F&&I(m,F)},onHover:F=>x(F?$:null),disabled:p},`${E.id}-${$}`))})})]})},mh=({track:e,index:t,isCurrentTrack:r,isDragging:n,isHovered:o,onRemove:i,onDragStart:l,onDragEnd:c,onDragOver:d,onHover:u,disabled:f})=>a.jsxs("li",{style:{...te.trackItem,...r?te.trackItemCurrent:{},...n?te.trackItemDragging:{},...o?te.trackItemHovered:{}},onMouseEnter:()=>u(!0),onMouseLeave:()=>u(!1),draggable:!0,onDragStart:l,onDragEnd:c,onDragOver:p=>{p.preventDefault(),d(t)},title:`${e.title} - ${e.artist}`,children:[a.jsx("span",{style:te.trackIndex,children:t+1}),a.jsxs("div",{style:te.trackInfo,children:[a.jsxs("div",{style:te.trackTitle,children:[r&&a.jsx("span",{style:te.playingIcon,children:""}),e.title]}),a.jsx("div",{style:te.trackArtist,children:e.artist})]}),a.jsx("span",{style:te.trackDuration,children:yh(e.duration)}),o&&a.jsx("button",{style:te.removeButton,onClick:p=>{p.preventDefault(),i()},disabled:f,title:"Remove from queue","aria-label":`Remove ${e.title} from queue`,children:""})]});function yh(e){if(!isFinite(e))return"0:00";const t=Math.floor(e/3600),r=Math.floor(e%3600/60),n=Math.floor(e%60);return t>0?`${t}:${r.toString().padStart(2,"0")}:${n.toString().padStart(2,"0")}`:`${r}:${n.toString().padStart(2,"0")}`}const te={container:{display:"flex",flexDirection:"column",width:"100%",height:"100%",backgroundColor:s.colors.bg.primary,borderLeft:`1px solid ${s.colors.border.light}`,overflow:"hidden"},collapsedContainer:{display:"flex",padding:s.spacing.md},header:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:s.spacing.md,borderBottom:`1px solid ${s.colors.border.light}`},title:{margin:0,fontSize:s.typography.fontSize.lg,fontWeight:s.typography.fontWeight.bold,color:s.colors.text.primary},toggleButton:{background:"none",border:"none",color:s.colors.text.primary,cursor:"pointer",fontSize:s.typography.fontSize.lg,padding:s.spacing.sm,borderRadius:s.borderRadius.md,transition:"background-color 0.2s",":hover":{backgroundColor:s.colors.bg.secondary}},controlBar:{display:"flex",gap:s.spacing.sm,padding:s.spacing.md,borderBottom:`1px solid ${s.colors.border.light}`,flexWrap:"wrap"},modeButton:{padding:`${s.spacing.xs} ${s.spacing.sm}`,borderRadius:s.borderRadius.md,border:`1px solid ${s.colors.border.light}`,backgroundColor:s.colors.bg.secondary,color:s.colors.text.primary,cursor:"pointer",fontSize:s.typography.fontSize.sm,fontWeight:s.typography.fontWeight.semibold,transition:"all 0.2s",":hover":{backgroundColor:s.colors.bg.tertiary},":disabled":{opacity:.5,cursor:"not-allowed"}},modeButtonActive:{backgroundColor:s.colors.accent.primary,color:s.colors.text.inverse,borderColor:s.colors.accent.primary},repeatModeButtons:{display:"flex",gap:s.spacing.xs,borderLeft:`1px solid ${s.colors.border.light}`,paddingLeft:s.spacing.sm,marginLeft:s.spacing.sm},repeatButton:{padding:`${s.spacing.xs} ${s.spacing.sm}`,borderRadius:s.borderRadius.md,border:`1px solid ${s.colors.border.light}`,backgroundColor:s.colors.bg.secondary,color:s.colors.text.primary,cursor:"pointer",fontSize:s.typography.fontSize.sm,fontWeight:s.typography.fontWeight.bold,transition:"all 0.2s",minWidth:"36px",":hover":{backgroundColor:s.colors.bg.tertiary},":disabled":{opacity:.5,cursor:"not-allowed"}},repeatButtonActive:{backgroundColor:s.colors.accent.primary,color:s.colors.text.inverse,borderColor:s.colors.accent.primary},clearButton:{marginLeft:"auto",padding:`${s.spacing.xs} ${s.spacing.sm}`,borderRadius:s.borderRadius.md,border:`1px solid ${s.colors.border.light}`,backgroundColor:s.colors.bg.secondary,color:s.colors.text.primary,cursor:"pointer",fontSize:s.typography.fontSize.sm,transition:"all 0.2s",":hover":{backgroundColor:s.colors.semantic.error,color:s.colors.text.inverse},":disabled":{opacity:.5,cursor:"not-allowed"}},errorBanner:{padding:s.spacing.md,backgroundColor:s.colors.semantic.error,color:s.colors.text.inverse,fontSize:s.typography.fontSize.sm},queueContainer:{flex:1,overflow:"auto",display:"flex",flexDirection:"column"},queueList:{listStyle:"none",margin:0,padding:0},trackItem:{display:"flex",alignItems:"center",gap:s.spacing.md,padding:s.spacing.md,borderBottom:`1px solid ${s.colors.border.light}`,cursor:"move",transition:"background-color 0.2s, opacity 0.2s",":hover":{backgroundColor:s.colors.bg.secondary}},trackItemCurrent:{backgroundColor:s.colors.bg.secondary,borderLeft:`3px solid ${s.colors.accent.primary}`,paddingLeft:`calc(${s.spacing.md} - 3px)`},trackItemDragging:{opacity:.6,backgroundColor:s.colors.bg.tertiary},trackItemHovered:{backgroundColor:s.colors.bg.secondary},trackIndex:{width:"32px",textAlign:"center",color:s.colors.text.tertiary,fontWeight:s.typography.fontWeight.semibold,fontSize:s.typography.fontSize.sm,flexShrink:0},trackInfo:{flex:1,minWidth:0,display:"flex",flexDirection:"column",gap:s.spacing.xs},trackTitle:{color:s.colors.text.primary,fontSize:s.typography.fontSize.md,fontWeight:s.typography.fontWeight.semibold,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",display:"flex",alignItems:"center",gap:s.spacing.xs},playingIcon:{color:s.colors.accent.primary,fontSize:s.typography.fontSize.sm,flexShrink:0},trackArtist:{color:s.colors.text.tertiary,fontSize:s.typography.fontSize.sm,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},trackDuration:{color:s.colors.text.tertiary,fontSize:s.typography.fontSize.sm,fontVariantNumeric:"tabular-nums",flexShrink:0,minWidth:"48px",textAlign:"right"},removeButton:{padding:s.spacing.xs,borderRadius:s.borderRadius.md,border:"none",backgroundColor:s.colors.semantic.error,color:s.colors.text.inverse,cursor:"pointer",fontSize:s.typography.fontSize.md,transition:"opacity 0.2s",flexShrink:0,":hover":{opacity:.8},":disabled":{opacity:.5,cursor:"not-allowed"}},emptyState:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",flex:1,color:s.colors.text.tertiary,textAlign:"center"},emptySubtext:{fontSize:s.typography.fontSize.sm,color:s.colors.text.tertiary,marginTop:s.spacing.sm}};function bh({audioElement:e,onDriftDetected:t,syncInterval:r=5e3,driftThreshold:n=500,updateInterval:o=100,onGetPlayerStatus:i,debug:l=!1}){const c=g.useCallback((y,b)=>{l&&console.log(`[usePlayerStreaming] ${y}`,b??"")},[l]),d={currentTime:0,duration:0,isPlaying:!1,isPaused:!0,isBuffering:!1,isError:!1,bufferedRanges:[],bufferedPercentage:0,lastSyncTime:Date.now(),drift:0,playbackRate:1},[u,f]=g.useState(d),p=Ot();g.useRef(null),g.useRef(null);const h=g.useCallback(y=>{const b=[];for(let x=0;x<y.buffered.length;x++)b.push({start:y.buffered.start(x),end:y.buffered.end(x)});return b},[]),m=g.useCallback((y,b)=>{if(b===0)return 0;const x=y.reduce((S,v)=>S+(v.end-v.start),0);return Math.min(x/b*100,100)},[]);return g.useEffect(()=>{{c("Audio element not available");return}},[e,o,h,m,c]),g.useEffect(()=>{},[p,e,n,t,c]),g.useEffect(()=>{},[e,i,r,n,t,c]),g.useEffect(()=>{},[e,c]),g.useEffect(()=>{},[e,c]),u}/**
 * PCMStreamBuffer - Circular buffer for streaming PCM samples
 *
 * Provides efficient real-time PCM sample buffering with:
 * - Circular buffer design for memory efficiency
 * - Automatic wrap-around handling
 * - Crossfade blending at chunk boundaries
 * - Buffer overflow/underflow detection
 *
 * @copyright (C) 2024 Auralis Team
 * @license GPLv3, see LICENSE for more details
 */class xh{constructor(t=100*1024*1024){B(this,"buffer",null);B(this,"writePos",0);B(this,"readPos",0);B(this,"sampleRate",48e3);B(this,"channels",2);B(this,"capacity",0);B(this,"isInitialized",!1);B(this,"lastChunkEnd",null);B(this,"crossfadeLength",0);this.capacity=t}initialize(t,r){this.sampleRate=t,this.channels=r;const n=this.capacity/4;this.buffer=new Float32Array(n),this.writePos=0,this.readPos=0,this.isInitialized=!0,this.lastChunkEnd=null,this.crossfadeLength=0}append(t,r=0){if(!this.isInitialized||!this.buffer)throw new Error("PCMStreamBuffer not initialized. Call initialize() first.");const n=t.length,o=this.capacity/4,i=this.getAvailableSamples(),l=n+r;i+l>o&&console.warn(`[PCMStreamBuffer] Buffer near capacity: used=${i} (${(i/this.sampleRate/this.channels).toFixed(1)}s), adding=${l}, capacity=${o}. New data may be dropped.`);let c=t;if(r>0&&this.lastChunkEnd!==null&&(c=this.applyCrossfade(t,r)),this.writeToBuffer(c),r>0){const d=Math.max(0,t.length-r);this.lastChunkEnd=new Float32Array(t.slice(d))}}read(t){if(!this.isInitialized||!this.buffer)throw new Error("PCMStreamBuffer not initialized. Call initialize() first.");const r=this.getAvailableSamples(),n=Math.min(t,r);if(n===0)return new Float32Array(0);const o=new Float32Array(n),i=this.buffer.length;if(this.readPos+n<=i)o.set(this.buffer.subarray(this.readPos,this.readPos+n));else{const l=i-this.readPos;o.set(this.buffer.subarray(this.readPos,i),0),o.set(this.buffer.subarray(0,n-l),l)}return this.readPos=(this.readPos+n)%i,o}getAvailableSamples(){if(!this.isInitialized)return 0;const t=this.buffer.length;return this.writePos>=this.readPos?this.writePos-this.readPos:t-this.readPos+this.writePos}isFull(){return this.isInitialized?this.getAvailableSamples()>=this.buffer.length*.95:!1}isEmpty(){return this.getAvailableSamples()===0}getMetadata(){return{sampleRate:this.sampleRate,channels:this.channels,capacity:this.capacity,availableSamples:this.getAvailableSamples(),isFull:this.isFull(),isEmpty:this.isEmpty()}}reset(){this.writePos=0,this.readPos=0,this.lastChunkEnd=null,this.crossfadeLength=0,this.buffer&&this.buffer.fill(0)}dispose(){this.buffer=null,this.isInitialized=!1,this.lastChunkEnd=null}applyCrossfade(t,r){if(!this.lastChunkEnd||this.lastChunkEnd.length===0)return t;const n=Math.min(r,this.lastChunkEnd.length,t.length);if(n===0)return t;const o=new Float32Array(t);for(let i=0;i<n;i++){const l=i/n,c=1-l,d=l,u=this.lastChunkEnd[this.lastChunkEnd.length-n+i]||0;o[i]=u*c+o[i]*d}return o}writeToBuffer(t){if(!this.buffer)return;const r=this.buffer.length,n=t.length,o=this.getAvailableSamples(),i=r-o;if(n>i){console.warn(`[PCMStreamBuffer] Buffer full! Dropping ${n} new samples (${(n/this.sampleRate/this.channels).toFixed(2)}s). Buffer: ${(o/this.sampleRate/this.channels).toFixed(1)}s used, ${(i/this.sampleRate/this.channels).toFixed(1)}s free.`);return}if(this.writePos+n<=r)this.buffer.set(t,this.writePos);else{const l=r-this.writePos;this.buffer.set(t.subarray(0,l),this.writePos),this.buffer.set(t.subarray(l),0)}this.writePos=(this.writePos+n)%r}getFillPercentage(){var n;const t=this.getAvailableSamples(),r=((n=this.buffer)==null?void 0:n.length)??1;return t/r*100}}/**
 * AudioPlaybackEngine - Web Audio API playback scheduling
 *
 * Manages real-time playback of PCM samples from circular buffer via Web Audio API.
 * Features:
 * - Efficient sample pulling from PCMStreamBuffer
 * - ScriptProcessorNode + AudioWorklet fallback
 * - Volume and gain control
 * - Pause/resume functionality
 * - Buffer underrun detection
 *
 * @copyright (C) 2024 Auralis Team
 * @license GPLv3, see LICENSE for more details
 */class Sh{constructor(t,r){B(this,"audioContext");B(this,"buffer");B(this,"gainNode");B(this,"scriptNode",null);B(this,"state","idle");B(this,"volume",1);B(this,"audioContextStartTime",0);B(this,"playbackStartTime",0);B(this,"samplesPlayed",0);B(this,"bufferUnderrunCount",0);B(this,"bufferSize",4096);B(this,"minBufferSamples",48e3);B(this,"pausedTime",0);B(this,"lowWaterMarkSeconds",3);B(this,"highWaterMarkSeconds",5);B(this,"isBufferPaused",!1);B(this,"onStateChange",()=>{});B(this,"onBufferUnderrun",()=>{});this.audioContext=t,this.buffer=r,this.gainNode=t.createGain(),this.gainNode.gain.value=this.volume,this.gainNode.connect(t.destination)}async startPlayback(){if(this.state==="playing")return;const t=this.buffer.getAvailableSamples();if(t<this.minBufferSamples){console.warn(`[AudioPlaybackEngine] Insufficient buffer for playback. Available: ${t}, Required: ${this.minBufferSamples}`),this.setState("error"),this.onBufferUnderrun();return}try{if(this.audioContext.state==="suspended"){console.log("[AudioPlaybackEngine] AudioContext suspended, resuming...");try{await this.audioContext.resume(),console.log("[AudioPlaybackEngine] AudioContext resumed successfully")}catch(r){console.error("[AudioPlaybackEngine] Failed to resume AudioContext:",r),this.setState("error");return}}this.createScriptProcessor(),this.audioContextStartTime=this.audioContext.currentTime,this.playbackStartTime=Date.now(),this.samplesPlayed=0,this.isBufferPaused=!1,this.setState("playing"),console.log("[AudioPlaybackEngine] Playback started")}catch(r){console.error("[AudioPlaybackEngine] Failed to start playback:",r),this.setState("error")}}pausePlayback(){this.state==="playing"&&(this.pausedTime=this.getCurrentPlaybackTime(),this.scriptNode&&(this.scriptNode.disconnect(),this.scriptNode=null),this.setState("paused"),console.log("[AudioPlaybackEngine] Playback paused at",this.pausedTime.toFixed(2),"s"))}resumePlayback(){this.state==="paused"&&(this.playbackStartTime=Date.now()-this.pausedTime*1e3,this.createScriptProcessor(),this.setState("playing"),console.log("[AudioPlaybackEngine] Playback resumed from",this.pausedTime.toFixed(2),"s"))}stopPlayback(){this.scriptNode&&(this.scriptNode.disconnect(),this.scriptNode=null),this.pausedTime=0,this.audioContextStartTime=0,this.playbackStartTime=0,this.samplesPlayed=0,this.bufferUnderrunCount=0,this.isBufferPaused=!1,this.setState("stopped"),console.log("[AudioPlaybackEngine] Playback stopped")}setVolume(t){const r=Math.max(0,Math.min(1,t));this.volume=r,this.gainNode.gain.value=r}getCurrentPlaybackTime(){if(this.state==="idle"||this.state==="stopped")return 0;if(this.state==="paused")return this.pausedTime;const t=this.buffer.getMetadata().sampleRate;return this.samplesPlayed/t}getStats(){return{isPlaying:this.state==="playing",currentTime:this.getCurrentPlaybackTime(),samplesPlayed:this.samplesPlayed,bufferUnderuns:this.bufferUnderrunCount}}onStateChanged(t){return this.onStateChange=t,()=>{this.onStateChange=()=>{}}}onUnderrun(t){return this.onBufferUnderrun=t,()=>{this.onBufferUnderrun=()=>{}}}isPlaying(){return this.state==="playing"}createScriptProcessor(){if(!this.scriptNode)try{this.scriptNode=this.audioContext.createScriptProcessor(this.bufferSize,0,2),this.scriptNode.onaudioprocess=t=>{this.handleAudioProcess(t)},this.scriptNode.connect(this.gainNode),console.log("[AudioPlaybackEngine] ScriptProcessorNode created with buffer size:",this.bufferSize)}catch(t){console.error("[AudioPlaybackEngine] Failed to create ScriptProcessorNode:",t),this.setState("error")}}handleAudioProcess(t){const r=t.outputBuffer,n=r.numberOfChannels,o=r.length,i=this.buffer.getMetadata().channels||2,l=this.buffer.getMetadata().sampleRate||44100,c=o*i,u=this.buffer.getAvailableSamples()/(l*i);if(!this.isBufferPaused&&u<this.lowWaterMarkSeconds){this.isBufferPaused=!0,console.warn(`[AudioPlaybackEngine] Buffer critically low (${u.toFixed(1)}s < ${this.lowWaterMarkSeconds}s). Pausing to let buffer recover...`);for(let p=0;p<n;p++)r.getChannelData(p).fill(0);return}if(this.isBufferPaused)if(u>=this.highWaterMarkSeconds)this.isBufferPaused=!1,console.log(`[AudioPlaybackEngine] Buffer recovered (${u.toFixed(1)}s >= ${this.highWaterMarkSeconds}s). Resuming playback.`);else{for(let p=0;p<n;p++)r.getChannelData(p).fill(0);return}const f=this.buffer.read(c);if(f.length===0){this.bufferUnderrunCount++,console.warn(`[AudioPlaybackEngine] Buffer underrun #${this.bufferUnderrunCount}. Expected ${c} samples, got 0`);for(let p=0;p<n;p++)r.getChannelData(p).fill(0);this.onBufferUnderrun();return}if(f.length<c&&console.warn(`[AudioPlaybackEngine] Low buffer. Expected ${c}, got ${f.length} samples`),i===1){const p=f.subarray(0,o);for(let h=0;h<n;h++)r.getChannelData(h).set(p)}else if(i===2){const p=r.getChannelData(0),h=r.getChannelData(1),m=Math.min(o,Math.floor(f.length/2));for(let y=0;y<m;y++)p[y]=f[y*2]||0,h[y]=f[y*2+1]||0;for(let y=m;y<o;y++)p[y]=0,h[y]=0}else for(let p=0;p<n;p++){const h=r.getChannelData(p);for(let m=0;m<o;m++){const y=m*i+p;y<f.length?h[m]=f[y]:h[m]=0}}this.samplesPlayed+=Math.floor(f.length/i)}setState(t){this.state!==t&&(this.state=t,this.onStateChange(t))}}function me(e){return`Minified Redux error #${e}; visit https://redux.js.org/Errors?code=${e} for the full message or use the non-minified dev environment for full errors. `}var vh=typeof Symbol=="function"&&Symbol.observable||"@@observable",$a=vh,$o=()=>Math.random().toString(36).substring(7).split("").join("."),wh={INIT:`@@redux/INIT${$o()}`,REPLACE:`@@redux/REPLACE${$o()}`,PROBE_UNKNOWN_ACTION:()=>`@@redux/PROBE_UNKNOWN_ACTION${$o()}`},Qn=wh;function Ws(e){if(typeof e!="object"||e===null)return!1;let t=e;for(;Object.getPrototypeOf(t)!==null;)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t||Object.getPrototypeOf(e)===null}function Us(e,t,r){if(typeof e!="function")throw new Error(me(2));if(typeof t=="function"&&typeof r=="function"||typeof r=="function"&&typeof arguments[3]=="function")throw new Error(me(0));if(typeof t=="function"&&typeof r>"u"&&(r=t,t=void 0),typeof r<"u"){if(typeof r!="function")throw new Error(me(1));return r(Us)(e,t)}let n=e,o=t,i=new Map,l=i,c=0,d=!1;function u(){l===i&&(l=new Map,i.forEach((x,S)=>{l.set(S,x)}))}function f(){if(d)throw new Error(me(3));return o}function p(x){if(typeof x!="function")throw new Error(me(4));if(d)throw new Error(me(5));let S=!0;u();const v=c++;return l.set(v,x),function(){if(S){if(d)throw new Error(me(6));S=!1,u(),l.delete(v),i=null}}}function h(x){if(!Ws(x))throw new Error(me(7));if(typeof x.type>"u")throw new Error(me(8));if(typeof x.type!="string")throw new Error(me(17));if(d)throw new Error(me(9));try{d=!0,o=n(o,x)}finally{d=!1}return(i=l).forEach(v=>{v()}),x}function m(x){if(typeof x!="function")throw new Error(me(10));n=x,h({type:Qn.REPLACE})}function y(){const x=p;return{subscribe(S){if(typeof S!="object"||S===null)throw new Error(me(11));function v(){const C=S;C.next&&C.next(f())}return v(),{unsubscribe:x(v)}},[$a](){return this}}}return h({type:Qn.INIT}),{dispatch:h,subscribe:p,getState:f,replaceReducer:m,[$a]:y}}function Ch(e){Object.keys(e).forEach(t=>{const r=e[t];if(typeof r(void 0,{type:Qn.INIT})>"u")throw new Error(me(12));if(typeof r(void 0,{type:Qn.PROBE_UNKNOWN_ACTION()})>"u")throw new Error(me(13))})}function kh(e){const t=Object.keys(e),r={};for(let i=0;i<t.length;i++){const l=t[i];typeof e[l]=="function"&&(r[l]=e[l])}const n=Object.keys(r);let o;try{Ch(r)}catch(i){o=i}return function(l={},c){if(o)throw o;let d=!1;const u={};for(let f=0;f<n.length;f++){const p=n[f],h=r[p],m=l[p],y=h(m,c);if(typeof y>"u")throw c&&c.type,new Error(me(14));u[p]=y,d=d||y!==m}return d=d||n.length!==Object.keys(l).length,d?u:l}}function Fa(e,t){return function(...r){return t(e.apply(this,r))}}function _a(e,t){if(typeof e=="function")return Fa(e,t);if(typeof e!="object"||e===null)throw new Error(me(16));const r={};for(const n in e){const o=e[n];typeof o=="function"&&(r[n]=Fa(o,t))}return r}function Gr(...e){return e.length===0?t=>t:e.length===1?e[0]:e.reduce((t,r)=>(...n)=>t(r(...n)))}function Tl(...e){return t=>(r,n)=>{const o=t(r,n);let i=()=>{throw new Error(me(15))};const l={getState:o.getState,dispatch:(d,...u)=>i(d,...u)},c=e.map(d=>d(l));return i=Gr(...c)(o.dispatch),{...o,dispatch:i}}}function jh(e){return Ws(e)&&"type"in e&&typeof e.type=="string"}var Ml=Symbol.for("immer-nothing"),Oa=Symbol.for("immer-draftable"),De=Symbol.for("immer-state");function Ye(e,...t){throw new Error(`[Immer] minified error nr: ${e}. Full error at: https://bit.ly/3cXEKWf`)}var _e=Object,xr=_e.getPrototypeOf,Vn="constructor",fo="prototype",hs="configurable",Kn="enumerable",On="writable",qr="value",ft=e=>!!e&&!!e[De];function Ze(e){var t;return e?$l(e)||go(e)||!!e[Oa]||!!((t=e[Vn])!=null&&t[Oa])||mo(e)||yo(e):!1}var Ph=_e[fo][Vn].toString(),Ba=new WeakMap;function $l(e){if(!e||!Hs(e))return!1;const t=xr(e);if(t===null||t===_e[fo])return!0;const r=_e.hasOwnProperty.call(t,Vn)&&t[Vn];if(r===Object)return!0;if(!or(r))return!1;let n=Ba.get(r);return n===void 0&&(n=Function.toString.call(r),Ba.set(r,n)),n===Ph}function mn(e,t,r=!0){yn(e)===0?(r?Reflect.ownKeys(e):_e.keys(e)).forEach(o=>{t(o,e[o],e)}):e.forEach((n,o)=>t(o,n,e))}function yn(e){const t=e[De];return t?t.type_:go(e)?1:mo(e)?2:yo(e)?3:0}var La=(e,t,r=yn(e))=>r===2?e.has(t):_e[fo].hasOwnProperty.call(e,t),fs=(e,t,r=yn(e))=>r===2?e.get(t):e[t],Yn=(e,t,r,n=yn(e))=>{n===2?e.set(t,r):n===3?e.add(r):e[t]=r};function Ih(e,t){return e===t?e!==0||1/e===1/t:e!==e&&t!==t}var go=Array.isArray,mo=e=>e instanceof Map,yo=e=>e instanceof Set,Hs=e=>typeof e=="object",or=e=>typeof e=="function",Fo=e=>typeof e=="boolean";function Eh(e){const t=+e;return Number.isInteger(t)&&String(t)===e}var dt=e=>e.copy_||e.base_,Gs=e=>e.modified_?e.copy_:e.base_;function gs(e,t){if(mo(e))return new Map(e);if(yo(e))return new Set(e);if(go(e))return Array[fo].slice.call(e);const r=$l(e);if(t===!0||t==="class_only"&&!r){const n=_e.getOwnPropertyDescriptors(e);delete n[De];let o=Reflect.ownKeys(n);for(let i=0;i<o.length;i++){const l=o[i],c=n[l];c[On]===!1&&(c[On]=!0,c[hs]=!0),(c.get||c.set)&&(n[l]={[hs]:!0,[On]:!0,[Kn]:c[Kn],[qr]:e[l]})}return _e.create(xr(e),n)}else{const n=xr(e);if(n!==null&&r)return{...e};const o=_e.create(n);return _e.assign(o,e)}}function qs(e,t=!1){return bo(e)||ft(e)||!Ze(e)||(yn(e)>1&&_e.defineProperties(e,{set:Pn,add:Pn,clear:Pn,delete:Pn}),_e.freeze(e),t&&mn(e,(r,n)=>{qs(n,!0)},!1)),e}function Ah(){Ye(2)}var Pn={[qr]:Ah};function bo(e){return e===null||!Hs(e)?!0:_e.isFrozen(e)}var Xn="MapSet",ms="Patches",za="ArrayMethods",Fl={};function Jt(e){const t=Fl[e];return t||Ye(0,e),t}var Na=e=>!!Fl[e],Qr,_l=()=>Qr,Dh=(e,t)=>({drafts_:[],parent_:e,immer_:t,canAutoFreeze_:!0,unfinalizedDrafts_:0,handledSet_:new Set,processedForPatches_:new Set,mapSetPlugin_:Na(Xn)?Jt(Xn):void 0,arrayMethodsPlugin_:Na(za)?Jt(za):void 0});function Wa(e,t){t&&(e.patchPlugin_=Jt(ms),e.patches_=[],e.inversePatches_=[],e.patchListener_=t)}function ys(e){bs(e),e.drafts_.forEach(Rh),e.drafts_=null}function bs(e){e===Qr&&(Qr=e.parent_)}var Ua=e=>Qr=Dh(Qr,e);function Rh(e){const t=e[De];t.type_===0||t.type_===1?t.revoke_():t.revoked_=!0}function Ha(e,t){t.unfinalizedDrafts_=t.drafts_.length;const r=t.drafts_[0];if(e!==void 0&&e!==r){r[De].modified_&&(ys(t),Ye(4)),Ze(e)&&(e=Ga(t,e));const{patchPlugin_:o}=t;o&&o.generateReplacementPatches_(r[De].base_,e,t)}else e=Ga(t,r);return Th(t,e,!0),ys(t),t.patches_&&t.patchListener_(t.patches_,t.inversePatches_),e!==Ml?e:void 0}function Ga(e,t){if(bo(t))return t;const r=t[De];if(!r)return Qs(t,e.handledSet_,e);if(!xo(r,e))return t;if(!r.modified_)return r.base_;if(!r.finalized_){const{callbacks_:n}=r;if(n)for(;n.length>0;)n.pop()(e);Ll(r,e)}return r.copy_}function Th(e,t,r=!1){!e.parent_&&e.immer_.autoFreeze_&&e.canAutoFreeze_&&qs(t,r)}function Ol(e){e.finalized_=!0,e.scope_.unfinalizedDrafts_--}var xo=(e,t)=>e.scope_===t,Mh=[];function Bl(e,t,r,n){const o=dt(e),i=e.type_;if(n!==void 0&&fs(o,n,i)===t){Yn(o,n,r,i);return}if(!e.draftLocations_){const c=e.draftLocations_=new Map;mn(o,(d,u)=>{if(ft(u)){const f=c.get(u)||[];f.push(d),c.set(u,f)}})}const l=e.draftLocations_.get(t)??Mh;for(const c of l)Yn(o,c,r,i)}function $h(e,t,r){e.callbacks_.push(function(o){var c;const i=t;if(!i||!xo(i,o))return;(c=o.mapSetPlugin_)==null||c.fixSetContents(i);const l=Gs(i);Bl(e,i.draft_??i,l,r),Ll(i,o)})}function Ll(e,t){var n;if(e.modified_&&!e.finalized_&&(e.type_===3||e.type_===1&&e.allIndicesReassigned_||(((n=e.assigned_)==null?void 0:n.size)??0)>0)){const{patchPlugin_:o}=t;if(o){const i=o.getPath(e);i&&o.generatePatches_(e,i,t)}Ol(e)}}function Fh(e,t,r){const{scope_:n}=e;if(ft(r)){const o=r[De];xo(o,n)&&o.callbacks_.push(function(){Bn(e);const l=Gs(o);Bl(e,r,l,t)})}else Ze(r)&&e.callbacks_.push(function(){const i=dt(e);fs(i,t,e.type_)===r&&n.drafts_.length>1&&(e.assigned_.get(t)??!1)===!0&&e.copy_&&Qs(fs(e.copy_,t,e.type_),n.handledSet_,n)})}function Qs(e,t,r){return!r.immer_.autoFreeze_&&r.unfinalizedDrafts_<1||ft(e)||t.has(e)||!Ze(e)||bo(e)||(t.add(e),mn(e,(n,o)=>{if(ft(o)){const i=o[De];if(xo(i,r)){const l=Gs(i);Yn(e,n,l,e.type_),Ol(i)}}else Ze(o)&&Qs(o,t,r)})),e}function _h(e,t){const r=go(e),n={type_:r?1:0,scope_:t?t.scope_:_l(),modified_:!1,finalized_:!1,assigned_:void 0,parent_:t,base_:e,draft_:null,copy_:null,revoke_:null,isManual_:!1,callbacks_:void 0};let o=n,i=Vs;r&&(o=[n],i=Vr);const{revoke:l,proxy:c}=Proxy.revocable(o,i);return n.draft_=c,n.revoke_=l,[c,n]}var Vs={get(e,t){if(t===De)return e;let r=e.scope_.arrayMethodsPlugin_;const n=e.type_===1&&typeof t=="string";if(n&&r!=null&&r.isArrayOperationMethod(t))return r.createMethodInterceptor(e,t);const o=dt(e);if(!La(o,t,e.type_))return Oh(e,o,t);const i=o[t];if(e.finalized_||!Ze(i)||n&&e.operationMethod&&(r!=null&&r.isMutatingArrayMethod(e.operationMethod))&&Eh(t))return i;if(i===_o(e.base_,t)){Bn(e);const l=e.type_===1?+t:t,c=Ss(e.scope_,i,e,l);return e.copy_[l]=c}return i},has(e,t){return t in dt(e)},ownKeys(e){return Reflect.ownKeys(dt(e))},set(e,t,r){const n=zl(dt(e),t);if(n!=null&&n.set)return n.set.call(e.draft_,r),!0;if(!e.modified_){const o=_o(dt(e),t),i=o==null?void 0:o[De];if(i&&i.base_===r)return e.copy_[t]=r,e.assigned_.set(t,!1),!0;if(Ih(r,o)&&(r!==void 0||La(e.base_,t,e.type_)))return!0;Bn(e),xs(e)}return e.copy_[t]===r&&(r!==void 0||t in e.copy_)||Number.isNaN(r)&&Number.isNaN(e.copy_[t])||(e.copy_[t]=r,e.assigned_.set(t,!0),Fh(e,t,r)),!0},deleteProperty(e,t){return Bn(e),_o(e.base_,t)!==void 0||t in e.base_?(e.assigned_.set(t,!1),xs(e)):e.assigned_.delete(t),e.copy_&&delete e.copy_[t],!0},getOwnPropertyDescriptor(e,t){const r=dt(e),n=Reflect.getOwnPropertyDescriptor(r,t);return n&&{[On]:!0,[hs]:e.type_!==1||t!=="length",[Kn]:n[Kn],[qr]:r[t]}},defineProperty(){Ye(11)},getPrototypeOf(e){return xr(e.base_)},setPrototypeOf(){Ye(12)}},Vr={};mn(Vs,(e,t)=>{Vr[e]=function(){const r=arguments;return r[0]=r[0][0],t.apply(this,r)}});Vr.deleteProperty=function(e,t){return Vr.set.call(this,e,t,void 0)};Vr.set=function(e,t,r){return Vs.set.call(this,e[0],t,r,e[0])};function _o(e,t){const r=e[De];return(r?dt(r):e)[t]}function Oh(e,t,r){var o;const n=zl(t,r);return n?qr in n?n[qr]:(o=n.get)==null?void 0:o.call(e.draft_):void 0}function zl(e,t){if(!(t in e))return;let r=xr(e);for(;r;){const n=Object.getOwnPropertyDescriptor(r,t);if(n)return n;r=xr(r)}}function xs(e){e.modified_||(e.modified_=!0,e.parent_&&xs(e.parent_))}function Bn(e){e.copy_||(e.assigned_=new Map,e.copy_=gs(e.base_,e.scope_.immer_.useStrictShallowCopy_))}var Bh=class{constructor(e){this.autoFreeze_=!0,this.useStrictShallowCopy_=!1,this.useStrictIteration_=!1,this.produce=(t,r,n)=>{if(or(t)&&!or(r)){const i=r;r=t;const l=this;return function(d=i,...u){return l.produce(d,f=>r.call(this,f,...u))}}or(r)||Ye(6),n!==void 0&&!or(n)&&Ye(7);let o;if(Ze(t)){const i=Ua(this),l=Ss(i,t,void 0);let c=!0;try{o=r(l),c=!1}finally{c?ys(i):bs(i)}return Wa(i,n),Ha(o,i)}else if(!t||!Hs(t)){if(o=r(t),o===void 0&&(o=t),o===Ml&&(o=void 0),this.autoFreeze_&&qs(o,!0),n){const i=[],l=[];Jt(ms).generateReplacementPatches_(t,o,{patches_:i,inversePatches_:l}),n(i,l)}return o}else Ye(1,t)},this.produceWithPatches=(t,r)=>{if(or(t))return(l,...c)=>this.produceWithPatches(l,d=>t(d,...c));let n,o;return[this.produce(t,r,(l,c)=>{n=l,o=c}),n,o]},Fo(e==null?void 0:e.autoFreeze)&&this.setAutoFreeze(e.autoFreeze),Fo(e==null?void 0:e.useStrictShallowCopy)&&this.setUseStrictShallowCopy(e.useStrictShallowCopy),Fo(e==null?void 0:e.useStrictIteration)&&this.setUseStrictIteration(e.useStrictIteration)}createDraft(e){Ze(e)||Ye(8),ft(e)&&(e=Lh(e));const t=Ua(this),r=Ss(t,e,void 0);return r[De].isManual_=!0,bs(t),r}finishDraft(e,t){const r=e&&e[De];(!r||!r.isManual_)&&Ye(9);const{scope_:n}=r;return Wa(n,t),Ha(void 0,n)}setAutoFreeze(e){this.autoFreeze_=e}setUseStrictShallowCopy(e){this.useStrictShallowCopy_=e}setUseStrictIteration(e){this.useStrictIteration_=e}shouldUseStrictIteration(){return this.useStrictIteration_}applyPatches(e,t){let r;for(r=t.length-1;r>=0;r--){const o=t[r];if(o.path.length===0&&o.op==="replace"){e=o.value;break}}r>-1&&(t=t.slice(r+1));const n=Jt(ms).applyPatches_;return ft(e)?n(e,t):this.produce(e,o=>n(o,t))}};function Ss(e,t,r,n){const[o,i]=mo(t)?Jt(Xn).proxyMap_(t,r):yo(t)?Jt(Xn).proxySet_(t,r):_h(t,r);return((r==null?void 0:r.scope_)??_l()).drafts_.push(o),i.callbacks_=(r==null?void 0:r.callbacks_)??[],i.key_=n,r&&n!==void 0?$h(r,i,n):i.callbacks_.push(function(d){var f;(f=d.mapSetPlugin_)==null||f.fixSetContents(i);const{patchPlugin_:u}=d;i.modified_&&u&&u.generatePatches_(i,[],d)}),o}function Lh(e){return ft(e)||Ye(10,e),Nl(e)}function Nl(e){if(!Ze(e)||bo(e))return e;const t=e[De];let r,n=!0;if(t){if(!t.modified_)return t.base_;t.finalized_=!0,r=gs(e,t.scope_.immer_.useStrictShallowCopy_),n=t.scope_.immer_.shouldUseStrictIteration()}else r=gs(e,!0);return mn(r,(o,i)=>{Yn(r,o,Nl(i))},n),t&&(t.finalized_=!1),r}var zh=new Bh,Wl=zh.produce;function Ul(e){return({dispatch:r,getState:n})=>o=>i=>typeof i=="function"?i(r,n,e):o(i)}var Nh=Ul(),Wh=Ul,Uh=typeof window<"u"&&window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__?window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__:function(){if(arguments.length!==0)return typeof arguments[0]=="object"?Gr:Gr.apply(null,arguments)};function qa(e,t){function r(...n){if(t){let o=t(...n);if(!o)throw new Error(ht(0));return{type:e,payload:o.payload,..."meta"in o&&{meta:o.meta},..."error"in o&&{error:o.error}}}return{type:e,payload:n[0]}}return r.toString=()=>`${e}`,r.type=e,r.match=n=>jh(n)&&n.type===e,r}var Hl=class _r extends Array{constructor(...t){super(...t),Object.setPrototypeOf(this,_r.prototype)}static get[Symbol.species](){return _r}concat(...t){return super.concat.apply(this,t)}prepend(...t){return t.length===1&&Array.isArray(t[0])?new _r(...t[0].concat(this)):new _r(...t.concat(this))}};function Qa(e){return Ze(e)?Wl(e,()=>{}):e}function In(e,t,r){return e.has(t)?e.get(t):e.set(t,r(t)).get(t)}function Hh(e){return typeof e=="boolean"}var Gh=()=>function(t){const{thunk:r=!0,immutableCheck:n=!0,serializableCheck:o=!0,actionCreatorCheck:i=!0}=t??{};let l=new Hl;return r&&(Hh(r)?l.push(Nh):l.push(Wh(r.extraArgument))),l},qh="RTK_autoBatch",Va=e=>t=>{setTimeout(t,e)},Qh=(e={type:"raf"})=>t=>(...r)=>{const n=t(...r);let o=!0,i=!1,l=!1;const c=new Set,d=e.type==="tick"?queueMicrotask:e.type==="raf"?typeof window<"u"&&window.requestAnimationFrame?window.requestAnimationFrame:Va(10):e.type==="callback"?e.queueNotification:Va(e.timeout),u=()=>{l=!1,i&&(i=!1,c.forEach(f=>f()))};return Object.assign({},n,{subscribe(f){const p=()=>o&&f(),h=n.subscribe(p);return c.add(f),()=>{h(),c.delete(f)}},dispatch(f){var p;try{return o=!((p=f==null?void 0:f.meta)!=null&&p[qh]),i=!o,i&&(l||(l=!0,d(u))),n.dispatch(f)}finally{o=!0}}})},Vh=e=>function(r){const{autoBatch:n=!0}=r??{};let o=new Hl(e);return n&&o.push(Qh(typeof n=="object"?n:void 0)),o};function Kh(e){const t=Gh(),{reducer:r=void 0,middleware:n,devTools:o=!0,preloadedState:i=void 0,enhancers:l=void 0}=e||{};let c;if(typeof r=="function")c=r;else if(Ws(r))c=kh(r);else throw new Error(ht(1));let d;typeof n=="function"?d=n(t):d=t();let u=Gr;o&&(u=Uh({trace:!1,...typeof o=="object"&&o}));const f=Tl(...d),p=Vh(f);let h=typeof l=="function"?l(p):p();const m=u(...h);return Us(c,i,m)}function Gl(e){const t={},r=[];let n;const o={addCase(i,l){const c=typeof i=="string"?i:i.type;if(!c)throw new Error(ht(28));if(c in t)throw new Error(ht(29));return t[c]=l,o},addAsyncThunk(i,l){return l.pending&&(t[i.pending.type]=l.pending),l.rejected&&(t[i.rejected.type]=l.rejected),l.fulfilled&&(t[i.fulfilled.type]=l.fulfilled),l.settled&&r.push({matcher:i.settled,reducer:l.settled}),o},addMatcher(i,l){return r.push({matcher:i,reducer:l}),o},addDefaultCase(i){return n=i,o}};return e(o),[t,r,n]}function Yh(e){return typeof e=="function"}function Xh(e,t){let[r,n,o]=Gl(t),i;if(Yh(e))i=()=>Qa(e());else{const c=Qa(e);i=()=>c}function l(c=i(),d){let u=[r[d.type],...n.filter(({matcher:f})=>f(d)).map(({reducer:f})=>f)];return u.filter(f=>!!f).length===0&&(u=[o]),u.reduce((f,p)=>{if(p)if(ft(f)){const m=p(f,d);return m===void 0?f:m}else{if(Ze(f))return Wl(f,h=>p(h,d));{const h=p(f,d);if(h===void 0){if(f===null)return f;throw Error("A case reducer on a non-draftable value must not return undefined")}return h}}return f},c)}return l.getInitialState=i,l}var Jh=Symbol.for("rtk-slice-createasyncthunk");function Zh(e,t){return`${e}/${t}`}function ef({creators:e}={}){var r;const t=(r=e==null?void 0:e.asyncThunk)==null?void 0:r[Jh];return function(o){const{name:i,reducerPath:l=i}=o;if(!i)throw new Error(ht(11));const c=(typeof o.reducers=="function"?o.reducers(rf()):o.reducers)||{},d=Object.keys(c),u={sliceCaseReducersByName:{},sliceCaseReducersByType:{},actionCreators:{},sliceMatchers:[]},f={addCase(C,I){const E=typeof C=="string"?C:C.type;if(!E)throw new Error(ht(12));if(E in u.sliceCaseReducersByType)throw new Error(ht(13));return u.sliceCaseReducersByType[E]=I,f},addMatcher(C,I){return u.sliceMatchers.push({matcher:C,reducer:I}),f},exposeAction(C,I){return u.actionCreators[C]=I,f},exposeCaseReducer(C,I){return u.sliceCaseReducersByName[C]=I,f}};d.forEach(C=>{const I=c[C],E={reducerName:C,type:Zh(i,C),createNotation:typeof o.reducers=="function"};of(I)?af(E,I,f,t):nf(E,I,f)});function p(){const[C={},I=[],E=void 0]=typeof o.extraReducers=="function"?Gl(o.extraReducers):[o.extraReducers],$={...C,...u.sliceCaseReducersByType};return Xh(o.initialState,F=>{for(let O in $)F.addCase(O,$[O]);for(let O of u.sliceMatchers)F.addMatcher(O.matcher,O.reducer);for(let O of I)F.addMatcher(O.matcher,O.reducer);E&&F.addDefaultCase(E)})}const h=C=>C,m=new Map,y=new WeakMap;let b;function x(C,I){return b||(b=p()),b(C,I)}function S(){return b||(b=p()),b.getInitialState()}function v(C,I=!1){function E(F){let O=F[C];return typeof O>"u"&&I&&(O=In(y,E,S)),O}function $(F=h){const O=In(m,I,()=>new WeakMap);return In(O,F,()=>{const A={};for(const[R,U]of Object.entries(o.selectors??{}))A[R]=tf(U,F,()=>In(y,F,S),I);return A})}return{reducerPath:C,getSelectors:$,get selectors(){return $(E)},selectSlice:E}}const k={name:i,reducer:x,actions:u.actionCreators,caseReducers:u.sliceCaseReducersByName,getInitialState:S,...v(l),injectInto(C,{reducerPath:I,...E}={}){const $=I??l;return C.inject({reducerPath:$,reducer:x},E),{...k,...v($,!0)}}};return k}}function tf(e,t,r,n){function o(i,...l){let c=t(i);return typeof c>"u"&&n&&(c=r()),e(c,...l)}return o.unwrapped=e,o}var So=ef();function rf(){function e(t,r){return{_reducerDefinitionType:"asyncThunk",payloadCreator:t,...r}}return e.withTypes=()=>e,{reducer(t){return Object.assign({[t.name](...r){return t(...r)}}[t.name],{_reducerDefinitionType:"reducer"})},preparedReducer(t,r){return{_reducerDefinitionType:"reducerWithPrepare",prepare:t,reducer:r}},asyncThunk:e}}function nf({type:e,reducerName:t,createNotation:r},n,o){let i,l;if("reducer"in n){if(r&&!sf(n))throw new Error(ht(17));i=n.reducer,l=n.prepare}else i=n;o.addCase(e,i).exposeCaseReducer(t,i).exposeAction(t,l?qa(e,l):qa(e))}function of(e){return e._reducerDefinitionType==="asyncThunk"}function sf(e){return e._reducerDefinitionType==="reducerWithPrepare"}function af({type:e,reducerName:t},r,n,o){if(!o)throw new Error(ht(18));const{payloadCreator:i,fulfilled:l,pending:c,rejected:d,settled:u,options:f}=r,p=o(e,i,f);n.exposeAction(t,p),l&&n.addCase(p.fulfilled,l),c&&n.addCase(p.pending,c),d&&n.addCase(p.rejected,d),u&&n.addMatcher(p.settled,u),n.exposeCaseReducer(t,{fulfilled:l||En,pending:c||En,rejected:d||En,settled:u||En})}function En(){}function ht(e){return`Minified Redux Toolkit error #${e}; visit https://redux-toolkit.js.org/Errors?code=${e} for the full message or use the non-minified dev environment for full errors. `}/**
 * Player State Slice
 * ~~~~~~~~~~~~~~~~~~
 *
 * Redux slice for managing player state including:
 * - Playback state (playing, paused, loading)
 * - Current track and time
 * - Volume and mute
 * - Audio preset
 *
 * Phase C.3: Component Testing & Integration
 *
 * @copyright (C) 2024 Auralis Team
 * @license GPLv3, see LICENSE for more details
 */const ql={state:"idle",trackId:null,intensity:1,progress:0,bufferedSamples:0,totalChunks:0,processedChunks:0,error:null},Ka={isPlaying:!1,currentTrack:null,currentTime:0,duration:0,volume:70,isMuted:!1,preset:"adaptive",isLoading:!1,error:null,lastUpdated:0,streaming:ql},Ql=So({name:"player",initialState:Ka,reducers:{setIsPlaying(e,t){e.isPlaying=t.payload,e.lastUpdated=Date.now()},setCurrentTrack(e,t){e.currentTrack=t.payload,t.payload&&(e.duration=t.payload.duration,e.currentTime=0),e.lastUpdated=Date.now()},setCurrentTime(e,t){e.currentTime=Math.min(t.payload,e.duration),e.lastUpdated=Date.now()},setDuration(e,t){e.duration=t.payload,e.lastUpdated=Date.now()},setVolume(e,t){e.volume=Math.max(0,Math.min(100,t.payload)),e.volume>0&&(e.isMuted=!1),e.lastUpdated=Date.now()},toggleMute(e){e.isMuted=!e.isMuted,e.lastUpdated=Date.now()},setMuted(e,t){e.isMuted=t.payload,e.lastUpdated=Date.now()},setPreset(e,t){e.preset=t.payload,e.lastUpdated=Date.now()},setIsLoading(e,t){e.isLoading=t.payload,e.lastUpdated=Date.now()},setError(e,t){e.error=t.payload,e.lastUpdated=Date.now()},clearError(e){e.error=null},updatePlaybackState(e,t){Object.assign(e,t.payload),e.lastUpdated=Date.now()},resetPlayer(e){Object.assign(e,Ka)},startStreaming(e,t){e.streaming.state="buffering",e.streaming.trackId=t.payload.trackId,e.streaming.totalChunks=t.payload.totalChunks,e.streaming.intensity=t.payload.intensity,e.streaming.processedChunks=0,e.streaming.progress=0,e.streaming.bufferedSamples=0,e.streaming.error=null,e.lastUpdated=Date.now()},updateStreamingProgress(e,t){e.streaming.processedChunks=t.payload.processedChunks,e.streaming.bufferedSamples=t.payload.bufferedSamples,e.streaming.progress=t.payload.progress,e.streaming.state==="buffering"&&t.payload.bufferedSamples>0&&(e.streaming.state="streaming"),e.lastUpdated=Date.now()},completeStreaming(e){e.streaming.state="complete",e.streaming.progress=100,e.lastUpdated=Date.now()},setStreamingError(e,t){e.streaming.state="error",e.streaming.error=t.payload,e.lastUpdated=Date.now()},resetStreaming(e){e.streaming=ql,e.lastUpdated=Date.now()},updateStreamingInfo(e,t){Object.assign(e.streaming,t.payload),e.lastUpdated=Date.now()}}}),{setIsPlaying:Ln,setCurrentTrack:Sr,setCurrentTime:Vl,setDuration:lf,setVolume:Kl,toggleMute:cf,setMuted:Yl,setPreset:Xl,setIsLoading:qk,setError:Qk,clearError:Vk,updatePlaybackState:Kk,resetPlayer:Yk,startStreaming:df,updateStreamingProgress:uf,completeStreaming:pf,setStreamingError:An,resetStreaming:Dn,updateStreamingInfo:Xk}=Ql.actions,hf=e=>e.player.isPlaying,ff=e=>e.player.volume,gf=e=>e.player.streaming,mf=Ql.reducer;function yf(e){try{const t=atob(e),r=new Uint8Array(t.length);for(let l=0;l<t.length;l++)r[l]=t.charCodeAt(l);const n=r.length/4;if(r.length%4!==0)throw new Error(`PCM data size (${r.length}) not divisible by 4 (float32 sample size)`);const o=new DataView(r.buffer),i=new Float32Array(n);for(let l=0;l<n;l++)i[l]=o.getFloat32(l*4,!0);return i}catch(t){throw t instanceof Error?new Error(`Failed to decode PCM base64: ${t.message}`):t}}function Ya(e,t,r){if(!e||!e.data)throw new Error("Invalid audio_chunk message format");const n=e.data;if(!n.samples||typeof n.samples!="string")throw new Error("Missing or invalid samples field in audio_chunk");if(n.sample_count===void 0||n.sample_count<=0)throw new Error("Invalid sample_count in audio_chunk");let o;try{o=yf(n.samples)}catch(l){throw new Error(`Failed to decode PCM samples: ${l instanceof Error?l.message:String(l)}`)}o.length!==n.sample_count&&console.warn(`Sample count mismatch: decoded ${o.length}, expected ${n.sample_count}`);const i={sampleRate:t,channels:r,chunkIndex:n.chunk_index??0,chunkCount:n.chunk_count??1,frameIndex:n.frame_index??0,frameCount:n.frame_count??1,sampleCount:o.length,crossfadeSamples:n.crossfade_samples??0};return{samples:o,metadata:i}}const Jl=()=>{const e=ln(),t=Ot(),r=Et(gf),n=g.useRef(null),o=g.useRef(null),i=g.useRef(null),l=g.useRef(null),c=g.useRef(null),d=g.useRef(null),u=g.useRef(null),f=g.useRef(null),p=g.useRef([]),h=g.useRef(null),m=g.useRef(-1),[y,b]=g.useState(0),[x,S]=g.useState(!1),[v,k]=g.useState("idle"),[C,I]=g.useState(null),E=g.useCallback(()=>{n.current=null,o.current=null,h.current=null,p.current=[],m.current=-1},[]),$=g.useCallback(T=>{try{console.log("[usePlayEnhanced] Stream started:",{trackId:T.data.track_id,chunks:T.data.total_chunks,duration:T.data.total_duration});const N=new xh;N.initialize(T.data.sample_rate,T.data.channels),n.current=N;const Q=T.data.sample_rate;if(!i.current||i.current.sampleRate!==Q){i.current&&(console.log("[usePlayEnhanced] Closing AudioContext (sample rate mismatch)",i.current.sampleRate,"",Q),i.current.close());const V=window.AudioContext||window.webkitAudioContext;i.current=new V({sampleRate:Q}),console.log("[usePlayEnhanced] Created AudioContext with sample rate:",Q)}const ee=new Sh(i.current,N);if(o.current=ee,ee.onStateChanged(V=>{V==="paused"?S(!0):V==="playing"&&S(!1)}),ee.onUnderrun(()=>{console.warn("[usePlayEnhanced] Buffer underrun detected")}),h.current={sampleRate:T.data.sample_rate,channels:T.data.channels,totalChunks:T.data.total_chunks,processedChunks:0},m.current=-1,e(df({trackId:T.data.track_id,totalChunks:T.data.total_chunks,intensity:1})),p.current.length>0){console.log("[usePlayEnhanced] Processing queued chunks:",p.current.length);const V=[...p.current];p.current=[];for(const pe of V)try{const{samples:je,metadata:ve}=Ya(pe,T.data.sample_rate,T.data.channels);N.append(je,ve.crossfadeSamples),h.current.processedChunks++}catch(je){console.error("[usePlayEnhanced] Error processing queued chunk:",je)}}const W=T.data.sample_rate*T.data.channels*2;N.getAvailableSamples()>=W&&(ee.startPlayback(),S(!1))}catch(N){const Q=`Failed to initialize streaming: ${N instanceof Error?N.message:String(N)}`;console.error("[usePlayEnhanced]",Q),e(An(Q))}},[e]),F=g.useCallback(T=>{var N;try{const Q=((N=T.data)==null?void 0:N.chunk_index)??0;if(!n.current||!h.current){console.log("[usePlayEnhanced] Queuing chunk until stream initialized:",{chunkIndex:Q,queueLength:p.current.length+1}),p.current.push(T);return}const ee=m.current;ee>=0&&Q<ee-1&&(console.warn("[usePlayEnhanced] Out-of-sequence chunk detected:",{expected:ee+1,received:Q,message:"New stream may have started without audio_stream_start. This can cause audio discontinuity."}),n.current.reset(),b(0),m.current=-1),m.current=Q;const{samples:re,metadata:W}=Ya(T,h.current.sampleRate,h.current.channels);n.current.append(re,W.crossfadeSamples),h.current.processedChunks++;const V=n.current.getAvailableSamples(),pe=h.current.processedChunks/h.current.totalChunks*100;e(uf({processedChunks:h.current.processedChunks,bufferedSamples:V,progress:Math.min(pe,100)}));const je=o.current,ve=h.current.sampleRate*h.current.channels*2;je&&!je.isPlaying()&&V>=ve&&(console.log("[usePlayEnhanced] Starting playback with buffer:",(V/(h.current.sampleRate*h.current.channels)).toFixed(1)+"s"),je.startPlayback(),S(!1));const Er=V/(h.current.sampleRate*h.current.channels);console.debug("[usePlayEnhanced] Chunk received:",{chunkIndex:W.chunkIndex,frames:`${W.frameIndex+1}/${W.frameCount}`,samples:W.sampleCount,buffered:`${Er.toFixed(1)}s`})}catch(Q){const ee=`Failed to process audio chunk: ${Q instanceof Error?Q.message:String(Q)}`;console.error("[usePlayEnhanced]",ee),e(An(ee))}},[e]),O=g.useCallback(T=>{console.log("[usePlayEnhanced] Stream ended:",{trackId:T.data.track_id,totalSamples:T.data.total_samples,duration:T.data.duration}),e(pf())},[e]),A=g.useCallback(T=>{const N=`Streaming error: ${T.data.error} (${T.data.code})`;console.error("[usePlayEnhanced]",N),e(An(N)),E()},[e,E]),R=g.useCallback(T=>{const{status:N,message:Q}=T.data||{};console.log("[usePlayEnhanced] Fingerprint progress:",{status:N,message:Q}),k(N||"idle"),I(Q||null),N==="complete"&&setTimeout(()=>{k("idle"),I(null)},2e3)},[]),U=g.useCallback(async(T,N,Q)=>{var ee,re;try{if((ee=o.current)==null||ee.stopPlayback(),n.current=null,h.current=null,p.current=[],m.current=-1,e(Dn()),k("idle"),I(null),!t.isConnected)throw new Error("WebSocket not connected. Please wait for connection and try again.");const W="http://localhost:8765";try{const V=await fetch(`${W}/api/library/tracks`);if(V.ok){const je=(re=(await V.json()).tracks)==null?void 0:re.find(ve=>ve.id===T);je&&(e(Sr(je)),console.log("[usePlayEnhanced] Set current track:",je.title))}}catch(V){console.warn("[usePlayEnhanced] Failed to load track data:",V)}t.send({type:"play_enhanced",data:{track_id:T,preset:N,intensity:Q}}),console.log("[usePlayEnhanced] Play enhanced requested:",{trackId:T,preset:N,intensity:Q})}catch(W){const V=`Failed to start enhanced playback: ${W instanceof Error?W.message:String(W)}`;console.error("[usePlayEnhanced]",V),e(An(V))}},[t,e]),L=g.useCallback(()=>{var T;(T=o.current)==null||T.stopPlayback(),e(Dn()),E(),b(0),S(!1)},[e,E]),ae=g.useCallback(()=>{var T;(T=o.current)==null||T.pausePlayback(),S(!0)},[]),K=g.useCallback(()=>{var T;(T=o.current)==null||T.resumePlayback(),S(!1)},[]),Z=g.useCallback(T=>{var N;(N=o.current)==null||N.setVolume(Math.max(0,Math.min(1,T)))},[]);return g.useEffect(()=>(l.current=t.subscribe("audio_stream_start",$),c.current=t.subscribe("audio_chunk",F),d.current=t.subscribe("audio_stream_end",O),u.current=t.subscribe("audio_stream_error",A),f.current=t.subscribe("fingerprint_progress",R),console.log("[usePlayEnhanced] Subscribed to streaming messages on mount"),()=>{var T,N,Q,ee,re;(T=l.current)==null||T.call(l),(N=c.current)==null||N.call(c),(Q=d.current)==null||Q.call(d),(ee=u.current)==null||ee.call(u),(re=f.current)==null||re.call(f),console.log("[usePlayEnhanced] Unsubscribed from streaming messages on unmount")}),[t,$,F,O,A,R]),g.useEffect(()=>{!t.isConnected&&o.current&&(console.log("[usePlayEnhanced] WebSocket disconnected - cleaning up playback state"),o.current.stopPlayback(),o.current=null,n.current=null,h.current=null,p.current=[],b(0),S(!1),k("idle"),I(null),e(Dn()))},[t.isConnected,e]),g.useEffect(()=>{const T=setInterval(()=>{var Q;const N=((Q=o.current)==null?void 0:Q.getCurrentPlaybackTime())||0;b(N)},100);return()=>clearInterval(T)},[]),g.useEffect(()=>()=>{var T;(T=o.current)==null||T.stopPlayback(),e(Dn())},[e]),{playEnhanced:U,stopPlayback:L,pausePlayback:ae,resumePlayback:K,setVolume:Z,isStreaming:r.state==="streaming"||r.state==="buffering",streamingState:r.state,streamingProgress:r.progress,bufferedSamples:r.bufferedSamples,processedChunks:r.processedChunks,totalChunks:r.totalChunks,error:r.error,currentTime:y,isPaused:x,fingerprintStatus:v,fingerprintMessage:C}};/**
 * Queue State Slice
 * ~~~~~~~~~~~~~~~~~
 *
 * Redux slice for managing audio queue state including:
 * - Queue tracks
 * - Current queue position
 * - Queue operations (add, remove, reorder)
 *
 * Phase C.3: Component Testing & Integration
 *
 * @copyright (C) 2024 Auralis Team
 * @license GPLv3, see LICENSE for more details
 */const Xa={tracks:[],currentIndex:0,isLoading:!1,error:null,lastUpdated:0},Zl=So({name:"queue",initialState:Xa,reducers:{addTrack(e,t){e.tracks.push(t.payload),e.lastUpdated=Date.now()},addTracks(e,t){e.tracks.push(...t.payload),e.lastUpdated=Date.now()},removeTrack(e,t){const r=t.payload;r>=0&&r<e.tracks.length&&(e.tracks.splice(r,1),(r<e.currentIndex||r===e.currentIndex&&e.currentIndex>=e.tracks.length)&&(e.currentIndex=Math.max(0,e.currentIndex-1)),e.lastUpdated=Date.now())},reorderTrack(e,t){const{fromIndex:r,toIndex:n}=t.payload;if(r===n)return;const[o]=e.tracks.splice(r,1);e.tracks.splice(n,0,o),e.currentIndex===r?e.currentIndex=n:r<e.currentIndex&&n>=e.currentIndex?e.currentIndex=Math.max(0,e.currentIndex-1):r>e.currentIndex&&n<=e.currentIndex&&(e.currentIndex=Math.min(e.tracks.length-1,e.currentIndex+1)),e.lastUpdated=Date.now()},clearQueue(e){e.tracks=[],e.currentIndex=0,e.lastUpdated=Date.now()},setQueue(e,t){e.tracks=t.payload,e.currentIndex=Math.min(e.currentIndex,e.tracks.length-1),e.lastUpdated=Date.now()},setCurrentIndex(e,t){const r=t.payload;r>=0&&r<e.tracks.length&&(e.currentIndex=r,e.lastUpdated=Date.now())},nextTrack(e){e.currentIndex<e.tracks.length-1&&(e.currentIndex+=1,e.lastUpdated=Date.now())},previousTrack(e){e.currentIndex>0&&(e.currentIndex-=1,e.lastUpdated=Date.now())},setIsLoading(e,t){e.isLoading=t.payload,e.lastUpdated=Date.now()},setError(e,t){e.error=t.payload,e.lastUpdated=Date.now()},clearError(e){e.error=null},resetQueue(e){Object.assign(e,Xa)}}}),{addTrack:bf,addTracks:xf,removeTrack:Sf,reorderTrack:vf,clearQueue:wf,setQueue:ec,setCurrentIndex:tc,nextTrack:rc,previousTrack:nc,setIsLoading:Jk,setError:Zk,clearError:ej,resetQueue:tj}=Zl.actions,Cf=e=>e.queue.tracks,kf=e=>e.queue.currentIndex,jf=Zl.reducer,Pf=()=>{const e=ln(),[t,r]=g.useState(!1),n=Et(L=>L.player||{}),o=n.currentTrack,i=Et(Cf),l=Et(kf),{playEnhanced:c,pausePlayback:d,resumePlayback:u,stopPlayback:f,setVolume:p,isStreaming:h,streamingState:m,processedChunks:y,totalChunks:b,currentTime:x,isPaused:S,error:v}=Jl(),k=m==="buffering",C=m==="error",I=b>0?y/b*100:0;bh({audioElement:null,syncInterval:5e3,driftThreshold:500,updateInterval:100});const E=L=>{console.warn("[Player] Seeking is not supported with WebSocket streaming")},$=async()=>{try{if(l>=i.length-1){console.log("[Player] Already at last track in queue");return}f(),e(rc());const L=i[l+1];L&&(e(Sr(L)),console.log("[Player] Playing next track:",L.title),await c(L.id,"adaptive",1))}catch(L){console.error("[Player] Next command error:",L)}},F=async()=>{try{if(l<=0){console.log("[Player] Already at first track in queue");return}f(),e(nc());const L=i[l-1];L&&(e(Sr(L)),console.log("[Player] Playing previous track:",L.title),await c(L.id,"adaptive",1))}catch(L){console.error("[Player] Previous command error:",L)}},O=async()=>{if(!(o!=null&&o.id)){console.warn("[Player] No track loaded, cannot play");return}try{h?S?(console.log("[Player] Resuming playback"),u()):(console.log("[Player] Pausing playback"),d()):(console.log("[Player] Starting WebSocket audio streaming for track:",o.id),await c(o.id,"adaptive",1))}catch(L){console.error("[Player] Play/Pause command error:",L)}},A=async L=>{try{p(L),console.log("[Player] Volume changed:",L)}catch(ae){console.error("[Player] Volume command error:",ae)}};sh({currentTime:x,duration:(o==null?void 0:o.duration)??0,isPlaying:h&&!S,bufferedPercentage:I});const R=g.useMemo(()=>n.volume??50,[n.volume,h]),U=g.useMemo(()=>R===0||n.isMuted===!0,[R,n.isMuted]);return a.jsxs("div",{"data-testid":"player",style:it.player,children:[a.jsxs("div",{style:it.progressBarContainer,children:[a.jsx(ih,{isBuffering:k,bufferedPercentage:I,isError:C,errorMessage:v??void 0}),a.jsx(lh,{currentTime:x,duration:(o==null?void 0:o.duration)??0,bufferedPercentage:I,onSeek:E,disabled:!0})]}),a.jsxs("div",{style:it.mainRow,children:[a.jsxs("div",{style:it.trackInfoSection,children:[a.jsx(uh,{title:(o==null?void 0:o.title)??"No track",artist:o==null?void 0:o.artist,album:o==null?void 0:o.album,isLoading:k,className:"player-track-display"}),a.jsx(ah,{currentTime:x,duration:(o==null?void 0:o.duration)??0})]}),a.jsx(ch,{isPlaying:h&&!S,onPlay:O,onPause:O,onNext:$,onPrevious:F,isLoading:k,disabled:C}),a.jsxs("div",{style:it.rightSection,children:[a.jsx(dh,{volume:R/100,onVolumeChange:A,isMuted:U,onMuteToggle:async()=>{await A(U?.5:0)},disabled:C}),a.jsx("button",{onClick:()=>r(!t),style:{...it.queueButton,backgroundColor:t?s.colors.accent.primary:"transparent",color:s.colors.text.primary,borderColor:t?s.colors.accent.primary:s.colors.border.medium},title:"Toggle queue (Q)","aria-label":"Toggle queue",onMouseEnter:L=>{L.currentTarget.style.borderColor=s.colors.accent.primary,t||(L.currentTarget.style.backgroundColor=s.colors.bg.secondary)},onMouseLeave:L=>{L.currentTarget.style.borderColor=s.colors.border.medium,t||(L.currentTarget.style.backgroundColor="transparent")},children:""})]})]}),t&&a.jsx("div",{style:it.queuePanelWrapper,children:a.jsx(gh,{collapsed:!1,onToggleCollapse:()=>r(!1)})}),C&&a.jsx("div",{style:it.errorBanner,children:a.jsx("span",{style:it.errorText,children:v||"Playback error occurred"})})]})},it={player:{display:"flex",flexDirection:"column",width:"100%",backgroundColor:s.colors.bg.primary,borderTop:`1px solid ${s.colors.border.medium}`,boxShadow:s.shadows.sm,zIndex:1e3,padding:0,gap:0},progressBarContainer:{width:"100%",height:"auto",padding:`${s.spacing.sm} ${s.spacing.lg}`,paddingBottom:s.spacing.xs},mainRow:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:s.spacing.lg,padding:`${s.spacing.md} ${s.spacing.lg}`,minHeight:"64px","@media (max-width: 768px)":{flexDirection:"column",alignItems:"stretch",padding:s.spacing.md,minHeight:"auto",gap:s.spacing.md}},trackInfoSection:{display:"flex",alignItems:"center",gap:s.spacing.md,minWidth:"200px",flex:"1 1 auto","@media (max-width: 768px)":{minWidth:"auto",width:"100%"}},rightSection:{display:"flex",alignItems:"center",gap:s.spacing.md,flex:"1 1 auto",justifyContent:"flex-end","@media (max-width: 768px)":{width:"100%",justifyContent:"space-between"}},queueButton:{width:"40px",height:"40px",padding:0,border:`1px solid ${s.colors.border.medium}`,borderRadius:s.borderRadius.md,cursor:"pointer",fontSize:s.typography.fontSize.lg,fontWeight:s.typography.fontWeight.medium,transition:s.transitions.all,backgroundColor:"transparent",color:s.colors.text.primary,outline:"none",display:"flex",alignItems:"center",justifyContent:"center"},queuePanelWrapper:{borderTop:`1px solid ${s.colors.border.medium}`,padding:s.spacing.lg,maxHeight:"400px",overflowY:"auto",backgroundColor:s.colors.bg.secondary},errorBanner:{display:"flex",alignItems:"center",padding:s.spacing.md,backgroundColor:s.colors.semantic.error,borderRadius:s.borderRadius.md,margin:s.spacing.sm},errorText:{color:s.colors.text.primary,fontSize:s.typography.fontSize.sm,fontWeight:s.typography.fontWeight.bold}},If=j(P)({width:s.spacing.xxxl,height:"100%",background:s.colors.bg.secondary,borderLeft:`1px solid ${s.colors.border.light}`,display:"flex",flexDirection:"column",alignItems:"center",paddingTop:s.spacing.md,paddingBottom:s.spacing.md,transition:s.transitions.slow}),Ef=j(P)({width:s.components.rightPanel.width,height:"100%",background:s.colors.bg.secondary,boxShadow:"-2px 0 16px rgba(0, 0, 0, 0.12)",display:"flex",flexDirection:"column",transition:s.transitions.slow,overflow:"hidden"}),Af=j(P)({padding:s.spacing.lg,paddingBottom:s.spacing.md,display:"flex",alignItems:"center",justifyContent:"space-between",background:s.colors.bg.level2}),Df=j(P)({flex:1,padding:s.spacing.xl,paddingTop:s.spacing.lg,overflowY:"auto",background:s.colors.bg.secondary}),Rf=j(P)({marginTop:s.spacing.md,display:"flex",flexDirection:"column",alignItems:"center",gap:s.spacing.md}),Tf=j(P)({display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",textAlign:"center",marginTop:s.spacing.xl});j(so)({spacing:s.spacing.lg});const Mf=({onToggleCollapse:e})=>a.jsxs(If,{children:[a.jsx(se,{onClick:e,sx:{color:s.colors.text.primary},children:a.jsx(Yi,{})}),a.jsx(Rf,{children:a.jsx(ke,{title:"Auto-Mastering",placement:"left",children:a.jsx(Un,{sx:{color:s.colors.accent.primary}})})})]});function $f(){const[e,t]=g.useState(null);return Dl(["player_state","track_loaded","track_changed"],r=>{r.type==="player_state"&&t(r.data.currentTrack)}),e}const Ff=j(se,{shouldForwardProp:e=>e!=="$isEnabled"})(({$isEnabled:e})=>({width:"40px",height:"40px",color:e?s.colors.accent.primary:s.colors.text.tertiary,background:e?`${s.colors.accent.primary}15`:"transparent",border:`2px solid ${e?s.colors.accent.primary:s.colors.border.medium}`,boxShadow:e?s.shadows.glowSoft:"none",transition:s.transitions.all,"&:hover":{transform:"scale(1.1)",background:e?`${s.colors.accent.primary}25`:s.colors.bg.elevated,boxShadow:e?s.shadows.glowMd:s.shadows.md},"&:active":{transform:"scale(0.95)"},"& .MuiSvgIcon-root":{fontSize:"20px",transition:s.transitions.transform,transform:e?"rotate(0deg)":"rotate(-180deg)"}})),_f=j(P,{shouldForwardProp:e=>e!=="$isEnabled"})(({$isEnabled:e})=>({fontSize:s.typography.fontSize.xs,fontWeight:s.typography.fontWeight.medium,color:e?s.colors.accent.primary:s.colors.text.tertiary,textTransform:"uppercase",letterSpacing:"0.5px",transition:s.transitions.color,marginTop:s.spacing.xs,textAlign:"center"})),Of=j(P)({display:"flex",flexDirection:"column",alignItems:"center",gap:"2px"}),Bf=j(st,{shouldForwardProp:e=>e!=="$isEnabled"&&e!=="$isProcessing"})(({$isEnabled:e,$isProcessing:t})=>({p:s.spacing.md,mb:s.spacing.lg,borderRadius:s.borderRadius.md,background:e?`${s.colors.accent.primary}1A`:s.colors.bg.tertiary,border:`1px solid ${e?`${s.colors.accent.primary}4D`:s.colors.border.light}`,transition:s.transitions.all,opacity:t?.7:1})),oc=q.memo(({isEnabled:e,onToggle:t,tooltipText:r})=>{const n=e?"Disable audio enhancement":"Enable audio enhancement";return a.jsx(ke,{title:r||n,arrow:!0,placement:"top",children:a.jsxs(Of,{children:[a.jsx(Ff,{onClick:()=>t(!e),$isEnabled:e,"aria-label":e?"Disable enhancement":"Enable enhancement",children:a.jsx(Zd,{})}),a.jsx(_f,{$isEnabled:e,children:e?"Enhanced":"Original"})]})})});oc.displayName="EnhancementToggle.ButtonVariant";const sc=q.memo(({isEnabled:e,onToggle:t,isProcessing:r=!1,label:n="Enable Auto-Mastering",showDescription:o=!0,description:i})=>{const l=e?"Analyzing audio and applying intelligent processing":"Turn on to enhance your music automatically";return a.jsxs(Bf,{elevation:0,$isEnabled:e,$isProcessing:r,children:[a.jsx(nt,{control:a.jsx(ot,{checked:e,onChange:c=>t(c.target.checked),disabled:r,sx:{"& .MuiSwitch-switchBase.Mui-checked":{color:s.colors.accent.primary},"& .MuiSwitch-switchBase.Mui-checked + .MuiSwitch-track":{backgroundColor:s.colors.accent.primary}}}),label:a.jsx(_,{variant:"body2",sx:{fontFamily:s.typography.fontFamily.primary,fontWeight:s.typography.fontWeight.semibold,color:s.colors.text.primary,fontSize:s.typography.fontSize.sm},children:n})}),o&&a.jsx(_,{variant:"caption",sx:{display:"block",mt:s.spacing.xs,ml:`calc(${s.spacing.xxl} + ${s.spacing.xs})`,color:s.colors.text.secondary,fontSize:s.typography.fontSize.xs,fontFamily:s.typography.fontFamily.primary},children:i||l})]})});sc.displayName="EnhancementToggle.SwitchVariant";const ac=q.memo(({variant:e="button",...t})=>e==="switch"?a.jsx(sc,{...t}):a.jsx(oc,{...t}));ac.displayName="EnhancementToggle";const ic=q.memo(({label:e,gradient:t})=>a.jsx(Dp,{label:e,size:"small",sx:{height:s.spacing.lg,fontSize:s.typography.fontSize.xs,background:t,color:s.colors.text.primary,fontWeight:s.typography.fontWeight.semibold,borderRadius:s.borderRadius.sm}}));ic.displayName="ParameterChip";const zn=q.memo(({label:e,value:t,gradient:r,chipLabel:n})=>a.jsxs(P,{children:[a.jsxs(P,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:s.spacing.sm},children:[a.jsx(_,{variant:"body2",sx:{color:s.colors.text.tertiary,fontSize:s.typography.fontSize.sm,fontWeight:s.typography.fontWeight.normal,opacity:.85},children:e}),a.jsx(ic,{label:n,gradient:r})]}),a.jsx(Mp,{variant:"determinate",value:t*100,sx:{height:"3px",borderRadius:s.borderRadius.sm,backgroundColor:s.colors.border.light,"& .MuiLinearProgress-bar":{background:r,borderRadius:s.borderRadius.sm,transition:s.transitions.base}}})]}));zn.displayName="ParameterBar";const Oo={spectralBalance:`linear-gradient(135deg, ${s.colors.accent.primary} 0%, ${s.colors.accent.secondary} 100%)`,dynamicRange:`linear-gradient(135deg, #3B82F6 0%, ${s.colors.accent.primary} 100%)`,energyLevel:`linear-gradient(135deg, ${s.colors.semantic.success} 0%, #26de81 100%)`},lc=q.memo(({params:e})=>{const t=o=>o<.3?"Dark":o<.7?"Balanced":"Bright",r=o=>o<.3?"Compressed":o<.7?"Moderate":"Dynamic",n=o=>o<.3?"Quiet":o<.7?"Moderate":"Loud";return a.jsxs(P,{children:[a.jsxs(_,{variant:"caption",sx:{color:s.colors.text.tertiary,textTransform:"uppercase",letterSpacing:1,fontWeight:s.typography.fontWeight.medium,mb:s.spacing.lg,display:"block",fontSize:s.typography.fontSize.xs,opacity:.8},children:[a.jsx(eu,{sx:{fontSize:s.typography.fontSize.sm,mr:s.spacing.xs,verticalAlign:"middle"}}),"Audio Characteristics"]}),a.jsxs(so,{spacing:s.spacing.lg,children:[" ",a.jsx(zn,{label:"Spectral Balance",value:e.spectral_balance,gradient:Oo.spectralBalance,chipLabel:t(e.spectral_balance)}),a.jsx(zn,{label:"Dynamic Range",value:e.dynamic_range,gradient:Oo.dynamicRange,chipLabel:r(e.dynamic_range)}),a.jsx(zn,{label:"Energy Level",value:e.energy_level,gradient:Oo.energyLevel,chipLabel:n(e.energy_level)})]})]})});lc.displayName="AudioCharacteristics";const bt=q.memo(({label:e,value:t,icon:r,valueColor:n=s.colors.text.primary})=>a.jsxs(P,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[a.jsxs(_,{variant:"body2",sx:{color:s.colors.text.tertiary,fontSize:s.typography.fontSize.sm,opacity:.85},children:[r&&a.jsx(r,{sx:{fontSize:s.typography.fontSize.sm,mr:s.spacing.xs,verticalAlign:"middle",opacity:.7}}),e]}),a.jsx(_,{variant:"body2",sx:{color:n,fontWeight:s.typography.fontWeight.medium,fontSize:s.typography.fontSize.sm},children:t})]}));bt.displayName="ParameterRow";const Lf=e=>{const t=(m,y=1)=>m==null?"":m.toFixed(y),r=m=>m==null?"":`${Math.round(m*100)}%`,n=(m,y=.1)=>m==null?!1:Math.abs(m)>y,o=(m,y=1)=>{const b=t(m,y);return b===""?b:parseFloat(b)>0?`+${b}`:b},i=m=>m==null?s.colors.text.primary:m>0?s.colors.semantic.success:s.colors.semantic.warning;return{formatNumber:t,formatPercent:r,formatDecibel:o,formatTargetLoudness:()=>({label:"Target Loudness",value:`${t(e.target_lufs)} LUFS`,shouldShow:!0}),formatPeakTarget:()=>({label:"Peak Level",value:`${t(e.peak_target_db)} dB`,shouldShow:!0}),formatBassBoost:()=>({label:"Bass Adjustment",value:`${o(e.bass_boost)} dB`,valueColor:i(e.bass_boost),shouldShow:n(e.bass_boost)}),formatAirBoost:()=>({label:"Air Adjustment",value:`${o(e.air_boost)} dB`,valueColor:i(e.air_boost),shouldShow:n(e.air_boost)}),formatCompression:()=>({label:"Compression",value:r(e.compression_amount),shouldShow:n(e.compression_amount,.05)}),formatExpansion:()=>({label:"Expansion",value:r(e.expansion_amount),valueColor:s.colors.semantic.info,shouldShow:n(e.expansion_amount,.05)}),formatStereoWidth:()=>({label:"Stereo Width",value:e.stereo_width!==void 0&&e.stereo_width!==null?`${Math.round(e.stereo_width*100)}%`:"%",shouldShow:!0})}},cc=q.memo(({params:e})=>{const{formatTargetLoudness:t,formatPeakTarget:r,formatBassBoost:n,formatAirBoost:o,formatCompression:i,formatExpansion:l,formatStereoWidth:c}=Lf(e),d=t(),u=r(),f=n(),p=o(),h=i(),m=l(),y=c();return a.jsxs(P,{children:[a.jsxs(_,{variant:"caption",sx:{color:s.colors.text.tertiary,textTransform:"uppercase",letterSpacing:1,fontWeight:s.typography.fontWeight.medium,mb:s.spacing.lg,display:"block",fontSize:s.typography.fontSize.xs,opacity:.8},children:[a.jsx(tu,{sx:{fontSize:s.typography.fontSize.sm,mr:s.spacing.xs,verticalAlign:"middle"}}),"Applied Processing"]}),a.jsxs(so,{spacing:s.spacing.lg,children:[" ",a.jsx(bt,{label:d.label,value:d.value,icon:ru}),a.jsx(bt,{label:u.label,value:u.value}),f.shouldShow&&a.jsx(bt,{label:f.label,value:f.value,valueColor:f.valueColor}),p.shouldShow&&a.jsx(bt,{label:p.label,value:p.value,valueColor:p.valueColor}),h.shouldShow&&a.jsx(bt,{label:h.label,value:h.value,icon:nu}),m.shouldShow&&a.jsx(bt,{label:m.label,value:m.value,valueColor:m.valueColor}),a.jsx(bt,{label:y.label,value:y.value})]})]})});cc.displayName="ProcessingParameters";const dc=q.memo(({recommendation:e,isLoading:t=!1})=>{if(t)return a.jsx("div",{style:{padding:s.spacing.md,background:s.colors.bg.secondary,borderRadius:s.borderRadius.md,textAlign:"center",color:s.colors.text.secondary},children:a.jsx("span",{children:" Analyzing mastering profile..."})});if(!e)return null;const r=e.is_hybrid&&e.weighted_profiles&&e.weighted_profiles.length>0;return a.jsxs("div",{style:{padding:s.spacing.md,background:s.colors.bg.secondary,borderRadius:s.borderRadius.md,border:`1px solid ${s.colors.border.medium}`,display:"flex",flexDirection:"column",gap:s.spacing.md},children:[a.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[a.jsx("div",{style:{fontSize:s.typography.fontSize.sm,fontWeight:s.typography.fontWeight.semibold,color:s.colors.text.primary},children:" Mastering Profile"}),a.jsxs("div",{style:{padding:`${s.spacing.xs} ${s.spacing.sm}`,background:zf(e.confidence_score),borderRadius:s.borderRadius.sm,fontSize:s.typography.fontSize.xs,fontWeight:s.typography.fontWeight.medium,color:s.colors.text.primary},children:[(e.confidence_score*100).toFixed(0),"% match"]})]}),a.jsx("div",{style:{fontSize:s.typography.fontSize.sm,color:s.colors.text.primary,fontWeight:s.typography.fontWeight.medium},children:e.primary_profile_name}),r&&a.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:s.spacing.sm,padding:s.spacing.sm,background:s.colors.bg.level3,borderRadius:s.borderRadius.sm,border:`1px solid ${s.colors.border.light}`},children:[a.jsx("div",{style:{fontSize:s.typography.fontSize.xs,fontWeight:s.typography.fontWeight.semibold,color:s.colors.text.secondary,textTransform:"uppercase",letterSpacing:"0.5px"},children:"Hybrid Blend"}),e.weighted_profiles.map((n,o)=>a.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",fontSize:s.typography.fontSize.xs,color:s.colors.text.secondary},children:[a.jsx("span",{style:{flex:1,overflow:"hidden",textOverflow:"ellipsis"},children:n.profile_name}),a.jsxs("span",{style:{marginLeft:s.spacing.sm,fontWeight:s.typography.fontWeight.semibold,color:s.colors.text.primary,minWidth:"40px",textAlign:"right"},children:[(n.weight*100).toFixed(0),"%"]})]},o))]}),a.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:s.spacing.sm},children:[a.jsx(Bo,{label:"Loudness",value:e.predicted_loudness_change,unit:"dB"}),a.jsx(Bo,{label:"Crest",value:e.predicted_crest_change,unit:"dB"}),a.jsx(Bo,{label:"Centroid",value:e.predicted_centroid_change,unit:"Hz"})]}),e.reasoning&&a.jsx("div",{style:{fontSize:s.typography.fontSize.xs,color:s.colors.text.secondary,fontStyle:"italic",lineHeight:"1.4"},children:e.reasoning})]})});dc.displayName="MasteringRecommendation";const Bo=({label:e,value:t,unit:r})=>a.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:s.spacing.xs,padding:s.spacing.sm,background:s.colors.bg.level3,borderRadius:s.borderRadius.sm,border:`1px solid ${s.colors.border.light}`},children:[a.jsx("div",{style:{fontSize:s.typography.fontSize.xs,color:s.colors.text.secondary,fontWeight:s.typography.fontWeight.medium},children:e}),a.jsxs("div",{style:{fontSize:s.typography.fontSize.sm,color:s.colors.text.primary,fontWeight:s.typography.fontWeight.semibold},children:[t>0?"+":"",t.toFixed(t%1!==0?1:0)," ",r]})]});function zf(e){return e>=.7?`${s.colors.semantic.success}22`:e>=.4?`${s.colors.semantic.warning}22`:s.colors.bg.level3}const uc=q.memo(()=>a.jsx(st,{elevation:0,sx:{p:s.spacing.md,borderRadius:s.borderRadius.md,background:`${s.colors.semantic.info}22`,border:`1px solid ${s.colors.semantic.info}55`},children:a.jsxs(_,{variant:"caption",sx:{color:s.colors.text.secondary,fontSize:s.typography.fontSize.xs,lineHeight:s.typography.lineHeight.relaxed,display:"block"},children:[a.jsx("strong",{style:{color:s.colors.text.primary},children:"Auto-Mastering"})," analyzes your music in real-time and applies intelligent processing tailored to each track's unique characteristics. No presets needed!"]})}));uc.displayName="InfoBox";const pc=j(P)({display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:`${s.spacing.xxxl} ${s.spacing.xl}`,textAlign:"center",minHeight:"300px"}),hc=j(P)({marginBottom:s.spacing.lg,"& .MuiSvgIcon-root":{fontSize:"80px",color:s.colors.text.tertiary,transition:s.transitions.base_inOut},"&:hover .MuiSvgIcon-root":{color:s.colors.accent.secondary,transform:"scale(1.1)"}}),fc=j(_)({fontSize:s.typography.fontSize["2xl"],fontWeight:s.typography.fontWeight.semibold,color:s.colors.text.primary,marginBottom:s.spacing.sm}),gc=j(_)({fontSize:s.typography.fontSize.base,color:s.colors.text.secondary,marginBottom:s.spacing.lg,maxWidth:"400px",lineHeight:s.typography.lineHeight.relaxed}),Nf={music:cn,search:au,playlist:su,folder:ou},gt=({icon:e="music",customIcon:t,title:r,description:n,actionLabel:o,onAction:i})=>{const l=Nf[e];return a.jsxs(pc,{children:[a.jsx(hc,{children:t||a.jsx(l,{})}),a.jsx(fc,{children:r}),n&&a.jsx(gc,{children:n}),o&&i&&a.jsx($e,{variant:"primary",onClick:i,size:"lg",children:o})]})},Wf=({onScanFolder:e,onFolderDrop:t,scanning:r=!1})=>{const n=q.lazy(()=>Mu(()=>import("./DropZone-CTvoQMTE.js"),__vite__mapDeps([0,1,2,3])).then(o=>({default:o.DropZone})));return a.jsx(pc,{children:t?a.jsx(q.Suspense,{fallback:a.jsx("div",{children:"Loading..."}),children:a.jsx(P,{sx:{width:"100%",maxWidth:600,mb:4},children:a.jsx(n,{onFolderDrop:t,onFolderSelect:e,scanning:r})})}):a.jsxs(a.Fragment,{children:[a.jsx(hc,{children:a.jsx(cn,{})}),a.jsx(fc,{children:"No music yet"}),a.jsx(gc,{children:"Your library is empty. Start by scanning a folder to add your music collection."}),e&&a.jsx($e,{variant:"primary",onClick:e,size:"lg",children:"Scan Folder"})]})})},Uf=({query:e})=>a.jsx(gt,{icon:"search",title:"No results found",description:e?`No tracks match "${e}". Try adjusting your search terms.`:"Try adjusting your search terms."}),mc=q.memo(()=>a.jsxs(st,{elevation:0,sx:{p:s.spacing.xl,borderRadius:s.borderRadius.md,background:s.colors.bg.tertiary,border:`1px solid ${s.colors.border.light}`,textAlign:"center"},children:[a.jsx(Un,{sx:{fontSize:s.typography.fontSize["4xl"],color:s.colors.accent.primary,mb:s.spacing.md,animation:`${s.animations.pulse.keyframes} pulse ${s.animations.pulse.duration} ${s.animations.pulse.timing} ${s.animations.pulse.iteration}`}}),a.jsx(_,{variant:"body2",sx:{color:s.colors.text.secondary,fontSize:s.typography.fontSize.sm},children:"Analyzing audio..."})]}));mc.displayName="LoadingState";const Hf=e=>{const{subscribe:t}=Ot(),[r,n]=g.useState(null),[o,i]=g.useState(!1),[l]=g.useState({});g.useEffect(()=>{if(!e)return;if(l[e]){n(l[e]);return}const u=t("mastering_recommendation",f=>{var p;if(((p=f.data)==null?void 0:p.track_id)===e){const h=f.data;l[e]=h,n(h),i(!1)}});return i(!0),u},[e,t,l]);const c=g.useCallback(()=>{n(null),e&&delete l[e]},[e,l]);return{recommendation:r,isLoading:o,clearRecommendation:c,isHybrid:(r==null?void 0:r.is_hybrid)??!1}},Gf=({params:e,isAnalyzing:t,onToggleCollapse:r,onMasteringToggle:n})=>{const{settings:o,setEnabled:i,isProcessing:l}=El(),c=$f(),d=c==null?void 0:c.id,{recommendation:u,isLoading:f}=Hf(d),p=async h=>{await i(h),n==null||n(h)};return a.jsxs(Ef,{children:[a.jsxs(Af,{children:[a.jsxs(P,{sx:{display:"flex",alignItems:"center",gap:s.spacing.sm},children:[a.jsx(Un,{sx:{color:s.colors.accent.primary,fontSize:s.typography.fontSize.lg}}),a.jsx(_,{variant:"subtitle1",sx:{fontFamily:s.typography.fontFamily.primary,fontWeight:s.typography.fontWeight.semibold,color:s.colors.text.primary,fontSize:s.typography.fontSize.md},children:"Auto-Mastering"})]}),a.jsx(se,{onClick:r,size:"small",sx:{color:s.colors.text.primary,transition:s.transitions.fast,"&:hover":{transform:"scale(1.1)"}},children:a.jsx(Xi,{})})]}),a.jsxs(Df,{children:[a.jsx(ac,{isEnabled:o.enabled,isProcessing:l,onToggle:p}),o.enabled&&e&&a.jsxs(so,{spacing:s.spacing.xxl,children:[" ",a.jsx(lc,{params:e}),a.jsx(cc,{params:e}),(u||f)&&a.jsx(dc,{recommendation:u,isLoading:f}),a.jsx(uc,{})]}),o.enabled&&!e&&t&&a.jsx(mc,{}),o.enabled&&!e&&!t&&a.jsx(gt,{icon:"music",title:"No track playing",description:"Play a track to see auto-mastering parameters"}),!o.enabled&&a.jsxs(Tf,{children:[a.jsx(Un,{sx:{fontSize:s.typography.fontSize["4xl"],color:s.colors.accent.primary,marginBottom:s.spacing.md,opacity:.3}}),a.jsx(_,{variant:"body2",sx:{color:s.colors.text.secondary,marginBottom:s.spacing.md,fontSize:s.typography.fontSize.sm},children:"Auto-Mastering is currently disabled"}),a.jsx(_,{variant:"caption",sx:{color:s.colors.text.disabled,lineHeight:s.typography.lineHeight.relaxed,fontSize:s.typography.fontSize.xs},children:"Enable the toggle above to start enhancing your music with intelligent processing"})]})]})]})},qf="http://localhost:8765";function yc(e){const t=e.startsWith("/")?e:`/${e}`;return`${qf}${t}`}const ye={PLAYLISTS:"/api/playlists",PLAYLIST:e=>`/api/playlists/${e}`,PLAYLIST_TRACKS:e=>`/api/playlists/${e}/tracks`,ADD_PLAYLIST_TRACK:e=>`/api/playlists/${e}/tracks`,REMOVE_PLAYLIST_TRACK:(e,t)=>`/api/playlists/${e}/tracks/${t}`,QUEUE:"/api/player/queue",QUEUE_TRACK:e=>`/api/player/queue/${e}`,QUEUE_REORDER:"/api/player/queue/reorder",QUEUE_SHUFFLE:"/api/player/queue/shuffle",QUEUE_CLEAR:"/api/player/queue/clear",SETTINGS:"/api/settings",ENHANCEMENT_SETTINGS:"/api/settings/enhancement",LIBRARY_STATS:"/api/library/stats",LIBRARY_TRACKS:"/api/library/tracks",LIBRARY_ALBUMS:"/api/library/albums",LIBRARY_ARTISTS:"/api/library/artists",ARTIST_TRACKS:e=>`/api/artists/${e}/tracks`,PLAYER_STATUS:"/api/player/status",PLAYER_LOAD:"/api/player/load",PLAYER_PLAY:"/api/player/play",PLAYER_PAUSE:"/api/player/pause",PLAYER_STOP:"/api/player/stop",PLAYER_SEEK:"/api/player/seek",PLAYER_VOLUME:"/api/player/volume"},Qf=({enabled:e})=>{const[t,r]=g.useState(null),[n,o]=g.useState(!1),i=g.useRef(null),l=g.useRef(0),c=3e4,d=g.useCallback(async()=>{if(i.current)return i.current;if(Date.now()-l.current<c&&t)return t;try{o(!0);const f=new AbortController,p=setTimeout(()=>f.abort(),5e3),h=fetch(yc("/api/processing/parameters"),{signal:f.signal}).then(async m=>{if(clearTimeout(p),m.ok){const y=await m.json();return r(y),l.current=Date.now(),y}return null}).catch(()=>null).finally(()=>{i.current=null,o(!1)});return i.current=h,await h}catch{return i.current=null,o(!1),null}},[t]);return g.useEffect(()=>{e&&d()},[e]),{params:t,isAnalyzing:n}},bc=q.memo(({collapsed:e=!1,onToggleCollapse:t,onMasteringToggle:r})=>{const{settings:n}=El(),{params:o,isAnalyzing:i}=Qf({enabled:n.enabled});return e?a.jsx(Mf,{onToggleCollapse:t}):a.jsx(Gf,{params:o,isAnalyzing:i,onToggleCollapse:t,onMasteringToggle:r})});bc.displayName="EnhancementPane";const Ft="#667eea",D={minimal:"rgba(102, 126, 234, 0.05)",ultraLight:"rgba(102, 126, 234, 0.08)",veryLight:"rgba(102, 126, 234, 0.1)",light:"rgba(102, 126, 234, 0.12)",lighter:"rgba(102, 126, 234, 0.15)",standard:"rgba(102, 126, 234, 0.2)",strong:"rgba(102, 126, 234, 0.3)",veryStrong:"rgba(102, 126, 234, 0.4)",stronger:"rgba(102, 126, 234, 0.5)"},Vf={veryStrong:"rgba(0, 0, 0, 0.4)"},Kf={aurora:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",auroraHover:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",electricPurple:"linear-gradient(135deg, #c44569 0%, #667eea 100%)",gradientPink:"linear-gradient(135deg, #f093fb 0%, #f5576c 100%)",gradientBlue:"linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)",gradientGreen:"linear-gradient(135deg, #43e97b 0%, #38f9d7 100%)",gradientSunset:"linear-gradient(135deg, #fa709a 0%, #fee140 100%)",gradientTeal:"linear-gradient(135deg, #30cfd0 0%, #330867 100%)",gradientPastel:"linear-gradient(135deg, #a8edea 0%, #fed6e3 100%)",gradientRose:"linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%)"},le=Kf,Rn={connected:"#4ade80",connecting:"#facc15",disconnected:"#ef4444"},xc={primary:`0 4px 12px ${D.veryStrong}`},Yf={dropdownDark:`0 8px 32px ${Vf.veryStrong}`},Xf={purple:`0 8px 32px ${D.strong}`},Jf="8px",Ja="16px",Za={gap:{standard:Ja},buttons:{compact:`${Jf} ${Ja}`}},Zf=j(st)(({theme:e})=>({position:"fixed",top:"80px",left:"50%",transform:"translateX(-50%)",zIndex:1200,background:`linear-gradient(135deg, ${D.veryStrong} 0%, rgba(118, 75, 162, 0.95) 100%)`,backdropFilter:"blur(20px)",border:`1px solid ${D.light}`,borderRadius:"16px",padding:Za.buttons.compact,display:"flex",alignItems:"center",gap:Za.gap.standard,boxShadow:Yf.dropdownDark,animation:"slideDown 0.3s ease-out","@keyframes slideDown":{from:{opacity:0,transform:"translate(-50%, -20px)"},to:{opacity:1,transform:"translate(-50%, 0)"}}})),eg=j(_)(({theme:e})=>({color:s.colors.text.primary,fontWeight:"bold",fontSize:"16px",minWidth:"140px"})),tg=j(se)(({theme:e})=>({color:s.colors.text.primary,backgroundColor:D.light,"&:hover":{backgroundColor:D.standard},transition:"all 0.2s ease"})),rg=j(se)(({theme:e})=>({color:s.colors.text.primary,marginLeft:"auto","&:hover":{backgroundColor:D.light}})),Dr=({icon:e,title:t,onClick:r})=>{const n=o=>{r(o)};return a.jsx(ke,{title:t,children:a.jsx(tg,{onClick:n,size:"medium",children:e})})},ng=({anchorEl:e,onClose:t,onEditMetadata:r})=>{const n=()=>{r(),t()};return a.jsx(Ds,{anchorEl:e,open:!!e,onClose:t,anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},PaperProps:{sx:{background:"linear-gradient(135deg, #1a1f3a 0%, #0A0E27 100%)",border:`1px solid ${D.standard}`,borderRadius:"12px",mt:1}},children:a.jsxs(ce,{onClick:n,sx:{color:"white",gap:1},children:[a.jsx(Rs,{fontSize:"small"}),"Edit Metadata"]})})},og=()=>{const[e,t]=g.useState(null),r=i=>{t(i.currentTarget)},n=()=>{t(null)};return{moreMenuAnchor:e,handleMoreMenuOpen:r,handleMoreMenuClose:n,handleAction:i=>{i(),n()}}},sg=e=>{switch(e){case"playlist":return"Remove from Playlist";case"favorites":return"Remove from Favorites";case"queue":return"Remove from Queue";default:return"Delete"}},ag=({selectedCount:e,onAddToPlaylist:t,onAddToQueue:r,onRemove:n,onToggleFavorite:o,onEditMetadata:i,onClearSelection:l,context:c="library"})=>{const{moreMenuAnchor:d,handleMoreMenuOpen:u,handleMoreMenuClose:f}=og();return a.jsxs(Zf,{elevation:8,children:[a.jsxs(eg,{children:[e," ",e===1?"track":"tracks"," selected"]}),t&&a.jsx(Dr,{icon:a.jsx(Ts,{}),title:"Add to Playlist",onClick:()=>t()}),r&&a.jsx(Dr,{icon:a.jsx(ao,{}),title:"Add to Queue",onClick:()=>r()}),o&&a.jsx(Dr,{icon:a.jsx(io,{}),title:"Toggle Favorite",onClick:()=>o()}),n&&a.jsx(Dr,{icon:a.jsx(dn,{}),title:sg(c),onClick:()=>n()}),i&&a.jsxs(a.Fragment,{children:[a.jsx(Dr,{icon:a.jsx(un,{}),title:"More Actions",onClick:u}),a.jsx(ng,{anchorEl:d,onClose:f,onEditMetadata:i})]}),a.jsx(rg,{onClick:l,size:"small",children:a.jsx(pn,{})})]})},Me=j(Mt)({"& .MuiOutlinedInput-root":{color:s.colors.text.primary,"& fieldset":{borderColor:D.light},"&:hover fieldset":{borderColor:D.standard},"&.Mui-focused fieldset":{borderColor:s.colors.accent.primary}},"& .MuiInputLabel-root":{color:D.standard}});j(Mt)(({theme:e})=>({"& .MuiOutlinedInput-root":{height:s.components.searchBar.height,borderRadius:0,background:"transparent",border:"none",borderBottom:`1px solid ${s.colors.border.light}`,transition:"border-color 0.15s ease",paddingRight:s.spacing.sm,"& fieldset":{border:"none"},"&:hover":{background:"transparent",borderBottom:`1px solid ${s.colors.border.medium}`},"&.Mui-focused":{background:"transparent",borderBottom:`1px solid ${s.colors.accent.primary}`,boxShadow:"none"}},"& .MuiOutlinedInput-input":{fontSize:s.typography.fontSize.md,color:s.colors.text.primary,padding:`${s.spacing.xs} ${s.spacing.md}`,"&::placeholder":{color:s.colors.text.tertiary,opacity:.7}},"& .MuiInputAdornment-root":{marginRight:s.spacing.sm,color:s.colors.text.tertiary,opacity:.6}}));j(Mt)(({theme:e})=>({"& .MuiOutlinedInput-root":{fontSize:s.typography.fontSize.sm,color:s.colors.text.primary,"& fieldset":{borderColor:D.ultraLight},"&:hover fieldset":{borderColor:D.lighter},"&.Mui-focused fieldset":{borderColor:s.colors.accent.primary}},"& .MuiOutlinedInput-input":{padding:`${s.spacing.xs} ${s.spacing.sm}`},"& .MuiInputLabel-root":{color:D.lighter,fontSize:s.typography.fontSize.sm}}));const ig=({metadata:e,onChange:t})=>a.jsxs(a.Fragment,{children:[a.jsx(he,{item:!0,xs:12,children:a.jsx(Me,{fullWidth:!0,label:"Title",value:e.title||"",onChange:r=>t("title",r.target.value),variant:"outlined"})}),a.jsx(he,{item:!0,xs:12,sm:6,children:a.jsx(Me,{fullWidth:!0,label:"Artist",value:e.artist||"",onChange:r=>t("artist",r.target.value),variant:"outlined"})}),a.jsx(he,{item:!0,xs:12,sm:6,children:a.jsx(Me,{fullWidth:!0,label:"Album Artist",value:e.albumartist||"",onChange:r=>t("albumartist",r.target.value),variant:"outlined"})}),a.jsx(he,{item:!0,xs:12,children:a.jsx(Me,{fullWidth:!0,label:"Album",value:e.album||"",onChange:r=>t("album",r.target.value),variant:"outlined"})})]}),lg=({metadata:e,onChange:t})=>a.jsxs(a.Fragment,{children:[a.jsx(he,{item:!0,xs:12,sm:6,children:a.jsx(Me,{fullWidth:!0,label:"Genre",value:e.genre||"",onChange:r=>t("genre",r.target.value),variant:"outlined"})}),a.jsx(he,{item:!0,xs:12,sm:6,children:a.jsx(Me,{fullWidth:!0,label:"Year",type:"number",value:e.year||"",onChange:r=>t("year",r.target.value),variant:"outlined"})}),a.jsx(he,{item:!0,xs:6,sm:3,children:a.jsx(Me,{fullWidth:!0,label:"Track #",type:"number",value:e.track||"",onChange:r=>t("track",r.target.value),variant:"outlined"})}),a.jsx(he,{item:!0,xs:6,sm:3,children:a.jsx(Me,{fullWidth:!0,label:"Disc #",type:"number",value:e.disc||"",onChange:r=>t("disc",r.target.value),variant:"outlined"})}),a.jsx(he,{item:!0,xs:12,sm:6,children:a.jsx(Me,{fullWidth:!0,label:"Composer",value:e.composer||"",onChange:r=>t("composer",r.target.value),variant:"outlined"})})]}),cg=({metadata:e,onChange:t})=>a.jsx(a.Fragment,{children:a.jsx(he,{item:!0,xs:12,children:a.jsx(Me,{fullWidth:!0,label:"Comment",value:e.comment||"",onChange:r=>t("comment",r.target.value),multiline:!0,rows:3,variant:"outlined"})})}),dg=({metadata:e,loading:t,onChange:r})=>t?a.jsx(P,{display:"flex",justifyContent:"center",p:4,children:a.jsx(ho,{})}):a.jsxs(he,{container:!0,spacing:2,children:[a.jsx(ig,{metadata:e,onChange:r}),a.jsx(lg,{metadata:e,onChange:r}),a.jsx(cg,{metadata:e,onChange:r})]}),ug=j(P)({display:"flex",alignItems:"center",justifyContent:"space-between"}),pg=j(P)({color:s.colors.text.primary,borderBottom:`1px solid ${D.ultraLight}`}),ei=j(P)({mb:2});j(P)({mt:2});const hg=({loading:e})=>a.jsx(pg,{component:"div",children:a.jsxs(ug,{children:[a.jsx(_,{variant:"h6",children:"Edit Metadata"}),e&&a.jsx(ho,{size:24})]})}),fg=({error:e,success:t})=>a.jsxs(a.Fragment,{children:[e&&a.jsx(ei,{children:a.jsx(qn,{variant:"error",children:e})}),t&&a.jsx(ei,{children:a.jsx(qn,{variant:"success",children:"Metadata saved successfully!"})})]}),gg=j(Ms)(({theme:e})=>({borderBottom:`1px solid ${s.colors.border.light}`,minHeight:48,"& .MuiTab-root":{textTransform:"none",fontSize:s.typography.fontSize.base,minHeight:48,color:e.palette.text.secondary,"&.Mui-selected":{color:Ft}},"& .MuiTabs-indicator":{backgroundColor:Ft}}));j(Ms)(({theme:e})=>({borderBottom:`1px solid ${s.colors.border.light}`,marginBottom:e.spacing(3),"& .MuiTab-root":{textTransform:"none",fontSize:s.typography.fontSize.md,fontWeight:s.typography.fontWeight.medium,minWidth:120,"&.Mui-selected":{color:Ft}},"& .MuiTabs-indicator":{backgroundColor:Ft}}));const Sc="8px",mg="50%",vc=j($e)({background:le.aurora,color:s.colors.text.primary,textTransform:"none",fontWeight:s.typography.fontWeight.semibold,padding:`${s.spacing.xs} ${s.spacing.lg}`,borderRadius:Sc,"&:hover":{background:le.auroraHover,transform:"translateY(-1px)",boxShadow:xc.primary},"&:disabled":{background:D.strong,color:"rgba(255, 255, 255, 0.5)"},transition:s.transitions.all}),Ks=j($e)(({theme:e})=>({color:s.colors.text.secondary,textTransform:"none","&:hover":{backgroundColor:D.veryLight,color:s.colors.text.primary},transition:s.transitions.all})),yg=j($e)(({theme:e})=>({background:le.aurora,color:s.colors.text.primary,textTransform:"none",fontWeight:s.typography.fontWeight.semibold,"&:hover":{background:le.auroraHover,transform:"translateY(-1px)",boxShadow:xc.primary},"&:disabled":{background:D.strong,color:"rgba(255, 255, 255, 0.5)"},transition:s.transitions.all})),wc=Ks,Zt=j(_)(({theme:e})=>({fontSize:s.typography.fontSize.sm,fontWeight:s.typography.fontWeight.semibold,color:s.colors.text.primary,marginBottom:e.spacing(1)})),Pe=j(_)(({theme:e})=>({fontSize:s.typography.fontSize.xs,color:s.colors.text.secondary,marginTop:e.spacing(.5)}));j(_)(({theme:e})=>({fontSize:s.typography.fontSize.xs,fontWeight:s.typography.fontWeight.bold,textTransform:"uppercase",color:s.colors.text.secondary,padding:e.spacing(2,2,1,2),letterSpacing:s.typography.letterSpacing.loose}));j(_)({fontSize:s.typography.fontSize.base,fontWeight:s.typography.fontWeight.medium,transition:s.transitions.color});j(_)(({theme:e})=>({fontSize:s.typography.fontSize.sm,color:s.colors.text.secondary}));j(_)(({theme:e})=>({fontSize:s.typography.fontSize.xs,color:s.colors.text.secondary,fontWeight:s.typography.fontWeight.normal}));j(_)(({theme:e})=>({color:s.colors.text.secondary,fontSize:s.typography.fontSize.sm,fontWeight:s.typography.fontWeight.normal}));j(_)(({theme:e})=>({fontSize:s.typography.fontSize.xs,color:s.colors.text.muted,lineHeight:s.typography.lineHeight.tight}));const bn=j(As)(({theme:e})=>({"& .MuiDialog-paper":{background:s.colors.bg.level4,backdropFilter:"blur(20px)",border:`1px solid ${s.colors.border.light}`,borderRadius:e.spacing(2)}})),xn=j(Ki)(({theme:e})=>({background:le.aurora,color:s.colors.text.primary,display:"flex",justifyContent:"space-between",alignItems:"center",padding:e.spacing(2,3)})),ue=j(P)(({theme:e})=>({marginBottom:e.spacing(3)})),bg=j(kr)(({theme:e})=>({borderTop:`1px solid ${s.colors.border.light}`,padding:e.spacing(2)})),xg={sx:{bgcolor:s.colors.bg.level3,backgroundImage:s.gradients.darkSubtle}},Sg=(e,t,r)=>{const[n,o]=g.useState({}),[i,l]=g.useState(!1),[c,d]=g.useState(!1),[u,f]=g.useState(null),[p,h]=g.useState(!1);g.useEffect(()=>{e&&(t?o(t):m())},[e,t]);const m=async()=>{l(!0),f(null);try{const x=await fetch(`/api/metadata/tracks/${e}`);if(!x.ok)throw new Error("Failed to fetch metadata");const S=await x.json();o(S.metadata||{})}catch(x){console.error("Error fetching metadata:",x),f(x instanceof Error?x.message:"Failed to load metadata")}finally{l(!1)}};return{metadata:n,loading:i,saving:c,error:u,success:p,updateField:(x,S)=>{o(v=>({...v,[x]:S}))},saveMetadata:async()=>{d(!0),f(null),h(!1);try{const x={};if(Object.entries(n).forEach(([v,k])=>{if(k!==void 0&&k!=="")if(["year","track","disc","bpm"].includes(v)){const C=parseInt(String(k),10);isNaN(C)||(x[v]=C)}else x[v]=k}),Object.keys(x).length===0){f("No changes to save"),d(!1);return}const S=await fetch(`/api/metadata/tracks/${e}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(x)});if(!S.ok){const v=await S.json();throw new Error(v.detail||"Failed to save metadata")}return h(!0),r&&r(e,x),!0}catch(x){return console.error("Error saving metadata:",x),f(x instanceof Error?x.message:"Failed to save metadata"),!1}finally{d(!1)}},setSuccess:h,setError:f}},vg=({open:e,trackId:t,currentMetadata:r,onClose:n,onSave:o})=>{const{metadata:i,loading:l,saving:c,error:d,success:u,updateField:f,saveMetadata:p,setSuccess:h}=Sg(t,r,o),m=async()=>{await p()&&setTimeout(()=>{n()},1e3)},y=()=>{c||(h(!1),n())};return a.jsxs(As,{open:e,onClose:y,maxWidth:"md",fullWidth:!0,PaperProps:xg,children:[a.jsx(hg,{loading:l}),a.jsxs(tr,{sx:{mt:2},children:[a.jsx(fg,{error:d,success:u}),a.jsx(dg,{metadata:i,loading:l,onChange:f})]}),a.jsxs(bg,{children:[a.jsx(wc,{onClick:y,disabled:c,startIcon:a.jsx(pn,{}),children:"Cancel"}),a.jsx(yg,{onClick:m,disabled:c||l,variant:"primary",startIcon:c?a.jsx(ho,{size:16}):a.jsx(iu,{}),children:c?"Saving...":"Save"})]})]})},wg=e=>{const[t,r]=g.useState(new Set),[n,o]=g.useState(null),i=g.useCallback(h=>t.has(h),[t]),l=g.useCallback((h,m)=>{r(y=>{const b=new Set(y);if(m!=null&&m.shiftKey&&n!==null){const x=e.map(k=>k.id),S=x.indexOf(n),v=x.indexOf(h);if(S!==-1&&v!==-1){const[k,C]=[Math.min(S,v),Math.max(S,v)];for(let I=k;I<=C;I++)b.add(x[I])}}else m!=null&&m.ctrlKey||m!=null&&m.metaKey?b.has(h)?b.delete(h):b.add(h):b.has(h)&&b.size===1?b.clear():(b.clear(),b.add(h));return o(h),b})},[e,n]),c=g.useCallback((h,m)=>{r(y=>{const b=new Set(y),x=e.map(k=>k.id),S=x.indexOf(h),v=x.indexOf(m);if(S!==-1&&v!==-1){const[k,C]=[Math.min(S,v),Math.max(S,v)];for(let I=k;I<=C;I++)b.add(x[I])}return b})},[e]),d=g.useCallback(()=>{r(new Set(e.map(h=>h.id)))},[e]),u=g.useCallback(()=>{r(new Set),o(null)},[]),f=g.useMemo(()=>t.size,[t]),p=g.useMemo(()=>t.size>0,[t]);return{selectedTracks:t,isSelected:i,toggleTrack:l,selectRange:c,selectAll:d,clearSelection:u,selectedCount:f,hasSelection:p}},ti=[{id:1,title:"Bohemian Rhapsody",artist:"Queen",album:"A Night at the Opera",duration:355,quality:.95,isEnhanced:!0,genre:"Rock",year:1975,albumArt:"https://via.placeholder.com/300x300/1976d2/white?text=Queen"},{id:2,title:"Hotel California",artist:"Eagles",album:"Hotel California",duration:391,quality:.88,isEnhanced:!1,genre:"Rock",year:1976,albumArt:"https://via.placeholder.com/300x300/d32f2f/white?text=Eagles"},{id:3,title:"Billie Jean",artist:"Michael Jackson",album:"Thriller",duration:294,quality:.92,isEnhanced:!0,genre:"Pop",year:1982,albumArt:"https://via.placeholder.com/300x300/388e3c/white?text=MJ"},{id:4,title:"Sweet Child O' Mine",artist:"Guns N' Roses",album:"Appetite for Destruction",duration:356,quality:.89,isEnhanced:!1,genre:"Rock",year:1987,albumArt:"https://via.placeholder.com/300x300/f57c00/white?text=GNR"}],Cg=({view:e,autoLoad:t=!0,includeStats:r=!0})=>{const[n,o]=g.useState([]),[i,l]=g.useState(!0),[c,d]=g.useState(null),[u,f]=g.useState(!0),[p,h]=g.useState(0),[m,y]=g.useState(0),[b,x]=g.useState(!1),[S,v]=g.useState(!1),[k,C]=g.useState(null),[I,E]=g.useState(r),$=g.useRef(!1),{success:F,error:O,info:A}=Fe(),R=g.useCallback(()=>!!window.electronAPI,[]),U=g.useCallback(()=>{o(ti),f(!1),h(ti.length)},[]),L=g.useCallback(async(T=!0)=>{var N,Q;if($.current){console.log("[useLibraryWithStats] Fetch already in progress, skipping");return}$.current=!0,l(!0),d(null),T&&(y(0),o([]));try{const re=T?0:m,W=e==="favourites"?`/api/library/tracks/favorites?limit=50&offset=${re}`:`/api/library/tracks?limit=50&offset=${re}`,V=await fetch(W);if(V.ok){const pe=await V.json(),je=(pe.tracks||[]).map(ve=>({...ve,artist:Array.isArray(ve.artists)&&ve.artists.length>0?ve.artists[0]:ve.artist||"Unknown Artist",albumArt:ve.album_art||ve.albumArt}));f(pe.has_more||!1),h(pe.total||0),o(T?je:ve=>[...ve,...je]),console.log("Loaded",((N=pe.tracks)==null?void 0:N.length)||0,e==="favourites"?"favorite tracks":"tracks from library"),console.log(`Pagination: ${re+(((Q=pe.tracks)==null?void 0:Q.length)||0)}/${pe.total||0}, has_more: ${pe.has_more}`),T&&pe.tracks&&pe.tracks.length>0?F(`Loaded ${pe.tracks.length} of ${pe.total} ${e==="favourites"?"favorites":"tracks"}`):T&&e==="favourites"&&A("No favorites yet. Click the heart icon on tracks to add them!")}else console.error("Failed to fetch tracks"),d("Failed to load library"),O("Failed to load library"),e!=="favourites"&&T&&U()}catch(ee){console.error("Error fetching tracks:",ee);const re="Failed to connect to server";d(re),O(re),e!=="favourites"&&U()}finally{l(!1),$.current=!1}},[e,F,O,A,U]),ae=g.useCallback(async()=>{if($.current){console.log("[useLibraryWithStats] loadMore already in progress, skipping");return}$.current=!0,x(!0);try{let N=0;y(re=>(N=re+50,N)),await new Promise(re=>setTimeout(re,0));const Q=e==="favourites"?`/api/library/tracks/favorites?limit=50&offset=${N}`:`/api/library/tracks?limit=50&offset=${N}`,ee=await fetch(Q);if(ee.ok){const re=await ee.json(),W=(re.tracks||[]).map(V=>({...V,artist:Array.isArray(V.artists)&&V.artists.length>0?V.artists[0]:V.artist||"Unknown Artist",albumArt:V.album_art||V.albumArt}));o(V=>[...V,...W]),f(re.has_more||!1),h(re.total||0),console.log(`Loaded more: ${N+W.length}/${re.total||0}`)}}catch(T){console.error("Error loading more tracks:",T)}finally{x(!1),$.current=!1}},[e]),K=g.useCallback(async()=>{let T;if(R())try{const N=await window.electronAPI.selectFolder();if(N&&N.length>0)T=N[0];else return}catch(N){console.error("Failed to open folder picker:",N),alert(" Failed to open folder picker");return}else if(T=prompt(`Enter folder path to scan:
(e.g., /home/user/Music)`)||void 0,!T)return;v(!0);try{const N=await fetch("/api/library/scan",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({directory:T})});if(N.ok){const Q=await N.json();alert(` Scan complete!
Added: ${Q.files_added||0} tracks`),await L(),r&&await Z()}else{const Q=await N.json();alert(` Scan failed: ${Q.detail||"Unknown error"}`)}}catch(N){console.error("Scan error:",N),alert(` Error scanning folder: ${N}`)}finally{v(!1)}},[R,L,r]),Z=g.useCallback(async()=>{if(r){E(!0);try{const T=await fetch("/api/library/stats");if(!T.ok)throw new Error(`HTTP error! status: ${T.status}`);const N=await T.json();C(N)}catch(T){console.error("Error fetching library stats:",T)}finally{E(!1)}}},[r]);return g.useEffect(()=>{console.log(`[useLibraryWithStats] useEffect triggered for view="${e}", autoLoad=${t}, includeStats=${r}`),t&&(console.log(`[useLibraryWithStats] Calling fetchTracks() for view="${e}"`),L(),r&&(console.log("[useLibraryWithStats] Calling refetchStats()"),Z()))},[e,t,r]),{tracks:n,stats:k,loading:i,error:c,hasMore:u,totalTracks:p,offset:m,isLoadingMore:b,scanning:S,statsLoading:I,fetchTracks:L,loadMore:ae,handleScanFolder:K,refetchStats:Z,isElectron:R}},kg=()=>a.jsx(P,{sx:{p:3},children:a.jsx(he,{container:!0,spacing:3,children:[...Array(12)].map((e,t)=>a.jsx(he,{item:!0,xs:12,sm:6,md:4,lg:3,children:a.jsxs(P,{children:[a.jsx(Xe,{variant:"rectangular",width:"100%",height:200,sx:{borderRadius:"8px",marginBottom:"12px"}}),a.jsx(Xe,{variant:"text",width:"80%"}),a.jsx(Xe,{variant:"text",width:"60%"}),a.jsx(Xe,{variant:"text",width:"40%"})]})},t))})});function jg(e){return{id:e.id,title:e.title,artist:e.artist,year:e.year??void 0,artworkUrl:e.artwork_path??void 0,trackCount:e.track_count,totalDuration:e.total_duration}}function Pg(e){return e.map(jg)}function Ig(e){return{albums:Pg(e.albums),total:e.total,offset:e.offset,limit:e.limit,hasMore:e.has_more}}const Eg="http://localhost:8765";async function Ag({pageParam:e=0,limit:t=50,search:r}){const n=new URLSearchParams({offset:e.toString(),limit:t.toString()});r&&n.append("search",r);const o=await fetch(`${Eg}/api/albums?${n}`);if(!o.ok)throw new Error(`Failed to fetch albums: ${o.statusText}`);return o.json()}function Dg(e={}){const{limit:t=50,search:r,enabled:n=!0}=e;return xp({queryKey:["albums",{search:r,limit:t}],queryFn:async({pageParam:o})=>{const i=await Ag({pageParam:o,limit:t,search:r});return Ig(i)},initialPageParam:0,getNextPageParam:o=>o.hasMore?o.offset+o.limit:void 0,enabled:n})}const Rg=j(P)(({size:e,useTokens:t})=>({width:e,height:e,borderRadius:t?s.borderRadius.md:"6px",overflow:"hidden",flexShrink:0,background:t?s.colors.bg.elevated:`linear-gradient(135deg, ${D.veryLight} 0%, ${D.veryLight} 100%)`,display:"flex",alignItems:"center",justifyContent:"center",boxShadow:t?s.shadows.md:"0 2px 8px rgba(0, 0, 0, 0.3)",transition:t?s.transitions.transform:"transform 0.2s ease","& img":{width:"100%",height:"100%",objectFit:"cover"},"&:hover":t?{transform:"scale(1.05)"}:{transform:"scale(1.02)"}})),Tg=j(lu)(({theme:e})=>({color:s.colors.text.tertiary,fontSize:"24px"})),Mg=q.memo(({artworkPath:e,title:t="Album",album:r="Album",size:n=64,useTokens:o=!0,sx:i,iconSize:l="24px"})=>a.jsx(Rg,{size:n,useTokens:o,sx:i,children:e?a.jsx("img",{src:e,alt:`${r||t} artwork`,loading:"lazy"}):a.jsx(Tg,{sx:{fontSize:l}})}));Mg.displayName="AlbumArtDisplay";const $g=ie`
  0% {
    transform: rotate(0deg);
  }
  100% {
    transform: rotate(360deg);
  }
`,Fg=ie`
  0% {
    transform: rotate(0deg);
  }
  100% {
    transform: rotate(360deg);
  }
`,Ys=ie`
  0%, 100% {
    opacity: 1;
  }
  50% {
    opacity: 0.5;
  }
`,_g=ie`
  0% {
    background-position: -1000px 0;
  }
  100% {
    background-position: 1000px 0;
  }
`,Cc=ie`
  from {
    opacity: 0;
    transform: scale(0.95);
  }
  to {
    opacity: 1;
    transform: scale(1);
  }
`;ie`
  0%, 100% {
    transform: translateY(0px);
  }
  50% {
    transform: translateY(-10px);
  }
`;ie`
  from {
    transform: translateY(10px);
    opacity: 0;
  }
  to {
    transform: translateY(0);
    opacity: 1;
  }
`;const Yt=j(P)({background:`linear-gradient(
    90deg,
    ${s.colors.bg.level2} 0%,
    ${s.colors.bg.level3} 50%,
    ${s.colors.bg.level2} 100%
  )`,backgroundSize:"1000px 100%",animation:`${_g} 2s infinite linear`,borderRadius:Sc});j(P)({animation:`${Ys} 2s ease-in-out infinite`});const Og=j(P)({position:"absolute",top:0,left:0,width:"100%",height:"100%"});j(P)({position:"relative",overflow:"hidden",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0});j(P)({display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:"16px"});j(P)({display:"inline-flex",position:"relative",animation:`${Ys} 2s ease-in-out infinite`});j("svg")({position:"absolute",top:0,left:0,pointerEvents:"none"});j(P)({position:"relative",display:"inline-flex",animation:`${Fg} 1.4s linear infinite`});j(P)({display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:`${s.spacing.md}px`,padding:`${s.spacing.xxxl}px`,minHeight:"200px"});j(P)(({theme:e})=>({fontSize:"14px",color:s.colors.text.secondary,fontWeight:500,animation:`${Ys} 2s ease-in-out infinite`}));const Bg=()=>a.jsxs(P,{children:[a.jsx(Yt,{sx:{width:"100%",paddingTop:"100%",borderRadius:"8px"}}),a.jsx(Yt,{sx:{width:"80%",height:"20px",mt:2,borderRadius:"4px"}}),a.jsx(Yt,{sx:{width:"60%",height:"16px",mt:1,borderRadius:"4px"}})]}),Lg=()=>a.jsxs(P,{sx:{display:"flex",alignItems:"center",gap:2,p:1.5,borderRadius:"6px"},children:[a.jsx(Yt,{sx:{width:"32px",height:"16px",borderRadius:"4px"}}),a.jsx(Yt,{sx:{width:"60%",height:"16px",borderRadius:"4px"}}),a.jsx(P,{sx:{flex:1}}),a.jsx(Yt,{sx:{width:"50px",height:"16px",borderRadius:"4px"}})]}),zg=({count:e=12})=>a.jsx(he,{container:!0,spacing:3,children:Array.from({length:e}).map((t,r)=>a.jsx(he,{item:!0,xs:12,sm:6,md:4,lg:3,children:a.jsx(Bg,{})},r))}),Ng=({width:e="100%",height:t="20px",borderRadius:r="4px",variant:n="rectangular"})=>{const o=()=>n==="circular"?"50%":n==="text"?"4px":r;return a.jsx(Yt,{sx:{width:e,height:t,borderRadius:o()}})},Wg=({src:e,retryOnError:t=!0,maxRetries:r=2,onLoad:n,onError:o})=>{const[i,l]=g.useState(!1),[c,d]=g.useState(!1),[u,f]=g.useState(null),[p,h]=g.useState(0);return g.useEffect(()=>{if(l(!1),d(!1),f(null),h(0),!e){d(!0);return}const m=new Image;return m.onload=()=>{f(e),l(!0),n==null||n()},m.onerror=()=>{if(t&&p<r){const y=Math.min(1e3*Math.pow(2,p),3e3);setTimeout(()=>{h(b=>b+1)},y)}else d(!0),o==null||o()},m.src=p>0?`${e}?retry=${p}`:e,()=>{m.onload=null,m.onerror=null}},[e,n,o,p,t,r]),{imageLoaded:i,imageError:c,imageSrc:u}},Ug=j(P)({position:"relative",overflow:"hidden",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0}),Hg=j("img")(({isloaded:e})=>({width:"100%",height:"100%",opacity:e==="true"?1:0,animation:e==="true"?`${Cc} 0.3s cubic-bezier(0.4, 0, 0.2, 1)`:"none",transition:"opacity 0.3s cubic-bezier(0.4, 0, 0.2, 1), transform 0.3s cubic-bezier(0.4, 0, 0.2, 1)"})),Gg=j(P)({width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center",background:`linear-gradient(135deg, ${D.lighter} 0%, ${D.light} 100%)`,color:D.standard,animation:`${Cc} 0.3s cubic-bezier(0.4, 0, 0.2, 1)`}),qg=({src:e,alt:t,width:r="100%",height:n="100%",borderRadius:o="8px",objectFit:i="cover",showFallback:l=!0,lazyLoad:c=!0,fallbackGradient:d,iconSize:u="3rem",retryOnError:f=!0,maxRetries:p=2,onLoad:h,onError:m})=>{const{imageLoaded:y,imageError:b,imageSrc:x}=Wg({src:e,retryOnError:f,maxRetries:p,onLoad:h,onError:m});return a.jsxs(Ug,{sx:{width:r,height:n,borderRadius:o},children:[!y&&!b&&a.jsx(Og,{children:a.jsx(Ng,{width:"100%",height:"100%",borderRadius:o,variant:"rectangular"})}),x&&!b&&a.jsx(Hg,{src:x,alt:t,isloaded:y?"true":"false",loading:c?"lazy":"eager",style:{objectFit:i,borderRadius:o}}),b&&l&&a.jsx(Gg,{sx:{borderRadius:o,background:d||`linear-gradient(135deg, ${D.lighter} 0%, ${D.light} 100%)`},children:a.jsx(cn,{sx:{fontSize:u,opacity:.5}})})]})},Qg=j(P,{shouldForwardProp:e=>e!=="clickable"&&e!=="size"})(({size:e,clickable:t})=>({width:e,height:e,minWidth:e,minHeight:e,position:"relative",overflow:"hidden",cursor:t?"pointer":"default",transition:"all 0.3s cubic-bezier(0.4, 0, 0.2, 1)",flexShrink:0,"&:hover":t?{transform:"scale(1.05)",boxShadow:`0 8px 32px ${D.veryStrong}`}:{}})),Vg=e=>{const t=(n,o)=>{const i=parseInt(n.slice(1,3),16),l=parseInt(n.slice(3,5),16),c=parseInt(n.slice(5,7),16);return`rgba(${i}, ${l}, ${c}, ${o})`};if(!e)return`linear-gradient(135deg, ${D.lighter} 0%, ${t(s.colors.accent.secondary,.15)} 100%)`;const r=[`linear-gradient(135deg, ${D.lighter} 0%, ${t(s.colors.accent.secondary,.15)} 100%)`,`linear-gradient(135deg, ${t(s.colors.accent.secondary,.15)} 0%, ${t(s.colors.accent.tertiary,.15)} 100%)`,`linear-gradient(135deg, ${t(s.colors.semantic.success,.15)} 0%, ${D.lighter} 100%)`,`linear-gradient(135deg, ${t(s.colors.accent.tertiary,.15)} 0%, ${t("#FFB800",.15)} 100%)`,`linear-gradient(135deg, ${t(s.colors.accent.primary,.15)} 0%, ${t(s.colors.semantic.success,.15)} 100%)`,`linear-gradient(135deg, ${t("#FFB800",.15)} 0%, ${t(s.colors.accent.tertiary,.15)} 100%)`,`linear-gradient(135deg, ${t(s.colors.accent.secondary,.15)} 0%, ${t(s.colors.accent.primary,.15)} 100%)`,`linear-gradient(135deg, ${D.lighter} 0%, ${t(s.colors.semantic.success,.15)} 100%)`];return r[e%r.length]},Kg=e=>{const t=typeof e=="number"?e:parseInt(String(e));return isNaN(t)?"3rem":t<=64?"1.5rem":t<=128?"2.5rem":t<=200?"3.5rem":"5rem"},Xs=({albumId:e,size:t=160,borderRadius:r=8,onClick:n,showSkeleton:o=!0,style:i})=>{const l=e?`/api/albums/${e}/artwork`:"";return a.jsx(Qg,{size:t,clickable:!!n,onClick:n,sx:{borderRadius:r},style:i,children:a.jsx(qg,{src:l,alt:`Album ${e} artwork`,width:"100%",height:"100%",borderRadius:r,objectFit:"cover",showFallback:!0,lazyLoad:!0,fallbackGradient:Vg(e),iconSize:Kg(t),retryOnError:!1,maxRetries:0})})},Yg=({isHovered:e,onClick:t})=>a.jsx(P,{sx:{position:"absolute",inset:0,display:"flex",alignItems:"center",justifyContent:"center",background:e?"rgba(0, 0, 0, 0.19)":"transparent",backdropFilter:e?"blur(4px)":"none",transition:"all 0.3s ease",opacity:e?1:0,pointerEvents:e?"auto":"none"},children:a.jsx(se,{sx:{width:56,height:56,background:le.aurora,color:s.colors.text.primary,transform:e?"scale(1)":"scale(0.8)",transition:"all 0.3s ease","&:hover":{background:le.electricPurple,transform:"scale(1.1)"}},onClick:t,children:a.jsx(at,{sx:{fontSize:32}})})}),Xg=({show:e})=>e?a.jsx(P,{sx:{position:"absolute",inset:0,display:"flex",alignItems:"center",justifyContent:"center",background:"rgba(0, 0, 0, 0.42)",backdropFilter:"blur(4px)"},children:a.jsx(ho,{size:40,sx:{color:D.veryStrong}})}):null,Jg=({show:e,onDownload:t,onExtract:r,isDownloading:n=!1,isExtracting:o=!1})=>e?a.jsxs(P,{sx:{position:"absolute",bottom:0,left:0,right:0,p:1,background:"linear-gradient(to top, rgba(0,0,0,0.42), transparent)",display:"flex",gap:.5,justifyContent:"center"},children:[a.jsx(ke,{title:"Download from online sources",children:a.jsx(se,{size:"small",onClick:t,disabled:n,sx:{color:s.colors.text.primary,background:le.aurora,"&:hover":{background:le.electricPurple}},children:a.jsx(Ji,{fontSize:"small"})})}),a.jsx(ke,{title:"Extract from audio files",children:a.jsx(se,{size:"small",onClick:r,disabled:o,sx:{color:s.colors.text.primary,background:D.light,"&:hover":{background:D.standard}},children:a.jsx(Zi,{fontSize:"small"})})})]}):null,Zg=({open:e,anchorEl:t,onClose:r,hasArtwork:n,onDownload:o,onExtract:i,onDelete:l,isDownloading:c=!1,isExtracting:d=!1})=>a.jsxs(Ds,{anchorEl:t,open:e,onClose:r,onClick:u=>u.stopPropagation(),children:[a.jsxs(ce,{onClick:o,disabled:c,children:[a.jsx(Ji,{sx:{mr:1},fontSize:"small"}),"Download Artwork"]}),a.jsxs(ce,{onClick:i,disabled:d,children:[a.jsx(Zi,{sx:{mr:1},fontSize:"small"}),"Extract from Files"]}),n&&a.jsxs(ce,{onClick:l,children:[a.jsx(dn,{sx:{mr:1},fontSize:"small"}),"Delete Artwork"]})]}),em=({children:e})=>a.jsx(P,{sx:{position:"relative",width:"100%",paddingBottom:"100%",overflow:"hidden",backgroundColor:s.colors.bg.primary,flexShrink:0,"&:hover .shimmer-overlay":{animation:"shimmer 3s ease-in-out infinite"},"@keyframes shimmer":{"0%":{transform:"translateX(-100%)"},"100%":{transform:"translateX(100%)"}}},children:a.jsx(P,{sx:{position:"absolute",top:0,left:0,width:"100%",height:"100%"},children:e})}),tm=({onClick:e})=>a.jsx(se,{onClick:e,sx:{position:"absolute",top:8,right:8,color:s.colors.text.primary,background:"rgba(0, 0, 0, 0.19)",backdropFilter:"blur(10px)","&:hover":{background:"rgba(0, 0, 0, 0.42)"}},children:a.jsx(un,{})}),rm=()=>a.jsx(P,{className:"shimmer-overlay",sx:{position:"absolute",top:0,left:"-100%",width:"100%",height:"100%",background:"linear-gradient(90deg, transparent 0%, rgba(255, 255, 255, 0.08) 50%, transparent 100%)",pointerEvents:"none"}}),nm=({albumId:e,hasArtwork:t,isHovered:r,isDownloading:n,isExtracting:o,onPlay:i,onMenuOpen:l,onMenuClose:c,onDownload:d,onExtract:u,onDelete:f})=>{const[p,h]=g.useState(null),m=v=>{v.stopPropagation(),h(v.currentTarget),l(v)},y=()=>{h(null),c()},b=v=>{v.stopPropagation(),d(v)},x=v=>{v.stopPropagation(),u(v)},S=()=>{y(),f()};return a.jsxs(a.Fragment,{children:[a.jsxs(em,{children:[a.jsx(Xs,{albumId:e,size:"100%",borderRadius:0}),!t&&a.jsx(rm,{}),a.jsx(Yg,{isHovered:r,onClick:i}),a.jsx(Xg,{show:n||o}),a.jsx(Jg,{show:!t&&!n&&!o,onDownload:b,onExtract:x,isDownloading:n,isExtracting:o}),a.jsx(tm,{onClick:m})]}),a.jsx(Zg,{open:!!p,anchorEl:p,onClose:y,hasArtwork:t,onDownload:()=>{y(),d({})},onExtract:()=>{y(),u({})},onDelete:S,isDownloading:n,isExtracting:o})]})},om=e=>{const t=Math.floor(e/3600),r=Math.floor(e%3600/60);return t>0?`${t}h ${r}m`:`${r}m`},sm=({title:e,artist:t,trackCount:r=0,duration:n,year:o})=>a.jsxs(el,{sx:{p:2,flexGrow:1,display:"flex",flexDirection:"column"},children:[a.jsx(ke,{title:e,placement:"top",children:a.jsx(_,{variant:"subtitle1",sx:{fontWeight:600,color:s.colors.text.primary,mb:1,lineHeight:1.4,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e})}),a.jsx(ke,{title:t,placement:"top",children:a.jsx(_,{variant:"body2",sx:{color:s.colors.text.secondary,fontWeight:400,lineHeight:1.5,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",mb:.75},children:t})}),a.jsxs(_,{variant:"caption",sx:{color:s.colors.text.tertiary,fontWeight:400,lineHeight:1.5,display:"block"},children:[r>0&&`${r} ${r===1?"track":"tracks"}`,n&&r>0&&"  ",n&&om(n),o&&"  ",o]})]});class Lo extends Error{constructor(t,r,n){super(t),this.statusCode=r,this.detail=n,this.name="APIRequestError"}}async function vo(e,t={}){const r=yc(e),{body:n,headers:o={},...i}=t,l={"Content-Type":"application/json",...o},c=n?JSON.stringify(n):void 0;try{const d=await fetch(r,{...i,headers:l,body:c});if(d.ok)return d.status===204?void 0:d.json();let u=`Request failed with status ${d.status}`,f;try{const p=await d.json();f=p.detail||p.message,f&&(u=f)}catch{u=`${d.status} ${d.statusText}`}throw new Lo(u,d.status,f)}catch(d){if(d instanceof Lo)throw d;const u=d instanceof Error?d.message:"Unknown error";throw new Lo(`Network error: ${u}`,0,u)}}async function Nn(e,t){return vo(e,{...t,method:"GET"})}async function vs(e,t,r){return vo(e,{...r,method:"POST",body:t})}async function ri(e,t,r){return vo(e,{...r,method:"PUT",body:t})}async function ni(e,t){return vo(e,{...t,method:"DELETE"})}function wo(e){return{async list(t){if(!e.list)throw new Error("list endpoint not configured");const r=typeof e.list=="function"?e.list(t):e.list;return Nn(r)},async getOne(t){if(!e.get)throw new Error("get endpoint not configured");const r=typeof e.get=="function"?e.get(t):e.get;return Nn(r)},async create(t){if(!e.create)throw new Error("create endpoint not configured");const r=typeof e.create=="function"?e.create(t):e.create;return vs(r,t)},async update(t,r){if(!e.update)throw new Error("update endpoint not configured");const n=typeof e.update=="function"?e.update(t,r):e.update;return ri(n,r)},async delete(t){if(!e.delete)throw new Error("delete endpoint not configured");const r=typeof e.delete=="function"?e.delete(t):e.delete;return ni(r)},async custom(t,r,n){if(!e.custom||!e.custom[t])throw new Error(`custom endpoint "${t}" not configured`);const o=typeof e.custom[t]=="function"?e.custom[t](n):e.custom[t];switch(r){case"get":return Nn(o);case"post":return vs(o,n||{});case"put":return ri(o,n||{});case"delete":return ni(o);default:throw new Error(`Unknown HTTP method: ${r}`)}},async batchCreate(t){return Promise.all(t.map(r=>this.create(r)))},async batchDelete(t){return Promise.all(t.map(r=>this.delete(r))).then(()=>{})}}}const Js=wo({custom:{extract:e=>`/albums/${e}/artwork/extract`,download:e=>`/albums/${e}/artwork/download`,delete:e=>`/albums/${e}/artwork`}});async function am(e){return Js.custom("extract","post",{albumId:e})}async function im(e){return Js.custom("download","post",{albumId:e})}async function lm(e){return Js.custom("delete","delete",{albumId:e})}const cm=(e,t)=>{const[r,n]=g.useState(!1),[o,i]=g.useState(!1),{success:l,error:c}=Fe();return{downloading:r,extracting:o,handleDownloadArtwork:async()=>{n(!0);try{const p=await im(e);l(`Downloaded artwork for "${p.album}" by ${p.artist}`),t==null||t()}catch(p){c(p instanceof Error?p.message:"Failed to download artwork")}finally{n(!1)}},handleExtractArtwork:async()=>{i(!0);try{const p=await am(e);l("Extracted artwork from audio files"),t==null||t()}catch(p){c(p instanceof Error?p.message:"Failed to extract artwork")}finally{i(!1)}},handleDeleteArtwork:async()=>{try{await lm(e),l("Artwork deleted"),t==null||t()}catch(p){c(p instanceof Error?p.message:"Failed to delete artwork")}}}},dm=({albumId:e,title:t,artist:r,hasArtwork:n=!1,trackCount:o=0,duration:i,year:l,onClick:c,onArtworkUpdated:d})=>{const[u,f]=g.useState(!1),[p,h]=g.useState(!1),{downloading:m,extracting:y,handleDownloadArtwork:b,handleExtractArtwork:x,handleDeleteArtwork:S}=cm(e,d);return a.jsxs(kl,{sx:{position:"relative",borderRadius:3,overflow:"hidden",cursor:"pointer",transition:"all 0.3s ease",background:s.colors.bg.level3,boxShadow:"0 2px 8px rgba(0, 0, 0, 0.15)",display:"flex",flexDirection:"column",height:"100%","&:hover":{transform:"translateY(-4px)",boxShadow:"0 8px 24px rgba(0, 0, 0, 0.25)",background:s.colors.bg.level4}},onMouseEnter:()=>f(!0),onMouseLeave:()=>f(!1),onClick:c,children:[a.jsx(nm,{albumId:e,hasArtwork:n,isHovered:u,isDownloading:m,isExtracting:y,onPlay:c||(()=>{}),onMenuOpen:()=>h(!0),onMenuClose:()=>h(!1),onDownload:async v=>{v.stopPropagation(),await b()},onExtract:async v=>{v.stopPropagation(),await x()},onDelete:S}),a.jsx(sm,{title:t,artist:r,trackCount:o,duration:i,year:l})]})},um=({onAlbumClick:e})=>{const t=g.useRef(null),{data:r,isLoading:n,error:o,fetchNextPage:i,hasNextPage:l,isFetchingNextPage:c}=Dg({limit:50}),d=(r==null?void 0:r.pages.flatMap(u=>u.albums))??[];return g.useEffect(()=>{if(!t.current||!l||c)return;const u=new IntersectionObserver(f=>{f[0].isIntersecting&&i()},{threshold:.1});return u.observe(t.current),()=>u.disconnect()},[l,c,i]),n&&d.length===0?a.jsx(kg,{}):o?a.jsx(gt,{title:"Error Loading Albums",description:o.message||"Failed to load albums"}):d.length===0?a.jsx(gt,{title:"No Albums Yet",description:"Your album library will appear here once you scan your music folder"}):a.jsxs("div",{style:{height:"100%",overflow:"auto",padding:"16px"},children:[a.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(200px, 1fr))",gap:"16px",width:"100%"},children:d.map(u=>a.jsx(dm,{albumId:u.id,title:u.title,artist:u.artist,hasArtwork:!!u.artworkUrl,trackCount:u.trackCount,duration:u.totalDuration,year:u.year,onClick:()=>e==null?void 0:e(u.id)},u.id))}),l&&a.jsx("div",{ref:t,style:{padding:"16px",textAlign:"center",minHeight:"40px"},children:c?"Loading more albums...":""})]})},pm=j(P)({padding:"24px",width:"100%"}),hm=j(br)({padding:0,marginBottom:"8px"}),fm=j(lo)({borderRadius:"12px",padding:"16px 20px",transition:"all 0.3s ease",border:"1px solid transparent","&:hover":{backgroundColor:`${s.colors.accent.primary}14`,border:`1px solid ${s.colors.accent.primary}4d`,transform:"translateX(4px)","& .artist-name":{color:s.colors.accent.primary}}}),gm=j($s)({width:56,height:56,marginRight:"20px",background:`linear-gradient(135deg, ${s.colors.accent.primary} 0%, ${s.colors.accent.secondary} 100%)`,fontSize:"24px"}),mm=j(_)({fontSize:"18px",fontWeight:600,color:s.colors.text.primary,transition:"color 0.2s ease"}),ym=j(_)({fontSize:"14px",color:s.colors.text.secondary,marginTop:"4px"}),bm=j(P)({marginBottom:"24px",paddingBottom:"16px",borderBottom:`1px solid ${s.colors.border.light}`}),xm=j(_)({fontSize:"14px",fontWeight:700,color:s.colors.accent.primary,textTransform:"uppercase",letterSpacing:"1px",marginTop:"32px",marginBottom:"12px",paddingLeft:"8px"}),Sm=()=>a.jsx(pm,{children:a.jsx(gn,{children:[...Array(15)].map((e,t)=>a.jsx(br,{children:a.jsxs(P,{sx:{display:"flex",alignItems:"center",width:"100%",padding:"16px 20px"},children:[a.jsx(Xe,{variant:"circular",width:56,height:56,sx:{marginRight:"20px"}}),a.jsxs(P,{sx:{flex:1},children:[a.jsx(Xe,{variant:"text",width:"30%",height:24}),a.jsx(Xe,{variant:"text",width:"50%",height:20,sx:{marginTop:"8px"}})]})]})},t))})}),vm=({loading:e,error:t})=>e?null:t?a.jsx(gt,{title:"Error Loading Artists",description:t}):a.jsx(gt,{title:"No Artists Yet",description:"Your artist library will appear here once you scan your music folder",customIcon:a.jsx(Fs,{sx:{fontSize:64,opacity:.3}})}),Co=wo({list:ye.PLAYLISTS,get:e=>ye.PLAYLIST(e),create:ye.PLAYLISTS,update:e=>ye.PLAYLIST(e),delete:e=>ye.PLAYLIST(e)});async function kc(){const e=await Co.list(),t=Array.isArray(e)?e:e.playlists;return{playlists:t,total:t.length}}async function wm(e){const t=await Co.create(e);return t.playlist||t}async function Cm(e,t){await Co.update(e,t)}async function km(e){await Co.delete(e)}async function oi(e,t){return(await vs(ye.ADD_PLAYLIST_TRACK(e),{track_ids:t})).added_count}const jm=({initialTrackIds:e,onPlaylistCreated:t,onClose:r})=>{const[n,o]=g.useState(""),[i,l]=g.useState(""),[c,d]=g.useState(!1),{success:u,error:f}=Fe(),p=g.useCallback(async()=>{if(!n.trim()){f("Please enter a playlist name");return}d(!0);try{const y=await wm({name:n.trim(),description:i.trim(),track_ids:e});u(`Playlist "${n}" created successfully`),t&&t(y),o(""),l(""),r()}catch(y){f(`Failed to create playlist: ${y}`)}finally{d(!1)}},[n,i,e,t,r,u,f]),h=g.useCallback(()=>{c||(o(""),l(""),r())},[c,r]),m=g.useCallback(y=>{y.key==="Enter"&&n.trim()&&!c&&p()},[n,c,p]);return{name:n,setName:o,description:i,setDescription:l,loading:c,handleCreate:p,handleClose:h,handleKeyPress:m}},Pm=j(P)({pt:2,display:"flex",flexDirection:"column",gap:2}),Im=j(P)({p:2,background:D.veryLight,borderRadius:"8px",border:`1px solid ${D.standard}`}),Em=j(P)({color:s.colors.text.secondary,fontSize:"14px"}),Am=({trackIds:e})=>!e||e.length===0?null:a.jsx(Im,{children:a.jsxs(Em,{children:[e.length," track",e.length!==1?"s":""," will be added to this playlist"]})}),Dm=({name:e,onNameChange:t,description:r,onDescriptionChange:n,loading:o,onKeyDown:i,initialTrackIds:l})=>a.jsxs(Pm,{children:[a.jsx(Me,{autoFocus:!0,label:"Playlist Name",fullWidth:!0,value:e,onChange:c=>t(c.target.value),onKeyDown:i,disabled:o,placeholder:"Enter playlist name"}),a.jsx(Me,{label:"Description (Optional)",fullWidth:!0,multiline:!0,rows:3,value:r,onChange:c=>n(c.target.value),disabled:o,placeholder:"Add a description for your playlist"}),a.jsx(Am,{trackIds:l})]}),Rm=({loading:e,nameEmpty:t,onCreate:r,onCancel:n})=>a.jsxs(kr,{sx:{p:2,pt:1},children:[a.jsx(Ks,{onClick:n,disabled:e,children:"Cancel"}),a.jsx(vc,{onClick:r,disabled:t||e,children:e?"Creating...":"Create Playlist"})]}),jc=({open:e,onClose:t,onPlaylistCreated:r,initialTrackIds:n})=>{const{name:o,setName:i,description:l,setDescription:c,loading:d,handleCreate:u,handleClose:f,handleKeyPress:p}=jm({initialTrackIds:n,onPlaylistCreated:r,onClose:t});return a.jsxs(bn,{open:e,onClose:f,maxWidth:"sm",fullWidth:!0,children:[a.jsx(xn,{children:"Create New Playlist"}),a.jsx(tr,{children:a.jsx(Dm,{name:o,onNameChange:i,description:l,onDescriptionChange:c,loading:d,onKeyDown:p,initialTrackIds:n})}),a.jsx(Rm,{loading:d,nameEmpty:!o.trim(),onCreate:u,onCancel:f})]})},Tm=j(ce)({fontSize:"13px",color:s.colors.text.secondary,padding:"8px 16px 8px 48px",transition:"all 0.2s ease","&:hover":{background:D.veryLight,color:s.colors.text.primary,transform:"translateX(2px)"}}),Mm=j(ce)({fontSize:"13px",color:s.colors.accent.primary,padding:"8px 16px 8px 48px",fontWeight:600,transition:"all 0.2s ease","&:hover":{background:D.lighter,transform:"translateX(2px)"}}),$m=j(P)({fontSize:"11px",fontWeight:600,color:s.colors.text.disabled,textTransform:"uppercase",letterSpacing:"0.5px",padding:"8px 16px 4px 16px"}),Fm=({playlists:e,isLoadingPlaylists:t,onAddToPlaylist:r,onCreateNewPlaylist:n})=>a.jsxs(a.Fragment,{children:[a.jsx(fe,{sx:{borderColor:D.minimal,my:1}}),a.jsxs(ce,{disabled:!0,children:[a.jsx(co,{children:a.jsx(Ts,{})}),a.jsx($t,{children:"Add to Playlist"})]}),e.length>0&&a.jsxs(a.Fragment,{children:[a.jsx($m,{children:"Your Playlists"}),e.map(o=>a.jsxs(Tm,{onClick:()=>r(o.id,o.name),children:[o.name," (",o.track_count,")"]},o.id))]}),a.jsxs(Mm,{onClick:n,children:[a.jsx(_s,{sx:{fontSize:"16px",mr:1}}),"Create New Playlist"]})]}),_m=j(Ds)({"& .MuiPaper-root":{background:s.colors.bg.level2,border:`1px solid ${s.colors.border.light}`,boxShadow:s.shadows.lg,borderRadius:s.borderRadius.md,minWidth:"220px",padding:s.spacing.sm,backdropFilter:"blur(12px)"}}),Om=j(ce)(({destructive:e})=>({borderRadius:s.borderRadius.sm,padding:`${s.spacing.md} ${s.spacing.md}`,margin:`${s.spacing.sm} 0`,fontSize:s.typography.fontSize.base,color:e?s.colors.semantic.error:s.colors.text.primary,transition:s.transitions.base_inOut,"&:hover":{background:e?s.colors.bg.level3:s.colors.bg.level4},"&.Mui-disabled":{color:s.colors.text.disabled,opacity:.5},"& .MuiListItemIcon-root":{color:e?s.colors.semantic.error:s.colors.text.secondary,minWidth:36}})),Bm=({actions:e,onActionClick:t})=>a.jsx(a.Fragment,{children:e.map((r,n)=>a.jsxs(q.Fragment,{children:[r.divider&&n>0&&a.jsx(fe,{sx:{borderColor:D.minimal,my:1}}),a.jsxs(Om,{onClick:()=>t(r),disabled:r.disabled,destructive:r.destructive,children:[r.icon&&a.jsx(co,{children:r.icon}),a.jsx($t,{children:r.label})]})]},r.id))}),Lm=({onAddToPlaylist:e,onCreatePlaylist:t,onClose:r,onCreateDialogOpen:n})=>{const{success:o,error:i}=Fe(),l=g.useCallback(async(u,f)=>{if(e)try{await e(u,f),o(`Added to "${f}"`),r()}catch(p){i(`Failed to add to playlist: ${p}`)}},[e,o,i,r]),c=g.useCallback(()=>{r(),n()},[r,n]),d=g.useCallback(async u=>{if(t)try{await t(u),o(`Added to "${u.name}"`)}catch(f){i(`Failed to add to playlist: ${f}`)}},[t,o,i]);return{handleAddToPlaylist:l,handleCreateNewPlaylist:c,handlePlaylistCreated:d}},Zs=({open:e,anchorPosition:t,onClose:r,actions:n,trackId:o,trackTitle:i,playlists:l=[],isLoadingPlaylists:c=!1,onPlaylistsLoad:d,onAddToPlaylist:u,onCreatePlaylist:f})=>{const p=g.useRef(null),[h,m]=g.useState(!1);g.useEffect(()=>{e&&o&&d&&d()},[e,o,d]),g.useEffect(()=>{const k=C=>{p.current&&!p.current.contains(C.target)&&r()};if(e)return document.addEventListener("mousedown",k),()=>document.removeEventListener("mousedown",k)},[e,r]);const{handleAddToPlaylist:y,handleCreateNewPlaylist:b,handlePlaylistCreated:x}=Lm({onAddToPlaylist:u,onCreatePlaylist:f,onClose:r,onCreateDialogOpen:()=>m(!0)}),S=k=>{k.onClick(),r()},v=o&&(l.length>0||u);return a.jsxs(a.Fragment,{children:[a.jsxs(_m,{ref:p,open:e,onClose:r,anchorReference:"anchorPosition",anchorPosition:t,transitionDuration:200,children:[a.jsx(Bm,{actions:n,onActionClick:S}),v&&a.jsx(Fm,{playlists:l,isLoadingPlaylists:c,onAddToPlaylist:y,onCreateNewPlaylist:b})]}),o&&a.jsx(jc,{open:h,onClose:()=>m(!1),onPlaylistCreated:x,initialTrackIds:o?[o]:void 0})]})},Pc=()=>{const[e,t]=g.useState({isOpen:!1,mousePosition:void 0});return{contextMenuState:e,handleContextMenu:o=>{o.preventDefault(),t({isOpen:!0,mousePosition:{top:o.clientY,left:o.clientX}})},handleCloseContextMenu:()=>{t({isOpen:!1,mousePosition:void 0})}}},zm=(e,t,r)=>[{id:"play",label:"Play Now",icon:a.jsx(at,{fontSize:"small"}),onClick:r.onPlay||(()=>{})},{id:"queue",label:"Add to Queue",icon:a.jsx(ao,{fontSize:"small"}),onClick:r.onAddToQueue||(()=>{})},{id:"playlist",label:"Add to Playlist",icon:a.jsx(Ts,{fontSize:"small"}),onClick:r.onAddToPlaylist||(()=>{}),divider:!0},{id:"love",label:t?"Remove from Favourites":"Add to Favourites",icon:t?a.jsx(io,{fontSize:"small"}):a.jsx(rl,{fontSize:"small"}),onClick:r.onToggleLove||(()=>{}),divider:!0},{id:"album",label:"Go to Album",icon:a.jsx(Os,{fontSize:"small"}),onClick:r.onShowAlbum||(()=>{})},{id:"artist",label:"Go to Artist",icon:a.jsx(Fs,{fontSize:"small"}),onClick:r.onShowArtist||(()=>{})},{id:"info",label:"Track Info",icon:a.jsx(tl,{fontSize:"small"}),onClick:r.onShowInfo||(()=>{})},...r.onEditMetadata?[{id:"edit-metadata",label:"Edit Metadata",icon:a.jsx(Rs,{fontSize:"small"}),onClick:r.onEditMetadata,divider:!!r.onDelete}]:[],...r.onDelete?[{id:"delete",label:"Remove from Library",icon:a.jsx(dn,{fontSize:"small"}),onClick:r.onDelete,destructive:!0}]:[]],Nm=(e,t)=>[{id:"play-all",label:"Play All Songs",icon:a.jsx(at,{fontSize:"small"}),onClick:t.onPlayAll||(()=>{})},{id:"queue",label:"Add All to Queue",icon:a.jsx(ao,{fontSize:"small"}),onClick:t.onAddToQueue||(()=>{}),divider:!0},{id:"albums",label:"Show Albums",icon:a.jsx(Os,{fontSize:"small"}),onClick:t.onShowAlbums||(()=>{})},{id:"info",label:"Artist Info",icon:a.jsx(tl,{fontSize:"small"}),onClick:t.onShowInfo||(()=>{})}],Wm=(e,t)=>[{id:"play",label:"Play Playlist",icon:a.jsx(at,{fontSize:"small"}),onClick:t.onPlay||(()=>{}),divider:!0},{id:"edit",label:"Edit Playlist",icon:a.jsx(Rs,{fontSize:"small"}),onClick:t.onEdit||(()=>{})},{id:"delete",label:"Delete Playlist",icon:a.jsx(dn,{fontSize:"small"}),onClick:t.onDelete||(()=>{}),destructive:!0,divider:!0}],Um=({currentCount:e,totalCount:t})=>a.jsxs(P,{sx:{height:"100px",width:"100%",display:"flex",alignItems:"center",justifyContent:"center",p:2},children:[a.jsx(P,{sx:{width:20,height:20,border:"2px solid",borderColor:"primary.main",borderRightColor:"transparent",borderRadius:"50%",animation:"spin 1s linear infinite","@keyframes spin":{"0%":{transform:"rotate(0deg)"},"100%":{transform:"rotate(360deg)"}}}}),a.jsxs(_,{variant:"body2",color:"text.secondary",sx:{ml:2},children:["Loading more artists... (",e,"/",t,")"]})]}),Hm=({loadedCount:e,totalCount:t})=>a.jsx(bm,{children:a.jsxs(_,{variant:"body2",color:"text.secondary",children:[e," ",e!==t?`of ${t}`:""," artists in your library"]})}),Gm=({artist:e,onClick:t,onContextMenu:r})=>{const n=o=>o.charAt(0).toUpperCase();return a.jsx(hm,{children:a.jsxs(fm,{onClick:()=>t(e),onContextMenu:o=>r(o,e),children:[a.jsx(gm,{children:n(e.name)}),a.jsx($t,{primary:a.jsx(mm,{className:"artist-name",children:e.name}),secondary:a.jsxs(ym,{children:[e.albumCount?`${e.albumCount} ${e.albumCount===1?"album":"albums"}`:"",e.albumCount&&e.trackCount?"  ":"",e.trackCount?`${e.trackCount} ${e.trackCount===1?"track":"tracks"}`:""]})})]})})},qm=({letter:e,artists:t,onArtistClick:r,onContextMenu:n})=>a.jsxs(P,{children:[a.jsx(xm,{children:e}),a.jsx(gn,{children:t.map(o=>a.jsx(Gm,{artist:o,onClick:r,onContextMenu:n},o.id))})]}),Qm=j(P)({padding:s.spacing.lg,width:"100%"}),Vm=j(P)({height:"1px",width:"100%"}),Km=j(P)({padding:s.spacing.lg,textAlign:"center"}),Ym=({artists:e,totalArtists:t,isLoadingMore:r,hasMore:n,containerRef:o,loadMoreTriggerRef:i,groupedArtists:l,sortedLetters:c,contextMenuState:d,contextActions:u,onArtistClick:f,onContextMenuOpen:p,onContextMenuClose:h})=>a.jsxs(Qm,{ref:o,children:[a.jsx(Hm,{loadedCount:e.length,totalCount:t}),c.map(m=>a.jsx(qm,{letter:m,artists:l[m],onArtistClick:f,onContextMenu:(y,b)=>p(b,y)},m)),n&&a.jsx(Vm,{ref:i}),r&&a.jsx(Um,{currentCount:e.length,totalCount:t}),!n&&e.length>0&&a.jsx(Km,{children:a.jsxs(_,{variant:"body2",color:"text.secondary",children:["Showing all ",t," artists"]})}),a.jsx(Zs,{anchorPosition:d.mousePosition,open:d.isOpen,onClose:h,actions:u})]}),Xm=({open:e,artist:t,onClose:r})=>t?a.jsxs(bn,{open:e,onClose:r,maxWidth:"sm",fullWidth:!0,children:[a.jsx(xn,{children:"Artist Information"}),a.jsx(tr,{sx:ze.content,children:a.jsxs(P,{sx:ze.artistContainer,children:[a.jsx("h2",{style:ze.artistName,children:t.name}),a.jsxs(P,{sx:ze.statsContainer,children:[a.jsxs(P,{sx:ze.statItem,children:[a.jsx("span",{style:ze.statLabel,children:"Albums"}),a.jsx("span",{style:ze.statValue,children:t.albumCount??0})]}),a.jsx(P,{sx:ze.statDivider}),a.jsxs(P,{sx:ze.statItem,children:[a.jsx("span",{style:ze.statLabel,children:"Tracks"}),a.jsx("span",{style:ze.statValue,children:t.trackCount??0})]})]})]})}),a.jsx(kr,{sx:ze.actions,children:a.jsx(wc,{onClick:r,startIcon:a.jsx(pn,{}),children:"Close"})})]}):null,ze={content:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"200px"},artistContainer:{textAlign:"center",width:"100%"},artistName:{margin:0,marginBottom:s.spacing.lg,fontSize:s.typography.fontSize.xl,fontWeight:s.typography.fontWeight.bold,color:s.colors.text.primary},statsContainer:{display:"flex",justifyContent:"center",alignItems:"center",gap:s.spacing.lg},statItem:{display:"flex",flexDirection:"column",alignItems:"center",gap:s.spacing.xs},statLabel:{fontSize:s.typography.fontSize.sm,color:s.colors.text.secondary,fontWeight:s.typography.fontWeight.semibold,textTransform:"uppercase",letterSpacing:"0.5px"},statValue:{fontSize:s.typography.fontSize.lg,fontWeight:s.typography.fontWeight.bold,color:s.colors.accent.primary},statDivider:{width:"1px",height:"40px",backgroundColor:s.colors.border.light},actions:{justifyContent:"center",padding:s.spacing.md}};function Jm(e="tracks",t={}){const r=Al(),[n,o]=g.useState([]),[i,l]=g.useState(0),[c,d]=g.useState(t.offset||0),[u,f]=g.useState(!t.skip),[p,h]=g.useState(null),m=g.useRef(null),y=g.useRef(""),b=g.useRef(!1),x=t.limit||50,S=t.skip||!1,v=c+n.length<i,k=g.useCallback((O,A)=>{switch(A){case"tracks":return O.tracks||O.items||[];case"albums":return O.albums||O.items||[];case"artists":return O.artists||O.items||[];default:return O.items||[]}},[]),C=g.useCallback((O=0)=>{const A=t.endpoint;if(A)return A;const R=`/api/library/${e}`,U=new URLSearchParams;return U.append("limit",String(x)),U.append("offset",String(O??0)),t.search&&U.append("search",t.search),t.orderBy&&U.append("order_by",t.orderBy),`${R}?${U.toString()}`},[e,x,t.endpoint,t.search,t.orderBy]),I=g.useCallback(async(O=0,A=!1)=>{const R=C(O),U=`${e}:${R}:${O}`;if(!(y.current===U&&u)){y.current=U,m.current&&m.current.abort(),m.current=new AbortController,f(!0),h(null);try{const L=await r.get(R);if(!L)throw new Error("No response from server");const ae=k(L,e);l(L.total||0),d(typeof L.offset=="number"?L.offset:0),o(A?K=>[...K,...ae]:ae)}catch(L){if(L instanceof Error&&L.name==="AbortError")return;const ae=L instanceof Error?{message:L.message,code:"QUERY_ERROR",status:500}:L;h(ae)}finally{f(!1)}}},[r,C,e]),E=g.useCallback(async()=>{if(b.current||!v||u)return;b.current=!0;const O=c+x,A=`/api/library/${e}?limit=${x}&offset=${O}${t.search?`&search=${encodeURIComponent(t.search)}`:""}${t.orderBy?`&order_by=${t.orderBy}`:""}`;try{const R=await r.get(A);if(R){const U=k(R,e);d(O),o(L=>[...L,...U]),l(R.total)}}catch(R){const U=R instanceof Error?{message:R.message,code:"FETCH_MORE_ERROR",status:500}:R;h(U)}finally{b.current=!1}},[r,c,x,v,u,e,t.search,t.orderBy,k]),$=g.useCallback(async()=>{d(0),o([]),await I(0,!1)},[I]),F=g.useCallback(()=>{h(null)},[]);return g.useEffect(()=>{if(!S)return I(0,!1),()=>{m.current&&m.current.abort()}},[e,S,t.search,t.orderBy,I]),{data:n,total:i,isLoading:u,error:p,offset:c,hasMore:v,fetchMore:E,refetch:$,clearError:F}}function Zm(e){return Jm("artists",e)}function Ic({ref:e,threshold:t=.8,rootMargin:r="100px",onLoadMore:n,hasMore:o,isLoading:i}){const[l,c]=g.useState(!1),d=g.useRef(null),u=e||d,f=g.useCallback(async()=>{if(!(l||i||!o)){c(!0);try{await n()}catch(p){console.error("Error loading more items:",p)}finally{c(!1)}}},[l,i,o,n]);return g.useEffect(()=>{const p=u.current;if(!p)return;const h=new IntersectionObserver(m=>{m[0].isIntersecting&&o&&!i&&!l&&f()},{threshold:t,rootMargin:r});return h.observe(p),()=>{p&&h.unobserve(p)}},[t,r,o,i,l,f]),{observerTarget:u,isFetching:l||i}}class ey{constructor(t=60){B(this,"targetFPS");B(this,"frameInterval");B(this,"lastFrameTime",0);B(this,"frameCount",0);B(this,"currentFPS",0);B(this,"fpsHistory",[]);B(this,"droppedFrames",0);this.targetFPS=t,this.frameInterval=1e3/t}shouldRender(t){return t-this.lastFrameTime>=this.frameInterval?(this.lastFrameTime=t,this.frameCount++,!0):(this.droppedFrames++,!1)}updateFPS(t){this.frameCount++;const r=performance.now(),n=r-this.lastFrameTime;n>=1e3&&(this.currentFPS=this.frameCount*1e3/n,this.fpsHistory.push(this.currentFPS),this.fpsHistory.length>60&&this.fpsHistory.shift(),this.frameCount=0,this.lastFrameTime=r)}getFPS(){return this.currentFPS}getAverageFPS(){return this.fpsHistory.length===0?0:this.fpsHistory.reduce((t,r)=>t+r,0)/this.fpsHistory.length}getDroppedFrames(){return this.droppedFrames}adjustTargetFPS(t){this.targetFPS=t,this.frameInterval=1e3/t}}class ty{constructor(t=1e3,r=2e3){B(this,"maxPoints");B(this,"threshold");this.maxPoints=t,this.threshold=r}decimate(t){if(t.length<=this.maxPoints)return t;const r=Math.ceil(t.length/this.maxPoints),n=[];for(let o=0;o<t.length;o+=r){const i=t.slice(o,Math.min(o+r,t.length)),l=Math.min(...i),c=Math.max(...i);n.length%2===0?n.push(c):n.push(l)}return n}adaptiveDecimate(t,r){if(t.length<=r)return t;const n=t.length/r,o=[];for(let i=0;i<r;i++){const l=Math.floor(i*n),c=Math.floor((i+1)*n),d=t.slice(l,c);if(d.length!==0)if(n>10){const u=Math.sqrt(d.reduce((f,p)=>f+p*p,0)/d.length);o.push(u)}else{const u=Math.max(...d.map(Math.abs));o.push(u)}}return o}}class ry{constructor(t=10){B(this,"pool",[]);B(this,"inUse",new Set);B(this,"maxSize");this.maxSize=t}getCanvas(t,r){for(const o of this.pool)if(!this.inUse.has(o)&&o.width===t&&o.height===r)return this.inUse.add(o),o;if(this.pool.length<this.maxSize){const o=document.createElement("canvas");return o.width=t,o.height=r,this.pool.push(o),this.inUse.add(o),o}const n=this.pool[0];return this.inUse.has(n)&&this.inUse.delete(n),n.width=t,n.height=r,this.inUse.add(n),n}releaseCanvas(t){this.inUse.delete(t)}cleanup(){this.pool.forEach(t=>{const r=t.getContext("2d");r&&r.clearRect(0,0,t.width,t.height)}),this.inUse.clear()}}class ny{constructor(){B(this,"measurements",new Map);B(this,"startTimes",new Map)}start(t){this.startTimes.set(t,performance.now())}end(t){const r=this.startTimes.get(t);if(!r)return 0;const n=performance.now()-r;this.measurements.has(t)||this.measurements.set(t,[]);const o=this.measurements.get(t);return o.push(n),o.length>100&&o.shift(),this.startTimes.delete(t),n}getAverage(t){const r=this.measurements.get(t);return!r||r.length===0?0:r.reduce((n,o)=>n+o,0)/r.length}getStats(t){const r=this.measurements.get(t);return!r||r.length===0?{avg:0,min:0,max:0,count:0}:{avg:r.reduce((n,o)=>n+o,0)/r.length,min:Math.min(...r),max:Math.max(...r),count:r.length}}clear(){this.measurements.clear(),this.startTimes.clear()}}class oy{constructor(t={}){B(this,"metrics");B(this,"currentProfile");B(this,"profiles");B(this,"frameController");B(this,"dataDecimator");B(this,"canvasPool");B(this,"performanceMonitor");B(this,"frameHistory",[]);B(this,"performanceCallbacks",[]);B(this,"animationFrameId",null);B(this,"lastFrameTime",0);B(this,"frameStartTime",0);B(this,"isOptimizing",!1);B(this,"observer");B(this,"memoryUsageInterval");const r={targetFPS:60,maxDataPoints:1e3,decimationThreshold:2e3,canvasPoolSize:10,...t};this.metrics={fps:0,frameTime:16.67,renderTime:0,cpuUsage:0,memoryUsage:0,droppedFrames:0,adaptiveQuality:1,dataPoints:0,bufferHealth:1},this.frameController=new ey(r.targetFPS),this.dataDecimator=new ty(r.maxDataPoints,r.decimationThreshold),this.canvasPool=new ry(r.canvasPoolSize),this.performanceMonitor=new ny,this.profiles=this.createAdaptiveProfiles(),this.currentProfile=this.profiles[1],this.initializePerformanceMonitoring()}createAdaptiveProfiles(){return[{name:"ultra",description:"Maximum Quality - Studio Monitoring",quality:{renderScale:1,dataDecimation:1,updateRate:60,smoothingFactor:.1,enableAAA:!0,enableShadows:!0,enableGlow:!0,enableAnimations:!0,maxDataPoints:8192},triggers:{cpuThreshold:90,fpsThreshold:55,memoryThreshold:2048}},{name:"balanced",description:"Balanced Performance - Professional Use",quality:{renderScale:.8,dataDecimation:2,updateRate:30,smoothingFactor:.3,enableAAA:!0,enableShadows:!1,enableGlow:!0,enableAnimations:!0,maxDataPoints:4096},triggers:{cpuThreshold:70,fpsThreshold:25,memoryThreshold:1024}},{name:"performance",description:"Performance Mode - Real-time Critical",quality:{renderScale:.6,dataDecimation:4,updateRate:20,smoothingFactor:.5,enableAAA:!1,enableShadows:!1,enableGlow:!1,enableAnimations:!0,maxDataPoints:2048},triggers:{cpuThreshold:50,fpsThreshold:15,memoryThreshold:512}},{name:"minimal",description:"Minimal Resources - Emergency Mode",quality:{renderScale:.4,dataDecimation:8,updateRate:10,smoothingFactor:.7,enableAAA:!1,enableShadows:!1,enableGlow:!1,enableAnimations:!1,maxDataPoints:1024},triggers:{cpuThreshold:30,fpsThreshold:8,memoryThreshold:256}}]}initializePerformanceMonitoring(){"PerformanceObserver"in window&&(this.observer=new PerformanceObserver(t=>{t.getEntries().forEach(n=>{n.entryType==="measure"&&n.name.startsWith("auralis-render")&&(this.metrics.renderTime=n.duration)})}),this.observer.observe({entryTypes:["measure"]})),this.memoryUsageInterval=window.setInterval(()=>{if("memory"in performance){const t=performance.memory;this.metrics.memoryUsage=t.usedJSHeapSize/(1024*1024)}},1e3),this.startFrameMonitoring()}startFrameMonitoring(){const t=r=>{if(this.lastFrameTime>0){const n=r-this.lastFrameTime;this.frameHistory.push(n),this.frameHistory.length>60&&this.frameHistory.shift();const o=this.frameHistory.reduce((i,l)=>i+l,0)/this.frameHistory.length;this.metrics.fps=1e3/o,this.metrics.frameTime=o,this.updateAdaptiveQuality()}this.lastFrameTime=r,this.animationFrameId=requestAnimationFrame(t)};this.animationFrameId=requestAnimationFrame(t)}updateAdaptiveQuality(){if(this.isOptimizing)return;const{fps:t,cpuUsage:r,memoryUsage:n}=this.metrics,o=this.currentProfile;t<o.triggers.fpsThreshold||r>o.triggers.cpuThreshold||n>o.triggers.memoryThreshold?this.downgradeQuality():t>o.triggers.fpsThreshold+10&&r<o.triggers.cpuThreshold-20&&n<o.triggers.memoryThreshold-200&&this.upgradeQuality(),this.metrics.adaptiveQuality=Math.max(.1,Math.min(1,t/60))}downgradeQuality(){const t=this.profiles.findIndex(r=>r.name===this.currentProfile.name);t<this.profiles.length-1&&(this.isOptimizing=!0,this.currentProfile=this.profiles[t+1],console.log(` Quality downgraded to: ${this.currentProfile.name}`),this.notifyPerformanceChange(),setTimeout(()=>{this.isOptimizing=!1},2e3))}upgradeQuality(){const t=this.profiles.findIndex(r=>r.name===this.currentProfile.name);t>0&&(this.isOptimizing=!0,this.currentProfile=this.profiles[t-1],console.log(` Quality upgraded to: ${this.currentProfile.name}`),this.notifyPerformanceChange(),setTimeout(()=>{this.isOptimizing=!1},5e3))}notifyPerformanceChange(){this.performanceCallbacks.forEach(t=>{t(this.getMetrics())})}optimizeData(t){performance.now();let r=t;if(t.length>this.currentProfile.quality.maxDataPoints){const n=Math.floor(this.currentProfile.quality.maxDataPoints*this.metrics.adaptiveQuality);r=this.dataDecimator.adaptiveDecimate(t,n)}return this.metrics.dataPoints=r.length,this.performanceMonitor.end("data-optimization"),r}optimizeDataArray(t){const{dataDecimation:r,maxDataPoints:n}=this.currentProfile.quality;if(!t||t.length===0)return t;let o=t;if(r>1&&(o=t.filter((i,l)=>l%r===0)),o.length>n){const i=Math.ceil(o.length/n);o=o.filter((l,c)=>c%i===0)}return this.metrics.dataPoints=o.length,o}shouldRender(){const t=performance.now(),r=this.frameController.shouldRender(t);return r&&(this.frameController.updateFPS(t),this.metrics.fps=this.frameController.getFPS(),this.metrics.droppedFrames=this.frameController.getDroppedFrames()),r}startRender(){this.frameStartTime=performance.now(),this.performanceMonitor.start("render-cycle"),"performance"in window&&performance.mark("auralis-render-start")}endRender(){const t=performance.now()-this.frameStartTime;this.metrics.renderTime=t,this.performanceMonitor.end("render-cycle"),"performance"in window&&(performance.mark("auralis-render-end"),performance.measure("auralis-render","auralis-render-start","auralis-render-end"))}getCanvas(t,r){return this.canvasPool.getCanvas(t,r)}releaseCanvas(t){this.canvasPool.releaseCanvas(t)}getOptimizedCanvasSize(t,r){const n=this.currentProfile.quality.renderScale;return{width:Math.round(t*n),height:Math.round(r*n)}}shouldUseEffect(t){const r=this.currentProfile.quality;switch(t){case"shadows":return r.enableShadows;case"glow":return r.enableGlow;case"antialiasing":return r.enableAAA;case"animations":return r.enableAnimations;default:return!0}}getSmoothingFactor(){return this.currentProfile.quality.smoothingFactor}getUpdateRate(){return this.currentProfile.quality.updateRate}getQualityLevel(){return this.metrics.adaptiveQuality}getMetrics(){return{...this.metrics}}getCurrentProfile(){return{...this.currentProfile}}setProfile(t){const r=this.profiles.find(n=>n.name===t);r&&(this.currentProfile=r,this.notifyPerformanceChange())}onPerformanceChange(t){this.performanceCallbacks.push(t)}updateCPUUsage(){if(this.frameHistory.length>10){const t=this.frameHistory.slice(-10).reduce((n,o)=>n+o,0)/10,r=1e3/60;this.metrics.cpuUsage=Math.min(100,t/r*50)}}updateBufferHealth(t,r){this.metrics.bufferHealth=Math.max(0,Math.min(1,t/r))}updateNetworkLatency(t){this.metrics.networkLatency=t}getPerformanceMonitor(){return this.performanceMonitor}exportPerformanceReport(){const t={timestamp:new Date().toISOString(),session:{duration:Date.now()-(this.lastFrameTime||Date.now()),totalFrames:this.frameHistory.length,droppedFrames:this.metrics.droppedFrames},currentMetrics:this.metrics,currentProfile:this.currentProfile.name,frameHistory:this.frameHistory.slice(-100),averagePerformance:{avgFPS:this.frameHistory.length>0?1e3/(this.frameHistory.reduce((r,n)=>r+n,0)/this.frameHistory.length):0,maxFrameTime:Math.max(...this.frameHistory),minFrameTime:Math.min(...this.frameHistory)}};return JSON.stringify(t,null,2)}cleanup(){this.animationFrameId&&cancelAnimationFrame(this.animationFrameId),this.observer&&this.observer.disconnect(),this.memoryUsageInterval&&clearInterval(this.memoryUsageInterval),this.canvasPool.cleanup(),this.performanceMonitor.clear(),this.performanceCallbacks=[]}}new oy;function sy(e){const t=g.useMemo(()=>e.reduce((n,o)=>{const i=o.name.charAt(0).toUpperCase();return n[i]||(n[i]=[]),n[i].push(o),n},{}),[e]),r=g.useMemo(()=>Object.keys(t).sort(),[t]);return{groupedArtists:t,sortedLetters:r}}/**
 * Cache State Slice
 * ~~~~~~~~~~~~~~~~~
 *
 * Redux slice for managing cache state including:
 * - Cache statistics
 * - Cache health status
 * - Last update timestamp
 *
 * Phase C.3: Component Testing & Integration
 *
 * @copyright (C) 2024 Auralis Team
 * @license GPLv3, see LICENSE for more details
 */const zo={stats:null,health:null,isLoading:!1,error:null,lastUpdate:0},Ec=So({name:"cache",initialState:zo,reducers:{setCacheStats(e,t){e.stats=t.payload,e.lastUpdate=Date.now()},setCacheHealth(e,t){e.health=t.payload,e.lastUpdate=Date.now()},updateCache(e,t){t.payload.stats&&(e.stats=t.payload.stats),t.payload.health&&(e.health=t.payload.health),e.lastUpdate=Date.now()},setIsLoading(e,t){e.isLoading=t.payload},setError(e,t){e.error=t.payload},clearError(e){e.error=null},clearCacheLocal(e){e.stats={...zo.stats,tier1:{chunks:0,size_mb:0,hits:0,misses:0,hit_rate:0},tier2:{chunks:0,size_mb:0,hits:0,misses:0,hit_rate:0},overall:{total_chunks:0,total_size_mb:0,total_hits:0,total_misses:0,overall_hit_rate:0,tracks_cached:0},tracks:{}},e.lastUpdate=Date.now()},resetCache(e){Object.assign(e,zo)}}}),{setCacheStats:rj,setCacheHealth:nj,updateCache:oj,setIsLoading:sj,setError:aj,clearError:ij,clearCacheLocal:lj,resetCache:cj}=Ec.actions,ay=Ec.reducer;/**
 * Connection State Slice
 * ~~~~~~~~~~~~~~~~~~~~~~
 *
 * Redux slice for managing connection state including:
 * - WebSocket connection status
 * - API connection status
 * - Network latency
 * - Reconnection attempts
 *
 * Phase C.3: Component Testing & Integration
 *
 * @copyright (C) 2024 Auralis Team
 * @license GPLv3, see LICENSE for more details
 */const si={wsConnected:!1,apiConnected:!1,latency:0,reconnectAttempts:0,maxReconnectAttempts:5,lastError:null,lastReconnectTime:0,lastUpdated:0},Ac=So({name:"connection",initialState:si,reducers:{setWSConnected(e,t){e.wsConnected=t.payload,t.payload&&(e.reconnectAttempts=0,e.lastError=null),e.lastUpdated=Date.now()},setAPIConnected(e,t){e.apiConnected=t.payload,t.payload&&(e.lastError=null),e.lastUpdated=Date.now()},setLatency(e,t){e.latency=t.payload,e.lastUpdated=Date.now()},incrementReconnectAttempts(e){e.reconnectAttempts=Math.min(e.reconnectAttempts+1,e.maxReconnectAttempts),e.lastReconnectTime=Date.now(),e.lastUpdated=Date.now()},resetReconnectAttempts(e){e.reconnectAttempts=0,e.lastUpdated=Date.now()},setMaxReconnectAttempts(e,t){e.maxReconnectAttempts=t.payload},setError(e,t){e.lastError=t.payload,e.lastUpdated=Date.now()},clearError(e){e.lastError=null},updateConnectionState(e,t){Object.assign(e,t.payload),e.lastUpdated=Date.now()},resetConnection(e){Object.assign(e,si)}}}),{setWSConnected:dj,setAPIConnected:uj,setLatency:pj,incrementReconnectAttempts:hj,resetReconnectAttempts:fj,setMaxReconnectAttempts:gj,setError:mj,clearError:yj,updateConnectionState:bj,resetConnection:xj}=Ac.actions,iy=Ac.reducer;/**
 * Redux State Hooks
 * ~~~~~~~~~~~~~~~~
 *
 * Convenience hooks for accessing Redux state and dispatching actions.
 * Provides a cleaner API for components instead of raw useSelector/useDispatch.
 *
 * Features:
 * - Memoized selectors to prevent unnecessary re-renders
 * - Type-safe actions
 * - Batch updates for related state
 * - Loading and error state helpers
 *
 * Phase C.4a: Redux Integration
 *
 * @copyright (C) 2024 Auralis Team
 * @license GPLv3, see LICENSE for more details
 */const ly=()=>{const e=ln(),t=Et(r=>r.player);return{isPlaying:t.isPlaying,currentTrack:t.currentTrack,currentTime:t.currentTime,duration:t.duration,volume:t.volume,isMuted:t.isMuted,preset:t.preset,isLoading:t.isLoading,error:t.error,play:g.useCallback(()=>e(Ln(!0)),[e]),pause:g.useCallback(()=>e(Ln(!1)),[e]),togglePlay:g.useCallback(()=>e(Ln(!t.isPlaying)),[e,t.isPlaying]),seek:g.useCallback(r=>e(Vl(r)),[e]),setVolume:g.useCallback(r=>e(Kl(r)),[e]),setMuted:g.useCallback(r=>e(Yl(r)),[e]),toggleMute:g.useCallback(()=>e(cf()),[e]),setPreset:g.useCallback(r=>e(Xl(r)),[e]),setTrack:g.useCallback(r=>e(Sr(r)),[e])}},Dc=()=>{const e=ln(),t=Et(r=>r.queue);return{tracks:t.tracks,currentIndex:t.currentIndex,currentTrack:t.tracks[t.currentIndex]||null,queueLength:t.tracks.length,isLoading:t.isLoading,error:t.error,remainingTime:t.tracks.slice(t.currentIndex+1).reduce((r,n)=>r+n.duration,0),totalTime:t.tracks.reduce((r,n)=>r+n.duration,0),add:g.useCallback(r=>e(bf(r)),[e]),addMany:g.useCallback(r=>e(xf(r)),[e]),remove:g.useCallback(r=>e(Sf(r)),[e]),reorder:g.useCallback((r,n)=>e(vf({fromIndex:r,toIndex:n})),[e]),setCurrentIndex:g.useCallback(r=>e(tc(r)),[e]),next:g.useCallback(()=>e(rc()),[e]),previous:g.useCallback(()=>e(nc()),[e]),clear:g.useCallback(()=>e(wf()),[e]),setQueue:g.useCallback(r=>e(ec(r)),[e])}};/**
 * Library Service
 *
 * Provides API functions for library operations:
 * - Fetch artist tracks for playback
 * - Library browsing and search
 *
 * Refactored to use centralized apiRequest utility for consistent error handling
 * and reduced code duplication (eliminates raw fetch wrapper pattern).
 *
 * @copyright (C) 2024 Auralis Team
 * @license GPLv3, see LICENSE for more details
 */async function ai(e){return Nn(ye.ARTIST_TRACKS(e))}const cy=({artist:e,onArtistClick:t})=>{const{success:r,error:n}=Fe(),o=Dc(),i=ly(),[l,c]=g.useState(!1),d=g.useCallback(async()=>{if(e)try{const f=await ai(e.id);if(f.tracks.length===0){n(`No tracks found for ${e.name}`);return}const p=f.tracks.map(h=>({id:h.id,title:h.title,album:h.album,duration:h.duration}));o.clear(),o.setQueue(p),i.play(),r(`Playing all songs by ${e.name}`)}catch(f){const p=f instanceof Error?f.message:"Failed to play artist tracks";n(p)}},[e,o,i,r,n]),u=g.useCallback(async()=>{if(e)try{r(`Added ${e.name} to queue`);const p=(await ai(e.id)).tracks.map(h=>({id:h.id,title:h.title,album:h.album,duration:h.duration}));if(p.length===0){n(`No tracks found for ${e.name}`);return}o.addMany(p)}catch(f){const p=f instanceof Error?f.message:"Failed to add artist tracks to queue";n(p)}},[e,o,r,n]);return g.useMemo(()=>e?{actions:Nm(e.id,{onPlayAll:d,onAddToQueue:u,onShowAlbums:()=>{t&&t(e.id,e.name)},onShowInfo:()=>{c(!0)}}),modal:{open:l,artist:e,onClose:()=>c(!1)}}:{actions:[],modal:{open:!1,artist:null,onClose:()=>{}}},[e,t,d,u,l])},dy=({onArtistClick:e})=>{const t=g.useRef(null),[r,n]=g.useState(null),{data:o,isLoading:i,error:l,total:c,hasMore:d,fetchMore:u}=Zm({limit:50}),{groupedArtists:f,sortedLetters:p}=sy(o),{observerTarget:h}=Ic({threshold:.8,onLoadMore:u,hasMore:d,isLoading:i}),{contextMenuState:m,handleContextMenu:y,handleCloseContextMenu:b}=Pc(),x=g.useCallback(I=>{e&&e(I.id,I.name)},[e]),S=g.useCallback((I,E)=>{I.preventDefault(),I.stopPropagation(),n(E),y(I)},[y]),{actions:v,modal:k}=cy({artist:r,onArtistClick:e});if(i&&o.length===0)return a.jsx(Sm,{});const C=a.jsx(vm,{loading:i,error:l==null?void 0:l.message});return l||o.length===0?C:a.jsxs(a.Fragment,{children:[a.jsx(Ym,{artists:o,totalArtists:c,isLoadingMore:i&&o.length>0,hasMore:d,containerRef:t,loadMoreTriggerRef:h,groupedArtists:f,sortedLetters:p,contextMenuState:m,contextActions:v,onArtistClick:x,onContextMenuOpen:S,onContextMenuClose:()=>{n(null),b()}}),a.jsx(Xm,{open:k.open,artist:k.artist,onClose:k.onClose})]})},uy=()=>a.jsx(nl,{children:a.jsxs(hn,{sx:{backgroundColor:`rgba(${parseInt(s.colors.bg.level3.slice(1,3),16)}, ${parseInt(s.colors.bg.level3.slice(3,5),16)}, ${parseInt(s.colors.bg.level3.slice(5,7),16)}, 0.5)`,borderBottom:`1px solid ${s.colors.border.light}`},children:[a.jsx(be,{width:"60px",sx:{color:s.colors.text.tertiary,fontWeight:s.typography.fontWeight.semibold,fontSize:s.typography.fontSize.xs,textTransform:"uppercase",letterSpacing:"0.5px",padding:`${s.spacing.md} ${s.spacing.sm}`},children:"#"}),a.jsx(be,{sx:{color:s.colors.text.tertiary,fontWeight:s.typography.fontWeight.semibold,fontSize:s.typography.fontSize.xs,textTransform:"uppercase",letterSpacing:"0.5px",padding:`${s.spacing.md} ${s.spacing.sm}`},children:"Title"}),a.jsx(be,{sx:{color:s.colors.text.tertiary,fontWeight:s.typography.fontWeight.semibold,fontSize:s.typography.fontSize.xs,textTransform:"uppercase",letterSpacing:"0.5px",padding:`${s.spacing.md} ${s.spacing.sm}`},children:"Artist"}),a.jsx(be,{align:"right",width:"100px",sx:{color:s.colors.text.tertiary,fontWeight:s.typography.fontWeight.semibold,fontSize:s.typography.fontSize.xs,textTransform:"uppercase",letterSpacing:"0.5px",padding:`${s.spacing.md} ${s.spacing.sm}`},children:"Duration"})]})}),Rc=j(hn)(({theme:e})=>({cursor:"pointer",transition:"background-color 0.2s ease","&:hover":{backgroundColor:D.ultraLight,"& .play-icon":{opacity:1}},"&.current-track":{backgroundColor:D.lighter,"& .track-number":{color:s.colors.accent.primary},"& .track-title":{color:s.colors.accent.primary,fontWeight:"bold"}}})),Tc=j(P)({opacity:0,transition:"opacity 0.2s ease",display:"flex",alignItems:"center",justifyContent:"center"}),py=({isCurrentTrack:e,isPlaying:t,trackNumber:r,index:n})=>a.jsx(be,{children:a.jsx(P,{sx:{display:"flex",alignItems:"center",justifyContent:"center"},children:e&&t?a.jsx(uo,{sx:{fontSize:20,color:s.colors.accent.primary}}):a.jsxs(a.Fragment,{children:[a.jsx(_,{className:"track-number",sx:{fontSize:"0.9rem",color:"text.secondary",".current-track &":{display:"none"}},children:r||n+1}),a.jsx(Tc,{className:"play-icon",children:a.jsx(at,{sx:{fontSize:20}})})]})})}),hy=({track:e,index:t,isCurrentTrack:r,isPlaying:n,onTrackClick:o,formatDuration:i})=>a.jsxs(Rc,{onClick:()=>o(e),className:r?"current-track":"",children:[a.jsx(py,{isCurrentTrack:r,isPlaying:n,trackNumber:e.track_number,index:t}),a.jsx(be,{children:a.jsx(_,{className:"track-title",sx:{fontSize:s.typography.fontSize.md,fontWeight:r?s.typography.fontWeight.semibold:s.typography.fontWeight.normal,color:r?s.colors.accent.primary:s.colors.text.primary},children:e.title})}),a.jsx(be,{children:a.jsx(_,{sx:{fontSize:s.typography.fontSize.sm,color:s.colors.text.secondary},children:e.artist})}),a.jsx(be,{align:"right",children:a.jsx(_,{sx:{fontSize:s.typography.fontSize.sm,color:s.colors.text.tertiary,fontFamily:s.typography.fontFamily.mono},children:i(e.duration)})})]}),fy=({tracks:e,currentTrackId:t,isPlaying:r=!1,onTrackClick:n,formatDuration:o})=>a.jsx(ol,{component:st,sx:{background:`rgba(${parseInt(s.colors.bg.level2.slice(1,3),16)}, ${parseInt(s.colors.bg.level2.slice(3,5),16)}, ${parseInt(s.colors.bg.level2.slice(5,7),16)}, 0.92)`,borderRadius:s.borderRadius.lg,backdropFilter:"blur(12px)",border:`1px solid ${s.colors.border.light}`,boxShadow:s.shadows.md,overflow:"hidden"},children:a.jsxs(sl,{children:[a.jsx(uy,{}),a.jsx(al,{children:e&&e.length>0?e.map((i,l)=>a.jsx(hy,{track:i,index:l,isCurrentTrack:t===i.id,isPlaying:r,onTrackClick:n,formatDuration:o},i.id)):a.jsx(hn,{children:a.jsx(be,{colSpan:4,align:"center",sx:{py:s.spacing.xl,borderTop:`1px solid ${s.colors.border.light}`},children:a.jsx(_,{sx:{color:s.colors.text.tertiary,fontSize:s.typography.fontSize.md},children:"No tracks found for this album"})})})})]})}),gy=j(P)({display:"flex",gap:s.spacing.xl,marginBottom:s.spacing.xl,padding:s.spacing.xl,background:`rgba(${parseInt(s.colors.bg.level2.slice(1,3),16)}, ${parseInt(s.colors.bg.level2.slice(3,5),16)}, ${parseInt(s.colors.bg.level2.slice(5,7),16)}, 0.92)`,borderRadius:s.borderRadius.lg,backdropFilter:"blur(12px)",border:`1px solid ${s.colors.border.light}`,boxShadow:s.shadows.md,"@media (max-width: 768px)":{flexDirection:"column",gap:s.spacing.lg,padding:s.spacing.lg}}),my=j(P)({flexShrink:0,display:"flex",alignItems:"center",justifyContent:"center","@media (max-width: 768px)":{alignSelf:"center"}}),yy=j(P)({flex:1,display:"flex",flexDirection:"column",justifyContent:"center",gap:s.spacing.md}),by=j(_)({fontSize:s.typography.fontSize["4xl"],fontWeight:s.typography.fontWeight.bold,background:s.gradients.aurora,backgroundClip:"text",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",marginBottom:s.spacing.sm,lineHeight:1.2}),xy=j(_)({fontSize:s.typography.fontSize.lg,color:s.colors.text.secondary,marginBottom:s.spacing.md,fontWeight:s.typography.fontWeight.semibold});j(_)({fontSize:s.typography.fontSize.sm,color:s.colors.text.tertiary,marginBottom:s.spacing.xs});const Sy=j(P)({display:"flex",gap:s.spacing.md,marginTop:s.spacing.lg,alignItems:"center",flexWrap:"wrap"}),Mc=({artwork:e,title:t,subtitle:r,metadata:n,actions:o,direction:i="row"})=>a.jsxs(gy,{sx:{flexDirection:i},children:[a.jsx(my,{children:e}),a.jsxs(yy,{children:[a.jsxs(P,{children:[a.jsx(by,{variant:"h2",children:t}),r&&a.jsx(xy,{variant:"h5",children:r})]}),n&&a.jsx(P,{children:n}),o&&a.jsx(Sy,{children:o})]})]}),vy=e=>{const t=Math.floor(e/3600),r=Math.floor(e%3600/60);return t>0?`${t} hr ${r} min`:`${r} min`},wy=({year:e,trackCount:t,totalDuration:r,genre:n})=>a.jsxs(P,{children:[a.jsxs(_,{variant:"body2",sx:{color:s.colors.text.tertiary,mb:s.spacing.sm,fontSize:s.typography.fontSize.sm,fontWeight:s.typography.fontWeight.normal},children:[e&&`${e}  `,t," ",t===1?"track":"tracks","  ",vy(r)]}),n&&a.jsxs(_,{variant:"body2",sx:{color:s.colors.text.tertiary,fontSize:s.typography.fontSize.sm,fontWeight:s.typography.fontWeight.normal},children:["Genre: ",n]})]}),Cy=({isPlaying:e,isFavorite:t,savingFavorite:r,firstTrackId:n,albumId:o,onPlay:i,onToggleFavorite:l,onAddToQueue:c,onMoreOptions:d})=>a.jsxs(P,{sx:{display:"flex",gap:s.spacing.md,flexWrap:"wrap",alignItems:"center"},children:[a.jsx($e,{variant:"primary",startIcon:e&&n?a.jsx(uo,{}):a.jsx(at,{}),onClick:i,disabled:r,sx:{background:s.gradients.aurora,color:s.colors.text.primary,fontWeight:s.typography.fontWeight.semibold,padding:`${s.spacing.sm} ${s.spacing.lg}`,borderRadius:s.borderRadius.md,border:"none",cursor:"pointer",transition:s.transitions.all,boxShadow:s.shadows.md,outline:"none","&:hover":{transform:"translateY(-2px)",boxShadow:s.shadows.glowMd},"&:active":{transform:"translateY(0)"},"&:disabled":{opacity:.5,cursor:"not-allowed"}},children:e&&n?"Pause":"Play Album"}),a.jsx(ke,{title:t?"Remove from favorites":"Add to favorites",children:a.jsx(se,{onClick:l,disabled:r,"aria-pressed":t,"aria-label":t?"Album is favorited. Press to remove":"Album is not favorited. Press to add",sx:{color:t?s.colors.semantic.error:s.colors.text.secondary,border:`1px solid ${s.colors.border.light}`,borderRadius:s.borderRadius.md,padding:s.spacing.sm,transition:s.transitions.all,"&:hover":{backgroundColor:s.colors.bg.tertiary,borderColor:s.colors.accent.primary,transform:"scale(1.05)"},"&:disabled":{opacity:.5,cursor:"not-allowed"}},children:t?a.jsx(io,{}):a.jsx(rl,{})})}),a.jsx(ke,{title:"Add to queue",children:a.jsx(se,{onClick:c,sx:{color:s.colors.text.secondary,border:`1px solid ${s.colors.border.light}`,borderRadius:s.borderRadius.md,padding:s.spacing.sm,transition:s.transitions.all,"&:hover":{backgroundColor:s.colors.bg.tertiary,borderColor:s.colors.accent.primary,transform:"scale(1.05)"}},children:a.jsx(cu,{})})}),a.jsx(ke,{title:"More options",children:a.jsx(se,{onClick:d,sx:{color:s.colors.text.secondary,border:`1px solid ${s.colors.border.light}`,borderRadius:s.borderRadius.md,padding:s.spacing.sm,transition:s.transitions.all,"&:hover":{backgroundColor:s.colors.bg.tertiary,borderColor:s.colors.accent.primary,transform:"scale(1.05)"}},children:a.jsx(un,{})})})]}),ky=({album:e,isPlaying:t=!1,currentTrackId:r,isFavorite:n,savingFavorite:o,onPlay:i,onToggleFavorite:l})=>{var c,d,u,f;return a.jsx(Mc,{artwork:a.jsx(P,{sx:{width:"280px",height:"280px",borderRadius:s.borderRadius.lg,overflow:"hidden",boxShadow:s.shadows.lg,transition:s.transitions.all,"&:hover":{transform:"scale(1.02)",boxShadow:s.shadows.glowMd}},children:a.jsx(Xs,{albumId:e.id,size:280,borderRadius:0})}),title:e.title,subtitle:e.artist_name||e.artist,metadata:a.jsx(wy,{year:e.year,trackCount:e.track_count,totalDuration:e.total_duration,genre:e.genre}),actions:a.jsx(Cy,{isPlaying:t&&r===((d=(c=e.tracks)==null?void 0:c[0])==null?void 0:d.id),isFavorite:n,savingFavorite:o,firstTrackId:(f=(u=e.tracks)==null?void 0:u[0])==null?void 0:f.id,onPlay:i,onToggleFavorite:l})})},jy=e=>{const[t,r]=g.useState(null),[n,o]=g.useState(!0),[i,l]=g.useState(null),[c,d]=g.useState(!1),[u,f]=g.useState(!1);g.useEffect(()=>{p()},[e]);const p=async()=>{var m;o(!0),l(null);try{const y=await fetch(`/api/albums/${e}/tracks`);if(!y.ok)throw new Error("Failed to fetch album details");const b=await y.json(),x={id:b.album_id,title:b.album_title,artist:b.artist,artist_name:b.artist,year:b.year,track_count:b.total_tracks,total_duration:((m=b.tracks)==null?void 0:m.reduce((S,v)=>S+(v.duration||0),0))||0,tracks:b.tracks||[]};r(x)}catch(y){console.error("Error fetching album details:",y),l(y instanceof Error?y.message:"Failed to load album details")}finally{o(!1)}};return{album:t,loading:n,error:i,isFavorite:c,savingFavorite:u,toggleFavorite:async()=>{var m,y;f(!0);try{const b=(y=(m=t==null?void 0:t.tracks)==null?void 0:m[0])==null?void 0:y.id;if(!b){l("Cannot favorite album: no tracks available");return}if(!(await fetch(`/api/library/tracks/${b}/favorite`,{method:"POST",headers:{"Content-Type":"application/json"}})).ok)throw new Error("Failed to update favorite status");d(!c)}catch(b){console.error("Error toggling favorite:",b),l(b instanceof Error?b.message:"Failed to update favorite status")}finally{f(!1)}},setError:l}},Py=({albumId:e,onBack:t,onTrackPlay:r,currentTrackId:n,isPlaying:o=!1})=>{const{album:i,loading:l,error:c,isFavorite:d,savingFavorite:u,toggleFavorite:f}=jy(e),p=y=>{const b=Math.floor(y),x=Math.floor(b/60),S=b%60;return`${x}:${S.toString().padStart(2,"0")}`},h=()=>{i!=null&&i.tracks&&i.tracks.length>0&&r&&r(i.tracks[0])},m=y=>{r&&r(y)};return l?a.jsxs(At,{maxWidth:"xl",sx:{py:s.spacing.xl,px:s.spacing.lg},role:"status","aria-live":"polite","aria-label":"Loading album details",children:[a.jsx(Xe,{variant:"rectangular",height:400,sx:{borderRadius:s.borderRadius.lg,mb:s.spacing.xl}}),a.jsx(Xe,{variant:"rectangular",height:300,sx:{borderRadius:s.borderRadius.lg}})]}):c||!i?a.jsxs(At,{maxWidth:"xl",sx:{py:s.spacing.xl,px:s.spacing.lg},children:[a.jsx(gt,{title:c?"Error Loading Album":"Album not found",description:c||void 0}),t&&a.jsx(P,{sx:{textAlign:"center",mt:s.spacing.lg},children:a.jsx($e,{onClick:t,startIcon:a.jsx(Yo,{}),sx:{background:s.gradients.aurora,color:s.colors.text.primary,fontWeight:s.typography.fontWeight.semibold,padding:`${s.spacing.sm} ${s.spacing.lg}`,borderRadius:s.borderRadius.md,border:"none",transition:s.transitions.all,boxShadow:s.shadows.md,"&:hover":{transform:"translateY(-2px)",boxShadow:s.shadows.glowMd}},children:"Back to Albums"})})]}):a.jsxs(At,{maxWidth:"xl",sx:{py:s.spacing.xl,px:s.spacing.lg},children:[t&&a.jsx(se,{onClick:t,"aria-label":"Go back to albums library",sx:{mb:s.spacing.lg,color:s.colors.text.secondary,border:`1px solid ${s.colors.border.light}`,borderRadius:s.borderRadius.md,padding:s.spacing.sm,transition:s.transitions.all,"&:hover":{backgroundColor:s.colors.bg.tertiary,borderColor:s.colors.accent.primary,transform:"scale(1.05)"},"&:focus-visible":{outline:`3px solid ${s.colors.accent.primary}`,outlineOffset:"2px"}},children:a.jsx(Yo,{})}),a.jsx(ky,{album:i,isPlaying:o,currentTrackId:n,isFavorite:d,savingFavorite:u,onPlay:h,onToggleFavorite:f}),a.jsx(fy,{tracks:i.tracks||[],currentTrackId:n,isPlaying:o,onTrackClick:m,formatDuration:p})]})},Iy=()=>a.jsxs(At,{maxWidth:"xl",sx:{py:4},children:[a.jsx(Xe,{variant:"rectangular",height:300,sx:{borderRadius:2,mb:4}}),a.jsx(Xe,{variant:"rectangular",height:400,sx:{borderRadius:2}})]}),Ey=e=>{const[t,r]=g.useState(null),[n,o]=g.useState(!0),[i,l]=g.useState(null),c=async()=>{o(!0),l(null);try{const d=await fetch(`/api/artists/${e}`);if(!d.ok)throw new Error("Failed to fetch artist details");const u=await d.json(),f={id:u.artist_id,name:u.artist_name,album_count:u.total_albums,track_count:u.total_tracks,albums:u.albums||[],tracks:[]};r(f)}catch(d){console.error("Error fetching artist details:",d),l(d instanceof Error?d.message:"Failed to load artist details")}finally{o(!1)}};return g.useEffect(()=>{c()},[e]),{artist:t,loading:n,error:i}},Ay=j(P)(({theme:e})=>({width:200,height:200,borderRadius:mg,background:le.aurora,display:"flex",alignItems:"center",justifyContent:"center",fontSize:"5rem",fontWeight:s.typography.fontWeight.bold,color:s.colors.text.primary,boxShadow:Xf.purple}));j($s)(({theme:e})=>({width:40,height:40,background:le.aurora,fontSize:s.typography.fontSize.md,fontWeight:s.typography.fontWeight.bold}));j($s)(({theme:e})=>({width:40,height:40,backgroundColor:D.standard}));const Dy=j(st)(({theme:e})=>({background:D.ultraLight,borderRadius:e.spacing(2),overflow:"hidden",cursor:"pointer",transition:s.transitions.all,border:`1px solid ${D.ultraLight}`,"&:hover":{transform:"translateY(-4px)",boxShadow:s.shadows.lg,"& .album-title":{color:s.colors.accent.primary}}})),Ry=j(_)(({theme:e})=>({fontSize:s.typography.fontSize.md,fontWeight:s.typography.fontWeight.semibold,color:s.colors.text.primary,marginBottom:4,transition:s.transitions.color})),Ty=j(_)(({theme:e})=>({fontSize:s.typography.fontSize.sm,color:s.colors.text.secondary})),My=j(ol)(({theme:e})=>({background:D.ultraLight,borderRadius:e.spacing(2),backdropFilter:"blur(10px)"})),$y=({artist:e,onPlayAll:t,onShuffle:r})=>{const n=o=>o.charAt(0).toUpperCase();return a.jsx(Mc,{artwork:a.jsx(Ay,{children:n(e.name)}),title:e.name,metadata:a.jsxs(_,{variant:"body1",sx:{color:s.colors.text.tertiary,fontSize:s.typography.fontSize.sm,fontWeight:s.typography.fontWeight.normal},children:[e.albumCount&&`${e.albumCount} ${e.albumCount===1?"album":"albums"}`,e.albumCount&&e.trackCount&&"  ",e.trackCount&&`${e.trackCount} ${e.trackCount===1?"track":"tracks"}`]}),actions:a.jsxs(P,{sx:{display:"flex",gap:s.spacing.md,flexWrap:"wrap",alignItems:"center"},children:[a.jsx($e,{variant:"primary",startIcon:a.jsx(at,{}),onClick:t,sx:{background:s.gradients.aurora,color:s.colors.text.primary,fontWeight:s.typography.fontWeight.semibold,padding:`${s.spacing.sm} ${s.spacing.lg}`,borderRadius:s.borderRadius.md,border:"none",cursor:"pointer",transition:s.transitions.all,boxShadow:s.shadows.md,outline:"none","&:hover":{transform:"translateY(-2px)",boxShadow:s.shadows.glowMd},"&:active":{transform:"translateY(0)"}},children:"Play All"}),a.jsx($e,{variant:"secondary",startIcon:a.jsx(du,{}),onClick:r,sx:{color:s.colors.text.secondary,borderColor:s.colors.border.light,fontWeight:s.typography.fontWeight.semibold,padding:`${s.spacing.sm} ${s.spacing.lg}`,borderRadius:s.borderRadius.md,transition:s.transitions.all,"&:hover":{backgroundColor:s.colors.bg.tertiary,borderColor:s.colors.accent.primary,transform:"scale(1.05)"},"&:active":{transform:"scale(0.98)"}},children:"Shuffle"}),a.jsx(se,{sx:{color:s.colors.text.secondary,border:`1px solid ${s.colors.border.light}`,borderRadius:s.borderRadius.md,padding:s.spacing.sm,transition:s.transitions.all,"&:hover":{backgroundColor:s.colors.bg.tertiary,borderColor:s.colors.accent.primary,transform:"scale(1.05)"}},children:a.jsx(un,{})})]})})},Fy=({artist:e,onBack:t,onPlayAll:r,onShuffle:n})=>a.jsxs(a.Fragment,{children:[t&&a.jsx(se,{onClick:t,"aria-label":"Go back to artists library",sx:{mb:s.spacing.lg,color:s.colors.text.secondary,border:`1px solid ${s.colors.border.light}`,borderRadius:s.borderRadius.md,padding:s.spacing.sm,transition:s.transitions.all,"&:hover":{backgroundColor:s.colors.bg.tertiary,borderColor:s.colors.accent.primary,transform:"scale(1.05)"},"&:focus-visible":{outline:`3px solid ${s.colors.accent.primary}`,outlineOffset:"2px"}},children:a.jsx(Yo,{})}),a.jsx($y,{artist:e,onPlayAll:r,onShuffle:n})]}),_y=({albums:e,onAlbumClick:t})=>!e||e.length===0?a.jsx(st,{sx:{padding:4,textAlign:"center",background:"rgba(255,255,255,0.03)",borderRadius:2},children:a.jsx(_,{color:"text.secondary",children:"No albums found for this artist"})}):a.jsx(P,{children:a.jsx(he,{container:!0,spacing:3,children:e.map(r=>a.jsx(he,{item:!0,xs:12,sm:6,md:4,lg:3,xl:2,children:a.jsxs(Dy,{onClick:()=>t(r.id),children:[a.jsx(Xs,{albumId:r.id,size:"100%",borderRadius:0}),a.jsxs(P,{sx:{p:2},children:[a.jsx(Ry,{className:"album-title",children:r.title}),a.jsxs(Ty,{children:[r.year&&`${r.year}  `,r.track_count," ",r.track_count===1?"track":"tracks"]})]})]})},r.id))})}),Oy=()=>a.jsx(nl,{children:a.jsxs(hn,{children:[a.jsx(be,{width:"60px",sx:{color:"text.secondary",fontWeight:"bold"},children:"#"}),a.jsx(be,{sx:{color:"text.secondary",fontWeight:"bold"},children:"Title"}),a.jsx(be,{sx:{color:"text.secondary",fontWeight:"bold"},children:"Album"}),a.jsx(be,{align:"right",width:"100px",sx:{color:"text.secondary",fontWeight:"bold"},children:"Duration"})]})}),By=({track:e,index:t,isCurrentTrack:r,isPlaying:n,onTrackClick:o,formatDuration:i})=>a.jsxs(Rc,{onClick:()=>o(e),className:r?"current-track":"",children:[a.jsx(be,{children:a.jsx(P,{sx:{display:"flex",alignItems:"center",justifyContent:"center"},children:r&&n?a.jsx(uo,{sx:{fontSize:20,color:"#667eea"}}):a.jsxs(a.Fragment,{children:[a.jsx(_,{sx:{fontSize:"0.9rem",color:"text.secondary",".current-track &":{display:"none"}},children:t+1}),a.jsx(Tc,{className:"play-icon",children:a.jsx(at,{sx:{fontSize:20}})})]})})}),a.jsx(be,{children:a.jsx(_,{className:"track-title",sx:{fontSize:"0.95rem",fontWeight:r?"bold":"normal"},children:e.title})}),a.jsx(be,{children:a.jsx(_,{sx:{fontSize:"0.9rem",color:"text.secondary"},children:e.album})}),a.jsx(be,{align:"right",children:a.jsx(_,{sx:{fontSize:"0.9rem",color:"text.secondary"},children:i(e.duration)})})]}),Ly=()=>({formatDuration:g.useCallback(t=>{const r=Math.floor(t/60),n=t%60;return`${r}:${n.toString().padStart(2,"0")}`},[])}),zy=({tracks:e,currentTrackId:t,isPlaying:r=!1,onTrackClick:n})=>{const{formatDuration:o}=Ly();return!e||e.length===0?a.jsx(hn,{children:a.jsx(be,{colSpan:4,align:"center",sx:{py:4},children:a.jsx(_,{color:"text.secondary",children:"No tracks found for this artist"})})}):a.jsx(My,{children:a.jsxs(sl,{children:[a.jsx(Oy,{}),a.jsx(al,{children:e.map((i,l)=>a.jsx(By,{track:i,index:l,isCurrentTrack:t===i.id,isPlaying:r,onTrackClick:n,formatDuration:o},i.id))})]})})},Ny=({artist:e,activeTab:t,onTabChange:r,currentTrackId:n,isPlaying:o,onTrackClick:i,onAlbumClick:l})=>{var c,d;return a.jsxs(P,{sx:{mt:s.spacing.xl},children:[a.jsxs(Ms,{value:t,onChange:(u,f)=>r(f),"aria-label":"Artist content sections",sx:{borderBottom:`1px solid ${s.colors.border.light}`,marginBottom:s.spacing.lg,"& .MuiTabs-indicator":{background:s.gradients.aurora,height:"3px",borderRadius:s.borderRadius.full},"& .MuiTab-root":{color:s.colors.text.secondary,fontWeight:s.typography.fontWeight.semibold,fontSize:s.typography.fontSize.md,transition:s.transitions.all,textTransform:"none","&:hover":{color:s.colors.text.primary},"&.Mui-selected":{color:s.colors.accent.primary}}},children:[a.jsx(xt,{label:`Albums (${((c=e.albums)==null?void 0:c.length)||0})`,id:"albums-tab","aria-controls":"albums-panel"}),a.jsx(xt,{label:`All Tracks (${((d=e.tracks)==null?void 0:d.length)||0})`,id:"tracks-tab","aria-controls":"tracks-panel"})]}),t===0&&a.jsx(P,{id:"albums-panel",role:"tabpanel","aria-labelledby":"albums-tab",children:a.jsx(_y,{albums:e.albums||[],onAlbumClick:l})}),t===1&&a.jsx(P,{id:"tracks-panel",role:"tabpanel","aria-labelledby":"tracks-tab",children:a.jsx(zy,{tracks:e.tracks||[],currentTrackId:n,isPlaying:o,onTrackClick:i})})]})},Wy=({artistId:e,onBack:t,onTrackPlay:r,onAlbumClick:n,currentTrackId:o,isPlaying:i=!1})=>{const{artist:l,loading:c,error:d}=Ey(e),[u,f]=g.useState(0),p=()=>{l!=null&&l.tracks&&l.tracks.length>0&&r&&r(l.tracks[0])},h=()=>{if(l!=null&&l.tracks&&l.tracks.length>0&&r){const b=Math.floor(Math.random()*l.tracks.length);r(l.tracks[b])}},m=b=>{r&&r(b)},y=b=>{n&&n(b)};return c?a.jsx(Iy,{}):d||!l?a.jsx(At,{maxWidth:"xl",sx:{py:s.spacing.xl,px:s.spacing.lg},role:"alert","aria-live":"assertive",children:a.jsx(gt,{title:d?"Error Loading Artist":"Artist not found",description:d||void 0})}):a.jsxs(At,{maxWidth:"xl",sx:{py:s.spacing.xl,px:s.spacing.lg},children:[a.jsx(Fy,{artist:l,onBack:t,onPlayAll:p,onShuffle:h}),a.jsx(Ny,{artist:l,activeTab:u,onTabChange:f,currentTrackId:o,isPlaying:i,onTrackClick:m,onAlbumClick:y})]})},ii=({icon:e,title:t,subtitle:r,children:n})=>a.jsxs(At,{maxWidth:"xl",sx:{py:4,display:"flex",flexDirection:"column"},children:[a.jsxs(P,{sx:{mb:4,flexShrink:0},children:[a.jsxs(_,{variant:"h3",component:"h1",fontWeight:"bold",gutterBottom:!0,sx:{background:`linear-gradient(45deg, ${s.colors.accent.primary}, ${s.colors.accent.secondary})`,backgroundClip:"text",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent"},children:[e," ",t]}),a.jsx(_,{variant:"subtitle1",color:"text.secondary",children:r})]}),a.jsx(P,{sx:{flex:1,minHeight:0,width:"100%"},children:n})]}),Uy=({view:e,selectedAlbumId:t,selectedArtistId:r,selectedArtistName:n,currentTrackId:o,isPlaying:i,onBackFromAlbum:l,onBackFromArtist:c,onAlbumClick:d,onArtistClick:u,onTrackPlay:f})=>t!==null?a.jsx(Py,{albumId:t,onBack:l,onTrackPlay:f,currentTrackId:o,isPlaying:i}):e==="albums"?a.jsx(ii,{icon:"",title:"Albums",subtitle:"Browse your music collection by album",children:a.jsx(um,{onAlbumClick:d})}):e==="artists"?r!==null?a.jsx(Wy,{artistId:r,artistName:n,onBack:c,onTrackPlay:f,onAlbumClick:d,currentTrackId:o,isPlaying:i}):a.jsx(ii,{icon:"",title:"Artists",subtitle:"Browse artists in your music library",children:a.jsx(dy,{onArtistClick:u})}):null,Hy=j(st)(({theme:e})=>({background:s.colors.bg.level2,borderRadius:e.spacing(3),overflow:"hidden",padding:e.spacing(2)}));j(P)(({theme:e})=>({padding:e.spacing(3)}));const Gy=j(P)(({theme:e})=>({height:"100px",width:"100%",display:"flex",alignItems:"center",justifyContent:"center",marginTop:e.spacing(2)})),qy=j(P)(({theme:e})=>({height:"100px",width:"100%",display:"flex",alignItems:"center",justifyContent:"center",padding:e.spacing(2)})),Qy=j(P)(({theme:e})=>({width:20,height:20,border:"2px solid",borderColor:e.palette.primary.main,borderRightColor:"transparent",borderRadius:"50%",animation:`${$g} 1s linear infinite`})),Vy=j(_)(({theme:e})=>({marginLeft:e.spacing(2),color:e.palette.text.secondary})),Ky=j(P)(({theme:e})=>({padding:e.spacing(3),textAlign:"center"})),Yy=j(_)(({theme:e})=>({color:e.palette.text.secondary})),Xy=j(kl)(({isPlaying:e})=>({position:"relative",borderRadius:12,overflow:"hidden",cursor:"pointer",transition:"all 0.3s ease",background:e?s.colors.bg.level4:s.colors.bg.tertiary,boxShadow:e?`0 4px 16px rgba(0, 0, 0, 0.25), 0 0 0 1px ${s.colors.accent.primary}40`:"0 2px 8px rgba(0, 0, 0, 0.15)",transform:e?"translateY(-2px)":"none","&:hover":{transform:"translateY(-4px)",boxShadow:e?`0 8px 28px rgba(0, 0, 0, 0.3), 0 0 0 1px ${s.colors.accent.primary}60`:"0 8px 24px rgba(0, 0, 0, 0.25)",background:s.colors.bg.level4}})),Jy=j(P)({position:"relative",width:"100%",paddingTop:"100%",display:"flex",alignItems:"center",justifyContent:"center",overflow:"hidden","&:hover .shimmer-overlay":{animation:"shimmer 3s ease-in-out infinite"},"@keyframes shimmer":{"0%":{transform:"translateX(-100%)"},"100%":{transform:"translateX(100%)"}}}),Zy=j(P)(()=>({position:"absolute",inset:0,display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.3s ease"})),eb=j(P)({position:"absolute",bottom:8,right:8,paddingLeft:8,paddingRight:8,paddingTop:4,paddingBottom:4,borderRadius:6,background:"rgba(27, 35, 46, 0.50)",backdropFilter:"blur(10px)",transition:"all 0.2s ease"}),tb=j(el)({padding:16}),rb=j(P)({position:"absolute",inset:0,display:"flex",alignItems:"center",justifyContent:"center"}),nb=j(P)({position:"absolute",top:0,left:"-100%",width:"100%",height:"100%",background:"linear-gradient(90deg, transparent 0%, rgba(255, 255, 255, 0.08) 50%, transparent 100%)",pointerEvents:"none"}),ob=e=>{const t=[le.aurora,le.gradientPink,le.gradientBlue,le.gradientGreen,le.gradientSunset,le.gradientTeal,le.gradientPastel,le.gradientRose],r=e||"Unknown Album";let n=0;for(let i=0;i<r.length;i++)n=r.charCodeAt(i)+((n<<5)-n);const o=Math.abs(n)%t.length;return t[o]},sb=e=>{const t=Math.floor(e/60),r=Math.floor(e%60);return`${t}:${r.toString().padStart(2,"0")}`},ab=({duration:e,hasArtwork:t,isHovered:r,onPlay:n})=>a.jsxs(a.Fragment,{children:[!t&&a.jsxs(a.Fragment,{children:[a.jsx(rb,{children:a.jsx(cn,{sx:{fontSize:64,color:D.lighter}})}),a.jsx(nb,{className:"shimmer-overlay"})]}),a.jsx(Zy,{sx:{background:r?"rgba(0, 0, 0, 0.5)":"transparent",backdropFilter:r?"blur(4px)":"none",opacity:r?1:0},children:a.jsx(se,{sx:{width:56,height:56,background:le.aurora,color:s.colors.text.primary,transform:r?"scale(1)":"scale(0.8)",transition:"all 0.3s ease","&:hover":{background:le.electricPurple,transform:"scale(1.1)"}},onClick:n,children:a.jsx(at,{sx:{fontSize:32}})})}),a.jsx(eb,{sx:{opacity:r?1:.6,background:r?"rgba(27, 35, 46, 0.70)":"rgba(27, 35, 46, 0.50)"},children:a.jsx(_,{variant:"caption",sx:{color:r?s.colors.text.primary:s.colors.text.tertiary,fontWeight:500,fontSize:"0.7rem",transition:"color 0.2s ease"},children:sb(e)})})]}),ib=({title:e,artist:t,album:r,isPlaying:n=!1})=>a.jsxs(tb,{children:[a.jsx(ke,{title:e,placement:"top",children:a.jsx(_,{variant:"subtitle1",sx:{fontWeight:n?700:600,color:s.colors.text.primary,mb:1,lineHeight:1.4,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",opacity:n?1:.95},children:e})}),a.jsx(ke,{title:t,placement:"top",children:a.jsx(_,{variant:"body2",sx:{color:s.colors.text.secondary,fontWeight:400,lineHeight:1.5,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",mb:.75},children:t})}),a.jsx(ke,{title:r,placement:"top",children:a.jsx(_,{variant:"caption",sx:{color:s.colors.text.tertiary,fontWeight:400,lineHeight:1.5,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",display:"block"},children:r})})]}),lb=()=>{const[e,t]=g.useState(!1);return{isHovered:e,setIsHovered:t}},cb=({id:e,title:t,artist:r,album:n,albumId:o,duration:i,albumArt:l,isPlaying:c=!1,onPlay:d})=>{const{isHovered:u,setIsHovered:f}=lb(),p=h=>{h.stopPropagation(),d(e)};return a.jsxs(Xy,{isPlaying:c,onMouseEnter:()=>f(!0),onMouseLeave:()=>f(!1),onClick:()=>d(e),children:[a.jsx(Jy,{sx:{background:l?`url(${l}) center/cover`:ob(n)},children:a.jsx(ab,{duration:i,hasArtwork:!!l,isHovered:u,onPlay:p})}),a.jsx(ib,{title:t,artist:r,album:n,isPlaying:c})]})},ea=q.forwardRef(({children:e},t)=>a.jsx(Gy,{ref:t,children:e}));ea.displayName="InfiniteScrollTrigger";const db=({tracks:e,hasMore:t,currentTrackId:r,loadMoreRef:n,onTrackPlay:o,onRemoveTrack:i,onReorderQueue:l,onShuffleQueue:c,onClearQueue:d})=>a.jsxs(a.Fragment,{children:[a.jsx(he,{container:!0,spacing:3,children:e.map((u,f)=>a.jsx(he,{item:!0,xs:12,sm:6,md:4,lg:3,className:"animate-fade-in-up",sx:{animationDelay:`${f*.05}s`,animationFillMode:"both"},children:a.jsx(cb,{id:u.id,title:u.title,artist:u.artist,album:u.album,albumId:u.album_id,duration:u.duration,albumArt:u.albumArt,onPlay:p=>{const h=e.find(m=>m.id===p);h&&o(h)}})},u.id))}),t&&a.jsx(ea,{ref:n})]}),ub=j(P)(({iscurrent:e})=>({display:"flex",alignItems:"center",height:"48px",padding:`0 ${s.spacing.md}`,borderRadius:s.borderRadius.sm,cursor:"pointer",transition:"all 0.2s cubic-bezier(0.4, 0, 0.2, 1)",background:e==="true"?D.light:"transparent",border:e==="true"?`1px solid ${D.standard}`:"1px solid transparent",position:"relative",marginBottom:s.spacing.sm,boxShadow:e==="true"?`0 0 0 1px ${D.veryLight}`:"none","&:hover":{background:e==="true"?D.lighter:D.ultraLight,transform:"translateX(4px) scale(1.005)",boxShadow:"0 2px 8px rgba(0, 0, 0, 0.15)","& .track-number":{opacity:0,transform:"scale(0.8)"},"& .play-button":{opacity:1,transform:"scale(1)"},"& .more-button":{opacity:1},"& .track-title":{color:s.colors.accent.primary},"& .album-art":{transform:"scale(1.05)",boxShadow:`0 4px 12px ${D.strong}`}},"&:active":{transform:"translateX(2px) scale(0.995)"}})),pb=j(P)({position:"absolute",left:0,top:0,bottom:0,width:"3px",background:le.aurora,borderRadius:`0 ${s.borderRadius.sm} ${s.borderRadius.sm} 0`}),hb=j(P)({minWidth:"40px",display:"flex",alignItems:"center",justifyContent:"center",position:"relative"}),fb=j(_)(({iscurrent:e})=>({fontSize:"14px",fontWeight:500,color:e==="true"?s.colors.accent.primary:s.colors.text.secondary,transition:"all 0.2s cubic-bezier(0.4, 0, 0.2, 1)"})),gb=j(se)({width:"32px",height:"32px",minWidth:"32px",minHeight:"32px",padding:"4px",flexShrink:0,position:"absolute",opacity:0,transform:"scale(0.8)",transition:"all 0.2s cubic-bezier(0.4, 0, 0.2, 1)",color:s.colors.accent.primary,"& .MuiSvgIcon-root":{fontSize:"20px"},"&:hover":{background:D.lighter,transform:"scale(1.1)"}}),mb=j(P)({width:"40px",height:"40px",marginRight:"12px",borderRadius:s.borderRadius.sm,overflow:"hidden",flexShrink:0,background:le.aurora,display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.2s cubic-bezier(0.4, 0, 0.2, 1)","& img":{width:"100%",height:"100%",objectFit:"cover",transition:"transform 0.3s cubic-bezier(0.4, 0, 0.2, 1)"}}),yb=j(P)({flex:1,minWidth:0,display:"flex",flexDirection:"column",justifyContent:"center"}),bb=j(_)(({iscurrent:e})=>({fontSize:"14px",fontWeight:e==="true"?600:500,color:s.colors.text.primary,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",lineHeight:1.4,transition:"color 0.2s cubic-bezier(0.4, 0, 0.2, 1)"})),xb=j(_)({fontSize:"13px",fontWeight:400,color:s.colors.text.secondary,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",lineHeight:1.4}),Sb=j(_)({fontSize:"13px",fontWeight:400,color:s.colors.text.secondary,minWidth:"200px",maxWidth:"300px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",marginRight:s.spacing.md},{"@media (max-width: 960px)":{display:"none"}}),vb=j(_)({fontSize:"13px",fontWeight:400,color:s.colors.text.disabled,minWidth:"50px",textAlign:"right",marginRight:s.spacing.sm}),wb=j(se)({width:"32px",height:"32px",minWidth:"32px",minHeight:"32px",padding:"4px",flexShrink:0,opacity:0,transition:`opacity ${s.transitions.fast}`,color:s.colors.text.secondary,"& .MuiSvgIcon-root":{fontSize:"20px"},"&:hover":{background:D.light,color:s.colors.accent.primary}}),Cb=({isCurrent:e,isPlaying:t,onClick:r})=>a.jsx(gb,{onClick:r,size:"small",className:"play-button",children:e&&t?a.jsx(uo,{}):a.jsx(at,{})}),kb=({albumArt:e,title:t,album:r,shouldShowImage:n,onImageError:o})=>a.jsx(mb,{children:n&&e?a.jsx("img",{src:e,alt:r||t,onError:o}):a.jsx(cn,{sx:{color:"rgba(255, 255, 255, 0.3)",fontSize:"20px"}})}),jb=({title:e,artist:t,album:r,duration:n,isCurrent:o})=>{const i=o?"true":"false";return a.jsxs(a.Fragment,{children:[a.jsxs(yb,{children:[a.jsx(bb,{iscurrent:i,children:e}),a.jsx(xb,{children:t})]}),r&&a.jsx(Sb,{sx:{display:{xs:"none",md:"block"}},children:r}),a.jsx(vb,{children:n})]})},Pb=({trackId:e,isCurrent:t,isPlaying:r,onPlay:n,onPause:o,onDoubleClick:i})=>{const l=g.useCallback(u=>{u.stopPropagation(),t&&r&&o?o():n(e)},[e,t,r,n,o]),c=g.useCallback(()=>{n(e)},[e,n]),d=g.useCallback(()=>{i==null||i(e)},[e,i]);return{handlePlayClick:l,handleRowClick:c,handleRowDoubleClick:d}},Ib=({track:e,onPlay:t,onToggleFavorite:r,onShowAlbum:n,onShowArtist:o,onShowInfo:i,onEditMetadata:l,onDelete:c})=>{const[d,u]=g.useState(null),[f,p]=g.useState([]),[h,m]=g.useState(!1),{success:y,info:b,error:x}=Fe(),S=Dc(),v=g.useCallback(async()=>{m(!0);try{const A=await kc();p(A.playlists)}catch(A){console.error("Failed to load playlists:",A)}finally{m(!1)}},[]),k=g.useCallback(async(A,R)=>{try{await oi(A,[e.id]),y(`Added to "${R}"`)}catch(U){x(`Failed to add to playlist: ${U}`)}},[e.id,y,x]),C=g.useCallback(async A=>{try{await oi(A.id,[e.id]),y(`Added to "${A.name}"`)}catch(R){x(`Failed to add to playlist: ${R}`)}},[e.id,y,x]),I=g.useCallback(()=>{try{const A={id:e.id,title:e.title,album:e.album,duration:e.duration};S.addMany([A]),y(`Added "${e.title}" to queue`)}catch(A){const R=A instanceof Error?A.message:"Failed to add track to queue";x(R)}},[e.id,e.title,e.album,e.duration,S,y,x]),E=g.useCallback(A=>{A.stopPropagation(),u({top:A.clientY,left:A.clientX})},[]),$=g.useCallback(A=>{A.preventDefault(),A.stopPropagation(),u({top:A.clientY,left:A.clientX})},[]),F=g.useCallback(()=>{u(null)},[]),O=g.useMemo(()=>zm(e.id,e.favorite||!1,{onPlay:()=>{t(e.id),b(`Now playing: ${e.title}`)},onAddToQueue:I,onAddToPlaylist:F,onToggleLove:r?()=>{r(e.id),y(e.favorite?`Removed "${e.title}" from favorites`:`Added "${e.title}" to favorites`)}:void 0,onShowAlbum:n&&e.album_id?()=>{n(e.album_id)}:void 0,onShowArtist:o?()=>{o(e.artist)}:void 0,onShowInfo:i?()=>{i(e.id)}:void 0,onEditMetadata:l?()=>{l(e.id)}:void 0,onDelete:c?()=>{c(e.id)}:void 0}),[e.id,e.title,e.favorite,e.album_id,e.artist,t,r,n,o,i,l,c,b,y,F,I]);return{contextMenuPosition:d,playlists:f,isLoadingPlaylists:h,handleMoreClick:E,handleTrackContextMenu:$,handleCloseContextMenu:F,fetchPlaylists:v,handleAddToPlaylist:k,handleCreatePlaylist:C,contextActions:O}},Eb=()=>{const[e,t]=g.useState(!1),r=g.useCallback(()=>{t(!0)},[]),n=g.useCallback(o=>!!(o&&!e),[e]);return{imageError:e,handleImageError:r,shouldShowImage:n}},Ab=()=>({formatDuration:g.useCallback(t=>{const r=Math.floor(t/60),n=Math.floor(t%60);return`${r}:${n.toString().padStart(2,"0")}`},[])}),Db=({track:e,index:t,isPlaying:r=!1,isCurrent:n=!1,onPlay:o,onPause:i,onDoubleClick:l,onEditMetadata:c,onToggleFavorite:d,onShowAlbum:u,onShowArtist:f,onShowInfo:p,onDelete:h})=>{const{handleImageError:m,shouldShowImage:y}=Eb(),{handlePlayClick:b,handleRowClick:x,handleRowDoubleClick:S}=Pb({trackId:e.id,isCurrent:n,isPlaying:r,onPlay:o,onPause:i,onDoubleClick:l}),{formatDuration:v}=Ab(),{contextMenuPosition:k,playlists:C,isLoadingPlaylists:I,handleMoreClick:E,handleTrackContextMenu:$,handleCloseContextMenu:F,handleAddToPlaylist:O,handleCreatePlaylist:A,contextActions:R}=Ib({track:e,onPlay:o,onEditMetadata:c,onToggleFavorite:d,onShowAlbum:u,onShowArtist:f,onShowInfo:p,onDelete:h}),U=n?"true":"false";return a.jsxs(a.Fragment,{children:[a.jsxs(ub,{iscurrent:U,onClick:x,onDoubleClick:S,onContextMenu:$,children:[n&&a.jsx(pb,{}),a.jsxs(hb,{children:[a.jsx(fb,{className:"track-number",iscurrent:U,children:t+1}),a.jsx(Cb,{isCurrent:n,isPlaying:r,onClick:b})]}),a.jsx(kb,{albumArt:e.albumArt,title:e.title,album:e.album,shouldShowImage:y(e.albumArt),onImageError:m}),a.jsx(jb,{title:e.title,artist:e.artist,album:e.album,duration:v(e.duration),isCurrent:n}),a.jsx(wb,{className:"more-button",onClick:E,size:"small",children:a.jsx(un,{})})]}),a.jsx(Zs,{open:!!k,anchorPosition:k||void 0,onClose:F,actions:R,trackId:e.id,trackTitle:e.title,playlists:C,isLoadingPlaylists:I,onPlaylistsLoad:()=>{},onAddToPlaylist:O,onCreatePlaylist:A})]})},Rb=j(P,{shouldForwardProp:e=>e!=="isSelected"})(({theme:e,isSelected:t})=>({display:"flex",alignItems:"center",gap:"8px",padding:"4px 8px",borderRadius:"8px",backgroundColor:t?D.lighter:"transparent",border:t?`1px solid ${D.strong}`:"1px solid transparent",transition:"all 0.2s ease",cursor:"pointer","&:hover":{backgroundColor:t?D.standard:D.ultraLight,"& .selection-checkbox":{opacity:1}}})),Tb=j(uu)(({theme:e})=>({color:D.lighter,opacity:0,transition:"opacity 0.2s ease","&.Mui-checked":{color:s.colors.accent.primary,opacity:1},"&.visible":{opacity:1},"& .MuiSvgIcon-root":{fontSize:"20px"}})),Mb=j(P)(({theme:e})=>({flex:1,minWidth:0})),$b=({onToggleSelect:e})=>{const t=g.useCallback(n=>{const o=n.target;o.closest("button")||o.closest('[role="button"]')||e(n)},[e]),r=g.useCallback(n=>{n.stopPropagation(),e(n)},[e]);return{handleContainerClick:t,handleCheckboxClick:r}},Fb=({track:e,index:t,isSelected:r,onToggleSelect:n,isPlaying:o,isCurrent:i,onPlay:l,onPause:c,onDoubleClick:d,onEditMetadata:u,onToggleFavorite:f,onShowAlbum:p,onShowArtist:h,onShowInfo:m,onDelete:y})=>{const{handleContainerClick:b,handleCheckboxClick:x}=$b({onToggleSelect:n});return a.jsxs(Rb,{isSelected:r,onClick:b,children:[a.jsx(Tb,{className:`selection-checkbox ${r?"visible":""}`,checked:r,onClick:x,size:"small"}),a.jsx(Mb,{children:a.jsx(Db,{track:e,index:t,isPlaying:o,isCurrent:i,onPlay:l,onPause:c,onDoubleClick:d,onEditMetadata:u,onToggleFavorite:f,onShowAlbum:p,onShowArtist:h,onShowInfo:m,onDelete:y})})]})},_b=({current:e,total:t,itemType:r="items",children:n})=>a.jsxs(qy,{children:[a.jsx(Qy,{}),a.jsx(Vy,{variant:"body2",children:n||a.jsxs(a.Fragment,{children:["Loading more ",r,e!==void 0&&t!==void 0&&` (${e}/${t})`,"..."]})})]}),Ob=({children:e,count:t,itemType:r="items"})=>a.jsx(Ky,{children:a.jsx(Yy,{variant:"body2",children:e||(t!==void 0?`Showing all ${t} ${r}`:"End of list")})}),Bb=j(st)(({theme:e})=>({background:"rgba(255,255,255,0.05)",borderRadius:e.shape.borderRadius*3,overflow:"hidden",padding:e.spacing(2)})),Lb=j(P)({animation:"fadeInLeft 0.5s ease-out forwards","&:not(:last-child)":{marginBottom:0}}),zb=({tracks:e,hasMore:t,isLoadingMore:r,totalTracks:n,currentTrackId:o,isPlaying:i,selectedTracks:l,isSelected:c,loadMoreRef:d,onToggleSelect:u,onTrackPlay:f,onPause:p,onEditMetadata:h})=>a.jsxs(Bb,{elevation:2,children:[e.map((m,y)=>a.jsx(Lb,{className:"animate-fade-in-left",sx:{animationDelay:`${y*.03}s`,animationFillMode:"both"},children:a.jsx(Fb,{track:m,index:y,isSelected:c(m.id),onToggleSelect:b=>u(m.id,b),isPlaying:i,isCurrent:o===m.id,onPlay:b=>{const x=e.find(S=>S.id===b);x&&f(x)},onPause:p,onEditMetadata:h})},m.id)),t&&a.jsx(ea,{ref:d}),r&&a.jsx(_b,{current:e.length,total:n,itemType:"tracks"}),!t&&e.length>0&&a.jsx(Ob,{count:n,itemType:"tracks"})]}),ko=wo({list:ye.QUEUE,delete:e=>ye.QUEUE_TRACK(e),custom:{reorder:ye.QUEUE_REORDER,shuffle:ye.QUEUE_SHUFFLE,clear:ye.QUEUE_CLEAR,set:ye.QUEUE}});async function Nb(e){await ko.delete(e)}async function Wb(e){await ko.custom("reorder","put",{new_order:e})}async function Ub(){await ko.custom("shuffle","post",{})}async function Hb(){await ko.custom("clear","post",{})}const Gb=({onRemoveTrack:e,onReorderQueue:t,onShuffleQueue:r,onClearQueue:n})=>{const{success:o,error:i,info:l}=Fe(),c=g.useCallback(async p=>{try{await Nb(p),l("Track removed from queue"),e==null||e()}catch{i("Failed to remove track from queue")}},[l,i,e]),d=g.useCallback(async p=>{try{await Wb(p),o("Queue reordered"),t==null||t()}catch{i("Failed to reorder queue")}},[o,i,t]),u=g.useCallback(async()=>{try{await Ub(),o("Queue shuffled"),r==null||r()}catch{i("Failed to shuffle queue")}},[o,i,r]),f=g.useCallback(async()=>{try{await Hb(),l("Queue cleared"),n==null||n()}catch{i("Failed to clear queue")}},[l,i,n]);return{handleRemoveTrack:c,handleReorderQueue:d,handleShuffleQueue:u,handleClearQueue:f}},qb=({tracks:e,viewMode:t,loading:r,hasMore:n,totalTracks:o,isLoadingMore:i,currentTrackId:l,isPlaying:c,selectedTracks:d,isSelected:u,onToggleSelect:f,onTrackPlay:p,onPause:h,onEditMetadata:m,onLoadMore:y})=>{const{handleRemoveTrack:b,handleReorderQueue:x,handleShuffleQueue:S,handleClearQueue:v}=Gb({}),{observerTarget:k,isFetching:C}=Ic({hasMore:n,isLoading:r||i,onLoadMore:async()=>{y()}});return r?t==="grid"?a.jsx(zg,{count:12}):a.jsx(Hy,{elevation:2,children:Array.from({length:8}).map((I,E)=>a.jsx(Lg,{},E))}):t==="grid"?a.jsx(db,{tracks:e,hasMore:n,currentTrackId:l,loadMoreRef:k,onTrackPlay:p,onRemoveTrack:b,onReorderQueue:x,onShuffleQueue:S,onClearQueue:v}):a.jsx(zb,{tracks:e,hasMore:n,isLoadingMore:C,totalTracks:o,currentTrackId:l,isPlaying:c,selectedTracks:d,isSelected:u,loadMoreRef:k,onToggleSelect:f,onTrackPlay:p,onPause:h,onEditMetadata:m})},Qb=({filteredTracksCount:e,hasSelection:t,onSelectAll:r,onClearSelection:n,onSelectAllInfo:o,onClearSelectionInfo:i})=>{g.useEffect(()=>{const l=c=>{const d=c.target;d.tagName.toLowerCase()==="input"||d.tagName.toLowerCase()==="textarea"||d.contentEditable==="true"||((c.ctrlKey||c.metaKey)&&c.key==="a"&&e>0&&(c.preventDefault(),r()),c.key==="Escape"&&t&&(c.preventDefault(),n()))};return window.addEventListener("keydown",l),()=>window.removeEventListener("keydown",l)},[e,t,r,n,o,i])},Vb=({selectedTracks:e,selectedCount:t,view:r,onFetchTracks:n,onClearSelection:o})=>{const{success:i,error:l,info:c}=Fe(),d=g.useCallback(async()=>{try{const h=Array.from(e);for(const m of h)await fetch("/api/player/queue/add-track",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({track_id:m})});i(`Added ${t} tracks to queue`),o()}catch{l("Failed to add tracks to queue")}},[e,t,o,i,l]),u=g.useCallback(async()=>{c("Bulk add to playlist - Coming soon!")},[c]),f=g.useCallback(async()=>{if(confirm(`Remove ${t} tracks?`))try{if(r==="favourites"){for(const h of e)await fetch(`/api/library/tracks/${h}/favorite`,{method:"DELETE"});i(`Removed ${t} tracks from favorites`)}else c("Bulk delete from library requires API implementation");o(),await n()}catch{l("Failed to remove tracks")}},[e,t,r,o,n,i,l,c]),p=g.useCallback(async()=>{try{for(const h of e)await fetch(`/api/library/tracks/${h}/favorite`,{method:"POST"});i(`Toggled favorite for ${t} tracks`),o(),await n()}catch{l("Failed to toggle favorites")}},[e,t,o,n,i,l]);return{handleBulkAddToQueue:d,handleBulkAddToPlaylist:u,handleBulkRemove:f,handleBulkToggleFavorite:p}},Kb=({view:e})=>{const[t,r]=g.useState(null),[n,o]=g.useState(null),[i,l]=g.useState("");g.useEffect(()=>{r(null),o(null),l("")},[e]);const c=g.useCallback(()=>{r(null)},[]),d=g.useCallback(()=>{o(null),l("")},[]),u=g.useCallback(p=>{r(p)},[]),f=g.useCallback((p,h)=>{o(p),l(h)},[]);return{selectedAlbumId:t,selectedArtistId:n,selectedArtistName:i,handleBackFromAlbum:c,handleBackFromArtist:d,handleAlbumClick:u,handleArtistClick:f}},Yb=e=>{const[t,r]=g.useState(!1),[n,o]=g.useState(null),{success:i}=Fe(),l=g.useCallback(u=>{o(u),r(!0)},[]),c=g.useCallback(()=>{r(!1),o(null)},[]),d=g.useCallback(async()=>{i("Metadata updated successfully"),await e()},[e,i]);return{editMetadataDialogOpen:t,editingTrackId:n,handleEditMetadata:l,handleCloseEditDialog:c,handleSaveMetadata:d}},Xb=e=>{const[t,r]=g.useState(void 0),[n,o]=g.useState(!1),{success:i}=Fe(),l=Ot(),c=g.useCallback(async u=>{try{await fetch("/api/player/queue",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({tracks:[u.id],start_index:0})}),l.send({type:"play_enhanced",data:{track_id:u.id,preset:"adaptive",intensity:1}}),console.log("[usePlaybackState] Sent play_enhanced message for track:",u.id),r(u.id),o(!0),i(`Now playing: ${u.title}`),e==null||e(u)}catch(f){console.error("Failed to play track:",f)}},[i,e,l]),d=g.useCallback(()=>{l.send({type:"pause_playback"}),o(!1)},[l]);return{currentTrackId:t,isPlaying:n,handlePlayTrack:c,handlePause:d}},$c=q.memo(({onTrackPlay:e,view:t="songs"})=>{const{tracks:r,loading:n,scanning:o,fetchTracks:i,handleScanFolder:l,hasMore:c,totalTracks:d,isLoadingMore:u,loadMore:f}=Cg({view:t,includeStats:!1}),[p,h]=g.useState(""),[m,y]=g.useState("grid"),b=g.useMemo(()=>p.trim()?r.filter(Er=>Er.title.toLowerCase().includes(p.toLowerCase())||Er.artist.toLowerCase().includes(p.toLowerCase())||Er.album.toLowerCase().includes(p.toLowerCase())):r,[p,r]),{selectedTracks:x,selectAll:S,clearSelection:v,selectedCount:k,hasSelection:C,isSelected:I,toggleTrack:E}=wg(b),{selectedAlbumId:$,selectedArtistId:F,selectedArtistName:O,handleBackFromAlbum:A,handleBackFromArtist:R,handleAlbumClick:U,handleArtistClick:L}=Kb({view:t}),{currentTrackId:ae,isPlaying:K,handlePlayTrack:Z,handlePause:T}=Xb(e),{editMetadataDialogOpen:N,editingTrackId:Q,handleCloseEditDialog:ee,handleSaveMetadata:re,handleEditMetadata:W}=Yb(i),{handleBulkAddToQueue:V,handleBulkAddToPlaylist:pe,handleBulkRemove:je,handleBulkToggleFavorite:ve}=Vb({selectedTracks:x,selectedCount:k,view:t,onFetchTracks:i,onClearSelection:v});return Qb({filteredTracksCount:b.length,hasSelection:C,onSelectAll:S,onClearSelection:v,onSelectAllInfo:()=>{},onClearSelectionInfo:()=>{}}),t==="albums"||t==="artists"||$!==null||F!==null?a.jsx(Uy,{view:t,selectedAlbumId:$,selectedArtistId:F,selectedArtistName:O,currentTrackId:ae,isPlaying:K,onBackFromAlbum:A,onBackFromArtist:R,onAlbumClick:U,onArtistClick:L,onTrackPlay:Z}):a.jsxs(a.Fragment,{children:[C&&a.jsx(ag,{selectedCount:k,onAddToQueue:V,onAddToPlaylist:pe,onRemove:je,onToggleFavorite:ve,onClearSelection:v,context:t==="favourites"?"favorites":"library"}),a.jsxs(At,{maxWidth:"xl",sx:{py:s.spacing.xl},children:[b.length===0&&!n?a.jsx(a.Fragment,{children:t==="favourites"?a.jsx(gt,{icon:"music",title:"No favorites yet",description:"Click the heart icon on tracks you love to add them to your favorites"}):p?a.jsx(Uf,{query:p}):a.jsx(Wf,{onScanFolder:l,onFolderDrop:l,scanning:o})}):a.jsx(qb,{tracks:b,viewMode:m,loading:n,hasMore:c,totalTracks:d,isLoadingMore:u,currentTrackId:ae,isPlaying:K,selectedTracks:x,isSelected:I,onToggleSelect:E,onTrackPlay:Z,onPause:T,onEditMetadata:W,onLoadMore:f}),Q&&a.jsx(vg,{open:N,trackId:Q,onClose:ee,onSave:re})]})]})});$c.displayName="CozyLibraryView";const Jb=({activeTab:e,onTabChange:t})=>a.jsx(P,{sx:{borderBottom:1,borderColor:"divider"},children:a.jsxs(gg,{value:e,onChange:t,children:[a.jsx(xt,{label:"Library"}),a.jsx(xt,{label:"Playback"}),a.jsx(xt,{label:"Audio"}),a.jsx(xt,{label:"Interface"}),a.jsx(xt,{label:"Enhancement"}),a.jsx(xt,{label:"Advanced"})]})}),Zb=({onClose:e})=>a.jsxs(xn,{children:[a.jsx(_,{variant:"h6",component:"span",children:"Settings"}),a.jsx(se,{onClick:e,sx:{color:"white"},children:a.jsx(pn,{})})]}),ex=j(tr)({padding:s.spacing.lg,minHeight:400}),tx=j(kr)({padding:s.spacing.md,borderTop:`1px solid ${D.ultraLight}`}),rx={background:`linear-gradient(45deg, ${s.colors.accent.primary}, ${s.colors.accent.secondary})`,"&:hover":{background:`linear-gradient(45deg, ${s.colors.accent.primary}, ${s.colors.accent.secondary})`}},nx=j(P)({flex:1}),ox=({scanFolders:e,onAddFolder:t,onRemoveFolder:r,onRescanFolder:n})=>a.jsxs(ue,{children:[a.jsx(Zt,{children:"Scan Folders"}),a.jsx(Pe,{children:"Folders to scan for music files. Use the native folder picker to select directories."}),a.jsxs(gn,{children:[e.length===0&&a.jsx(br,{sx:{px:0},children:a.jsx($t,{primary:"No folders added yet",secondary:"Click 'Add Folder' below to start building your library",primaryTypographyProps:{color:"text.secondary"}})}),e.map((o,i)=>a.jsxs(br,{sx:{px:0,py:1},children:[a.jsx(pu,{sx:{mr:2,color:s.colors.accent.primary}}),a.jsx($t,{primary:o,primaryTypographyProps:{fontSize:"0.9rem"}}),a.jsxs(hu,{children:[a.jsx(se,{onClick:()=>n(o),size:"sm",sx:{mr:1},tooltip:"Rescan this folder",children:a.jsx(fu,{fontSize:"small"})}),a.jsx(se,{onClick:()=>r(o),size:"sm",tooltip:"Remove this folder",sx:{color:s.colors.semantic.error},children:a.jsx(dn,{fontSize:"small"})})]})]},i))]}),a.jsx($e,{startIcon:a.jsx(_s,{}),onClick:t,variant:"secondary",sx:{borderColor:s.colors.accent.primary,color:s.colors.accent.primary,"&:hover":{borderColor:s.colors.accent.primary,backgroundColor:D.standard}},children:"Add Folder"})]}),sx=({autoScan:e,scanInterval:t,onSettingChange:r})=>a.jsxs(P,{children:[a.jsx(fe,{sx:{my:3}}),a.jsxs(ue,{children:[a.jsx(nt,{control:a.jsx(ot,{checked:e,onChange:n=>r("auto_scan",n.target.checked)}),label:"Auto-scan library"}),a.jsx(Pe,{children:"Automatically scan for new files at regular intervals"})]}),e&&a.jsxs(ue,{children:[a.jsx(Zt,{children:"Scan Interval (seconds)"}),a.jsx(Mt,{type:"number",fullWidth:!0,value:t,onChange:n=>r("scan_interval",parseInt(n.target.value)),inputProps:{min:60,max:86400}})]})]}),ax=({scanFolders:e,autoScan:t,scanInterval:r,onSettingChange:n,onAddFolder:o,onRemoveFolder:i,onRescanFolder:l})=>a.jsxs(P,{children:[a.jsx(ox,{scanFolders:e,onAddFolder:o,onRemoveFolder:i,onRescanFolder:l}),a.jsx(sx,{autoScan:t,scanInterval:r,onSettingChange:n})]}),ix=({gaplessEnabled:e,crossfadeEnabled:t,crossfadeDuration:r,replayGainEnabled:n,volume:o,onSettingChange:i})=>a.jsxs(P,{children:[a.jsxs(ue,{children:[a.jsx(nt,{control:a.jsx(ot,{checked:e,onChange:l=>i("gapless_enabled",l.target.checked)}),label:"Gapless playback"}),a.jsx(Pe,{children:"Eliminate silence between tracks for seamless listening"})]}),a.jsx(fe,{sx:{my:3}}),a.jsxs(ue,{children:[a.jsx(nt,{control:a.jsx(ot,{checked:t,onChange:l=>i("crossfade_enabled",l.target.checked)}),label:"Crossfade"}),a.jsx(Pe,{children:"Smoothly transition between tracks"})]}),t&&a.jsxs(ue,{children:[a.jsxs(Zt,{children:["Crossfade Duration: ",r.toFixed(1),"s"]}),a.jsx(ps,{value:r,onChange:(l,c)=>i("crossfade_duration",c),min:0,max:10,step:.5,valueLabelDisplay:"auto"})]}),a.jsx(fe,{sx:{my:3}}),a.jsxs(ue,{children:[a.jsx(nt,{control:a.jsx(ot,{checked:n,onChange:l=>i("replay_gain_enabled",l.target.checked)}),label:"Replay Gain"}),a.jsx(Pe,{children:"Normalize volume levels across tracks"})]}),a.jsx(fe,{sx:{my:3}}),a.jsxs(ue,{children:[a.jsxs(Zt,{children:["Default Volume: ",Math.round(o*100),"%"]}),a.jsx(ps,{value:o,onChange:(l,c)=>i("volume",c),min:0,max:1,step:.01,valueLabelDisplay:"auto",valueLabelFormat:l=>`${Math.round(l*100)}%`})]})]}),lx=({outputDevice:e,bitDepth:t,sampleRate:r,onSettingChange:n})=>a.jsxs(P,{children:[a.jsx(ue,{children:a.jsxs(Or,{fullWidth:!0,children:[a.jsx(Br,{children:"Output Device"}),a.jsx(Lr,{value:e,onChange:o=>n("output_device",o.target.value),label:"Output Device",children:a.jsx(ce,{value:"default",children:"Default"})})]})}),a.jsx(fe,{sx:{my:3}}),a.jsxs(ue,{children:[a.jsxs(Or,{fullWidth:!0,children:[a.jsx(Br,{children:"Bit Depth"}),a.jsxs(Lr,{value:t,onChange:o=>n("bit_depth",o.target.value),label:"Bit Depth",children:[a.jsx(ce,{value:16,children:"16-bit"}),a.jsx(ce,{value:24,children:"24-bit"}),a.jsx(ce,{value:32,children:"32-bit"})]})]}),a.jsx(Pe,{children:"Higher bit depth provides better dynamic range"})]}),a.jsx(fe,{sx:{my:3}}),a.jsxs(ue,{children:[a.jsxs(Or,{fullWidth:!0,children:[a.jsx(Br,{children:"Sample Rate"}),a.jsxs(Lr,{value:r,onChange:o=>n("sample_rate",o.target.value),label:"Sample Rate",children:[a.jsx(ce,{value:44100,children:"44.1 kHz (CD Quality)"}),a.jsx(ce,{value:48e3,children:"48 kHz (Studio)"}),a.jsx(ce,{value:96e3,children:"96 kHz (Hi-Res)"}),a.jsx(ce,{value:192e3,children:"192 kHz (Ultra Hi-Res)"})]})]}),a.jsx(Pe,{children:"Higher sample rates capture more audio detail"})]})]}),cx=({theme:e,showVisualizations:t,miniPlayerOnClose:r,onSettingChange:n})=>a.jsxs(P,{children:[a.jsx(ue,{children:a.jsxs(Or,{fullWidth:!0,children:[a.jsx(Br,{children:"Theme"}),a.jsxs(Lr,{value:e,onChange:o=>n("theme",o.target.value),label:"Theme",children:[a.jsx(ce,{value:"dark",children:"Dark"}),a.jsx(ce,{value:"light",children:"Light"})]})]})}),a.jsx(fe,{sx:{my:3}}),a.jsxs(ue,{children:[a.jsx(nt,{control:a.jsx(ot,{checked:t,onChange:o=>n("show_visualizations",o.target.checked)}),label:"Show visualizations"}),a.jsx(Pe,{children:"Display audio visualizations and waveforms"})]}),a.jsx(fe,{sx:{my:3}}),a.jsxs(ue,{children:[a.jsx(nt,{control:a.jsx(ot,{checked:r,onChange:o=>n("mini_player_on_close",o.target.checked)}),label:"Mini player on close"}),a.jsx(Pe,{children:"Show mini player when closing main window"})]})]}),dx=({defaultPreset:e,autoEnhance:t,enhancementIntensity:r,onSettingChange:n})=>a.jsxs(P,{children:[a.jsxs(ue,{children:[a.jsxs(Or,{fullWidth:!0,children:[a.jsx(Br,{children:"Default Preset"}),a.jsxs(Lr,{value:e,onChange:o=>n("default_preset",o.target.value),label:"Default Preset",children:[a.jsx(ce,{value:"adaptive",children:"Adaptive"}),a.jsx(ce,{value:"gentle",children:"Gentle"}),a.jsx(ce,{value:"warm",children:"Warm"}),a.jsx(ce,{value:"bright",children:"Bright"}),a.jsx(ce,{value:"punchy",children:"Punchy"})]})]}),a.jsx(Pe,{children:"Default audio enhancement preset for playback"})]}),a.jsx(fe,{sx:{my:3}}),a.jsxs(ue,{children:[a.jsx(nt,{control:a.jsx(ot,{checked:t,onChange:o=>n("auto_enhance",o.target.checked)}),label:"Auto-enhance playback"}),a.jsx(Pe,{children:"Automatically apply enhancement to all tracks"})]}),a.jsx(fe,{sx:{my:3}}),a.jsxs(ue,{children:[a.jsxs(Zt,{children:["Enhancement Intensity: ",Math.round(r*100),"%"]}),a.jsx(ps,{value:r,onChange:(o,i)=>n("enhancement_intensity",i),min:0,max:1,step:.1,valueLabelDisplay:"auto",valueLabelFormat:o=>`${Math.round(o*100)}%`}),a.jsx(Pe,{children:"Adjust the strength of audio enhancement"})]})]}),ux=({cacheSize:e,maxConcurrentScans:t,enableAnalytics:r,debugMode:n,onSettingChange:o})=>a.jsxs(P,{children:[a.jsxs(ue,{children:[a.jsx(Zt,{children:"Cache Size (MB)"}),a.jsx(Mt,{type:"number",fullWidth:!0,value:e,onChange:i=>o("cache_size",parseInt(i.target.value)),inputProps:{min:128,max:8192}}),a.jsx(Pe,{children:"Amount of disk space for processed audio cache"})]}),a.jsx(fe,{sx:{my:3}}),a.jsxs(ue,{children:[a.jsx(Zt,{children:"Max Concurrent Scans"}),a.jsx(Mt,{type:"number",fullWidth:!0,value:t,onChange:i=>o("max_concurrent_scans",parseInt(i.target.value)),inputProps:{min:1,max:16}}),a.jsx(Pe,{children:"Number of parallel threads for library scanning"})]}),a.jsx(fe,{sx:{my:3}}),a.jsxs(ue,{children:[a.jsx(nt,{control:a.jsx(ot,{checked:r,onChange:i=>o("enable_analytics",i.target.checked)}),label:"Enable analytics"}),a.jsx(Pe,{children:"Collect anonymous usage data to improve Auralis"})]}),a.jsx(fe,{sx:{my:3}}),a.jsxs(ue,{children:[a.jsx(nt,{control:a.jsx(ot,{checked:n,onChange:i=>o("debug_mode",i.target.checked)}),label:"Debug mode"}),a.jsx(Pe,{children:"Show detailed logging and diagnostic information"})]})]}),px=({activeTab:e,getValue:t,onSettingChange:r,onAddFolder:n,onRemoveFolder:o,onRescanFolder:i})=>a.jsxs(ex,{children:[e===0&&a.jsx(ax,{scanFolders:t("scan_folders"),autoScan:t("auto_scan"),scanInterval:t("scan_interval"),onSettingChange:r,onAddFolder:n,onRemoveFolder:o,onRescanFolder:i}),e===1&&a.jsx(ix,{gaplessEnabled:t("gapless_enabled"),crossfadeEnabled:t("crossfade_enabled"),crossfadeDuration:t("crossfade_duration"),replayGainEnabled:t("replay_gain_enabled"),volume:t("volume"),onSettingChange:r}),e===2&&a.jsx(lx,{outputDevice:t("output_device"),bitDepth:t("bit_depth"),sampleRate:t("sample_rate"),onSettingChange:r}),e===3&&a.jsx(cx,{theme:t("theme"),showVisualizations:t("show_visualizations"),miniPlayerOnClose:t("mini_player_on_close"),onSettingChange:r}),e===4&&a.jsx(dx,{defaultPreset:t("default_preset"),autoEnhance:t("auto_enhance"),enhancementIntensity:t("enhancement_intensity"),onSettingChange:r}),e===5&&a.jsx(ux,{cacheSize:t("cache_size"),maxConcurrentScans:t("max_concurrent_scans"),enableAnalytics:t("enable_analytics"),debugMode:t("debug_mode"),onSettingChange:r})]}),hx=({onReset:e,onCancel:t,onSave:r})=>a.jsxs(tx,{children:[a.jsx($e,{onClick:e,startIcon:a.jsx(gu,{}),variant:"danger",children:"Reset to Defaults"}),a.jsx(nx,{}),a.jsx($e,{onClick:t,variant:"ghost",children:"Cancel"}),a.jsx($e,{onClick:r,variant:"primary",sx:rx,children:"Save Changes"})]}),Sn=wo({list:ye.SETTINGS,update:ye.SETTINGS,custom:{reset:`${ye.SETTINGS}/reset`,addScanFolder:`${ye.SETTINGS}/scan-folders`,removeScanFolder:`${ye.SETTINGS}/scan-folders/delete`}});async function fx(){const e=await Sn.list();if(Array.isArray(e)&&e.length>0)return e[0];throw new Error("No settings found")}async function gx(e){return Sn.update(0,e)}async function mx(){return Sn.custom("reset","post",{})}async function yx(e){return Sn.custom("addScanFolder","post",{folder:e})}async function bx(e){return Sn.custom("removeScanFolder","post",{folder:e})}const Rr={getSettings:fx,updateSettings:gx,resetSettings:mx,addScanFolder:yx,removeScanFolder:bx},xx=({open:e,onSettingsChange:t})=>{const[r,n]=g.useState(null),[o,i]=g.useState(!0),[l,c]=g.useState({});g.useEffect(()=>{e&&d()},[e]);const d=g.useCallback(async()=>{i(!0);try{const S=await Rr.getSettings();n(S)}catch(S){console.error("Failed to load settings:",S)}finally{i(!1)}},[]),u=g.useCallback((S,v)=>{c(k=>({...k,[S]:v}))},[]),f=g.useCallback(async S=>{if(Object.keys(l).length===0){S();return}try{const v=await Rr.updateSettings(l);n(v.settings),c({}),t==null||t(v.settings),S()}catch(v){console.error("Failed to save settings:",v)}},[l,t]),p=g.useCallback(async()=>{if(window.confirm("Reset all settings to defaults?"))try{const S=await Rr.resetSettings();n(S.settings),c({}),t==null||t(S.settings)}catch(S){console.error("Failed to reset settings:",S)}},[t]),h=g.useCallback(async S=>{try{(await fetch("/api/library/scan",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({directory:S})})).ok&&console.log(`Scan started for: ${S}`)}catch(v){console.error("Failed to trigger scan:",v)}},[]),m=g.useCallback(async()=>{let S=null;if(window.electronAPI&&window.electronAPI.selectFolder)try{S=await window.electronAPI.selectFolder()}catch(v){console.error("Electron folder picker failed:",v)}if(S||(S=prompt("Enter folder path:")),!!S)try{const v=await Rr.addScanFolder(S);n(v.settings),t==null||t(v.settings),await h(S)}catch(v){console.error("Failed to add scan folder:",v)}},[h,t]),y=g.useCallback(async S=>{if(window.confirm(`Remove folder from library?

${S}

Note: Files will remain on disk.`))try{const v=await Rr.removeScanFolder(S);n(v.settings),t==null||t(v.settings)}catch(v){console.error("Failed to remove scan folder:",v)}},[t]),b=g.useCallback(async S=>{await h(S)},[h]),x=g.useCallback(S=>S in l?l[S]:r?r[S]:null,[r,l]);return{settings:r,loading:o,pendingChanges:l,handleSettingChange:u,handleSave:f,handleReset:p,handleAddScanFolder:m,handleRemoveScanFolder:y,handleRescanFolder:b,getValue:x}},Sx=({open:e,onClose:t,onSettingsChange:r})=>{const[n,o]=g.useState(0),{settings:i,handleSettingChange:l,handleSave:c,handleReset:d,handleAddScanFolder:u,handleRemoveScanFolder:f,handleRescanFolder:p,getValue:h}=xx({open:e,onSettingsChange:r});return i?a.jsxs(bn,{open:e,onClose:t,maxWidth:"md",fullWidth:!0,children:[a.jsx(Zb,{onClose:t}),a.jsx(Jb,{activeTab:n,onTabChange:(m,y)=>o(y)}),a.jsx(px,{activeTab:n,getValue:h,onSettingChange:l,onAddFolder:u,onRemoveFolder:f,onRescanFolder:p}),a.jsx(hx,{onReset:d,onCancel:t,onSave:()=>c(t)})]}):null};function vx(e){const t=[],r=typeof navigator<"u"&&navigator.platform.toUpperCase().indexOf("MAC")>=0;(e.ctrl||e.meta)&&t.push(r?"":"Ctrl"),e.shift&&t.push(r?"":"Shift"),e.alt&&t.push(r?"":"Alt");const o={" ":"Space",ArrowUp:"",ArrowDown:"",ArrowLeft:"",ArrowRight:"",Enter:"",Escape:"Esc",Delete:"Del"}[e.key]||e.key.toUpperCase();return t.push(o),t.join(r?"":"+")}const wx=(e,t)=>g.useMemo(()=>{const r={};return e.forEach(i=>{r[i.category]||(r[i.category]=[]),r[i.category].push(i)}),{groupedShortcuts:r,config:{categoryOrder:["Playback","Navigation","Library","Queue","Global"],categoryIcons:{Playback:"",Navigation:"",Library:"",Queue:"",Global:""}},formatFn:t||vx}},[e,t]),Cx=({onClose:e})=>a.jsxs(xn,{children:[a.jsx(il,{}),a.jsx(_,{variant:"h6",component:"div",sx:{flex:1},children:"Keyboard Shortcuts"}),a.jsx(se,{onClick:e,sx:{color:s.colors.text.primary,"&:hover":{background:"rgba(102, 126, 234, 0.05)"}},children:a.jsx(pn,{})})]}),kx=j(st)(()=>({background:s.colors.bg.level3,border:`1px solid ${s.colors.border.light}`,borderRadius:s.borderRadius.lg,padding:s.spacing.md,marginBottom:s.spacing.md})),jx=j(P)(()=>({display:"flex",justifyContent:"space-between",alignItems:"center",padding:`${s.spacing.sm} 0`,borderBottom:`1px solid ${s.colors.bg.level3}`,"&:last-child":{borderBottom:"none"}})),Px=j(P)(()=>({background:s.colors.bg.level2,border:`1px solid ${s.colors.border.heavy}`,borderRadius:s.borderRadius.sm,padding:`${s.spacing.sm} 12px`,fontFamily:s.typography.fontFamily.mono,fontSize:s.typography.fontSize.base,fontWeight:s.typography.fontWeight.bold,color:s.colors.accent.primary,minWidth:"80px",textAlign:"center",boxShadow:s.shadows.sm})),Ix=j(_)(()=>({color:s.colors.text.tertiary,fontSize:s.typography.fontSize.base})),Ex=j(_)(()=>({color:s.colors.accent.primary,fontWeight:s.typography.fontWeight.bold,fontSize:s.typography.fontSize.md,marginBottom:s.spacing.sm,display:"flex",alignItems:"center",gap:s.spacing.sm})),Ax=j(P)(()=>({textAlign:"center",padding:`40px ${s.spacing.md}`,color:s.colors.text.muted})),Dx={p:3},Rx=()=>a.jsxs(Ax,{children:[a.jsx(il,{sx:{fontSize:64,mb:2,opacity:.3}}),a.jsx(_,{variant:"h6",gutterBottom:!0,children:"No keyboard shortcuts configured"}),a.jsx(_,{variant:"body2",children:"Enable keyboard shortcuts in settings to see available shortcuts here."})]}),Tx=({categories:e,formatShortcut:t})=>a.jsxs(a.Fragment,{children:[e.map(r=>a.jsxs(kx,{elevation:0,children:[a.jsxs(Ex,{children:[a.jsx("span",{children:r.icon}),r.category]}),r.shortcuts.map((n,o)=>a.jsxs(jx,{children:[a.jsx(Ix,{children:n.description}),a.jsx(Px,{children:t(n)})]},o))]},r.category)),a.jsx(fe,{sx:{my:3,borderColor:D.ultraLight}}),a.jsx(P,{sx:{textAlign:"center",color:D.standard},children:a.jsxs(_,{variant:"body2",children:["Press ",a.jsx("strong",{children:"?"})," anytime to show this dialog"]})})]}),Mx=({open:e,shortcuts:t,onClose:r,formatShortcut:n})=>{const{groupedShortcuts:o,config:i,formatFn:l}=wx(t,n),c=i.categoryOrder.map(d=>({category:d,shortcuts:o[d]||[],icon:i.categoryIcons[d]})).filter(d=>d.shortcuts.length>0);return a.jsxs(bn,{open:e,onClose:r,maxWidth:"md",fullWidth:!0,children:[a.jsx(Cx,{onClose:r}),a.jsx(tr,{sx:Dx,children:t.length===0?a.jsx(Rx,{}):a.jsx(Tx,{categories:c,formatShortcut:l})})]})};var $x="Invariant failed";function Fx(e,t){throw new Error($x)}var Je=function(t){var r=t.top,n=t.right,o=t.bottom,i=t.left,l=n-i,c=o-r,d={top:r,right:n,bottom:o,left:i,width:l,height:c,x:i,y:r,center:{x:(n+i)/2,y:(o+r)/2}};return d},ta=function(t,r){return{top:t.top-r.top,left:t.left-r.left,bottom:t.bottom+r.bottom,right:t.right+r.right}},li=function(t,r){return{top:t.top+r.top,left:t.left+r.left,bottom:t.bottom-r.bottom,right:t.right-r.right}},_x=function(t,r){return{top:t.top+r.y,left:t.left+r.x,bottom:t.bottom+r.y,right:t.right+r.x}},No={top:0,right:0,bottom:0,left:0},ra=function(t){var r=t.borderBox,n=t.margin,o=n===void 0?No:n,i=t.border,l=i===void 0?No:i,c=t.padding,d=c===void 0?No:c,u=Je(ta(r,o)),f=Je(li(r,l)),p=Je(li(f,d));return{marginBox:u,borderBox:Je(r),paddingBox:f,contentBox:p,margin:o,border:l,padding:d}},Ne=function(t){var r=t.slice(0,-2),n=t.slice(-2);if(n!=="px")return 0;var o=Number(r);return isNaN(o)&&Fx(),o},Ox=function(){return{x:window.pageXOffset,y:window.pageYOffset}},Jn=function(t,r){var n=t.borderBox,o=t.border,i=t.margin,l=t.padding,c=_x(n,r);return ra({borderBox:c,border:o,margin:i,padding:l})},Zn=function(t,r){return r===void 0&&(r=Ox()),Jn(t,r)},Fc=function(t,r){var n={top:Ne(r.marginTop),right:Ne(r.marginRight),bottom:Ne(r.marginBottom),left:Ne(r.marginLeft)},o={top:Ne(r.paddingTop),right:Ne(r.paddingRight),bottom:Ne(r.paddingBottom),left:Ne(r.paddingLeft)},i={top:Ne(r.borderTopWidth),right:Ne(r.borderRightWidth),bottom:Ne(r.borderBottomWidth),left:Ne(r.borderLeftWidth)};return ra({borderBox:t,margin:n,padding:o,border:i})},_c=function(t){var r=t.getBoundingClientRect(),n=window.getComputedStyle(t);return Fc(r,n)},Kr=function(t){var r=[],n=null,o=function(){for(var l=arguments.length,c=new Array(l),d=0;d<l;d++)c[d]=arguments[d];r=c,!n&&(n=requestAnimationFrame(function(){n=null,t.apply(void 0,r)}))};return o.cancel=function(){n&&(cancelAnimationFrame(n),n=null)},o};function Oc(e,t){}Oc.bind(null,"warn");Oc.bind(null,"error");function Rt(){}function Bx(e,t){return{...e,...t}}function He(e,t,r){const n=t.map(o=>{const i=Bx(r,o.options);return e.addEventListener(o.eventName,o.fn,i),function(){e.removeEventListener(o.eventName,o.fn,i)}});return function(){n.forEach(i=>{i()})}}const Lx="Invariant failed";class eo extends Error{}eo.prototype.toString=function(){return this.message};function M(e,t){throw new eo(Lx)}class zx extends q.Component{constructor(...t){super(...t),this.callbacks=null,this.unbind=Rt,this.onWindowError=r=>{const n=this.getCallbacks();n.isDragging()&&n.tryAbort(),r.error instanceof eo&&r.preventDefault()},this.getCallbacks=()=>{if(!this.callbacks)throw new Error("Unable to find AppCallbacks in <ErrorBoundary/>");return this.callbacks},this.setCallbacks=r=>{this.callbacks=r}}componentDidMount(){this.unbind=He(window,[{eventName:"error",fn:this.onWindowError}])}componentDidCatch(t){if(t instanceof eo){this.setState({});return}throw t}componentWillUnmount(){this.unbind()}render(){return this.props.children(this.setCallbacks)}}const Nx=`
  Press space bar to start a drag.
  When dragging you can use the arrow keys to move the item around and escape to cancel.
  Some screen readers may require you to be in focus mode or to use your pass through key
`,to=e=>e+1,Wx=e=>`
  You have lifted an item in position ${to(e.source.index)}
`,Bc=(e,t)=>{const r=e.droppableId===t.droppableId,n=to(e.index),o=to(t.index);return r?`
      You have moved the item from position ${n}
      to position ${o}
    `:`
    You have moved the item from position ${n}
    in list ${e.droppableId}
    to list ${t.droppableId}
    in position ${o}
  `},Lc=(e,t,r)=>t.droppableId===r.droppableId?`
      The item ${e}
      has been combined with ${r.draggableId}`:`
      The item ${e}
      in list ${t.droppableId}
      has been combined with ${r.draggableId}
      in list ${r.droppableId}
    `,Ux=e=>{const t=e.destination;if(t)return Bc(e.source,t);const r=e.combine;return r?Lc(e.draggableId,e.source,r):"You are over an area that cannot be dropped on"},ci=e=>`
  The item has returned to its starting position
  of ${to(e.index)}
`,Hx=e=>{if(e.reason==="CANCEL")return`
      Movement cancelled.
      ${ci(e.source)}
    `;const t=e.destination,r=e.combine;return t?`
      You have dropped the item.
      ${Bc(e.source,t)}
    `:r?`
      You have dropped the item.
      ${Lc(e.draggableId,e.source,r)}
    `:`
    The item has been dropped while not over a drop area.
    ${ci(e.source)}
  `},Wn={dragHandleUsageInstructions:Nx,onDragStart:Wx,onDragUpdate:Ux,onDragEnd:Hx};function Gx(e,t){return!!(e===t||Number.isNaN(e)&&Number.isNaN(t))}function zc(e,t){if(e.length!==t.length)return!1;for(let r=0;r<e.length;r++)if(!Gx(e[r],t[r]))return!1;return!0}function J(e,t){const r=g.useState(()=>({inputs:t,result:e()}))[0],n=g.useRef(!0),o=g.useRef(r),l=n.current||!!(t&&o.current.inputs&&zc(t,o.current.inputs))?o.current:{inputs:t,result:e()};return g.useEffect(()=>{n.current=!1,o.current=l},[l]),l.result}function H(e,t){return J(()=>e,t)}const Se={x:0,y:0},Ce=(e,t)=>({x:e.x+t.x,y:e.y+t.y}),Oe=(e,t)=>({x:e.x-t.x,y:e.y-t.y}),Tt=(e,t)=>e.x===t.x&&e.y===t.y,jr=e=>({x:e.x!==0?-e.x:0,y:e.y!==0?-e.y:0}),er=(e,t,r=0)=>e==="x"?{x:t,y:r}:{x:r,y:t},Yr=(e,t)=>Math.sqrt((t.x-e.x)**2+(t.y-e.y)**2),di=(e,t)=>Math.min(...t.map(r=>Yr(e,r))),Nc=e=>t=>({x:e(t.x),y:e(t.y)});var qx=(e,t)=>{const r=Je({top:Math.max(t.top,e.top),right:Math.min(t.right,e.right),bottom:Math.min(t.bottom,e.bottom),left:Math.max(t.left,e.left)});return r.width<=0||r.height<=0?null:r};const vn=(e,t)=>({top:e.top+t.y,left:e.left+t.x,bottom:e.bottom+t.y,right:e.right+t.x}),ui=e=>[{x:e.left,y:e.top},{x:e.right,y:e.top},{x:e.left,y:e.bottom},{x:e.right,y:e.bottom}],Qx={top:0,right:0,bottom:0,left:0},Vx=(e,t)=>t?vn(e,t.scroll.diff.displacement):e,Kx=(e,t,r)=>r&&r.increasedBy?{...e,[t.end]:e[t.end]+r.increasedBy[t.line]}:e,Yx=(e,t)=>t&&t.shouldClipSubject?qx(t.pageMarginBox,e):Je(e);var vr=({page:e,withPlaceholder:t,axis:r,frame:n})=>{const o=Vx(e.marginBox,n),i=Kx(o,r,t),l=Yx(i,n);return{page:e,withPlaceholder:t,active:l}},na=(e,t)=>{e.frame||M();const r=e.frame,n=Oe(t,r.scroll.initial),o=jr(n),i={...r,scroll:{initial:r.scroll.initial,current:t,diff:{value:n,displacement:o},max:r.scroll.max}},l=vr({page:e.subject.page,withPlaceholder:e.subject.withPlaceholder,axis:e.axis,frame:i});return{...e,frame:i,subject:l}};function xe(e,t=zc){let r=null;function n(...o){if(r&&r.lastThis===this&&t(o,r.lastArgs))return r.lastResult;const i=e.apply(this,o);return r={lastResult:i,lastArgs:o,lastThis:this},i}return n.clear=function(){r=null},n}const Wc=xe(e=>e.reduce((t,r)=>(t[r.descriptor.id]=r,t),{})),Uc=xe(e=>e.reduce((t,r)=>(t[r.descriptor.id]=r,t),{})),jo=xe(e=>Object.values(e)),Xx=xe(e=>Object.values(e));var Pr=xe((e,t)=>Xx(t).filter(n=>e===n.descriptor.droppableId).sort((n,o)=>n.descriptor.index-o.descriptor.index));function oa(e){return e.at&&e.at.type==="REORDER"?e.at.destination:null}function Po(e){return e.at&&e.at.type==="COMBINE"?e.at.combine:null}var Io=xe((e,t)=>t.filter(r=>r.descriptor.id!==e.descriptor.id)),Jx=({isMovingForward:e,draggable:t,destination:r,insideDestination:n,previousImpact:o})=>{if(!r.isCombineEnabled||!oa(o))return null;function l(m){const y={type:"COMBINE",combine:{draggableId:m,droppableId:r.descriptor.id}};return{...o,at:y}}const c=o.displaced.all,d=c.length?c[0]:null;if(e)return d?l(d):null;const u=Io(t,n);if(!d){if(!u.length)return null;const m=u[u.length-1];return l(m.descriptor.id)}const f=u.findIndex(m=>m.descriptor.id===d);f===-1&&M();const p=f-1;if(p<0)return null;const h=u[p];return l(h.descriptor.id)},Ir=(e,t)=>e.descriptor.droppableId===t.descriptor.id;const Hc={point:Se,value:0},Xr={invisible:{},visible:{},all:[]},Zx={displaced:Xr,displacedBy:Hc,at:null};var Ge=(e,t)=>r=>e<=r&&r<=t,Gc=e=>{const t=Ge(e.top,e.bottom),r=Ge(e.left,e.right);return n=>{if(t(n.top)&&t(n.bottom)&&r(n.left)&&r(n.right))return!0;const i=t(n.top)||t(n.bottom),l=r(n.left)||r(n.right);if(i&&l)return!0;const d=n.top<e.top&&n.bottom>e.bottom,u=n.left<e.left&&n.right>e.right;return d&&u?!0:d&&l||u&&i}},e0=e=>{const t=Ge(e.top,e.bottom),r=Ge(e.left,e.right);return n=>t(n.top)&&t(n.bottom)&&r(n.left)&&r(n.right)};const sa={direction:"vertical",line:"y",crossAxisLine:"x",start:"top",end:"bottom",size:"height",crossAxisStart:"left",crossAxisEnd:"right",crossAxisSize:"width"},qc={direction:"horizontal",line:"x",crossAxisLine:"y",start:"left",end:"right",size:"width",crossAxisStart:"top",crossAxisEnd:"bottom",crossAxisSize:"height"};var t0=e=>t=>{const r=Ge(t.top,t.bottom),n=Ge(t.left,t.right);return o=>e===sa?r(o.top)&&r(o.bottom):n(o.left)&&n(o.right)};const r0=(e,t)=>{const r=t.frame?t.frame.scroll.diff.displacement:Se;return vn(e,r)},n0=(e,t,r)=>t.subject.active?r(t.subject.active)(e):!1,o0=(e,t,r)=>r(t)(e),aa=({target:e,destination:t,viewport:r,withDroppableDisplacement:n,isVisibleThroughFrameFn:o})=>{const i=n?r0(e,t):e;return n0(i,t,o)&&o0(i,r,o)},s0=e=>aa({...e,isVisibleThroughFrameFn:Gc}),Qc=e=>aa({...e,isVisibleThroughFrameFn:e0}),a0=e=>aa({...e,isVisibleThroughFrameFn:t0(e.destination.axis)}),i0=(e,t,r)=>{if(typeof r=="boolean")return r;if(!t)return!0;const{invisible:n,visible:o}=t;if(n[e])return!1;const i=o[e];return i?i.shouldAnimate:!0};function l0(e,t){const r=e.page.marginBox,n={top:t.point.y,right:0,bottom:0,left:t.point.x};return Je(ta(r,n))}function Jr({afterDragging:e,destination:t,displacedBy:r,viewport:n,forceShouldAnimate:o,last:i}){return e.reduce(function(c,d){const u=l0(d,r),f=d.descriptor.id;if(c.all.push(f),!s0({target:u,destination:t,viewport:n,withDroppableDisplacement:!0}))return c.invisible[d.descriptor.id]=!0,c;const h=i0(f,i,o),m={draggableId:f,shouldAnimate:h};return c.visible[f]=m,c},{all:[],visible:{},invisible:{}})}function c0(e,t){if(!e.length)return 0;const r=e[e.length-1].descriptor.index;return t.inHomeList?r:r+1}function pi({insideDestination:e,inHomeList:t,displacedBy:r,destination:n}){const o=c0(e,{inHomeList:t});return{displaced:Xr,displacedBy:r,at:{type:"REORDER",destination:{droppableId:n.descriptor.id,index:o}}}}function ro({draggable:e,insideDestination:t,destination:r,viewport:n,displacedBy:o,last:i,index:l,forceShouldAnimate:c}){const d=Ir(e,r);if(l==null)return pi({insideDestination:t,inHomeList:d,displacedBy:o,destination:r});const u=t.find(y=>y.descriptor.index===l);if(!u)return pi({insideDestination:t,inHomeList:d,displacedBy:o,destination:r});const f=Io(e,t),p=t.indexOf(u),h=f.slice(p);return{displaced:Jr({afterDragging:h,destination:r,displacedBy:o,last:i,viewport:n.frame,forceShouldAnimate:c}),displacedBy:o,at:{type:"REORDER",destination:{droppableId:r.descriptor.id,index:l}}}}function _t(e,t){return!!t.effected[e]}var d0=({isMovingForward:e,destination:t,draggables:r,combine:n,afterCritical:o})=>{if(!t.isCombineEnabled)return null;const i=n.draggableId,c=r[i].descriptor.index;return _t(i,o)?e?c:c-1:e?c+1:c},u0=({isMovingForward:e,isInHomeList:t,insideDestination:r,location:n})=>{if(!r.length)return null;const o=n.index,i=e?o+1:o-1,l=r[0].descriptor.index,c=r[r.length-1].descriptor.index,d=t?c:c+1;return i<l||i>d?null:i},p0=({isMovingForward:e,isInHomeList:t,draggable:r,draggables:n,destination:o,insideDestination:i,previousImpact:l,viewport:c,afterCritical:d})=>{const u=l.at;if(u||M(),u.type==="REORDER"){const p=u0({isMovingForward:e,isInHomeList:t,location:u.destination,insideDestination:i});return p==null?null:ro({draggable:r,insideDestination:i,destination:o,viewport:c,last:l.displaced,displacedBy:l.displacedBy,index:p})}const f=d0({isMovingForward:e,destination:o,displaced:l.displaced,draggables:n,combine:u.combine,afterCritical:d});return f==null?null:ro({draggable:r,insideDestination:i,destination:o,viewport:c,last:l.displaced,displacedBy:l.displacedBy,index:f})},h0=({displaced:e,afterCritical:t,combineWith:r,displacedBy:n})=>{const o=!!(e.visible[r]||e.invisible[r]);return _t(r,t)?o?Se:jr(n.point):o?n.point:Se},f0=({afterCritical:e,impact:t,draggables:r})=>{const n=Po(t);n||M();const o=n.draggableId,i=r[o].page.borderBox.center,l=h0({displaced:t.displaced,afterCritical:e,combineWith:o,displacedBy:t.displacedBy});return Ce(i,l)};const Vc=(e,t)=>t.margin[e.start]+t.borderBox[e.size]/2,g0=(e,t)=>t.margin[e.end]+t.borderBox[e.size]/2,ia=(e,t,r)=>t[e.crossAxisStart]+r.margin[e.crossAxisStart]+r.borderBox[e.crossAxisSize]/2,hi=({axis:e,moveRelativeTo:t,isMoving:r})=>er(e.line,t.marginBox[e.end]+Vc(e,r),ia(e,t.marginBox,r)),fi=({axis:e,moveRelativeTo:t,isMoving:r})=>er(e.line,t.marginBox[e.start]-g0(e,r),ia(e,t.marginBox,r)),m0=({axis:e,moveInto:t,isMoving:r})=>er(e.line,t.contentBox[e.start]+Vc(e,r),ia(e,t.contentBox,r));var y0=({impact:e,draggable:t,draggables:r,droppable:n,afterCritical:o})=>{const i=Pr(n.descriptor.id,r),l=t.page,c=n.axis;if(!i.length)return m0({axis:c,moveInto:n.page,isMoving:l});const{displaced:d,displacedBy:u}=e,f=d.all[0];if(f){const h=r[f];if(_t(f,o))return fi({axis:c,moveRelativeTo:h.page,isMoving:l});const m=Jn(h.page,u.point);return fi({axis:c,moveRelativeTo:m,isMoving:l})}const p=i[i.length-1];if(p.descriptor.id===t.descriptor.id)return l.borderBox.center;if(_t(p.descriptor.id,o)){const h=Jn(p.page,jr(o.displacedBy.point));return hi({axis:c,moveRelativeTo:h,isMoving:l})}return hi({axis:c,moveRelativeTo:p.page,isMoving:l})},ws=(e,t)=>{const r=e.frame;return r?Ce(t,r.scroll.diff.displacement):t};const b0=({impact:e,draggable:t,droppable:r,draggables:n,afterCritical:o})=>{const i=t.page.borderBox.center,l=e.at;return!r||!l?i:l.type==="REORDER"?y0({impact:e,draggable:t,draggables:n,droppable:r,afterCritical:o}):f0({impact:e,draggables:n,afterCritical:o})};var Eo=e=>{const t=b0(e),r=e.droppable;return r?ws(r,t):t},Kc=(e,t)=>{const r=Oe(t,e.scroll.initial),n=jr(r);return{frame:Je({top:t.y,bottom:t.y+e.frame.height,left:t.x,right:t.x+e.frame.width}),scroll:{initial:e.scroll.initial,max:e.scroll.max,current:t,diff:{value:r,displacement:n}}}};function gi(e,t){return e.map(r=>t[r])}function x0(e,t){for(let r=0;r<t.length;r++){const n=t[r].visible[e];if(n)return n}return null}var S0=({impact:e,viewport:t,destination:r,draggables:n,maxScrollChange:o})=>{const i=Kc(t,Ce(t.scroll.current,o)),l=r.frame?na(r,Ce(r.frame.scroll.current,o)):r,c=e.displaced,d=Jr({afterDragging:gi(c.all,n),destination:r,displacedBy:e.displacedBy,viewport:i.frame,last:c,forceShouldAnimate:!1}),u=Jr({afterDragging:gi(c.all,n),destination:l,displacedBy:e.displacedBy,viewport:t.frame,last:c,forceShouldAnimate:!1}),f={},p={},h=[c,d,u];return c.all.forEach(y=>{const b=x0(y,h);if(b){p[y]=b;return}f[y]=!0}),{...e,displaced:{all:c.all,invisible:f,visible:p}}},v0=(e,t)=>Ce(e.scroll.diff.displacement,t),la=({pageBorderBoxCenter:e,draggable:t,viewport:r})=>{const n=v0(r,e),o=Oe(n,t.page.borderBox.center);return Ce(t.client.borderBox.center,o)},Yc=({draggable:e,destination:t,newPageBorderBoxCenter:r,viewport:n,withDroppableDisplacement:o,onlyOnMainAxis:i=!1})=>{const l=Oe(r,e.page.borderBox.center),d={target:vn(e.page.borderBox,l),destination:t,withDroppableDisplacement:o,viewport:n};return i?a0(d):Qc(d)},w0=({isMovingForward:e,draggable:t,destination:r,draggables:n,previousImpact:o,viewport:i,previousPageBorderBoxCenter:l,previousClientSelection:c,afterCritical:d})=>{if(!r.isEnabled)return null;const u=Pr(r.descriptor.id,n),f=Ir(t,r),p=Jx({isMovingForward:e,draggable:t,destination:r,insideDestination:u,previousImpact:o})||p0({isMovingForward:e,isInHomeList:f,draggable:t,draggables:n,destination:r,insideDestination:u,previousImpact:o,viewport:i,afterCritical:d});if(!p)return null;const h=Eo({impact:p,draggable:t,droppable:r,draggables:n,afterCritical:d});if(Yc({draggable:t,destination:r,newPageBorderBoxCenter:h,viewport:i.frame,withDroppableDisplacement:!1,onlyOnMainAxis:!0}))return{clientSelection:la({pageBorderBoxCenter:h,draggable:t,viewport:i}),impact:p,scrollJumpRequest:null};const y=Oe(h,l),b=S0({impact:p,viewport:i,destination:r,draggables:n,maxScrollChange:y});return{clientSelection:c,impact:b,scrollJumpRequest:y}};const Ie=e=>{const t=e.subject.active;return t||M(),t};var C0=({isMovingForward:e,pageBorderBoxCenter:t,source:r,droppables:n,viewport:o})=>{const i=r.subject.active;if(!i)return null;const l=r.axis,c=Ge(i[l.start],i[l.end]),d=jo(n).filter(f=>f!==r).filter(f=>f.isEnabled).filter(f=>!!f.subject.active).filter(f=>Gc(o.frame)(Ie(f))).filter(f=>{const p=Ie(f);return e?i[l.crossAxisEnd]<p[l.crossAxisEnd]:p[l.crossAxisStart]<i[l.crossAxisStart]}).filter(f=>{const p=Ie(f),h=Ge(p[l.start],p[l.end]);return c(p[l.start])||c(p[l.end])||h(i[l.start])||h(i[l.end])}).sort((f,p)=>{const h=Ie(f)[l.crossAxisStart],m=Ie(p)[l.crossAxisStart];return e?h-m:m-h}).filter((f,p,h)=>Ie(f)[l.crossAxisStart]===Ie(h[0])[l.crossAxisStart]);if(!d.length)return null;if(d.length===1)return d[0];const u=d.filter(f=>Ge(Ie(f)[l.start],Ie(f)[l.end])(t[l.line]));return u.length===1?u[0]:u.length>1?u.sort((f,p)=>Ie(f)[l.start]-Ie(p)[l.start])[0]:d.sort((f,p)=>{const h=di(t,ui(Ie(f))),m=di(t,ui(Ie(p)));return h!==m?h-m:Ie(f)[l.start]-Ie(p)[l.start]})[0]};const mi=(e,t)=>{const r=e.page.borderBox.center;return _t(e.descriptor.id,t)?Oe(r,t.displacedBy.point):r},k0=(e,t)=>{const r=e.page.borderBox;return _t(e.descriptor.id,t)?vn(r,jr(t.displacedBy.point)):r};var j0=({pageBorderBoxCenter:e,viewport:t,destination:r,insideDestination:n,afterCritical:o})=>n.filter(l=>Qc({target:k0(l,o),destination:r,viewport:t.frame,withDroppableDisplacement:!0})).sort((l,c)=>{const d=Yr(e,ws(r,mi(l,o))),u=Yr(e,ws(r,mi(c,o)));return d<u?-1:u<d?1:l.descriptor.index-c.descriptor.index})[0]||null,wn=xe(function(t,r){const n=r[t.line];return{value:n,point:er(t.line,n)}});const P0=(e,t,r)=>{const n=e.axis;if(e.descriptor.mode==="virtual")return er(n.line,t[n.line]);const o=e.subject.page.contentBox[n.size],d=Pr(e.descriptor.id,r).reduce((u,f)=>u+f.client.marginBox[n.size],0)+t[n.line]-o;return d<=0?null:er(n.line,d)},Xc=(e,t)=>({...e,scroll:{...e.scroll,max:t}}),Jc=(e,t,r)=>{const n=e.frame;Ir(t,e)&&M(),e.subject.withPlaceholder&&M();const o=wn(e.axis,t.displaceBy).point,i=P0(e,o,r),l={placeholderSize:o,increasedBy:i,oldFrameMaxScroll:e.frame?e.frame.scroll.max:null};if(!n){const f=vr({page:e.subject.page,withPlaceholder:l,axis:e.axis,frame:e.frame});return{...e,subject:f}}const c=i?Ce(n.scroll.max,i):n.scroll.max,d=Xc(n,c),u=vr({page:e.subject.page,withPlaceholder:l,axis:e.axis,frame:d});return{...e,subject:u,frame:d}},I0=e=>{const t=e.subject.withPlaceholder;t||M();const r=e.frame;if(!r){const l=vr({page:e.subject.page,axis:e.axis,frame:null,withPlaceholder:null});return{...e,subject:l}}const n=t.oldFrameMaxScroll;n||M();const o=Xc(r,n),i=vr({page:e.subject.page,axis:e.axis,frame:o,withPlaceholder:null});return{...e,subject:i,frame:o}};var E0=({previousPageBorderBoxCenter:e,moveRelativeTo:t,insideDestination:r,draggable:n,draggables:o,destination:i,viewport:l,afterCritical:c})=>{if(!t){if(r.length)return null;const p={displaced:Xr,displacedBy:Hc,at:{type:"REORDER",destination:{droppableId:i.descriptor.id,index:0}}},h=Eo({impact:p,draggable:n,droppable:i,draggables:o,afterCritical:c}),m=Ir(n,i)?i:Jc(i,n,o);return Yc({draggable:n,destination:m,newPageBorderBoxCenter:h,viewport:l.frame,withDroppableDisplacement:!1,onlyOnMainAxis:!0})?p:null}const d=e[i.axis.line]<=t.page.borderBox.center[i.axis.line],u=(()=>{const p=t.descriptor.index;return t.descriptor.id===n.descriptor.id||d?p:p+1})(),f=wn(i.axis,n.displaceBy);return ro({draggable:n,insideDestination:r,destination:i,viewport:l,displacedBy:f,last:Xr,index:u})},A0=({isMovingForward:e,previousPageBorderBoxCenter:t,draggable:r,isOver:n,draggables:o,droppables:i,viewport:l,afterCritical:c})=>{const d=C0({isMovingForward:e,pageBorderBoxCenter:t,source:n,droppables:i,viewport:l});if(!d)return null;const u=Pr(d.descriptor.id,o),f=j0({pageBorderBoxCenter:t,viewport:l,destination:d,insideDestination:u,afterCritical:c}),p=E0({previousPageBorderBoxCenter:t,destination:d,draggable:r,draggables:o,moveRelativeTo:f,insideDestination:u,viewport:l,afterCritical:c});if(!p)return null;const h=Eo({impact:p,draggable:r,droppable:d,draggables:o,afterCritical:c});return{clientSelection:la({pageBorderBoxCenter:h,draggable:r,viewport:l}),impact:p,scrollJumpRequest:null}},Be=e=>{const t=e.at;return t?t.type==="REORDER"?t.destination.droppableId:t.combine.droppableId:null};const D0=(e,t)=>{const r=Be(e);return r?t[r]:null};var R0=({state:e,type:t})=>{const r=D0(e.impact,e.dimensions.droppables),n=!!r,o=e.dimensions.droppables[e.critical.droppable.id],i=r||o,l=i.axis.direction,c=l==="vertical"&&(t==="MOVE_UP"||t==="MOVE_DOWN")||l==="horizontal"&&(t==="MOVE_LEFT"||t==="MOVE_RIGHT");if(c&&!n)return null;const d=t==="MOVE_DOWN"||t==="MOVE_RIGHT",u=e.dimensions.draggables[e.critical.draggable.id],f=e.current.page.borderBoxCenter,{draggables:p,droppables:h}=e.dimensions;return c?w0({isMovingForward:d,previousPageBorderBoxCenter:f,draggable:u,destination:i,draggables:p,viewport:e.viewport,previousClientSelection:e.current.client.selection,previousImpact:e.impact,afterCritical:e.afterCritical}):A0({isMovingForward:d,previousPageBorderBoxCenter:f,draggable:u,isOver:i,draggables:p,droppables:h,viewport:e.viewport,afterCritical:e.afterCritical})};function Lt(e){return e.phase==="DRAGGING"||e.phase==="COLLECTING"}function Zc(e){const t=Ge(e.top,e.bottom),r=Ge(e.left,e.right);return function(o){return t(o.y)&&r(o.x)}}function T0(e,t){return e.left<t.right&&e.right>t.left&&e.top<t.bottom&&e.bottom>t.top}function M0({pageBorderBox:e,draggable:t,candidates:r}){const n=t.page.borderBox.center,o=r.map(i=>{const l=i.axis,c=er(i.axis.line,e.center[l.line],i.page.borderBox.center[l.crossAxisLine]);return{id:i.descriptor.id,distance:Yr(n,c)}}).sort((i,l)=>l.distance-i.distance);return o[0]?o[0].id:null}function $0({pageBorderBox:e,draggable:t,droppables:r}){const n=jo(r).filter(o=>{if(!o.isEnabled)return!1;const i=o.subject.active;if(!i||!T0(e,i))return!1;if(Zc(i)(e.center))return!0;const l=o.axis,c=i.center[l.crossAxisLine],d=e[l.crossAxisStart],u=e[l.crossAxisEnd],f=Ge(i[l.crossAxisStart],i[l.crossAxisEnd]),p=f(d),h=f(u);return!p&&!h?!0:p?d<c:u>c});return n.length?n.length===1?n[0].descriptor.id:M0({pageBorderBox:e,draggable:t,candidates:n}):null}const ed=(e,t)=>Je(vn(e,t));var F0=(e,t)=>{const r=e.frame;return r?ed(t,r.scroll.diff.value):t};function td({displaced:e,id:t}){return!!(e.visible[t]||e.invisible[t])}function _0({draggable:e,closest:t,inHomeList:r}){return t?r&&t.descriptor.index>e.descriptor.index?t.descriptor.index-1:t.descriptor.index:null}var O0=({pageBorderBoxWithDroppableScroll:e,draggable:t,destination:r,insideDestination:n,last:o,viewport:i,afterCritical:l})=>{const c=r.axis,d=wn(r.axis,t.displaceBy),u=d.value,f=e[c.start],p=e[c.end],m=Io(t,n).find(b=>{const x=b.descriptor.id,S=b.page.borderBox.center[c.line],v=_t(x,l),k=td({displaced:o,id:x});return v?k?p<=S:f<S-u:k?p<=S+u:f<S})||null,y=_0({draggable:t,closest:m,inHomeList:Ir(t,r)});return ro({draggable:t,insideDestination:n,destination:r,viewport:i,last:o,displacedBy:d,index:y})};const B0=4;var L0=({draggable:e,pageBorderBoxWithDroppableScroll:t,previousImpact:r,destination:n,insideDestination:o,afterCritical:i})=>{if(!n.isCombineEnabled)return null;const l=n.axis,c=wn(n.axis,e.displaceBy),d=c.value,u=t[l.start],f=t[l.end],h=Io(e,o).find(y=>{const b=y.descriptor.id,x=y.page.borderBox,v=x[l.size]/B0,k=_t(b,i),C=td({displaced:r.displaced,id:b});return k?C?f>x[l.start]+v&&f<x[l.end]-v:u>x[l.start]-d+v&&u<x[l.end]-d-v:C?f>x[l.start]+d+v&&f<x[l.end]+d-v:u>x[l.start]+v&&u<x[l.end]-v});return h?{displacedBy:c,displaced:r.displaced,at:{type:"COMBINE",combine:{draggableId:h.descriptor.id,droppableId:n.descriptor.id}}}:null},rd=({pageOffset:e,draggable:t,draggables:r,droppables:n,previousImpact:o,viewport:i,afterCritical:l})=>{const c=ed(t.page.borderBox,e),d=$0({pageBorderBox:c,draggable:t,droppables:n});if(!d)return Zx;const u=n[d],f=Pr(u.descriptor.id,r),p=F0(u,c);return L0({pageBorderBoxWithDroppableScroll:p,draggable:t,previousImpact:o,destination:u,insideDestination:f,afterCritical:l})||O0({pageBorderBoxWithDroppableScroll:p,draggable:t,destination:u,insideDestination:f,last:o.displaced,viewport:i,afterCritical:l})},ca=(e,t)=>({...e,[t.descriptor.id]:t});const z0=({previousImpact:e,impact:t,droppables:r})=>{const n=Be(e),o=Be(t);if(!n||n===o)return r;const i=r[n];if(!i.subject.withPlaceholder)return r;const l=I0(i);return ca(r,l)};var N0=({draggable:e,draggables:t,droppables:r,previousImpact:n,impact:o})=>{const i=z0({previousImpact:n,impact:o,droppables:r}),l=Be(o);if(!l)return i;const c=r[l];if(Ir(e,c)||c.subject.withPlaceholder)return i;const d=Jc(c,e,t);return ca(i,d)},zr=({state:e,clientSelection:t,dimensions:r,viewport:n,impact:o,scrollJumpRequest:i})=>{const l=n||e.viewport,c=r||e.dimensions,d=t||e.current.client.selection,u=Oe(d,e.initial.client.selection),f={offset:u,selection:d,borderBoxCenter:Ce(e.initial.client.borderBoxCenter,u)},p={selection:Ce(f.selection,l.scroll.current),borderBoxCenter:Ce(f.borderBoxCenter,l.scroll.current),offset:Ce(f.offset,l.scroll.diff.value)},h={client:f,page:p};if(e.phase==="COLLECTING")return{...e,dimensions:c,viewport:l,current:h};const m=c.draggables[e.critical.draggable.id],y=o||rd({pageOffset:p.offset,draggable:m,draggables:c.draggables,droppables:c.droppables,previousImpact:e.impact,viewport:l,afterCritical:e.afterCritical}),b=N0({draggable:m,impact:y,previousImpact:e.impact,draggables:c.draggables,droppables:c.droppables});return{...e,current:h,dimensions:{draggables:c.draggables,droppables:b},impact:y,viewport:l,scrollJumpRequest:i||null,forceShouldAnimate:i?!1:null}};function W0(e,t){return e.map(r=>t[r])}var nd=({impact:e,viewport:t,draggables:r,destination:n,forceShouldAnimate:o})=>{const i=e.displaced,l=W0(i.all,r),c=Jr({afterDragging:l,destination:n,displacedBy:e.displacedBy,viewport:t.frame,forceShouldAnimate:o,last:i});return{...e,displaced:c}},od=({impact:e,draggable:t,droppable:r,draggables:n,viewport:o,afterCritical:i})=>{const l=Eo({impact:e,draggable:t,draggables:n,droppable:r,afterCritical:i});return la({pageBorderBoxCenter:l,draggable:t,viewport:o})},sd=({state:e,dimensions:t,viewport:r})=>{e.movementMode!=="SNAP"&&M();const n=e.impact,o=r||e.viewport,i=t||e.dimensions,{draggables:l,droppables:c}=i,d=l[e.critical.draggable.id],u=Be(n);u||M();const f=c[u],p=nd({impact:n,viewport:o,destination:f,draggables:l}),h=od({impact:p,draggable:d,droppable:f,draggables:l,viewport:o,afterCritical:e.afterCritical});return zr({impact:p,clientSelection:h,state:e,dimensions:i,viewport:o})},U0=e=>({index:e.index,droppableId:e.droppableId}),ad=({draggable:e,home:t,draggables:r,viewport:n})=>{const o=wn(t.axis,e.displaceBy),i=Pr(t.descriptor.id,r),l=i.indexOf(e);l===-1&&M();const c=i.slice(l+1),d=c.reduce((h,m)=>(h[m.descriptor.id]=!0,h),{}),u={inVirtualList:t.descriptor.mode==="virtual",displacedBy:o,effected:d};return{impact:{displaced:Jr({afterDragging:c,destination:t,displacedBy:o,last:null,viewport:n.frame,forceShouldAnimate:!1}),displacedBy:o,at:{type:"REORDER",destination:U0(e.descriptor)}},afterCritical:u}},H0=(e,t)=>({draggables:e.draggables,droppables:ca(e.droppables,t)}),G0=({draggable:e,offset:t,initialWindowScroll:r})=>{const n=Jn(e.client,t),o=Zn(n,r);return{...e,placeholder:{...e.placeholder,client:n},client:n,page:o}},q0=e=>{const t=e.frame;return t||M(),t},Q0=({additions:e,updatedDroppables:t,viewport:r})=>{const n=r.scroll.diff.value;return e.map(o=>{const i=o.descriptor.droppableId,l=t[i],d=q0(l).scroll.diff.value,u=Ce(n,d);return G0({draggable:o,offset:u,initialWindowScroll:r.scroll.initial})})},V0=({state:e,published:t})=>{const r=t.modified.map(S=>{const v=e.dimensions.droppables[S.droppableId];return na(v,S.scroll)}),n={...e.dimensions.droppables,...Wc(r)},o=Uc(Q0({additions:t.additions,updatedDroppables:n,viewport:e.viewport})),i={...e.dimensions.draggables,...o};t.removals.forEach(S=>{delete i[S]});const l={droppables:n,draggables:i},c=Be(e.impact),d=c?l.droppables[c]:null,u=l.draggables[e.critical.draggable.id],f=l.droppables[e.critical.droppable.id],{impact:p,afterCritical:h}=ad({draggable:u,home:f,draggables:i,viewport:e.viewport}),m=d&&d.isCombineEnabled?e.impact:p,y=rd({pageOffset:e.current.page.offset,draggable:l.draggables[e.critical.draggable.id],draggables:l.draggables,droppables:l.droppables,previousImpact:m,viewport:e.viewport,afterCritical:h}),b={...e,phase:"DRAGGING",impact:y,onLiftImpact:p,dimensions:l,afterCritical:h,forceShouldAnimate:!1};return e.phase==="COLLECTING"?b:{...b,phase:"DROP_PENDING",reason:e.reason,isWaiting:!1}};const Cs=e=>e.movementMode==="SNAP",Wo=(e,t,r)=>{const n=H0(e.dimensions,t);return!Cs(e)||r?zr({state:e,dimensions:n}):sd({state:e,dimensions:n})};function Uo(e){return e.isDragging&&e.movementMode==="SNAP"?{...e,scrollJumpRequest:null}:e}const yi={phase:"IDLE",completed:null,shouldFlush:!1};var K0=(e=yi,t)=>{if(t.type==="FLUSH")return{...yi,shouldFlush:!0};if(t.type==="INITIAL_PUBLISH"){e.phase!=="IDLE"&&M();const{critical:r,clientSelection:n,viewport:o,dimensions:i,movementMode:l}=t.payload,c=i.draggables[r.draggable.id],d=i.droppables[r.droppable.id],u={selection:n,borderBoxCenter:c.client.borderBox.center,offset:Se},f={client:u,page:{selection:Ce(u.selection,o.scroll.initial),borderBoxCenter:Ce(u.selection,o.scroll.initial),offset:Ce(u.selection,o.scroll.diff.value)}},p=jo(i.droppables).every(b=>!b.isFixedOnPage),{impact:h,afterCritical:m}=ad({draggable:c,home:d,draggables:i.draggables,viewport:o});return{phase:"DRAGGING",isDragging:!0,critical:r,movementMode:l,dimensions:i,initial:f,current:f,isWindowScrollAllowed:p,impact:h,afterCritical:m,onLiftImpact:h,viewport:o,scrollJumpRequest:null,forceShouldAnimate:null}}if(t.type==="COLLECTION_STARTING")return e.phase==="COLLECTING"||e.phase==="DROP_PENDING"?e:(e.phase!=="DRAGGING"&&M(),{...e,phase:"COLLECTING"});if(t.type==="PUBLISH_WHILE_DRAGGING")return e.phase==="COLLECTING"||e.phase==="DROP_PENDING"||M(),V0({state:e,published:t.payload});if(t.type==="MOVE"){if(e.phase==="DROP_PENDING")return e;Lt(e)||M();const{client:r}=t.payload;return Tt(r,e.current.client.selection)?e:zr({state:e,clientSelection:r,impact:Cs(e)?e.impact:null})}if(t.type==="UPDATE_DROPPABLE_SCROLL"){if(e.phase==="DROP_PENDING"||e.phase==="COLLECTING")return Uo(e);Lt(e)||M();const{id:r,newScroll:n}=t.payload,o=e.dimensions.droppables[r];if(!o)return e;const i=na(o,n);return Wo(e,i,!1)}if(t.type==="UPDATE_DROPPABLE_IS_ENABLED"){if(e.phase==="DROP_PENDING")return e;Lt(e)||M();const{id:r,isEnabled:n}=t.payload,o=e.dimensions.droppables[r];o||M(),o.isEnabled===n&&M();const i={...o,isEnabled:n};return Wo(e,i,!0)}if(t.type==="UPDATE_DROPPABLE_IS_COMBINE_ENABLED"){if(e.phase==="DROP_PENDING")return e;Lt(e)||M();const{id:r,isCombineEnabled:n}=t.payload,o=e.dimensions.droppables[r];o||M(),o.isCombineEnabled===n&&M();const i={...o,isCombineEnabled:n};return Wo(e,i,!0)}if(t.type==="MOVE_BY_WINDOW_SCROLL"){if(e.phase==="DROP_PENDING"||e.phase==="DROP_ANIMATING")return e;Lt(e)||M(),e.isWindowScrollAllowed||M();const r=t.payload.newScroll;if(Tt(e.viewport.scroll.current,r))return Uo(e);const n=Kc(e.viewport,r);return Cs(e)?sd({state:e,viewport:n}):zr({state:e,viewport:n})}if(t.type==="UPDATE_VIEWPORT_MAX_SCROLL"){if(!Lt(e))return e;const r=t.payload.maxScroll;if(Tt(r,e.viewport.scroll.max))return e;const n={...e.viewport,scroll:{...e.viewport.scroll,max:r}};return{...e,viewport:n}}if(t.type==="MOVE_UP"||t.type==="MOVE_DOWN"||t.type==="MOVE_LEFT"||t.type==="MOVE_RIGHT"){if(e.phase==="COLLECTING"||e.phase==="DROP_PENDING")return e;e.phase!=="DRAGGING"&&M();const r=R0({state:e,type:t.type});return r?zr({state:e,impact:r.impact,clientSelection:r.clientSelection,scrollJumpRequest:r.scrollJumpRequest}):e}if(t.type==="DROP_PENDING"){const r=t.payload.reason;return e.phase!=="COLLECTING"&&M(),{...e,phase:"DROP_PENDING",isWaiting:!0,reason:r}}if(t.type==="DROP_ANIMATE"){const{completed:r,dropDuration:n,newHomeClientOffset:o}=t.payload;return e.phase==="DRAGGING"||e.phase==="DROP_PENDING"||M(),{phase:"DROP_ANIMATING",completed:r,dropDuration:n,newHomeClientOffset:o,dimensions:e.dimensions}}if(t.type==="DROP_COMPLETE"){const{completed:r}=t.payload;return{phase:"IDLE",completed:r,shouldFlush:!1}}return e};function ne(e,t){return e instanceof Object&&"type"in e&&e.type===t}const Y0=e=>({type:"BEFORE_INITIAL_CAPTURE",payload:e}),X0=e=>({type:"LIFT",payload:e}),J0=e=>({type:"INITIAL_PUBLISH",payload:e}),Z0=e=>({type:"PUBLISH_WHILE_DRAGGING",payload:e}),eS=()=>({type:"COLLECTION_STARTING",payload:null}),tS=e=>({type:"UPDATE_DROPPABLE_SCROLL",payload:e}),rS=e=>({type:"UPDATE_DROPPABLE_IS_ENABLED",payload:e}),nS=e=>({type:"UPDATE_DROPPABLE_IS_COMBINE_ENABLED",payload:e}),id=e=>({type:"MOVE",payload:e}),oS=e=>({type:"MOVE_BY_WINDOW_SCROLL",payload:e}),sS=e=>({type:"UPDATE_VIEWPORT_MAX_SCROLL",payload:e}),aS=()=>({type:"MOVE_UP",payload:null}),iS=()=>({type:"MOVE_DOWN",payload:null}),lS=()=>({type:"MOVE_RIGHT",payload:null}),cS=()=>({type:"MOVE_LEFT",payload:null}),da=()=>({type:"FLUSH",payload:null}),dS=e=>({type:"DROP_ANIMATE",payload:e}),ua=e=>({type:"DROP_COMPLETE",payload:e}),ld=e=>({type:"DROP",payload:e}),uS=e=>({type:"DROP_PENDING",payload:e}),cd=()=>({type:"DROP_ANIMATION_FINISHED",payload:null});var pS=e=>({getState:t,dispatch:r})=>n=>o=>{if(!ne(o,"LIFT")){n(o);return}const{id:i,clientSelection:l,movementMode:c}=o.payload,d=t();d.phase==="DROP_ANIMATING"&&r(ua({completed:d.completed})),t().phase!=="IDLE"&&M(),r(da()),r(Y0({draggableId:i,movementMode:c}));const f={draggableId:i,scrollOptions:{shouldPublishImmediately:c==="SNAP"}},{critical:p,dimensions:h,viewport:m}=e.startPublishing(f);r(J0({critical:p,dimensions:h,clientSelection:l,movementMode:c,viewport:m}))},hS=e=>()=>t=>r=>{ne(r,"INITIAL_PUBLISH")&&e.dragging(),ne(r,"DROP_ANIMATE")&&e.dropping(r.payload.completed.result.reason),(ne(r,"FLUSH")||ne(r,"DROP_COMPLETE"))&&e.resting(),t(r)};const pa={outOfTheWay:"cubic-bezier(0.2, 0, 0, 1)",drop:"cubic-bezier(.2,1,.1,1)"},Zr={opacity:{drop:0,combining:.7},scale:{drop:.75}},dd={outOfTheWay:.2,minDropTime:.33,maxDropTime:.55},Bt=`${dd.outOfTheWay}s ${pa.outOfTheWay}`,Nr={fluid:`opacity ${Bt}`,snap:`transform ${Bt}, opacity ${Bt}`,drop:e=>{const t=`${e}s ${pa.drop}`;return`transform ${t}, opacity ${t}`},outOfTheWay:`transform ${Bt}`,placeholder:`height ${Bt}, width ${Bt}, margin ${Bt}`},bi=e=>Tt(e,Se)?void 0:`translate(${e.x}px, ${e.y}px)`,ks={moveTo:bi,drop:(e,t)=>{const r=bi(e);if(r)return t?`${r} scale(${Zr.scale.drop})`:r}},{minDropTime:js,maxDropTime:ud}=dd,fS=ud-js,xi=1500,gS=.6;var mS=({current:e,destination:t,reason:r})=>{const n=Yr(e,t);if(n<=0)return js;if(n>=xi)return ud;const o=n/xi,i=js+fS*o,l=r==="CANCEL"?i*gS:i;return Number(l.toFixed(2))},yS=({impact:e,draggable:t,dimensions:r,viewport:n,afterCritical:o})=>{const{draggables:i,droppables:l}=r,c=Be(e),d=c?l[c]:null,u=l[t.descriptor.droppableId],f=od({impact:e,draggable:t,draggables:i,afterCritical:o,droppable:d||u,viewport:n});return Oe(f,t.client.borderBox.center)},bS=({draggables:e,reason:t,lastImpact:r,home:n,viewport:o,onLiftImpact:i})=>!r.at||t!=="DROP"?{impact:nd({draggables:e,impact:i,destination:n,viewport:o,forceShouldAnimate:!0}),didDropInsideDroppable:!1}:r.at.type==="REORDER"?{impact:r,didDropInsideDroppable:!0}:{impact:{...r,displaced:Xr},didDropInsideDroppable:!0};const xS=({getState:e,dispatch:t})=>r=>n=>{if(!ne(n,"DROP")){r(n);return}const o=e(),i=n.payload.reason;if(o.phase==="COLLECTING"){t(uS({reason:i}));return}if(o.phase==="IDLE")return;o.phase==="DROP_PENDING"&&o.isWaiting&&M(),o.phase==="DRAGGING"||o.phase==="DROP_PENDING"||M();const c=o.critical,d=o.dimensions,u=d.draggables[o.critical.draggable.id],{impact:f,didDropInsideDroppable:p}=bS({reason:i,lastImpact:o.impact,afterCritical:o.afterCritical,onLiftImpact:o.onLiftImpact,home:o.dimensions.droppables[o.critical.droppable.id],viewport:o.viewport,draggables:o.dimensions.draggables}),h=p?oa(f):null,m=p?Po(f):null,y={index:c.draggable.index,droppableId:c.droppable.id},b={draggableId:u.descriptor.id,type:u.descriptor.type,source:y,reason:i,mode:o.movementMode,destination:h,combine:m},x=yS({impact:f,draggable:u,dimensions:d,viewport:o.viewport,afterCritical:o.afterCritical}),S={critical:o.critical,afterCritical:o.afterCritical,result:b,impact:f};if(!(!Tt(o.current.client.offset,x)||!!b.combine)){t(ua({completed:S}));return}const k=mS({current:o.current.client.offset,destination:x,reason:i});t(dS({newHomeClientOffset:x,dropDuration:k,completed:S}))};var pd=()=>({x:window.pageXOffset,y:window.pageYOffset});function SS(e){return{eventName:"scroll",options:{passive:!0,capture:!1},fn:t=>{t.target!==window&&t.target!==window.document||e()}}}function vS({onWindowScroll:e}){function t(){e(pd())}const r=Kr(t),n=SS(r);let o=Rt;function i(){return o!==Rt}function l(){i()&&M(),o=He(window,[n])}function c(){i()||M(),r.cancel(),o(),o=Rt}return{start:l,stop:c,isActive:i}}const wS=e=>ne(e,"DROP_COMPLETE")||ne(e,"DROP_ANIMATE")||ne(e,"FLUSH"),CS=e=>{const t=vS({onWindowScroll:r=>{e.dispatch(oS({newScroll:r}))}});return r=>n=>{!t.isActive()&&ne(n,"INITIAL_PUBLISH")&&t.start(),t.isActive()&&wS(n)&&t.stop(),r(n)}};var kS=e=>{let t=!1,r=!1;const n=setTimeout(()=>{r=!0}),o=i=>{t||r||(t=!0,e(i),clearTimeout(n))};return o.wasCalled=()=>t,o},jS=()=>{const e=[],t=o=>{const i=e.findIndex(c=>c.timerId===o);i===-1&&M();const[l]=e.splice(i,1);l.callback()};return{add:o=>{const i=setTimeout(()=>t(i)),l={timerId:i,callback:o};e.push(l)},flush:()=>{if(!e.length)return;const o=[...e];e.length=0,o.forEach(i=>{clearTimeout(i.timerId),i.callback()})}}};const PS=(e,t)=>e==null&&t==null?!0:e==null||t==null?!1:e.droppableId===t.droppableId&&e.index===t.index,IS=(e,t)=>e==null&&t==null?!0:e==null||t==null?!1:e.draggableId===t.draggableId&&e.droppableId===t.droppableId,ES=(e,t)=>{if(e===t)return!0;const r=e.draggable.id===t.draggable.id&&e.draggable.droppableId===t.draggable.droppableId&&e.draggable.type===t.draggable.type&&e.draggable.index===t.draggable.index,n=e.droppable.id===t.droppable.id&&e.droppable.type===t.droppable.type;return r&&n},Tr=(e,t)=>{t()},Tn=(e,t)=>({draggableId:e.draggable.id,type:e.droppable.type,source:{droppableId:e.droppable.id,index:e.draggable.index},mode:t});function Ho(e,t,r,n){if(!e){r(n(t));return}const o=kS(r);e(t,{announce:o}),o.wasCalled()||r(n(t))}var AS=(e,t)=>{const r=jS();let n=null;const o=(p,h)=>{n&&M(),Tr("onBeforeCapture",()=>{const m=e().onBeforeCapture;m&&m({draggableId:p,mode:h})})},i=(p,h)=>{n&&M(),Tr("onBeforeDragStart",()=>{const m=e().onBeforeDragStart;m&&m(Tn(p,h))})},l=(p,h)=>{n&&M();const m=Tn(p,h);n={mode:h,lastCritical:p,lastLocation:m.source,lastCombine:null},r.add(()=>{Tr("onDragStart",()=>Ho(e().onDragStart,m,t,Wn.onDragStart))})},c=(p,h)=>{const m=oa(h),y=Po(h);n||M();const b=!ES(p,n.lastCritical);b&&(n.lastCritical=p);const x=!PS(n.lastLocation,m);x&&(n.lastLocation=m);const S=!IS(n.lastCombine,y);if(S&&(n.lastCombine=y),!b&&!x&&!S)return;const v={...Tn(p,n.mode),combine:y,destination:m};r.add(()=>{Tr("onDragUpdate",()=>Ho(e().onDragUpdate,v,t,Wn.onDragUpdate))})},d=()=>{n||M(),r.flush()},u=p=>{n||M(),n=null,Tr("onDragEnd",()=>Ho(e().onDragEnd,p,t,Wn.onDragEnd))};return{beforeCapture:o,beforeStart:i,start:l,update:c,flush:d,drop:u,abort:()=>{if(!n)return;const p={...Tn(n.lastCritical,n.mode),combine:null,destination:null,reason:"CANCEL"};u(p)}}},DS=(e,t)=>{const r=AS(e,t);return n=>o=>i=>{if(ne(i,"BEFORE_INITIAL_CAPTURE")){r.beforeCapture(i.payload.draggableId,i.payload.movementMode);return}if(ne(i,"INITIAL_PUBLISH")){const c=i.payload.critical;r.beforeStart(c,i.payload.movementMode),o(i),r.start(c,i.payload.movementMode);return}if(ne(i,"DROP_COMPLETE")){const c=i.payload.completed.result;r.flush(),o(i),r.drop(c);return}if(o(i),ne(i,"FLUSH")){r.abort();return}const l=n.getState();l.phase==="DRAGGING"&&r.update(l.critical,l.impact)}};const RS=e=>t=>r=>{if(!ne(r,"DROP_ANIMATION_FINISHED")){t(r);return}const n=e.getState();n.phase!=="DROP_ANIMATING"&&M(),e.dispatch(ua({completed:n.completed}))},TS=e=>{let t=null,r=null;function n(){r&&(cancelAnimationFrame(r),r=null),t&&(t(),t=null)}return o=>i=>{if((ne(i,"FLUSH")||ne(i,"DROP_COMPLETE")||ne(i,"DROP_ANIMATION_FINISHED"))&&n(),o(i),!ne(i,"DROP_ANIMATE"))return;const l={eventName:"scroll",options:{capture:!0,passive:!1,once:!0},fn:function(){e.getState().phase==="DROP_ANIMATING"&&e.dispatch(cd())}};r=requestAnimationFrame(()=>{r=null,t=He(window,[l])})}};var MS=e=>()=>t=>r=>{(ne(r,"DROP_COMPLETE")||ne(r,"FLUSH")||ne(r,"DROP_ANIMATE"))&&e.stopPublishing(),t(r)},$S=e=>{let t=!1;return()=>r=>n=>{if(ne(n,"INITIAL_PUBLISH")){t=!0,e.tryRecordFocus(n.payload.critical.draggable.id),r(n),e.tryRestoreFocusRecorded();return}if(r(n),!!t){if(ne(n,"FLUSH")){t=!1,e.tryRestoreFocusRecorded();return}if(ne(n,"DROP_COMPLETE")){t=!1;const o=n.payload.completed.result;o.combine&&e.tryShiftRecord(o.draggableId,o.combine.draggableId),e.tryRestoreFocusRecorded()}}}};const FS=e=>ne(e,"DROP_COMPLETE")||ne(e,"DROP_ANIMATE")||ne(e,"FLUSH");var _S=e=>t=>r=>n=>{if(FS(n)){e.stop(),r(n);return}if(ne(n,"INITIAL_PUBLISH")){r(n);const o=t.getState();o.phase!=="DRAGGING"&&M(),e.start(o);return}r(n),e.scroll(t.getState())};const OS=e=>t=>r=>{if(t(r),!ne(r,"PUBLISH_WHILE_DRAGGING"))return;const n=e.getState();n.phase==="DROP_PENDING"&&(n.isWaiting||e.dispatch(ld({reason:n.reason})))},BS=Gr;var LS=({dimensionMarshal:e,focusMarshal:t,styleMarshal:r,getResponders:n,announce:o,autoScroller:i})=>Us(K0,BS(Tl(hS(r),MS(e),pS(e),xS,RS,TS,OS,_S(i),CS,$S(t),DS(n,o))));const Go=()=>({additions:{},removals:{},modified:{}});function zS({registry:e,callbacks:t}){let r=Go(),n=null;const o=()=>{n||(t.collectionStarting(),n=requestAnimationFrame(()=>{n=null;const{additions:d,removals:u,modified:f}=r,p=Object.keys(d).map(y=>e.draggable.getById(y).getDimension(Se)).sort((y,b)=>y.descriptor.index-b.descriptor.index),h=Object.keys(f).map(y=>{const x=e.droppable.getById(y).callbacks.getScrollWhileDragging();return{droppableId:y,scroll:x}}),m={additions:p,removals:Object.keys(u),modified:h};r=Go(),t.publish(m)}))};return{add:d=>{const u=d.descriptor.id;r.additions[u]=d,r.modified[d.descriptor.droppableId]=!0,r.removals[u]&&delete r.removals[u],o()},remove:d=>{const u=d.descriptor;r.removals[u.id]=!0,r.modified[u.droppableId]=!0,r.additions[u.id]&&delete r.additions[u.id],o()},stop:()=>{n&&(cancelAnimationFrame(n),n=null,r=Go())}}}var hd=({scrollHeight:e,scrollWidth:t,height:r,width:n})=>{const o=Oe({x:t,y:e},{x:n,y:r});return{x:Math.max(0,o.x),y:Math.max(0,o.y)}},fd=()=>{const e=document.documentElement;return e||M(),e},gd=()=>{const e=fd();return hd({scrollHeight:e.scrollHeight,scrollWidth:e.scrollWidth,width:e.clientWidth,height:e.clientHeight})},NS=()=>{const e=pd(),t=gd(),r=e.y,n=e.x,o=fd(),i=o.clientWidth,l=o.clientHeight,c=n+i,d=r+l;return{frame:Je({top:r,left:n,right:c,bottom:d}),scroll:{initial:e,current:e,max:t,diff:{value:Se,displacement:Se}}}},WS=({critical:e,scrollOptions:t,registry:r})=>{const n=NS(),o=n.scroll.current,i=e.droppable,l=r.droppable.getAllByType(i.type).map(f=>f.callbacks.getDimensionAndWatchScroll(o,t)),c=r.draggable.getAllByType(e.draggable.type).map(f=>f.getDimension(o));return{dimensions:{draggables:Uc(c),droppables:Wc(l)},critical:e,viewport:n}};function Si(e,t,r){return!(r.descriptor.id===t.id||r.descriptor.type!==t.type||e.droppable.getById(r.descriptor.droppableId).descriptor.mode!=="virtual")}var US=(e,t)=>{let r=null;const n=zS({callbacks:{publish:t.publishWhileDragging,collectionStarting:t.collectionStarting},registry:e}),o=(h,m)=>{e.droppable.exists(h)||M(),r&&t.updateDroppableIsEnabled({id:h,isEnabled:m})},i=(h,m)=>{r&&(e.droppable.exists(h)||M(),t.updateDroppableIsCombineEnabled({id:h,isCombineEnabled:m}))},l=(h,m)=>{r&&(e.droppable.exists(h)||M(),t.updateDroppableScroll({id:h,newScroll:m}))},c=(h,m)=>{r&&e.droppable.getById(h).callbacks.scroll(m)},d=()=>{if(!r)return;n.stop();const h=r.critical.droppable;e.droppable.getAllByType(h.type).forEach(m=>m.callbacks.dragStopped()),r.unsubscribe(),r=null},u=h=>{r||M();const m=r.critical.draggable;h.type==="ADDITION"&&Si(e,m,h.value)&&n.add(h.value),h.type==="REMOVAL"&&Si(e,m,h.value)&&n.remove(h.value)};return{updateDroppableIsEnabled:o,updateDroppableIsCombineEnabled:i,scrollDroppable:c,updateDroppableScroll:l,startPublishing:h=>{r&&M();const m=e.draggable.getById(h.draggableId),y=e.droppable.getById(m.descriptor.droppableId),b={draggable:m.descriptor,droppable:y.descriptor},x=e.subscribe(u);return r={critical:b,unsubscribe:x},WS({critical:b,registry:e,scrollOptions:h.scrollOptions})},stopPublishing:d}},md=(e,t)=>e.phase==="IDLE"?!0:e.phase!=="DROP_ANIMATING"||e.completed.result.draggableId===t?!1:e.completed.result.reason==="DROP",HS=e=>{window.scrollBy(e.x,e.y)};const GS=xe(e=>jo(e).filter(t=>!(!t.isEnabled||!t.frame))),qS=(e,t)=>GS(t).find(n=>(n.frame||M(),Zc(n.frame.pageMarginBox)(e)))||null;var QS=({center:e,destination:t,droppables:r})=>{if(t){const o=r[t];return o.frame?o:null}return qS(e,r)};const en={startFromPercentage:.25,maxScrollAtPercentage:.05,maxPixelScroll:28,ease:e=>e**2,durationDampening:{stopDampeningAt:1200,accelerateAt:360},disabled:!1};var VS=(e,t,r=()=>en)=>{const n=r(),o=e[t.size]*n.startFromPercentage,i=e[t.size]*n.maxScrollAtPercentage;return{startScrollingFrom:o,maxScrollValueAt:i}},yd=({startOfRange:e,endOfRange:t,current:r})=>{const n=t-e;return n===0?0:(r-e)/n},ha=1,KS=(e,t,r=()=>en)=>{const n=r();if(e>t.startScrollingFrom)return 0;if(e<=t.maxScrollValueAt)return n.maxPixelScroll;if(e===t.startScrollingFrom)return ha;const i=1-yd({startOfRange:t.maxScrollValueAt,endOfRange:t.startScrollingFrom,current:e}),l=n.maxPixelScroll*n.ease(i);return Math.ceil(l)},YS=(e,t,r)=>{const n=r(),o=n.durationDampening.accelerateAt,i=n.durationDampening.stopDampeningAt,l=t,c=i,u=Date.now()-l;if(u>=i)return e;if(u<o)return ha;const f=yd({startOfRange:o,endOfRange:c,current:u}),p=e*n.ease(f);return Math.ceil(p)},vi=({distanceToEdge:e,thresholds:t,dragStartTime:r,shouldUseTimeDampening:n,getAutoScrollerOptions:o})=>{const i=KS(e,t,o);return i===0?0:n?Math.max(YS(i,r,o),ha):i},wi=({container:e,distanceToEdges:t,dragStartTime:r,axis:n,shouldUseTimeDampening:o,getAutoScrollerOptions:i})=>{const l=VS(e,n,i);return t[n.end]<t[n.start]?vi({distanceToEdge:t[n.end],thresholds:l,dragStartTime:r,shouldUseTimeDampening:o,getAutoScrollerOptions:i}):-1*vi({distanceToEdge:t[n.start],thresholds:l,dragStartTime:r,shouldUseTimeDampening:o,getAutoScrollerOptions:i})},XS=({container:e,subject:t,proposedScroll:r})=>{const n=t.height>e.height,o=t.width>e.width;return!o&&!n?r:o&&n?null:{x:o?0:r.x,y:n?0:r.y}};const JS=Nc(e=>e===0?0:e);var bd=({dragStartTime:e,container:t,subject:r,center:n,shouldUseTimeDampening:o,getAutoScrollerOptions:i})=>{const l={top:n.y-t.top,right:t.right-n.x,bottom:t.bottom-n.y,left:n.x-t.left},c=wi({container:t,distanceToEdges:l,dragStartTime:e,axis:sa,shouldUseTimeDampening:o,getAutoScrollerOptions:i}),d=wi({container:t,distanceToEdges:l,dragStartTime:e,axis:qc,shouldUseTimeDampening:o,getAutoScrollerOptions:i}),u=JS({x:d,y:c});if(Tt(u,Se))return null;const f=XS({container:t,subject:r,proposedScroll:u});return f?Tt(f,Se)?null:f:null};const ZS=Nc(e=>e===0?0:e>0?1:-1),fa=(()=>{const e=(t,r)=>t<0?t:t>r?t-r:0;return({current:t,max:r,change:n})=>{const o=Ce(t,n),i={x:e(o.x,r.x),y:e(o.y,r.y)};return Tt(i,Se)?null:i}})(),xd=({max:e,current:t,change:r})=>{const n={x:Math.max(t.x,e.x),y:Math.max(t.y,e.y)},o=ZS(r),i=fa({max:n,current:t,change:o});return!i||o.x!==0&&i.x===0||o.y!==0&&i.y===0},ga=(e,t)=>xd({current:e.scroll.current,max:e.scroll.max,change:t}),ev=(e,t)=>{if(!ga(e,t))return null;const r=e.scroll.max,n=e.scroll.current;return fa({current:n,max:r,change:t})},ma=(e,t)=>{const r=e.frame;return r?xd({current:r.scroll.current,max:r.scroll.max,change:t}):!1},tv=(e,t)=>{const r=e.frame;return!r||!ma(e,t)?null:fa({current:r.scroll.current,max:r.scroll.max,change:t})};var rv=({viewport:e,subject:t,center:r,dragStartTime:n,shouldUseTimeDampening:o,getAutoScrollerOptions:i})=>{const l=bd({dragStartTime:n,container:e.frame,subject:t,center:r,shouldUseTimeDampening:o,getAutoScrollerOptions:i});return l&&ga(e,l)?l:null},nv=({droppable:e,subject:t,center:r,dragStartTime:n,shouldUseTimeDampening:o,getAutoScrollerOptions:i})=>{const l=e.frame;if(!l)return null;const c=bd({dragStartTime:n,container:l.pageMarginBox,subject:t,center:r,shouldUseTimeDampening:o,getAutoScrollerOptions:i});return c&&ma(e,c)?c:null},Ci=({state:e,dragStartTime:t,shouldUseTimeDampening:r,scrollWindow:n,scrollDroppable:o,getAutoScrollerOptions:i})=>{const l=e.current.page.borderBoxCenter,d=e.dimensions.draggables[e.critical.draggable.id].page.marginBox;if(e.isWindowScrollAllowed){const p=e.viewport,h=rv({dragStartTime:t,viewport:p,subject:d,center:l,shouldUseTimeDampening:r,getAutoScrollerOptions:i});if(h){n(h);return}}const u=QS({center:l,destination:Be(e.impact),droppables:e.dimensions.droppables});if(!u)return;const f=nv({dragStartTime:t,droppable:u,subject:d,center:l,shouldUseTimeDampening:r,getAutoScrollerOptions:i});f&&o(u.descriptor.id,f)},ov=({scrollWindow:e,scrollDroppable:t,getAutoScrollerOptions:r=()=>en})=>{const n=Kr(e),o=Kr(t);let i=null;const l=u=>{i||M();const{shouldUseTimeDampening:f,dragStartTime:p}=i;Ci({state:u,scrollWindow:n,scrollDroppable:o,dragStartTime:p,shouldUseTimeDampening:f,getAutoScrollerOptions:r})};return{start:u=>{i&&M();const f=Date.now();let p=!1;const h=()=>{p=!0};Ci({state:u,dragStartTime:0,shouldUseTimeDampening:!1,scrollWindow:h,scrollDroppable:h,getAutoScrollerOptions:r}),i={dragStartTime:f,shouldUseTimeDampening:p},p&&l(u)},stop:()=>{i&&(n.cancel(),o.cancel(),i=null)},scroll:l}},sv=({move:e,scrollDroppable:t,scrollWindow:r})=>{const n=(c,d)=>{const u=Ce(c.current.client.selection,d);e({client:u})},o=(c,d)=>{if(!ma(c,d))return d;const u=tv(c,d);if(!u)return t(c.descriptor.id,d),null;const f=Oe(d,u);return t(c.descriptor.id,f),Oe(d,f)},i=(c,d,u)=>{if(!c||!ga(d,u))return u;const f=ev(d,u);if(!f)return r(u),null;const p=Oe(u,f);return r(p),Oe(u,p)};return c=>{const d=c.scrollJumpRequest;if(!d)return;const u=Be(c.impact);u||M();const f=o(c.dimensions.droppables[u],d);if(!f)return;const p=c.viewport,h=i(c.isWindowScrollAllowed,p,f);h&&n(c,h)}},av=({scrollDroppable:e,scrollWindow:t,move:r,getAutoScrollerOptions:n})=>{const o=ov({scrollWindow:t,scrollDroppable:e,getAutoScrollerOptions:n}),i=sv({move:r,scrollWindow:t,scrollDroppable:e});return{scroll:d=>{if(!(n().disabled||d.phase!=="DRAGGING")){if(d.movementMode==="FLUID"){o.scroll(d);return}d.scrollJumpRequest&&i(d)}},start:o.start,stop:o.stop}};const wr="data-rfd",Cr=(()=>{const e=`${wr}-drag-handle`;return{base:e,draggableId:`${e}-draggable-id`,contextId:`${e}-context-id`}})(),Ps=(()=>{const e=`${wr}-draggable`;return{base:e,contextId:`${e}-context-id`,id:`${e}-id`}})(),iv=(()=>{const e=`${wr}-droppable`;return{base:e,contextId:`${e}-context-id`,id:`${e}-id`}})(),ki={contextId:`${wr}-scroll-container-context-id`},lv=e=>t=>`[${t}="${e}"]`,Mr=(e,t)=>e.map(r=>{const n=r.styles[t];return n?`${r.selector} { ${n} }`:""}).join(" "),cv="pointer-events: none;";var dv=e=>{const t=lv(e),r=(()=>{const c=`
      cursor: -webkit-grab;
      cursor: grab;
    `;return{selector:t(Cr.contextId),styles:{always:`
          -webkit-touch-callout: none;
          -webkit-tap-highlight-color: rgba(0,0,0,0);
          touch-action: manipulation;
        `,resting:c,dragging:cv,dropAnimating:c}}})(),n=(()=>{const c=`
      transition: ${Nr.outOfTheWay};
    `;return{selector:t(Ps.contextId),styles:{dragging:c,dropAnimating:c,userCancel:c}}})(),o={selector:t(iv.contextId),styles:{always:"overflow-anchor: none;"}},l=[n,r,o,{selector:"body",styles:{dragging:`
        cursor: grabbing;
        cursor: -webkit-grabbing;
        user-select: none;
        -webkit-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
        overflow-anchor: none;
      `}}];return{always:Mr(l,"always"),resting:Mr(l,"resting"),dragging:Mr(l,"dragging"),dropAnimating:Mr(l,"dropAnimating"),userCancel:Mr(l,"userCancel")}};const Le=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u"?g.useLayoutEffect:g.useEffect,qo=()=>{const e=document.querySelector("head");return e||M(),e},ji=e=>{const t=document.createElement("style");return e&&t.setAttribute("nonce",e),t.type="text/css",t};function uv(e,t){const r=J(()=>dv(e),[e]),n=g.useRef(null),o=g.useRef(null),i=H(xe(p=>{const h=o.current;h||M(),h.textContent=p}),[]),l=H(p=>{const h=n.current;h||M(),h.textContent=p},[]);Le(()=>{!n.current&&!o.current||M();const p=ji(t),h=ji(t);return n.current=p,o.current=h,p.setAttribute(`${wr}-always`,e),h.setAttribute(`${wr}-dynamic`,e),qo().appendChild(p),qo().appendChild(h),l(r.always),i(r.resting),()=>{const m=y=>{const b=y.current;b||M(),qo().removeChild(b),y.current=null};m(n),m(o)}},[t,l,i,r.always,r.resting,e]);const c=H(()=>i(r.dragging),[i,r.dragging]),d=H(p=>{if(p==="DROP"){i(r.dropAnimating);return}i(r.userCancel)},[i,r.dropAnimating,r.userCancel]),u=H(()=>{o.current&&i(r.resting)},[i,r.resting]);return J(()=>({dragging:c,dropping:d,resting:u}),[c,d,u])}function Sd(e,t){return Array.from(e.querySelectorAll(t))}var vd=e=>e&&e.ownerDocument&&e.ownerDocument.defaultView?e.ownerDocument.defaultView:window;function Ao(e){return e instanceof vd(e).HTMLElement}function pv(e,t){const r=`[${Cr.contextId}="${e}"]`,n=Sd(document,r);if(!n.length)return null;const o=n.find(i=>i.getAttribute(Cr.draggableId)===t);return!o||!Ao(o)?null:o}function hv(e){const t=g.useRef({}),r=g.useRef(null),n=g.useRef(null),o=g.useRef(!1),i=H(function(h,m){const y={id:h,focus:m};return t.current[h]=y,function(){const x=t.current;x[h]!==y&&delete x[h]}},[]),l=H(function(h){const m=pv(e,h);m&&m!==document.activeElement&&m.focus()},[e]),c=H(function(h,m){r.current===h&&(r.current=m)},[]),d=H(function(){n.current||o.current&&(n.current=requestAnimationFrame(()=>{n.current=null;const h=r.current;h&&l(h)}))},[l]),u=H(function(h){r.current=null;const m=document.activeElement;m&&m.getAttribute(Cr.draggableId)===h&&(r.current=h)},[]);return Le(()=>(o.current=!0,function(){o.current=!1;const h=n.current;h&&cancelAnimationFrame(h)}),[]),J(()=>({register:i,tryRecordFocus:u,tryRestoreFocusRecorded:d,tryShiftRecord:c}),[i,u,d,c])}function fv(){const e={draggables:{},droppables:{}},t=[];function r(p){return t.push(p),function(){const m=t.indexOf(p);m!==-1&&t.splice(m,1)}}function n(p){t.length&&t.forEach(h=>h(p))}function o(p){return e.draggables[p]||null}function i(p){const h=o(p);return h||M(),h}const l={register:p=>{e.draggables[p.descriptor.id]=p,n({type:"ADDITION",value:p})},update:(p,h)=>{const m=e.draggables[h.descriptor.id];m&&m.uniqueId===p.uniqueId&&(delete e.draggables[h.descriptor.id],e.draggables[p.descriptor.id]=p)},unregister:p=>{const h=p.descriptor.id,m=o(h);m&&p.uniqueId===m.uniqueId&&(delete e.draggables[h],e.droppables[p.descriptor.droppableId]&&n({type:"REMOVAL",value:p}))},getById:i,findById:o,exists:p=>!!o(p),getAllByType:p=>Object.values(e.draggables).filter(h=>h.descriptor.type===p)};function c(p){return e.droppables[p]||null}function d(p){const h=c(p);return h||M(),h}const u={register:p=>{e.droppables[p.descriptor.id]=p},unregister:p=>{const h=c(p.descriptor.id);h&&p.uniqueId===h.uniqueId&&delete e.droppables[p.descriptor.id]},getById:d,findById:c,exists:p=>!!c(p),getAllByType:p=>Object.values(e.droppables).filter(h=>h.descriptor.type===p)};function f(){e.draggables={},e.droppables={},t.length=0}return{draggable:l,droppable:u,subscribe:r,clean:f}}function gv(){const e=J(fv,[]);return g.useEffect(()=>function(){e.clean()},[e]),e}var ya=q.createContext(null),no=()=>{const e=document.body;return e||M(),e};const mv={position:"absolute",width:"1px",height:"1px",margin:"-1px",border:"0",padding:"0",overflow:"hidden",clip:"rect(0 0 0 0)","clip-path":"inset(100%)"},yv=e=>`rfd-announcement-${e}`;function bv(e){const t=J(()=>yv(e),[e]),r=g.useRef(null);return g.useEffect(function(){const i=document.createElement("div");return r.current=i,i.id=t,i.setAttribute("aria-live","assertive"),i.setAttribute("aria-atomic","true"),mu(i.style,mv),no().appendChild(i),function(){setTimeout(function(){const d=no();d.contains(i)&&d.removeChild(i),i===r.current&&(r.current=null)})}},[t]),H(o=>{const i=r.current;if(i){i.textContent=o;return}},[])}const xv={separator:"::"};function ba(e,t=xv){const r=q.useId();return J(()=>`${e}${t.separator}${r}`,[t.separator,e,r])}function Sv({contextId:e,uniqueId:t}){return`rfd-hidden-text-${e}-${t}`}function vv({contextId:e,text:t}){const r=ba("hidden-text",{separator:"-"}),n=J(()=>Sv({contextId:e,uniqueId:r}),[r,e]);return g.useEffect(function(){const i=document.createElement("div");return i.id=n,i.textContent=t,i.style.display="none",no().appendChild(i),function(){const c=no();c.contains(i)&&c.removeChild(i)}},[n,t]),n}var Do=q.createContext(null);function wd(e){const t=g.useRef(e);return g.useEffect(()=>{t.current=e}),t}function wv(){let e=null;function t(){return!!e}function r(l){return l===e}function n(l){e&&M();const c={abandon:l};return e=c,c}function o(){e||M(),e=null}function i(){e&&(e.abandon(),o())}return{isClaimed:t,isActive:r,claim:n,release:o,tryAbandon:i}}function tn(e){return e.phase==="IDLE"||e.phase==="DROP_ANIMATING"?!1:e.isDragging}const Cv=9,kv=13,xa=27,Cd=32,jv=33,Pv=34,Iv=35,Ev=36,Av=37,Dv=38,Rv=39,Tv=40,Mv={[kv]:!0,[Cv]:!0};var kd=e=>{Mv[e.keyCode]&&e.preventDefault()};const Ro=(()=>{const e="visibilitychange";return typeof document>"u"?e:[e,`ms${e}`,`webkit${e}`,`moz${e}`,`o${e}`].find(n=>`on${n}`in document)||e})(),jd=0,Pi=5;function $v(e,t){return Math.abs(t.x-e.x)>=Pi||Math.abs(t.y-e.y)>=Pi}const Ii={type:"IDLE"};function Fv({cancel:e,completed:t,getPhase:r,setPhase:n}){return[{eventName:"mousemove",fn:o=>{const{button:i,clientX:l,clientY:c}=o;if(i!==jd)return;const d={x:l,y:c},u=r();if(u.type==="DRAGGING"){o.preventDefault(),u.actions.move(d);return}u.type!=="PENDING"&&M();const f=u.point;if(!$v(f,d))return;o.preventDefault();const p=u.actions.fluidLift(d);n({type:"DRAGGING",actions:p})}},{eventName:"mouseup",fn:o=>{const i=r();if(i.type!=="DRAGGING"){e();return}o.preventDefault(),i.actions.drop({shouldBlockNextClick:!0}),t()}},{eventName:"mousedown",fn:o=>{r().type==="DRAGGING"&&o.preventDefault(),e()}},{eventName:"keydown",fn:o=>{if(r().type==="PENDING"){e();return}if(o.keyCode===xa){o.preventDefault(),e();return}kd(o)}},{eventName:"resize",fn:e},{eventName:"scroll",options:{passive:!0,capture:!1},fn:()=>{r().type==="PENDING"&&e()}},{eventName:"webkitmouseforcedown",fn:o=>{const i=r();if(i.type==="IDLE"&&M(),i.actions.shouldRespectForcePress()){e();return}o.preventDefault()}},{eventName:Ro,fn:e}]}function _v(e){const t=g.useRef(Ii),r=g.useRef(Rt),n=J(()=>({eventName:"mousedown",fn:function(p){if(p.defaultPrevented||p.button!==jd||p.ctrlKey||p.metaKey||p.shiftKey||p.altKey)return;const h=e.findClosestDraggableId(p);if(!h)return;const m=e.tryGetLock(h,l,{sourceEvent:p});if(!m)return;p.preventDefault();const y={x:p.clientX,y:p.clientY};r.current(),u(m,y)}}),[e]),o=J(()=>({eventName:"webkitmouseforcewillbegin",fn:f=>{if(f.defaultPrevented)return;const p=e.findClosestDraggableId(f);if(!p)return;const h=e.findOptionsForDraggable(p);h&&(h.shouldRespectForcePress||e.canGetLock(p)&&f.preventDefault())}}),[e]),i=H(function(){const p={passive:!1,capture:!0};r.current=He(window,[o,n],p)},[o,n]),l=H(()=>{t.current.type!=="IDLE"&&(t.current=Ii,r.current(),i())},[i]),c=H(()=>{const f=t.current;l(),f.type==="DRAGGING"&&f.actions.cancel({shouldBlockNextClick:!0}),f.type==="PENDING"&&f.actions.abort()},[l]),d=H(function(){const p={capture:!0,passive:!1},h=Fv({cancel:c,completed:l,getPhase:()=>t.current,setPhase:m=>{t.current=m}});r.current=He(window,h,p)},[c,l]),u=H(function(p,h){t.current.type!=="IDLE"&&M(),t.current={type:"PENDING",point:h,actions:p},d()},[d]);Le(function(){return i(),function(){r.current()}},[i])}function Ov(){}const Bv={[Pv]:!0,[jv]:!0,[Ev]:!0,[Iv]:!0};function Lv(e,t){function r(){t(),e.cancel()}function n(){t(),e.drop()}return[{eventName:"keydown",fn:o=>{if(o.keyCode===xa){o.preventDefault(),r();return}if(o.keyCode===Cd){o.preventDefault(),n();return}if(o.keyCode===Tv){o.preventDefault(),e.moveDown();return}if(o.keyCode===Dv){o.preventDefault(),e.moveUp();return}if(o.keyCode===Rv){o.preventDefault(),e.moveRight();return}if(o.keyCode===Av){o.preventDefault(),e.moveLeft();return}if(Bv[o.keyCode]){o.preventDefault();return}kd(o)}},{eventName:"mousedown",fn:r},{eventName:"mouseup",fn:r},{eventName:"click",fn:r},{eventName:"touchstart",fn:r},{eventName:"resize",fn:r},{eventName:"wheel",fn:r,options:{passive:!0}},{eventName:Ro,fn:r}]}function zv(e){const t=g.useRef(Ov),r=J(()=>({eventName:"keydown",fn:function(i){if(i.defaultPrevented||i.keyCode!==Cd)return;const l=e.findClosestDraggableId(i);if(!l)return;const c=e.tryGetLock(l,f,{sourceEvent:i});if(!c)return;i.preventDefault();let d=!0;const u=c.snapLift();t.current();function f(){d||M(),d=!1,t.current(),n()}t.current=He(window,Lv(u,f),{capture:!0,passive:!1})}}),[e]),n=H(function(){const i={passive:!1,capture:!0};t.current=He(window,[r],i)},[r]);Le(function(){return n(),function(){t.current()}},[n])}const Qo={type:"IDLE"},Nv=120,Wv=.15;function Uv({cancel:e,getPhase:t}){return[{eventName:"orientationchange",fn:e},{eventName:"resize",fn:e},{eventName:"contextmenu",fn:r=>{r.preventDefault()}},{eventName:"keydown",fn:r=>{if(t().type!=="DRAGGING"){e();return}r.keyCode===xa&&r.preventDefault(),e()}},{eventName:Ro,fn:e}]}function Hv({cancel:e,completed:t,getPhase:r}){return[{eventName:"touchmove",options:{capture:!1},fn:n=>{const o=r();if(o.type!=="DRAGGING"){e();return}o.hasMoved=!0;const{clientX:i,clientY:l}=n.touches[0],c={x:i,y:l};n.preventDefault(),o.actions.move(c)}},{eventName:"touchend",fn:n=>{const o=r();if(o.type!=="DRAGGING"){e();return}n.preventDefault(),o.actions.drop({shouldBlockNextClick:!0}),t()}},{eventName:"touchcancel",fn:n=>{if(r().type!=="DRAGGING"){e();return}n.preventDefault(),e()}},{eventName:"touchforcechange",fn:n=>{const o=r();o.type==="IDLE"&&M();const i=n.touches[0];if(!i||!(i.force>=Wv))return;const c=o.actions.shouldRespectForcePress();if(o.type==="PENDING"){c&&e();return}if(c){if(o.hasMoved){n.preventDefault();return}e();return}n.preventDefault()}},{eventName:Ro,fn:e}]}function Gv(e){const t=g.useRef(Qo),r=g.useRef(Rt),n=H(function(){return t.current},[]),o=H(function(m){t.current=m},[]),i=J(()=>({eventName:"touchstart",fn:function(m){if(m.defaultPrevented)return;const y=e.findClosestDraggableId(m);if(!y)return;const b=e.tryGetLock(y,c,{sourceEvent:m});if(!b)return;const x=m.touches[0],{clientX:S,clientY:v}=x,k={x:S,y:v};r.current(),p(b,k)}}),[e]),l=H(function(){const m={capture:!0,passive:!1};r.current=He(window,[i],m)},[i]),c=H(()=>{const h=t.current;h.type!=="IDLE"&&(h.type==="PENDING"&&clearTimeout(h.longPressTimerId),o(Qo),r.current(),l())},[l,o]),d=H(()=>{const h=t.current;c(),h.type==="DRAGGING"&&h.actions.cancel({shouldBlockNextClick:!0}),h.type==="PENDING"&&h.actions.abort()},[c]),u=H(function(){const m={capture:!0,passive:!1},y={cancel:d,completed:c,getPhase:n},b=He(window,Hv(y),m),x=He(window,Uv(y),m);r.current=function(){b(),x()}},[d,n,c]),f=H(function(){const m=n();m.type!=="PENDING"&&M();const y=m.actions.fluidLift(m.point);o({type:"DRAGGING",actions:y,hasMoved:!1})},[n,o]),p=H(function(m,y){n().type!=="IDLE"&&M();const b=setTimeout(f,Nv);o({type:"PENDING",point:y,actions:m,longPressTimerId:b}),u()},[u,n,o,f]);Le(function(){return l(),function(){r.current();const y=n();y.type==="PENDING"&&(clearTimeout(y.longPressTimerId),o(Qo))}},[n,l,o]),Le(function(){return He(window,[{eventName:"touchmove",fn:()=>{},options:{capture:!1,passive:!1}}])},[])}const qv=["input","button","textarea","select","option","optgroup","video","audio"];function Pd(e,t){if(t==null)return!1;if(qv.includes(t.tagName.toLowerCase()))return!0;const n=t.getAttribute("contenteditable");return n==="true"||n===""?!0:t===e?!1:Pd(e,t.parentElement)}function Qv(e,t){const r=t.target;return Ao(r)?Pd(e,r):!1}var Vv=e=>Je(e.getBoundingClientRect()).center;function Kv(e){return e instanceof vd(e).Element}const Yv=(()=>{const e="matches";return typeof document>"u"?e:[e,"msMatchesSelector","webkitMatchesSelector"].find(n=>n in Element.prototype)||e})();function Id(e,t){return e==null?null:e[Yv](t)?e:Id(e.parentElement,t)}function Xv(e,t){return e.closest?e.closest(t):Id(e,t)}function Jv(e){return`[${Cr.contextId}="${e}"]`}function Zv(e,t){const r=t.target;if(!Kv(r))return null;const n=Jv(e),o=Xv(r,n);return!o||!Ao(o)?null:o}function ew(e,t){const r=Zv(e,t);return r?r.getAttribute(Cr.draggableId):null}function tw(e,t){const r=`[${Ps.contextId}="${e}"]`,o=Sd(document,r).find(i=>i.getAttribute(Ps.id)===t);return!o||!Ao(o)?null:o}function rw(e){e.preventDefault()}function Mn({expected:e,phase:t,isLockActive:r,shouldWarn:n}){return!(!r()||e!==t)}function Ed({lockAPI:e,store:t,registry:r,draggableId:n}){if(e.isClaimed())return!1;const o=r.draggable.findById(n);return!(!o||!o.options.isEnabled||!md(t.getState(),n))}function nw({lockAPI:e,contextId:t,store:r,registry:n,draggableId:o,forceSensorStop:i,sourceEvent:l}){if(!Ed({lockAPI:e,store:r,registry:n,draggableId:o}))return null;const d=n.draggable.getById(o),u=tw(t,d.descriptor.id);if(!u||l&&!d.options.canDragInteractiveElements&&Qv(u,l))return null;const f=e.claim(i||Rt);let p="PRE_DRAG";function h(){return d.options.shouldRespectForcePress}function m(){return e.isActive(f)}function y(I,E){Mn({expected:I,phase:p,isLockActive:m,shouldWarn:!0})&&r.dispatch(E())}const b=y.bind(null,"DRAGGING");function x(I){function E(){e.release(),p="COMPLETED"}p!=="PRE_DRAG"&&(E(),M()),r.dispatch(X0(I.liftActionArgs)),p="DRAGGING";function $(F,O={shouldBlockNextClick:!1}){if(I.cleanup(),O.shouldBlockNextClick){const A=He(window,[{eventName:"click",fn:rw,options:{once:!0,passive:!1,capture:!0}}]);setTimeout(A)}E(),r.dispatch(ld({reason:F}))}return{isActive:()=>Mn({expected:"DRAGGING",phase:p,isLockActive:m,shouldWarn:!1}),shouldRespectForcePress:h,drop:F=>$("DROP",F),cancel:F=>$("CANCEL",F),...I.actions}}function S(I){const E=Kr(F=>{b(()=>id({client:F}))});return{...x({liftActionArgs:{id:o,clientSelection:I,movementMode:"FLUID"},cleanup:()=>E.cancel(),actions:{move:E}}),move:E}}function v(){const I={moveUp:()=>b(aS),moveRight:()=>b(lS),moveDown:()=>b(iS),moveLeft:()=>b(cS)};return x({liftActionArgs:{id:o,clientSelection:Vv(u),movementMode:"SNAP"},cleanup:Rt,actions:I})}function k(){Mn({expected:"PRE_DRAG",phase:p,isLockActive:m,shouldWarn:!0})&&e.release()}return{isActive:()=>Mn({expected:"PRE_DRAG",phase:p,isLockActive:m,shouldWarn:!1}),shouldRespectForcePress:h,fluidLift:S,snapLift:v,abort:k}}const ow=[_v,zv,Gv];function sw({contextId:e,store:t,registry:r,customSensors:n,enableDefaultSensors:o}){const i=[...o?ow:[],...n||[]],l=g.useState(()=>wv())[0],c=H(function(x,S){tn(x)&&!tn(S)&&l.tryAbandon()},[l]);Le(function(){let x=t.getState();return t.subscribe(()=>{const v=t.getState();c(x,v),x=v})},[l,t,c]),Le(()=>l.tryAbandon,[l.tryAbandon]);const d=H(b=>Ed({lockAPI:l,registry:r,store:t,draggableId:b}),[l,r,t]),u=H((b,x,S)=>nw({lockAPI:l,registry:r,contextId:e,store:t,draggableId:b,forceSensorStop:x||null,sourceEvent:S&&S.sourceEvent?S.sourceEvent:null}),[e,l,r,t]),f=H(b=>ew(e,b),[e]),p=H(b=>{const x=r.draggable.findById(b);return x?x.options:null},[r.draggable]),h=H(function(){l.isClaimed()&&(l.tryAbandon(),t.getState().phase!=="IDLE"&&t.dispatch(da()))},[l,t]),m=H(()=>l.isClaimed(),[l]),y=J(()=>({canGetLock:d,tryGetLock:u,findClosestDraggableId:f,findOptionsForDraggable:p,tryReleaseLock:h,isLockClaimed:m}),[d,u,f,p,h,m]);for(let b=0;b<i.length;b++)i[b](y)}const aw=e=>({onBeforeCapture:t=>{const r=()=>{e.onBeforeCapture&&e.onBeforeCapture(t)};dl.flushSync(r)},onBeforeDragStart:e.onBeforeDragStart,onDragStart:e.onDragStart,onDragEnd:e.onDragEnd,onDragUpdate:e.onDragUpdate}),iw=e=>({...en,...e.autoScrollerOptions,durationDampening:{...en.durationDampening,...e.autoScrollerOptions}});function $r(e){return e.current||M(),e.current}function lw(e){const{contextId:t,setCallbacks:r,sensors:n,nonce:o,dragHandleUsageInstructions:i}=e,l=g.useRef(null),c=wd(e),d=H(()=>aw(c.current),[c]),u=H(()=>iw(c.current),[c]),f=bv(t),p=vv({contextId:t,text:i}),h=uv(t,o),m=H(A=>{$r(l).dispatch(A)},[]),y=J(()=>_a({publishWhileDragging:Z0,updateDroppableScroll:tS,updateDroppableIsEnabled:rS,updateDroppableIsCombineEnabled:nS,collectionStarting:eS},m),[m]),b=gv(),x=J(()=>US(b,y),[b,y]),S=J(()=>av({scrollWindow:HS,scrollDroppable:x.scrollDroppable,getAutoScrollerOptions:u,..._a({move:id},m)}),[x.scrollDroppable,m,u]),v=hv(t),k=J(()=>LS({announce:f,autoScroller:S,dimensionMarshal:x,focusMarshal:v,getResponders:d,styleMarshal:h}),[f,S,x,v,d,h]);l.current=k;const C=H(()=>{const A=$r(l);A.getState().phase!=="IDLE"&&A.dispatch(da())},[]),I=H(()=>{const A=$r(l).getState();return A.phase==="DROP_ANIMATING"?!0:A.phase==="IDLE"?!1:A.isDragging},[]),E=J(()=>({isDragging:I,tryAbort:C}),[I,C]);r(E);const $=H(A=>md($r(l).getState(),A),[]),F=H(()=>Lt($r(l).getState()),[]),O=J(()=>({marshal:x,focus:v,contextId:t,canLift:$,isMovementAllowed:F,dragHandleUsageInstructionsId:p,registry:b}),[t,x,p,v,$,F,b]);return sw({contextId:t,store:k,registry:b,customSensors:n||null,enableDefaultSensors:e.enableDefaultSensors!==!1}),g.useEffect(()=>C,[C]),q.createElement(Do.Provider,{value:O},q.createElement(ll,{context:ya,store:k},e.children))}function cw(){return q.useId()}function dw(e){const t=cw(),r=e.dragHandleUsageInstructions||Wn.dragHandleUsageInstructions;return q.createElement(zx,null,n=>q.createElement(lw,{nonce:e.nonce,contextId:t,setCallbacks:n,dragHandleUsageInstructions:r,enableDefaultSensors:e.enableDefaultSensors,sensors:e.sensors,onBeforeCapture:e.onBeforeCapture,onBeforeDragStart:e.onBeforeDragStart,onDragStart:e.onDragStart,onDragUpdate:e.onDragUpdate,onDragEnd:e.onDragEnd,autoScrollerOptions:e.autoScrollerOptions},e.children))}const Ei={dragging:5e3,dropAnimating:4500},uw=(e,t)=>t?Nr.drop(t.duration):e?Nr.snap:Nr.fluid,pw=(e,t)=>{if(e)return t?Zr.opacity.drop:Zr.opacity.combining},hw=e=>e.forceShouldAnimate!=null?e.forceShouldAnimate:e.mode==="SNAP";function fw(e){const r=e.dimension.client,{offset:n,combineWith:o,dropping:i}=e,l=!!o,c=hw(e),d=!!i,u=d?ks.drop(n,l):ks.moveTo(n);return{position:"fixed",top:r.marginBox.top,left:r.marginBox.left,boxSizing:"border-box",width:r.borderBox.width,height:r.borderBox.height,transition:uw(c,i),transform:u,opacity:pw(l,d),zIndex:d?Ei.dropAnimating:Ei.dragging,pointerEvents:"none"}}function gw(e){return{transform:ks.moveTo(e.offset),transition:e.shouldAnimateDisplacement?void 0:"none"}}function mw(e){return e.type==="DRAGGING"?fw(e):gw(e)}function yw(e,t,r=Se){const n=window.getComputedStyle(t),o=t.getBoundingClientRect(),i=Fc(o,n),l=Zn(i,r),c={client:i,tagName:t.tagName.toLowerCase(),display:n.display},d={x:i.marginBox.width,y:i.marginBox.height};return{descriptor:e,placeholder:c,displaceBy:d,client:i,page:l}}function bw(e){const t=ba("draggable"),{descriptor:r,registry:n,getDraggableRef:o,canDragInteractiveElements:i,shouldRespectForcePress:l,isEnabled:c}=e,d=J(()=>({canDragInteractiveElements:i,shouldRespectForcePress:l,isEnabled:c}),[i,c,l]),u=H(m=>{const y=o();return y||M(),yw(r,y,m)},[r,o]),f=J(()=>({uniqueId:t,descriptor:r,options:d,getDimension:u}),[r,u,d,t]),p=g.useRef(f),h=g.useRef(!0);Le(()=>(n.draggable.register(p.current),()=>n.draggable.unregister(p.current)),[n.draggable]),Le(()=>{if(h.current){h.current=!1;return}const m=p.current;p.current=f,n.draggable.update(f,m)},[f,n.draggable])}var Sa=q.createContext(null);function oo(e){const t=g.useContext(e);return t||M(),t}function xw(e){e.preventDefault()}const Sw=e=>{const t=g.useRef(null),r=H((E=null)=>{t.current=E},[]),n=H(()=>t.current,[]),{contextId:o,dragHandleUsageInstructionsId:i,registry:l}=oo(Do),{type:c,droppableId:d}=oo(Sa),u=J(()=>({id:e.draggableId,index:e.index,type:c,droppableId:d}),[e.draggableId,e.index,c,d]),{children:f,draggableId:p,isEnabled:h,shouldRespectForcePress:m,canDragInteractiveElements:y,isClone:b,mapped:x,dropAnimationFinished:S}=e;if(!b){const E=J(()=>({descriptor:u,registry:l,getDraggableRef:n,canDragInteractiveElements:y,shouldRespectForcePress:m,isEnabled:h}),[u,l,n,y,m,h]);bw(E)}const v=J(()=>h?{tabIndex:0,role:"button","aria-describedby":i,"data-rfd-drag-handle-draggable-id":p,"data-rfd-drag-handle-context-id":o,draggable:!1,onDragStart:xw}:null,[o,i,p,h]),k=H(E=>{x.type==="DRAGGING"&&x.dropping&&E.propertyName==="transform"&&dl.flushSync(S)},[S,x]),C=J(()=>{const E=mw(x),$=x.type==="DRAGGING"&&x.dropping?k:void 0;return{innerRef:r,draggableProps:{"data-rfd-draggable-context-id":o,"data-rfd-draggable-id":p,style:E,onTransitionEnd:$},dragHandleProps:v}},[o,v,p,x,k,r]),I=J(()=>({draggableId:u.id,type:u.type,source:{index:u.index,droppableId:u.droppableId}}),[u.droppableId,u.id,u.index,u.type]);return q.createElement(q.Fragment,null,f(C,x.snapshot,I))};var Ad=(e,t)=>e===t,Dd=e=>{const{combine:t,destination:r}=e;return r?r.droppableId:t?t.droppableId:null};const vw=e=>e.combine?e.combine.draggableId:null,ww=e=>e.at&&e.at.type==="COMBINE"?e.at.combine.draggableId:null;function Cw(){const e=xe((o,i)=>({x:o,y:i})),t=xe((o,i,l=null,c=null,d=null)=>({isDragging:!0,isClone:i,isDropAnimating:!!d,dropAnimation:d,mode:o,draggingOver:l,combineWith:c,combineTargetFor:null})),r=xe((o,i,l,c,d=null,u=null,f=null)=>({mapped:{type:"DRAGGING",dropping:null,draggingOver:d,combineWith:u,mode:i,offset:o,dimension:l,forceShouldAnimate:f,snapshot:t(i,c,d,u,null)}}));return(o,i)=>{if(tn(o)){if(o.critical.draggable.id!==i.draggableId)return null;const l=o.current.client.offset,c=o.dimensions.draggables[i.draggableId],d=Be(o.impact),u=ww(o.impact),f=o.forceShouldAnimate;return r(e(l.x,l.y),o.movementMode,c,i.isClone,d,u,f)}if(o.phase==="DROP_ANIMATING"){const l=o.completed;if(l.result.draggableId!==i.draggableId)return null;const c=i.isClone,d=o.dimensions.draggables[i.draggableId],u=l.result,f=u.mode,p=Dd(u),h=vw(u),y={duration:o.dropDuration,curve:pa.drop,moveTo:o.newHomeClientOffset,opacity:h?Zr.opacity.drop:null,scale:h?Zr.scale.drop:null};return{mapped:{type:"DRAGGING",offset:o.newHomeClientOffset,dimension:d,dropping:y,draggingOver:p,combineWith:h,mode:f,forceShouldAnimate:null,snapshot:t(f,c,p,h,y)}}}return null}}function Rd(e=null){return{isDragging:!1,isDropAnimating:!1,isClone:!1,dropAnimation:null,mode:null,draggingOver:null,combineTargetFor:e,combineWith:null}}const kw={mapped:{type:"SECONDARY",offset:Se,combineTargetFor:null,shouldAnimateDisplacement:!0,snapshot:Rd(null)}};function jw(){const e=xe((l,c)=>({x:l,y:c})),t=xe(Rd),r=xe((l,c=null,d)=>({mapped:{type:"SECONDARY",offset:l,combineTargetFor:c,shouldAnimateDisplacement:d,snapshot:t(c)}})),n=l=>l?r(Se,l,!0):null,o=(l,c,d,u)=>{const f=d.displaced.visible[l],p=!!(u.inVirtualList&&u.effected[l]),h=Po(d),m=h&&h.draggableId===l?c:null;if(!f){if(!p)return n(m);if(d.displaced.invisible[l])return null;const x=jr(u.displacedBy.point),S=e(x.x,x.y);return r(S,m,!0)}if(p)return n(m);const y=d.displacedBy.point,b=e(y.x,y.y);return r(b,m,f.shouldAnimate)};return(l,c)=>{if(tn(l))return l.critical.draggable.id===c.draggableId?null:o(c.draggableId,l.critical.draggable.id,l.impact,l.afterCritical);if(l.phase==="DROP_ANIMATING"){const d=l.completed;return d.result.draggableId===c.draggableId?null:o(c.draggableId,d.result.draggableId,d.impact,d.afterCritical)}return null}}const Pw=()=>{const e=Cw(),t=jw();return(n,o)=>e(n,o)||t(n,o)||kw},Iw={dropAnimationFinished:cd},Ew=cl(Pw,Iw,null,{context:ya,areStatePropsEqual:Ad})(Sw);function Aw(e){return oo(Sa).isUsingCloneFor===e.draggableId&&!e.isClone?null:q.createElement(Ew,e)}const Td=e=>t=>e===t,Dw=Td("scroll"),Rw=Td("auto"),Ai=(e,t)=>t(e.overflowX)||t(e.overflowY),Tw=e=>{const t=window.getComputedStyle(e),r={overflowX:t.overflowX,overflowY:t.overflowY};return Ai(r,Dw)||Ai(r,Rw)},Mw=()=>!1,Md=e=>e==null?null:e===document.body?Mw()?e:null:e===document.documentElement?null:Tw(e)?e:Md(e.parentElement);var Is=e=>({x:e.scrollLeft,y:e.scrollTop});const $d=e=>e?window.getComputedStyle(e).position==="fixed"?!0:$d(e.parentElement):!1;var $w=e=>{const t=Md(e),r=$d(e);return{closestScrollable:t,isFixedOnPage:r}},Fw=({descriptor:e,isEnabled:t,isCombineEnabled:r,isFixedOnPage:n,direction:o,client:i,page:l,closest:c})=>{const d=(()=>{if(!c)return null;const{scrollSize:h,client:m}=c,y=hd({scrollHeight:h.scrollHeight,scrollWidth:h.scrollWidth,height:m.paddingBox.height,width:m.paddingBox.width});return{pageMarginBox:c.page.marginBox,frameClient:m,scrollSize:h,shouldClipSubject:c.shouldClipSubject,scroll:{initial:c.scroll,current:c.scroll,max:y,diff:{value:Se,displacement:Se}}}})(),u=o==="vertical"?sa:qc,f=vr({page:l,withPlaceholder:null,axis:u,frame:d});return{descriptor:e,isCombineEnabled:r,isFixedOnPage:n,axis:u,isEnabled:t,client:i,page:l,frame:d,subject:f}};const _w=(e,t)=>{const r=_c(e);if(!t||e!==t)return r;const n=r.paddingBox.top-t.scrollTop,o=r.paddingBox.left-t.scrollLeft,i=n+t.scrollHeight,l=o+t.scrollWidth,d=ta({top:n,right:l,bottom:i,left:o},r.border);return ra({borderBox:d,margin:r.margin,border:r.border,padding:r.padding})};var Ow=({ref:e,descriptor:t,env:r,windowScroll:n,direction:o,isDropDisabled:i,isCombineEnabled:l,shouldClipSubject:c})=>{const d=r.closestScrollable,u=_w(e,d),f=Zn(u,n),p=(()=>{if(!d)return null;const m=_c(d),y={scrollHeight:d.scrollHeight,scrollWidth:d.scrollWidth};return{client:m,page:Zn(m,n),scroll:Is(d),scrollSize:y,shouldClipSubject:c}})();return Fw({descriptor:t,isEnabled:!i,isCombineEnabled:l,isFixedOnPage:r.isFixedOnPage,direction:o,client:u,page:f,closest:p})};const Bw={passive:!1},Lw={passive:!0};var Di=e=>e.shouldPublishImmediately?Bw:Lw;const $n=e=>e&&e.env.closestScrollable||null;function zw(e){const t=g.useRef(null),r=oo(Do),n=ba("droppable"),{registry:o,marshal:i}=r,l=wd(e),c=J(()=>({id:e.droppableId,type:e.type,mode:e.mode}),[e.droppableId,e.mode,e.type]),d=g.useRef(c),u=J(()=>xe((C,I)=>{t.current||M();const E={x:C,y:I};i.updateDroppableScroll(c.id,E)}),[c.id,i]),f=H(()=>{const C=t.current;return!C||!C.env.closestScrollable?Se:Is(C.env.closestScrollable)},[]),p=H(()=>{const C=f();u(C.x,C.y)},[f,u]),h=J(()=>Kr(p),[p]),m=H(()=>{const C=t.current,I=$n(C);if(C&&I||M(),C.scrollOptions.shouldPublishImmediately){p();return}h()},[h,p]),y=H((C,I)=>{t.current&&M();const E=l.current,$=E.getDroppableRef();$||M();const F=$w($),O={ref:$,descriptor:c,env:F,scrollOptions:I};t.current=O;const A=Ow({ref:$,descriptor:c,env:F,windowScroll:C,direction:E.direction,isDropDisabled:E.isDropDisabled,isCombineEnabled:E.isCombineEnabled,shouldClipSubject:!E.ignoreContainerClipping}),R=F.closestScrollable;return R&&(R.setAttribute(ki.contextId,r.contextId),R.addEventListener("scroll",m,Di(O.scrollOptions))),A},[r.contextId,c,m,l]),b=H(()=>{const C=t.current,I=$n(C);return C&&I||M(),Is(I)},[]),x=H(()=>{const C=t.current;C||M();const I=$n(C);t.current=null,I&&(h.cancel(),I.removeAttribute(ki.contextId),I.removeEventListener("scroll",m,Di(C.scrollOptions)))},[m,h]),S=H(C=>{const I=t.current;I||M();const E=$n(I);E||M(),E.scrollTop+=C.y,E.scrollLeft+=C.x},[]),v=J(()=>({getDimensionAndWatchScroll:y,getScrollWhileDragging:b,dragStopped:x,scroll:S}),[x,y,b,S]),k=J(()=>({uniqueId:n,descriptor:c,callbacks:v}),[v,c,n]);Le(()=>(d.current=k.descriptor,o.droppable.register(k),()=>{t.current&&x(),o.droppable.unregister(k)}),[v,c,x,k,i,o.droppable]),Le(()=>{t.current&&i.updateDroppableIsEnabled(d.current.id,!e.isDropDisabled)},[e.isDropDisabled,i]),Le(()=>{t.current&&i.updateDroppableIsCombineEnabled(d.current.id,e.isCombineEnabled)},[e.isCombineEnabled,i])}function Vo(){}const Ri={width:0,height:0,margin:Qx},Nw=({isAnimatingOpenOnMount:e,placeholder:t,animate:r})=>e||r==="close"?Ri:{height:t.client.borderBox.height,width:t.client.borderBox.width,margin:t.client.margin},Ww=({isAnimatingOpenOnMount:e,placeholder:t,animate:r})=>{const n=Nw({isAnimatingOpenOnMount:e,placeholder:t,animate:r});return{display:t.display,boxSizing:"border-box",width:n.width,height:n.height,marginTop:n.margin.top,marginRight:n.margin.right,marginBottom:n.margin.bottom,marginLeft:n.margin.left,flexShrink:"0",flexGrow:"0",pointerEvents:"none",transition:r!=="none"?Nr.placeholder:null}},Uw=e=>{const t=g.useRef(null),r=H(()=>{t.current&&(clearTimeout(t.current),t.current=null)},[]),{animate:n,onTransitionEnd:o,onClose:i,contextId:l}=e,[c,d]=g.useState(e.animate==="open");g.useEffect(()=>c?n!=="open"?(r(),d(!1),Vo):t.current?Vo:(t.current=setTimeout(()=>{t.current=null,d(!1)}),r):Vo,[n,c,r]);const u=H(p=>{p.propertyName==="height"&&(o(),n==="close"&&i())},[n,i,o]),f=Ww({isAnimatingOpenOnMount:c,animate:e.animate,placeholder:e.placeholder});return q.createElement(e.placeholder.tagName,{style:f,"data-rfd-placeholder-context-id":l,onTransitionEnd:u,ref:e.innerRef})};var Hw=q.memo(Uw);class Gw extends q.PureComponent{constructor(...t){super(...t),this.state={isVisible:!!this.props.on,data:this.props.on,animate:this.props.shouldAnimate&&this.props.on?"open":"none"},this.onClose=()=>{this.state.animate==="close"&&this.setState({isVisible:!1})}}static getDerivedStateFromProps(t,r){return t.shouldAnimate?t.on?{isVisible:!0,data:t.on,animate:"open"}:r.isVisible?{isVisible:!0,data:r.data,animate:"close"}:{isVisible:!1,animate:"close",data:null}:{isVisible:!!t.on,data:t.on,animate:"none"}}render(){if(!this.state.isVisible)return null;const t={onClose:this.onClose,data:this.state.data,animate:this.state.animate};return this.props.children(t)}}const qw=e=>{const t=g.useContext(Do);t||M();const{contextId:r,isMovementAllowed:n}=t,o=g.useRef(null),i=g.useRef(null),{children:l,droppableId:c,type:d,mode:u,direction:f,ignoreContainerClipping:p,isDropDisabled:h,isCombineEnabled:m,snapshot:y,useClone:b,updateViewportMaxScroll:x,getContainerForClone:S}=e,v=H(()=>o.current,[]),k=H((R=null)=>{o.current=R},[]);H(()=>i.current,[]);const C=H((R=null)=>{i.current=R},[]),I=H(()=>{n()&&x({maxScroll:gd()})},[n,x]);zw({droppableId:c,type:d,mode:u,direction:f,isDropDisabled:h,isCombineEnabled:m,ignoreContainerClipping:p,getDroppableRef:v});const E=J(()=>q.createElement(Gw,{on:e.placeholder,shouldAnimate:e.shouldAnimatePlaceholder},({onClose:R,data:U,animate:L})=>q.createElement(Hw,{placeholder:U,onClose:R,innerRef:C,animate:L,contextId:r,onTransitionEnd:I})),[r,I,e.placeholder,e.shouldAnimatePlaceholder,C]),$=J(()=>({innerRef:k,placeholder:E,droppableProps:{"data-rfd-droppable-id":c,"data-rfd-droppable-context-id":r}}),[r,c,E,k]),F=b?b.dragging.draggableId:null,O=J(()=>({droppableId:c,type:d,isUsingCloneFor:F}),[c,F,d]);function A(){if(!b)return null;const{dragging:R,render:U}=b,L=q.createElement(Aw,{draggableId:R.draggableId,index:R.source.index,isClone:!0,isEnabled:!0,shouldRespectForcePress:!1,canDragInteractiveElements:!0},(ae,K)=>U(ae,K,R));return yu.createPortal(L,S())}return q.createElement(Sa.Provider,{value:O},l($,y),A())};function Qw(){return document.body||M(),document.body}const Ti={mode:"standard",type:"DEFAULT",direction:"vertical",isDropDisabled:!1,isCombineEnabled:!1,ignoreContainerClipping:!1,renderClone:null,getContainerForClone:Qw},Fd=e=>{let t={...e},r;for(r in Ti)e[r]===void 0&&(t={...t,[r]:Ti[r]});return t},Ko=(e,t)=>e===t.droppable.type,Mi=(e,t)=>t.draggables[e.draggable.id],Vw=()=>{const e={placeholder:null,shouldAnimatePlaceholder:!0,snapshot:{isDraggingOver:!1,draggingOverWith:null,draggingFromThisWith:null,isUsingPlaceholder:!1},useClone:null},t={...e,shouldAnimatePlaceholder:!1},r=xe(i=>({draggableId:i.id,type:i.type,source:{index:i.index,droppableId:i.droppableId}})),n=xe((i,l,c,d,u,f)=>{const p=u.descriptor.id;if(u.descriptor.droppableId===i){const y=f?{render:f,dragging:r(u.descriptor)}:null,b={isDraggingOver:c,draggingOverWith:c?p:null,draggingFromThisWith:p,isUsingPlaceholder:!0};return{placeholder:u.placeholder,shouldAnimatePlaceholder:!1,snapshot:b,useClone:y}}if(!l)return t;if(!d)return e;const m={isDraggingOver:c,draggingOverWith:p,draggingFromThisWith:null,isUsingPlaceholder:!0};return{placeholder:u.placeholder,shouldAnimatePlaceholder:!0,snapshot:m,useClone:null}});return(i,l)=>{const c=Fd(l),d=c.droppableId,u=c.type,f=!c.isDropDisabled,p=c.renderClone;if(tn(i)){const h=i.critical;if(!Ko(u,h))return t;const m=Mi(h,i.dimensions),y=Be(i.impact)===d;return n(d,f,y,y,m,p)}if(i.phase==="DROP_ANIMATING"){const h=i.completed;if(!Ko(u,h.critical))return t;const m=Mi(h.critical,i.dimensions);return n(d,f,Dd(h.result)===d,Be(h.impact)===d,m,p)}if(i.phase==="IDLE"&&i.completed&&!i.shouldFlush){const h=i.completed;if(!Ko(u,h.critical))return t;const m=Be(h.impact)===d,y=!!(h.impact.at&&h.impact.at.type==="COMBINE"),b=h.critical.droppable.id===d;return m?y?e:t:b?e:t}return t}},Kw={updateViewportMaxScroll:sS},Yw=cl(Vw,Kw,(e,t,r)=>({...Fd(r),...e,...t}),{context:ya,areStatePropsEqual:Ad})(qw),Xw=({onDragEnd:e,children:t})=>a.jsx(dw,{onDragEnd:e,children:a.jsx(P,{sx:{flex:1,background:"var(--midnight-blue)",color:"var(--silver)",display:"flex",flexDirection:"row",overflow:"hidden",position:"relative"},children:t})}),Jw=j(P)({width:s.components.sidebar.width,height:"100%",background:s.colors.bg.secondary,boxShadow:"2px 0 16px rgba(0, 0, 0, 0.12)",display:"flex",flexDirection:"column",transition:`width ${s.transitions.slow}`}),Zw=j(_)({fontSize:s.typography.fontSize.xs,fontWeight:s.typography.fontWeight.medium,color:s.colors.text.disabled,textTransform:"uppercase",letterSpacing:"1px",padding:`${s.spacing.md} ${s.spacing.lg} ${s.spacing.sm}`,opacity:.6}),_d=j(lo)(({isactive:e})=>({borderRadius:s.borderRadius.md,height:`calc(${s.spacing.lg} + ${s.spacing.md})`,marginBottom:s.spacing.sm,position:"relative",transition:s.transitions.all,...e==="true"&&{background:wa(s.colors.accent.primary,.15),"&::before":{content:'""',position:"absolute",left:0,top:0,bottom:0,width:"3px",background:s.gradients.aurora,borderRadius:"0 2px 2px 0"}},"&:hover":{background:e==="true"?wa(s.colors.accent.primary,.2):s.colors.bg.elevated,transform:"translateX(2px)"}})),eC=j(P)({width:s.spacing.xxxl,height:"100%",background:s.colors.bg.secondary,boxShadow:"2px 0 16px rgba(0, 0, 0, 0.12)",display:"flex",flexDirection:"column",transition:`width ${s.transitions.slow}`}),tC=({onToggleCollapse:e})=>a.jsx(eC,{children:a.jsx(P,{sx:{p:s.spacing.md,display:"flex",justifyContent:"center"},children:a.jsx(se,{onClick:e,sx:{color:s.colors.text.secondary},children:a.jsx(Xi,{})})})}),rC=ie`
  0%, 100% {
    transform: translateY(0px);
  }
  50% {
    transform: translateY(-4px);
  }
`,Od=ie`
  0% {
    background-position: -200% center;
  }
  100% {
    background-position: 200% center;
  }
`,nC=j(P,{shouldForwardProp:e=>e!=="animated"})(({animated:e})=>({display:"flex",alignItems:"center",gap:"12px",animation:e?`${rC} 3s ease-in-out infinite`:"none"})),oC=j(P)(({size:e})=>({width:e,height:e,borderRadius:"8px",background:le.aurora,display:"flex",alignItems:"center",justifyContent:"center",position:"relative",overflow:"hidden",boxShadow:`0 4px 12px ${D.strong}`,"&::before":{content:'""',position:"absolute",top:0,left:0,right:0,bottom:0,background:`linear-gradient(90deg, transparent, rgba(255,255,255,${.3}), transparent)`,backgroundSize:"200% 100%",animation:`${Od} 3s infinite`}})),sC=j("svg")(({size:e})=>({width:e*.6,height:e*.6,position:"relative",zIndex:1})),aC=j(_,{shouldForwardProp:e=>e!=="animated"})(({size:e,animated:t})=>({fontSize:{small:"16px",medium:"20px",large:"28px"}[e],fontWeight:700,background:le.aurora,backgroundClip:"text",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",letterSpacing:"-0.5px",backgroundSize:t?"200% auto":"100% auto",animation:t?`${Od} 3s linear infinite`:"none"})),iC=({size:e})=>a.jsxs(sC,{size:e,viewBox:"0 0 24 24",fill:"none",children:[a.jsx("path",{d:"M2 12C2 12 4 8 8 8C12 8 12 16 16 16C20 16 22 12 22 12",stroke:"white",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round"}),a.jsx("path",{d:"M2 16C2 16 4 12 8 12C12 12 12 20 16 20C20 20 22 16 22 16",stroke:"white",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",opacity:"0.6"}),a.jsx("path",{d:"M2 8C2 8 4 4 8 4C12 4 12 12 16 12C20 12 22 8 22 8",stroke:"white",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",opacity:"0.4"})]}),lC=({size:e="medium",showText:t=!0,animated:r=!1})=>{const n={small:32,medium:40,large:56}[e];return a.jsxs(nC,{animated:r,children:[a.jsx(oC,{size:n,children:a.jsx(iC,{size:n})}),t&&a.jsx(aC,{size:e,animated:r,children:"Auralis"})]})},cC=({onToggleCollapse:e})=>a.jsxs(a.Fragment,{children:[a.jsxs(P,{sx:{p:s.spacing.md,display:"flex",alignItems:"center",justifyContent:"space-between"},children:[a.jsx(lC,{size:"medium",showText:!0,animated:!0}),a.jsx(se,{onClick:e,size:"small",sx:{color:s.colors.text.secondary,transition:s.transitions.all,"&:hover":{color:s.colors.text.primary,transform:"scale(1.1)"}},children:a.jsx(Yi,{})})]}),a.jsx(fe,{sx:{borderColor:s.colors.border.light}})]}),$i=({items:e,selectedItem:t,onItemClick:r})=>a.jsx(gn,{sx:{px:s.spacing.md},children:e.map(n=>a.jsx(br,{disablePadding:!0,children:a.jsxs(_d,{isactive:t===n.id?"true":"false",onClick:()=>r(n.id),children:[a.jsx(co,{sx:{color:t===n.id?s.colors.accent.primary:s.colors.text.tertiary,minWidth:`calc(${s.spacing.lg} + ${s.spacing.sm})`,transition:s.transitions.color,opacity:t===n.id?1:.7},children:n.icon}),a.jsx($t,{primary:n.label,primaryTypographyProps:{fontSize:s.typography.fontSize.base,fontWeight:t===n.id?s.typography.fontWeight.medium:s.typography.fontWeight.normal,color:t===n.id?s.colors.text.primary:s.colors.text.tertiary,opacity:t===n.id?1:.75}})]})},n.id))}),dC=({playlist:e,onPlaylistUpdated:t,onClose:r})=>{const[n,o]=g.useState(""),[i,l]=g.useState(""),[c,d]=g.useState(!1),{success:u,error:f}=Fe();g.useEffect(()=>{e&&(o(e.name),l(e.description||""))},[e]);const p=g.useCallback(async()=>{if(e){if(!n.trim()){f("Please enter a playlist name");return}d(!0);try{await Cm(e.id,{name:n.trim(),description:i.trim()}),u(`Playlist "${n}" updated successfully`),t&&t(),r()}catch(y){f(`Failed to update playlist: ${y}`)}finally{d(!1)}}},[e,n,i,t,r,u,f]),h=g.useCallback(()=>{c||r()},[c,r]),m=g.useCallback(y=>{y.key==="Enter"&&n.trim()&&!c&&p()},[n,c,p]);return{name:n,setName:o,description:i,setDescription:l,loading:c,handleSave:p,handleClose:h,handleKeyPress:m}},uC=j(P)({pt:2,display:"flex",flexDirection:"column",gap:2}),pC=j(P)({p:2,background:D.veryLight,borderRadius:"8px",border:`1px solid ${D.standard}`}),hC=j(P)({color:s.colors.text.secondary,fontSize:"14px"}),fC=({name:e,onNameChange:t,description:r,onDescriptionChange:n,loading:o,onKeyPress:i})=>a.jsxs(uC,{children:[a.jsx(Me,{autoFocus:!0,label:"Playlist Name",fullWidth:!0,value:e,onChange:l=>t(l.target.value),onKeyPress:i,disabled:o,placeholder:"Enter playlist name"}),a.jsx(Me,{label:"Description (Optional)",fullWidth:!0,multiline:!0,rows:3,value:r,onChange:l=>n(l.target.value),disabled:o,placeholder:"Add a description for your playlist"})]}),gC=({trackCount:e})=>a.jsx(pC,{children:a.jsxs(hC,{children:[e," track",e!==1?"s":""," in this playlist"]})}),mC=({loading:e,nameEmpty:t,onSave:r,onCancel:n})=>a.jsxs(kr,{sx:{p:2,pt:1},children:[a.jsx(Ks,{onClick:n,disabled:e,children:"Cancel"}),a.jsx(vc,{onClick:r,disabled:t||e,children:e?"Saving...":"Save Changes"})]}),yC=({open:e,onClose:t,playlist:r,onPlaylistUpdated:n})=>{const{name:o,setName:i,description:l,setDescription:c,loading:d,handleSave:u,handleClose:f,handleKeyPress:p}=dC({playlist:r,onPlaylistUpdated:n,onClose:t});return r?a.jsxs(bn,{open:e,onClose:f,maxWidth:"sm",fullWidth:!0,children:[a.jsx(xn,{children:"Edit Playlist"}),a.jsxs(tr,{children:[a.jsx(fC,{name:o,onNameChange:i,description:l,onDescriptionChange:c,loading:d,onKeyPress:p}),a.jsx(gC,{trackCount:r.track_count})]}),a.jsx(mC,{loading:d,nameEmpty:!o.trim(),onSave:u,onCancel:f})]}):null},bC=j(P)({marginTop:"16px"}),xC=j(P)({display:"flex",alignItems:"center",justifyContent:"space-between",padding:"8px 16px",cursor:"pointer","&:hover":{background:D.minimal},transition:"background 0.2s ease"}),SC=j(_)({fontSize:"14px",fontWeight:600,color:s.colors.text.secondary,textTransform:"uppercase",letterSpacing:"0.5px",display:"flex",alignItems:"center",gap:"8px"});j(br)({padding:0});j(lo)(({selected:e})=>({paddingLeft:"32px",paddingRight:"8px",height:"40px",borderRadius:"6px",margin:"2px 8px",transition:"all 0.2s ease",background:e?D.lighter:"transparent",borderLeft:e?`3px solid ${Ft}`:"3px solid transparent","&:hover":{background:e?D.standard:D.ultraLight,transform:"translateX(2px)","& .playlist-actions":{opacity:1}},"& .MuiListItemText-primary":{fontSize:"14px",color:e?s.colors.text.primary:s.colors.text.secondary,fontWeight:e?600:400}}));j(P)({display:"flex",gap:"4px",opacity:0,transition:"opacity 0.2s ease"});j(se)({width:"28px",height:"28px",color:s.colors.text.secondary,"&:hover":{color:Ft,background:D.veryLight},"& .MuiSvgIcon-root":{fontSize:"18px"}});const vC=j(se)({width:"28px",height:"28px",color:s.colors.text.secondary,"&:hover":{color:Ft,background:D.veryLight},"& .MuiSvgIcon-root":{fontSize:"20px"}}),Fi=j(P)({padding:"16px 32px",textAlign:"center",color:s.colors.text.disabled,fontSize:"13px"}),wC=({playlistCount:e,expanded:t,onExpandToggle:r,onCreateClick:n})=>{const o=g.useCallback(i=>{i.stopPropagation(),n()},[n]);return a.jsxs(xC,{onClick:r,role:"button","aria-label":t?"Collapse playlists":"Expand playlists","aria-expanded":t,children:[a.jsxs(SC,{children:[a.jsx(ao,{sx:{fontSize:"18px"}}),"Playlists (",e,")"]}),a.jsxs(P,{sx:{display:"flex",alignItems:"center",gap:"4px"},children:[a.jsx(ke,{title:"Create playlist",children:a.jsx(vC,{onClick:o,children:a.jsx(_s,{})})}),t?a.jsx(bu,{}):a.jsx(xu,{})]})]})},CC=j(lo,{shouldForwardProp:e=>e!=="isDraggingOver"&&e!=="selected"})(({theme:e,isDraggingOver:t,selected:r})=>({borderRadius:e.spacing(1),marginBottom:e.spacing(.5),padding:e.spacing(1,2),transition:"all 0.2s ease",backgroundColor:t?D.standard:r?D.veryLight:"transparent",border:t?`2px dashed ${D.stronger}`:"2px solid transparent","&:hover":{backgroundColor:t?D.light:r?D.lighter:"rgba(255, 255, 255, 0.05)"}})),kC=j(Su)(({theme:e})=>({marginRight:e.spacing(2),color:e.palette.text.secondary})),jC=j(_)(({theme:e})=>({fontSize:"0.75rem",color:e.palette.text.secondary,marginLeft:e.spacing(1)})),PC=j(P)(({theme:e})=>({position:"absolute",top:0,left:0,right:0,bottom:0,display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:D.veryLight,border:`2px dashed ${D.stronger}`,borderRadius:e.spacing(1),pointerEvents:"none",zIndex:1})),IC=j(_)(({theme:e})=>({color:e.palette.primary.main,fontWeight:600,fontSize:"0.875rem"})),EC=j(P)({position:"relative"}),AC=j(P)({display:"none"}),DC=({playlistName:e,trackCount:t})=>a.jsxs(a.Fragment,{children:[a.jsx(kC,{fontSize:"small"}),a.jsx($t,{primary:e,secondary:a.jsxs(jC,{component:"span",children:[t," ",t===1?"track":"tracks"]})})]}),RC=({visible:e})=>e?a.jsx(PC,{children:a.jsx(IC,{children:"Drop to add tracks"})}):null,TC=({playlistId:e,playlistName:t,trackCount:r,selected:n=!1,onClick:o,onContextMenu:i})=>{const l=`playlist-${e}`;return a.jsx(Yw,{droppableId:l,type:"TRACK",children:(c,d)=>a.jsxs(EC,{ref:c.innerRef,...c.droppableProps,children:[a.jsx(CC,{selected:n,isDraggingOver:d.isDraggingOver,onClick:o,onContextMenu:i,children:a.jsx(DC,{playlistName:t,trackCount:r})}),a.jsx(RC,{visible:d.isDraggingOver}),a.jsx(AC,{children:c.placeholder})]})})},MC=({playlists:e,loading:t,expanded:r,selectedPlaylistId:n,contextMenuState:o,contextActions:i,onPlaylistSelect:l,onContextMenuOpen:c,onContextMenuClose:d})=>a.jsxs(a.Fragment,{children:[a.jsx(vu,{in:r,children:a.jsx(gn,{sx:{py:0},children:t?a.jsx(Fi,{children:"Loading playlists..."}):e.length===0?a.jsxs(Fi,{children:["No playlists yet",a.jsx("br",{}),"Click + to create one"]}):e.map(u=>a.jsx(P,{sx:{px:1},children:a.jsx(TC,{playlistId:u.id,playlistName:u.name,trackCount:u.track_count,selected:n===u.id,onClick:()=>l&&l(u.id),onContextMenu:f=>c(f,u)})},u.id))})}),a.jsx(Zs,{anchorPosition:o.mousePosition,open:o.isOpen,onClose:d,actions:i})]}),$C=({onPlaylistCreated:e,onPlaylistUpdated:t,onPlaylistDeleted:r,onPlaylistsRefresh:n})=>{const{subscribe:o}=Ot();g.useEffect(()=>{console.log(" PlaylistList: Setting up WebSocket subscriptions");const i=o("playlist_created",()=>{e()}),l=o("playlist_updated",p=>{try{t(p.data.playlist_id,p.data.updates)}catch(h){console.error("Error handling playlist_updated:",h)}}),c=o("playlist_deleted",p=>{try{r(p.data.playlist_id)}catch(h){console.error("Error handling playlist_deleted:",h)}}),d=o("playlist_tracks_added",()=>{n()}),u=o("playlist_track_removed",()=>{n()}),f=o("playlist_cleared",()=>{n()});return()=>{console.log(" PlaylistList: Cleaning up WebSocket subscriptions"),i(),l(),c(),d(),u(),f()}},[o,e,t,r,n])},FC=({selectedPlaylistId:e,onPlaylistSelect:t})=>{const{success:r,error:n,info:o}=Fe(),i=g.useCallback(async()=>{try{return(await kc()).playlists}catch(f){return console.error("Failed to load playlists:",f),[]}},[]),l=g.useCallback(async(f,p)=>{if(!window.confirm(`Delete playlist "${p}"?`))return!1;try{return await km(f),r(`Playlist "${p}" deleted`),e===f&&t&&t(-1),!0}catch(h){return n(`Failed to delete playlist: ${h}`),!1}},[e,t,r,n]),c=g.useCallback(f=>f,[]),d=g.useCallback(f=>{t&&t(f.id)},[t]),u=g.useCallback(async()=>await i(),[i]);return{fetchPlaylists:i,handleDelete:l,handleEdit:c,handlePlaylistCreated:d,handlePlaylistUpdated:u}},_C=({playlist:e,onPlaylistSelect:t,onDelete:r,onEdit:n})=>{const{info:o}=Fe();return g.useMemo(()=>e?Wm(e.id.toString(),{onPlay:()=>{o(`Playing playlist: ${e.name}`),t&&t(e.id)},onEdit:()=>{n(e)},onDelete:()=>{r(e.id,e.name)}}):[],[e,t,r,n,o])},OC=({onPlaylistSelect:e,selectedPlaylistId:t})=>{const[r,n]=g.useState([]),[o,i]=g.useState(!0),[l,c]=g.useState(!1),[d,u]=g.useState(!1),[f,p]=g.useState(null),[h,m]=g.useState(null),[y,b]=g.useState(!1),{contextMenuState:x,handleContextMenu:S,handleCloseContextMenu:v}=Pc(),{fetchPlaylists:k,handleDelete:C}=FC({selectedPlaylistId:t,onPlaylistSelect:e});g.useEffect(()=>{(async()=>{b(!0);const U=await k();n(U),b(!1)})()},[k]),$C({onPlaylistCreated:async()=>{const R=await k();n(R)},onPlaylistUpdated:(R,U)=>{n(L=>L.map(ae=>ae.id===R?{...ae,...U}:ae))},onPlaylistDeleted:R=>{n(U=>U.filter(L=>L.id!==R))},onPlaylistsRefresh:async()=>{const R=await k();n(R)}});const I=R=>{n(U=>[...U,R]),e&&e(R.id)},E=async(R,U)=>{await C(R,U)&&n(ae=>ae.filter(K=>K.id!==R))},$=async()=>{const R=await k();n(R)},F=(R,U)=>{R.preventDefault(),R.stopPropagation(),m(U),S(R)},O=()=>{m(null),v()},A=_C({playlist:h,onPlaylistSelect:e,onDelete:E,onEdit:R=>{p(R),u(!0)}});return a.jsxs(bC,{children:[a.jsx(wC,{playlistCount:r.length,expanded:o,onExpandToggle:()=>i(!o),onCreateClick:()=>c(!0)}),a.jsx(MC,{playlists:r,loading:y,expanded:o,selectedPlaylistId:t,contextMenuState:x,contextActions:A,onPlaylistSelect:e,onContextMenuOpen:F,onContextMenuClose:O}),a.jsx(jc,{open:l,onClose:()=>c(!1),onPlaylistCreated:I}),a.jsx(yC,{open:d,onClose:()=>{u(!1),p(null)},playlist:f,onPlaylistUpdated:$})]})},BC=({selectedItem:e,onItemClick:t})=>{const r=[{id:"songs",label:"Songs",icon:a.jsx(wu,{})},{id:"albums",label:"Albums",icon:a.jsx(Os,{})},{id:"artists",label:"Artists",icon:a.jsx(Fs,{})}],n=[{id:"favourites",label:"Favourites",icon:a.jsx(io,{})},{id:"recent",label:"Recently Played",icon:a.jsx(Cu,{})}];return a.jsxs(P,{sx:{flex:1,overflowY:"auto",overflowX:"hidden"},children:[a.jsx(Zw,{children:"Library"}),a.jsx($i,{items:r,selectedItem:e,onItemClick:t}),a.jsx(fe,{sx:{borderColor:s.colors.border.light,my:s.spacing.lg,opacity:.5}})," ",a.jsx($i,{items:n,selectedItem:e,onItemClick:t}),a.jsx(fe,{sx:{borderColor:s.colors.border.light,my:s.spacing.lg,opacity:.5}})," ",a.jsx(OC,{selectedPlaylistId:e.startsWith("playlist-")?parseInt(e.replace("playlist-","")):void 0,onPlaylistSelect:o=>t(`playlist-${o}`)})]})},LC=j(P)({display:"inline-flex",alignItems:"center",gap:s.spacing.sm}),zC=j(se,{shouldForwardProp:e=>e!=="buttonSize"&&e!=="isDark"})(({buttonSize:e,isDark:t})=>({width:e,height:e,background:t?s.colors.border.light:s.colors.bg.level3,backdropFilter:"blur(10px)",border:`1px solid ${t?s.colors.border.medium:s.colors.border.light}`,transition:s.transitions.slow_inOut,overflow:"hidden",position:"relative","&:hover":{background:t?s.colors.border.medium:s.colors.bg.level4,transform:"scale(1.05) rotate(15deg)",boxShadow:t?s.shadows.lg:s.shadows.md},"&:active":{transform:"scale(0.95) rotate(0deg)"}})),NC=j(P)({position:"absolute",inset:0,background:s.gradients.aurora,opacity:0,transition:s.transitions.slow_inOut}),WC=j(P)({position:"relative",display:"flex",alignItems:"center",justifyContent:"center",transition:s.transitions.verySlow_inOut}),UC=j(P)({fontSize:s.typography.fontSize.xs,fontWeight:s.typography.fontWeight.semibold,textTransform:"uppercase",letterSpacing:s.typography.letterSpacing.loose}),HC=e=>g.useMemo(()=>({iconSize:e==="small"?20:e==="large"?28:24,buttonSize:e==="small"?36:e==="large"?52:44}),[e]),GC=({isDark:e,iconSize:t})=>a.jsx(WC,{sx:{transform:e?"rotate(0deg)":"rotate(180deg)"},children:e?a.jsx(ku,{sx:{fontSize:t,color:s.colors.semantic.warning,filter:`drop-shadow(0 0 8px ${s.colors.semantic.warning}99)`,transition:"all 0.3s ease"}}):a.jsx(ju,{sx:{fontSize:t,color:Ft,filter:`drop-shadow(0 0 8px ${D.veryStrong})`,transition:"all 0.3s ease"}})}),qC=({isDark:e,color:t})=>a.jsx(UC,{sx:{color:t},children:e?"Dark":"Light"}),QC=({size:e="medium",showLabel:t=!1})=>{const{mode:r,toggleTheme:n,colors:o}=wp(),i=r==="dark",{iconSize:l,buttonSize:c}=HC(e);return a.jsx(ke,{title:i?"Switch to light mode":"Switch to dark mode",placement:"bottom",children:a.jsxs(LC,{children:[a.jsxs(zC,{onClick:n,buttonSize:c,isDark:i,children:[a.jsx(NC,{sx:{".MuiIconButton-root:hover &":{opacity:i?.15:.12}}}),a.jsx(GC,{isDark:i,iconSize:l})]}),t&&a.jsx(qC,{isDark:i,color:o.text.secondary})]})})},VC=({onOpenSettings:e})=>a.jsxs(P,{sx:{mt:"auto",p:s.spacing.md,borderTop:`1px solid ${s.colors.border.light}`},children:[a.jsx(P,{sx:{display:"flex",alignItems:"center",gap:s.spacing.sm,mb:s.spacing.sm},children:a.jsx(P,{sx:{flex:1},children:a.jsxs(_d,{onClick:e,isactive:"false",children:[a.jsx(co,{sx:{color:s.colors.text.secondary,minWidth:`calc(${s.spacing.lg} + ${s.spacing.sm})`,transition:s.transitions.color},children:a.jsx(Pu,{})}),a.jsx($t,{primary:"Settings",primaryTypographyProps:{fontSize:s.typography.fontSize.base,fontWeight:s.typography.fontWeight.normal,color:s.colors.text.secondary}})]})})}),a.jsx(P,{sx:{display:"flex",justifyContent:"center",mt:s.spacing.md},children:a.jsx(QC,{size:"medium"})})]}),KC=e=>{const[t,r]=g.useState(!0),[n,o]=g.useState("songs"),i=g.useCallback(l=>{o(l),e&&e(l)},[e]);return{selectedItem:n,playlistsOpen:t,handleItemClick:i,setPlaylistsOpen:r}},YC=({collapsed:e=!1,onToggleCollapse:t,onNavigate:r,onOpenSettings:n})=>{const{selectedItem:o,handleItemClick:i}=KC(r);return e?a.jsx(tC,{onToggleCollapse:t}):a.jsxs(Jw,{children:[a.jsx(cC,{onToggleCollapse:t}),a.jsx(BC,{selectedItem:o,onItemClick:i}),a.jsx(VC,{onOpenSettings:n})]})},Bd=q.memo(YC),XC=({open:e,onClose:t,onNavigate:r,onOpenSettings:n})=>{const o=l=>{r(l),t()},i=()=>{n(),t()};return a.jsx(Iu,{anchor:"left",open:e,onClose:t,onOpen:()=>{},disableSwipeToOpen:!1,swipeAreaWidth:20,ModalProps:{keepMounted:!0},PaperProps:{sx:{width:240,background:"var(--midnight-blue)",borderRight:`1px solid ${D.veryLight}`}},children:a.jsx(Bd,{collapsed:!1,onNavigate:o,onOpenSettings:i})})},JC=({collapsed:e,onToggleCollapse:t,onNavigate:r,onOpenSettings:n,mobileDrawerOpen:o,onCloseMobileDrawer:i,isMobile:l})=>{const c=po(),d=Wr(c.breakpoints.down("md"));return l||d?a.jsx(XC,{open:o,onClose:i,onNavigate:r,onOpenSettings:n}):a.jsx(Bd,{collapsed:e,onToggleCollapse:t,onNavigate:r,onOpenSettings:n})},ZC=j(P)({display:"flex",alignItems:"center",justifyContent:"space-between",padding:`${s.spacing.md} ${s.spacing.lg}`,background:s.colors.bg.level2,borderBottom:`1px solid ${D.veryLight}`,height:70,gap:s.spacing.md}),ek=j(P)(({theme:e})=>({display:"flex",alignItems:"center",gap:12})),tk=j(P)({display:"flex",alignItems:"center",gap:12,flex:1,justifyContent:"flex-end"}),rk=j(P)(({focused:e})=>({display:"flex",alignItems:"center",background:"transparent",borderRadius:0,border:"none",borderBottom:`1px solid ${e?s.colors.accent.primary:s.colors.border.light}`,padding:`${s.spacing.xs} ${s.spacing.md}`,gap:8,transition:"border-color 0.15s ease"})),nk=j(P)(({color:e})=>({width:12,height:12,borderRadius:"50%",background:e,boxShadow:`0 0 8px ${e}80`,minWidth:12})),ok=j(P)({fontSize:s.typography.fontSize.xl,fontWeight:s.typography.fontWeight.semibold,color:s.colors.text.secondary,whiteSpace:"nowrap"}),sk=({showMobileMenu:e,title:t,onOpenMobileDrawer:r})=>a.jsxs(ek,{sx:{flex:e?0:1},children:[e&&a.jsx(se,{onClick:r,sx:{color:"var(--silver)",padding:"8px","&:hover":{background:D.veryLight}},children:a.jsx(Eu,{})}),!e&&a.jsx(ok,{children:t})]}),ak=({searchQuery:e,isSearchFocused:t,minWidth:r,onSearchChange:n,onFocus:o,onBlur:i,onClear:l})=>a.jsxs(rk,{focused:t,sx:{minWidth:r},children:[a.jsx(Au,{sx:{color:D.stronger,fontSize:"18px",opacity:.6}}),a.jsx(Mt,{placeholder:"Search tracks, albums, artists...",value:e,onChange:n,onFocus:o,onBlur:i,sx:{flex:1,"& .MuiOutlinedInput-root":{border:"none",padding:0},"& .MuiOutlinedInput-input":{padding:0,color:"var(--silver)",fontSize:"14px","&::placeholder":{color:D.standard,opacity:1}},"& .MuiOutlinedInput-notchedOutline":{border:"none"}}}),e&&a.jsx(se,{onClick:l,size:"small",sx:{color:D.stronger,padding:"4px","&:hover":{color:"var(--silver)"}},children:a.jsx(Du,{fontSize:"small"})})]}),ik=({color:e})=>a.jsx(nk,{color:e}),lk=({onSearch:e,onSearchClear:t})=>{const[r,n]=g.useState(""),[o,i]=g.useState(!1),l=g.useCallback(d=>{const u=d.target.value;n(u),e(u)},[e]),c=g.useCallback(()=>{n(""),e(""),t==null||t()},[e,t]);return{searchQuery:r,isSearchFocused:o,setIsSearchFocused:i,handleSearchChange:l,handleSearchClear:c}},ck=e=>g.useMemo(()=>{switch(e){case"connected":return Rn.connected;case"connecting":return Rn.connecting;case"disconnected":return Rn.disconnected;default:return Rn.disconnected}},[e]),dk=({onSearch:e,onOpenMobileDrawer:t,title:r,connectionStatus:n,isMobile:o,onSearchClear:i})=>{const l=po(),c=Wr(l.breakpoints.down("md")),d=o||c,{searchQuery:u,isSearchFocused:f,setIsSearchFocused:p,handleSearchChange:h,handleSearchClear:m}=lk({onSearch:e,onSearchClear:i}),y=ck(n);return a.jsxs(ZC,{children:[a.jsx(sk,{showMobileMenu:d,title:r,onOpenMobileDrawer:t}),a.jsxs(tk,{children:[a.jsx(ak,{searchQuery:u,isSearchFocused:f,minWidth:d?200:300,onSearchChange:h,onFocus:()=>p(!0),onBlur:()=>p(!1),onClear:m}),a.jsx(ik,{color:y})]})]})},uk=({children:e,onPlayTrack:t,onQueueTrack:r})=>a.jsx(P,{sx:{flex:1,display:"flex",flexDirection:"column",overflow:"hidden"},children:a.jsx(P,{sx:{flex:1,overflow:"auto",paddingBottom:"100px","&::-webkit-scrollbar":{width:"8px"},"&::-webkit-scrollbar-track":{background:"transparent"},"&::-webkit-scrollbar-thumb":{background:D.strong,borderRadius:"4px","&:hover":{background:D.stronger}}},children:e})}),pk=j(P)(({isCollapsed:e})=>({display:"flex",flexDirection:"column",background:"var(--midnight-blue)",borderLeft:`1px solid ${D.veryLight}`,transition:"width 0.3s ease",width:e?60:320,minWidth:e?60:320,height:"100%",overflow:"hidden"})),hk=j(P)({display:"flex",alignItems:"center",justifyContent:"space-between",padding:"12px 8px",borderBottom:`1px solid ${D.veryLight}`,gap:16}),fk=j(P)({fontSize:"12px",fontWeight:600,color:"rgba(255, 255, 255, 0.5)",textTransform:"uppercase",letterSpacing:"0.5px",flex:1}),gk=j(P)({flex:1,overflow:"auto",padding:"16px 12px","&::-webkit-scrollbar":{width:"6px"},"&::-webkit-scrollbar-track":{background:"transparent"},"&::-webkit-scrollbar-thumb":{background:D.strong,borderRadius:"3px","&:hover":{background:D.stronger}}}),mk=j(P)({padding:"12px 8px",borderTop:`1px solid ${D.veryLight}`,display:"flex",gap:8}),yk=({isCollapsed:e,useV2:t,onToggleCollapse:r})=>a.jsxs(hk,{children:[!e&&a.jsx(fk,{children:t?"Enhancement V2":"Enhancement"}),a.jsx(ke,{title:e?"Expand":"Collapse",children:a.jsx(se,{onClick:r,size:"small",sx:{color:"rgba(255, 255, 255, 0.5)",padding:"4px","&:hover":{color:"var(--silver)",background:D.veryLight}},children:e?a.jsx(Ru,{fontSize:"small"}):a.jsx(Tu,{fontSize:"small"})})})]}),bk=({useV2:e,onToggleV2:t})=>a.jsx(mk,{children:a.jsx(ke,{title:e?"Switch to V1":"Switch to V2",children:a.jsx($e,{onClick:t,size:"sm",fullWidth:!0,variant:"secondary",sx:{background:e?D.standard:D.minimal,color:e?s.colors.accent.primary:s.colors.text.muted,fontSize:s.typography.fontSize.xs,fontWeight:s.typography.fontWeight.semibold,textTransform:"uppercase",letterSpacing:"0.5px",padding:s.spacing.sm,border:`1px solid ${e?D.strong:D.veryLight}`,borderRadius:s.borderRadius.sm,"&:hover":{background:e?D.strong:D.veryLight}},children:e?"V2 Active":"V1"})})}),xk=(e=!1)=>{const[t,r]=g.useState(e);return{isCollapsed:t,handleCollapsedToggle:()=>{r(!t)}}},Sk=({onEnhancementChange:e,onToggleV2:t,useV2:r=!1,initiallyCollapsed:n=!1,children:o})=>{const{isCollapsed:i,handleCollapsedToggle:l}=xk(n);return a.jsxs(pk,{isCollapsed:i,children:[a.jsx(yk,{isCollapsed:i,useV2:r,onToggleCollapse:l}),!i&&a.jsx(gk,{children:o}),!i&&a.jsx(bk,{useV2:r,onToggleV2:t})]})},vk=()=>{const e=po(),t=Wr(e.breakpoints.down("md")),r=Wr(e.breakpoints.down("lg")),[n,o]=g.useState(!1),[i,l]=g.useState(!1),[c,d]=g.useState(!1);return g.useEffect(()=>{t?(o(!0),l(!1)):o(!1)},[t]),g.useEffect(()=>{d(!!r)},[r]),{isMobile:t,isTablet:r,sidebarCollapsed:n,mobileDrawerOpen:i,presetPaneCollapsed:c,setSidebarCollapsed:o,setMobileDrawerOpen:l,setPresetPaneCollapsed:d,toggleSidebarCollapse:()=>{o(!n)},toggleMobileDrawer:()=>{l(!i)},togglePresetPaneCollapse:()=>{d(!c)}}},wk=({info:e,success:t})=>({handleDragEnd:g.useCallback(async n=>{const{source:o,destination:i,draggableId:l}=n;if(!i||o.droppableId===i.droppableId&&o.index===i.index)return;const c=parseInt(l.replace("track-",""),10);try{if(i.droppableId==="queue")await Ck(c,i.index,t);else if(i.droppableId.startsWith("playlist-")){const d=parseInt(i.droppableId.replace("playlist-",""),10);await kk(c,d,i.index,t)}else if(i.droppableId===o.droppableId){if(o.droppableId==="queue")await jk(o.index,i.index,e);else if(o.droppableId.startsWith("playlist-")){const d=parseInt(o.droppableId.replace("playlist-",""),10);await Pk(d,o.index,i.index,e)}}}catch(d){console.error("Drag and drop error:",d),e("Failed to complete drag and drop operation")}},[e,t])});async function Ck(e,t,r){if(!(await fetch("/api/player/queue/add-track",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({track_id:e,position:t})})).ok)throw new Error("Failed to add track to queue");r(`Added track to queue at position ${t+1}`)}async function kk(e,t,r,n){if(!(await fetch(`/api/playlists/${t}/tracks/add`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({track_id:e,position:r})})).ok)throw new Error("Failed to add track to playlist");n("Added track to playlist")}async function jk(e,t,r){if(!(await fetch("/api/player/queue/move",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({from_index:e,to_index:t})})).ok)throw new Error("Failed to reorder queue");r("Queue reordered")}async function Pk(e,t,r,n){if(!(await fetch(`/api/playlists/${e}/tracks/reorder`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({from_index:t,to_index:r})})).ok)throw new Error("Failed to reorder playlist");n("Playlist reordered")}class Ik{constructor(){B(this,"shortcuts",new Map);B(this,"enabled",!0);B(this,"listener",null);B(this,"handleKeyDown",t=>{if(!this.enabled||!(t.key==="/"&&!t.ctrlKey&&!t.metaKey&&!t.shiftKey&&!t.altKey)&&this.isInputElement(t.target))return;const n=this.generateKey(t.key,t.ctrlKey||t.metaKey,t.shiftKey,t.altKey),o=this.shortcuts.get(n);o&&(t.preventDefault(),o.handler())})}generateKey(t,r,n,o){const i=[];return r&&i.push("ctrl"),n&&i.push("shift"),o&&i.push("alt"),i.push(t.toLowerCase()),i.join("+")}isInputElement(t){if(!t||!(t instanceof HTMLElement))return!1;const r=t.tagName.toLowerCase(),n=["input","textarea","select"].includes(r),o=t.contentEditable==="true";return n||o}register(t,r){const n=this.generateKey(t.key,t.ctrl||t.meta||!1,t.shift||!1,t.alt||!1);this.shortcuts.set(n,{...t,handler:r})}unregister(t){const r=this.generateKey(t.key,t.ctrl||t.meta||!1,t.shift||!1,t.alt||!1);this.shortcuts.delete(r)}clear(){this.shortcuts.clear()}getShortcuts(){return Array.from(this.shortcuts.values()).map(({handler:t,...r})=>r)}enable(){this.enabled=!0}disable(){this.enabled=!1}isEnabled(){return this.enabled}startListening(){this.listener||(this.listener=this.handleKeyDown,window.addEventListener("keydown",this.listener))}stopListening(){this.listener&&(window.removeEventListener("keydown",this.listener),this.listener=null)}formatShortcut(t){const r=[],n=typeof navigator<"u"&&navigator.platform.toUpperCase().indexOf("MAC")>=0;(t.ctrl||t.meta)&&r.push(n?"":"Ctrl"),t.shift&&r.push(n?"":"Shift"),t.alt&&r.push(n?"":"Alt");const i={" ":"Space",ArrowUp:"",ArrowDown:"",ArrowLeft:"",ArrowRight:"",Enter:"",Escape:"Esc",Delete:"Del"}[t.key]||t.key.toUpperCase();return r.push(i),r.join(n?"":"+")}}const lt=new Ik,Ek=[{configKey:"onPlayPause",shortcuts:[{key:" ",category:"Playback",description:"Play/Pause"}],handler:e=>e.onPlayPause},{configKey:"onNext",shortcuts:[{key:"ArrowRight",category:"Playback",description:"Next track"}],handler:e=>e.onNext},{configKey:"onPrevious",shortcuts:[{key:"ArrowLeft",category:"Playback",description:"Previous track"}],handler:e=>e.onPrevious},{configKey:"onSeekForward",shortcuts:[{key:"ArrowRight",category:"Playback",description:"Seek forward",modifiers:{shift:!0}}],handler:e=>e.onSeekForward},{configKey:"onSeekBackward",shortcuts:[{key:"ArrowLeft",category:"Playback",description:"Seek backward",modifiers:{shift:!0}}],handler:e=>e.onSeekBackward},{configKey:"onVolumeUp",shortcuts:[{key:"ArrowUp",category:"Playback",description:"Volume up"}],handler:e=>e.onVolumeUp},{configKey:"onVolumeDown",shortcuts:[{key:"ArrowDown",category:"Playback",description:"Volume down"}],handler:e=>e.onVolumeDown},{configKey:"onMute",shortcuts:[{key:"0",category:"Playback",description:"Mute/Unmute"},{key:"m",category:"Playback",description:"Mute/Unmute",modifiers:{ctrl:!0}}],handler:e=>e.onMute},{configKey:"onToggleEnhancement",shortcuts:[{key:"m",category:"Global",description:"Toggle enhancement"}],handler:e=>e.onToggleEnhancement},{configKey:"onToggleLyrics",shortcuts:[{key:"l",category:"Global",description:"Toggle lyrics"}],handler:e=>e.onToggleLyrics},{configKey:"onShowSongs",shortcuts:[{key:"1",category:"Navigation",description:"Show Songs"}],handler:e=>e.onShowSongs},{configKey:"onShowAlbums",shortcuts:[{key:"2",category:"Navigation",description:"Show Albums"}],handler:e=>e.onShowAlbums},{configKey:"onShowArtists",shortcuts:[{key:"3",category:"Navigation",description:"Show Artists"}],handler:e=>e.onShowArtists},{configKey:"onShowPlaylists",shortcuts:[{key:"4",category:"Navigation",description:"Show Playlists"}],handler:e=>e.onShowPlaylists},{configKey:"onFocusSearch",shortcuts:[{key:"/",category:"Navigation",description:"Focus search"},{key:"k",category:"Navigation",description:"Quick search",modifiers:{ctrl:!0}},{key:"k",category:"Navigation",description:"Quick search",modifiers:{meta:!0}}],handler:e=>e.onFocusSearch},{configKey:"onEscape",shortcuts:[{key:"Escape",category:"Navigation",description:"Clear search / Close dialogs"}],handler:e=>e.onEscape},{configKey:"onPlaySelected",shortcuts:[{key:"Enter",category:"Library",description:"Play selected"}],handler:e=>e.onPlaySelected},{configKey:"onToggleFavorite",shortcuts:[{key:"l",category:"Library",description:"Toggle favorite"}],handler:e=>e.onToggleFavorite},{configKey:"onAddToPlaylist",shortcuts:[{key:"p",category:"Library",description:"Add to playlist"}],handler:e=>e.onAddToPlaylist},{configKey:"onAddToQueue",shortcuts:[{key:"q",category:"Library",description:"Add to queue"}],handler:e=>e.onAddToQueue},{configKey:"onShowInfo",shortcuts:[{key:"i",category:"Library",description:"Show info"}],handler:e=>e.onShowInfo},{configKey:"onDelete",shortcuts:[{key:"Delete",category:"Library",description:"Delete"}],handler:e=>e.onDelete},{configKey:"onClearQueue",shortcuts:[{key:"c",category:"Queue",description:"Clear queue",modifiers:{shift:!0}}],handler:e=>e.onClearQueue},{configKey:"onShuffleQueue",shortcuts:[{key:"s",category:"Queue",description:"Shuffle queue",modifiers:{shift:!0}}],handler:e=>e.onShuffleQueue},{configKey:"onShowHelp",shortcuts:[{key:"?",category:"Global",description:"Show help"}],handler:e=>e.onShowHelp},{configKey:"onOpenSettings",shortcuts:[{key:",",category:"Global",description:"Open settings",modifiers:{ctrl:!0}},{key:",",category:"Global",description:"Open settings",modifiers:{meta:!0}}],handler:e=>e.onOpenSettings}],Ak=[{key:"1",category:"Presets",description:"Adaptive preset"},{key:"2",category:"Presets",description:"Gentle preset"},{key:"3",category:"Presets",description:"Warm preset"},{key:"4",category:"Presets",description:"Bright preset"},{key:"5",category:"Presets",description:"Punchy preset"}],Dk=["adaptive","gentle","warm","bright","punchy"];function _i(e){var r,n,o,i;const t=e.category==="Presets"?"Global":e.category;return{key:e.key,category:t,description:e.description,...((r=e.modifiers)==null?void 0:r.ctrl)&&{ctrl:!0},...((n=e.modifiers)==null?void 0:n.shift)&&{shift:!0},...((o=e.modifiers)==null?void 0:o.meta)&&{meta:!0},...((i=e.modifiers)==null?void 0:i.alt)&&{alt:!0}}}const Rk=e=>{const t=[];return Ek.forEach(r=>{const n=r.handler(e);n&&r.shortcuts.forEach(o=>{const i=_i(o);t.push({...i,handler:n})})}),e.onPresetChange&&Ak.forEach((r,n)=>{const o=_i(r);t.push({...o,handler:()=>{var i;return(i=e.onPresetChange)==null?void 0:i.call(e,Dk[n])}})}),t},Tk=e=>{const[t,r]=g.useState(!1),[n,o]=g.useState(Array.isArray(e)?!0:(e==null?void 0:e.enabled)!==!1),i=Array.isArray(e)?e:Rk(e||{});g.useEffect(()=>(lt.clear(),i.forEach(f=>{const{handler:p,...h}=f;lt.register(h,p)}),lt.startListening(),()=>{lt.stopListening(),lt.clear()}),[i]),g.useEffect(()=>{n?lt.enable():lt.disable()},[n]);const l=g.useCallback(()=>r(!0),[]),c=g.useCallback(()=>r(!1),[]),d=g.useCallback(()=>o(!0),[]),u=g.useCallback(()=>o(!1),[]);return{shortcuts:lt.getShortcuts(),isHelpOpen:t,openHelp:l,closeHelp:c,enable:d,disable:u,isEnabled:n,formatShortcut:f=>lt.formatShortcut(f)}};function Mk(){const e=po(),t=Wr(e.breakpoints.down("lg")),{isMobile:r,sidebarCollapsed:n,mobileDrawerOpen:o,presetPaneCollapsed:i,setSidebarCollapsed:l,setMobileDrawerOpen:c,setPresetPaneCollapsed:d}=vk(),[u,f]=g.useState(null),[p,h]=g.useState(""),[m,y]=g.useState("songs"),[b,x]=g.useState(!1),{isConnected:S}=Ot(),{success:v,info:k}=Fe(),C=Et(hf),I=Et(ff),{playEnhanced:E}=Jl(),{setQueue:$}=Rl(),F=g.useCallback(async()=>{try{await fetch(C?"/api/player/pause":"/api/player/play",{method:"POST"})}catch(W){console.error("Playback control error:",W)}},[C]),O=g.useCallback(async()=>{try{await fetch("/api/player/next",{method:"POST"})}catch(W){console.error("Next track error:",W)}},[]),A=g.useCallback(async()=>{try{await fetch("/api/player/previous",{method:"POST"})}catch(W){console.error("Previous track error:",W)}},[]),R=g.useCallback(async W=>{try{await fetch("/api/player/volume",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({volume:W})})}catch(V){console.error("Volume control error:",V)}},[]),{handleDragEnd:U}=wk({info:k,success:v}),L=async W=>{try{f(W),console.log("Playing track:",W.title),await $([W],0),await E(W.id,"adaptive",1),k(`Now playing: ${W.title}`)}catch(V){console.error("Failed to play track:",V),k("Failed to start playback")}},ae=[{key:" ",description:"Play/Pause",category:"Playback",handler:()=>{F(),k(C?"Paused":"Playing")}},{key:"ArrowRight",description:"Next track",category:"Playback",handler:()=>{O(),k("Next track")}},{key:"ArrowLeft",description:"Previous track",category:"Playback",handler:()=>{A(),k("Previous track")}},{key:"ArrowUp",description:"Volume up",category:"Playback",handler:()=>{const W=Math.min(I+10,100);R(W),k(`Volume: ${W}%`)}},{key:"ArrowDown",description:"Volume down",category:"Playback",handler:()=>{const W=Math.max(I-10,0);R(W),k(`Volume: ${W}%`)}},{key:"m",description:"Mute/Unmute",category:"Playback",handler:()=>{const W=I>0?0:80;R(W),k(W===0?"Muted":"Unmuted")}},{key:"1",description:"Show Songs",category:"Navigation",handler:()=>{y("songs"),k("Songs view")}},{key:"2",description:"Show Albums",category:"Navigation",handler:()=>{y("albums"),k("Albums view")}},{key:"3",description:"Show Artists",category:"Navigation",handler:()=>{y("artists"),k("Artists view")}},{key:"4",description:"Show Playlists",category:"Navigation",handler:()=>{y("playlists"),k("Playlists view")}},{key:"/",description:"Focus search",category:"Navigation",handler:()=>{const W=document.querySelector('input[placeholder*="Search"]');W&&(W.focus(),W.select())}},{key:"Escape",description:"Clear search / Close dialogs",category:"Navigation",handler:()=>{p?(h(""),k("Search cleared")):b&&x(!1)}},{key:"?",description:"Show keyboard shortcuts",category:"Global",handler:()=>{}},{key:",",ctrl:!0,description:"Open settings",category:"Global",handler:()=>{x(!0)}}],{shortcuts:K,isHelpOpen:Z,openHelp:T,closeHelp:N,formatShortcut:Q}=Tk(ae);g.useEffect(()=>{const W=ae.find(V=>V.key==="?");W&&(W.handler=T)},[T]);const ee=W=>{console.log("Mastering:",W?"enabled":"disabled"),k(W?" Mastering enabled":"Mastering disabled")},re=g.useCallback(W=>{y(W)},[]);return a.jsxs(P,{sx:{display:"flex",flexDirection:"column",width:"100vw",height:"100vh",overflow:"hidden"},children:[a.jsxs(Xw,{onDragEnd:U,children:[a.jsx(JC,{collapsed:n,onToggleCollapse:()=>l(!n),onNavigate:re,onOpenSettings:()=>x(!0),mobileDrawerOpen:o,onCloseMobileDrawer:()=>c(!1),isMobile:r}),a.jsxs(P,{sx:{display:"flex",flexDirection:"column",flex:1,overflow:"hidden"},children:[a.jsx(dk,{onSearch:h,onOpenMobileDrawer:()=>c(!0),title:"Your Music",connectionStatus:S?"connected":"connecting",isMobile:r,onSearchClear:()=>h("")}),a.jsx(uk,{children:a.jsx($c,{onTrackPlay:L,view:m})})]}),!t&&a.jsx(Sk,{useV2:!0,initiallyCollapsed:i,onToggleV2:()=>{},children:a.jsx(bc,{collapsed:i,onToggleCollapse:()=>d(!i),onMasteringToggle:ee})})]}),a.jsx(Sx,{open:b,onClose:()=>x(!1),onSettingsChange:W=>{console.log("Settings changed:",W),v("Settings saved successfully")}}),a.jsx(Mx,{open:Z,shortcuts:K,onClose:N,formatShortcut:Q}),a.jsx(P,{sx:{flexShrink:0},children:a.jsx(Pf,{})})]})}/**
 * usePlayerStateSync - Synchronize WebSocket player_state with Redux
 * ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
 *
 * This hook ensures that Redux playerSlice and queueSlice stay in sync with the authoritative
 * backend player state received via WebSocket.
 *
 * It subscribes to 'player_state' WebSocket messages and dispatches Redux actions
 * to keep both player and queue state up to date. This is the single synchronization point
 * between WebSocket broadcasts and Redux.
 *
 * State synchronized:
 * - Player: currentTrack, isPlaying, currentTime, duration, volume, isMuted, preset
 * - Queue: tracks, currentIndex (queue position)
 *
 * Architecture: Backend  WebSocket broadcast  This hook  Redux dispatch  UI
 *
 * @copyright (C) 2025 Auralis Team
 * @license GPLv3
 */function $k(){const e=ln(),{subscribe:t}=Ot();g.useEffect(()=>{if(!t){console.warn("[usePlayerStateSync] WebSocket context not available");return}const r=t("player_state",n=>{try{const o=n.data;if(o.current_track?e(Sr({id:o.current_track.id,title:o.current_track.title,artist:o.current_track.artist,album:o.current_track.album||"",duration:o.current_track.duration||0,coverUrl:o.current_track.album_art})):o.current_track===null&&e(Sr(null)),o.is_playing!==void 0&&e(Ln(o.is_playing)),o.current_time!==void 0&&e(Vl(o.current_time)),o.duration!==void 0&&e(lf(o.duration)),o.volume!==void 0&&e(Kl(o.volume)),o.is_muted!==void 0&&e(Yl(o.is_muted)),o.current_preset&&e(Xl(o.current_preset)),o.queue&&Array.isArray(o.queue)){const i=o.queue.map(l=>({id:l.id,title:l.title,artist:l.artist,album:l.album||"",duration:l.duration||0,coverUrl:l.album_art}));e(ec(i))}o.queue_index!==void 0&&e(tc(o.queue_index)),console.log("[usePlayerStateSync] Redux updated from WebSocket:",o)}catch(o){console.error("[usePlayerStateSync] Error processing player_state:",o)}});return()=>{r==null||r()}},[t,e])}/**
 * Redux Store Configuration
 * ~~~~~~~~~~~~~~~~~~~~~~~~
 *
 * Central store for application state management with slices for:
 * - Player state (playback, current track, volume)
 * - Queue state (tracks, current index)
 * - Cache state (stats, health)
 * - Connection state (WebSocket, API, latency)
 *
 * Phase C.3: Component Testing & Integration
 *
 * @copyright (C) 2024 Auralis Team
 * @license GPLv3, see LICENSE for more details
 */const Fk=Kh({reducer:{player:mf,queue:jf,cache:ay,connection:iy},middleware:e=>e({serializableCheck:{ignoredActions:["connection/setError","cache/setError"],ignoredPaths:["connection.lastError","cache.error"]}}),devTools:!1}),_k=new sp({defaultOptions:{queries:{staleTime:1e3*60*5,refetchOnWindowFocus:!1,retry:1}}});function Ok(){return $k(),null}function Bk(){return a.jsx(vp,{children:a.jsx(Jp,{maxToasts:3,children:a.jsxs(nh,{children:[a.jsx(Ok,{}),a.jsx(oh,{children:a.jsx(Mk,{})})]})})})}function Lk(){return a.jsx(ll,{store:Fk,children:a.jsx(ip,{client:_k,children:a.jsx(Bk,{})})})}const Sj=Object.freeze(Object.defineProperty({__proto__:null,default:Lk},Symbol.toStringTag,{value:"Module"}));export{Sj as A,le as g};
